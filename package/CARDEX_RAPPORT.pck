CREATE OR REPLACE PACKAGE CARDEX_RAPPORT is
  TYPE REC_DO_DOSSIER_RAPPORT IS RECORD(
    L_DO_CLE                DO_DOSSIER.L_DO_CLE%TYPE,
    SITE_DOSSIER            DO_DOSSIER.L_SI_CLE%TYPE,
    V_DO_NUMERO_DOSSIER     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    I_CA_CLE                DO_DOSSIER.I_CA_CLE%TYPE,
    SEVERITE_DOSSIER        DO_DOSSIER.I_SE_CLE%TYPE,
    CONFIDENTIALITE_DOSSIER DO_DOSSIER.I_CC_CLE%TYPE,
    I_NH_CLE                DO_DOSSIER.I_NH_CLE%TYPE,
    I_PE_CLE                DO_DOSSIER.I_PE_CLE%TYPE,
    STATUT_DOSSIER          DO_DOSSIER.I_ST_CLE%TYPE,
    V_DO_MOT_PASSE          DO_DOSSIER.V_DO_MOT_PASSE%TYPE,
    D_DO_DATE_DEBUT         DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    D_DO_DATE_FIN           DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_DO_DUREE              DO_DOSSIER.V_DO_DUREE%TYPE,
    V_DO_ANCIENNE_REFERENCE DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    V_DO_REFERENCE_VIDEO    DO_DOSSIER.V_DO_REFERENCE_VIDEO%TYPE,
    D_DO_DATE_RAPPORTEE     DO_DOSSIER.D_DO_DATE_RAPPORTEE%TYPE,
    I_DO_CLASSE             DO_DOSSIER.I_DO_CLASSE%TYPE,
    I_DO_RACE               DO_DOSSIER.I_DO_RACE%TYPE,
    V_DO_LIEU               DO_DOSSIER.V_DO_LIEU%TYPE,
    I_OR_CLE                DO_DOSSIER.I_OR_CLE%TYPE,
    I_CR_CLE                DO_DOSSIER.I_CR_CLE%TYPE,
    V_DO_REFERENCE1         DO_DOSSIER.V_DO_REFERENCE1%TYPE,
    V_DO_REFERENCE2         DO_DOSSIER.V_DO_REFERENCE2%TYPE,
    V_DO_ASSIGNE_A          DO_DOSSIER.V_DO_ASSIGNE_A%TYPE,
    D_DO_DATE_ASSIGNATION   DO_DOSSIER.D_DO_DATE_ASSIGNATION%TYPE,
    D_DO_DATE_EVENEMENT     DO_DOSSIER.D_DO_DATE_EVENEMENT%TYPE,
    V_DO_CREE_PAR           DO_DOSSIER.V_DO_CREE_PAR%TYPE,
    D_DO_DATE_CREATION      DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
    I_TY_CLE                TY_TYPE.I_TY_CLE%TYPE,
    I_NA_CLE                NA_NATURE.I_NA_CLE%TYPE,
    I_GE_CLE                GE_GENRE.I_GE_CLE%TYPE,
    I_GE_ENTITE             GE_GENRE.I_GE_ENTITE%TYPE,
    V_DO_REFERENCE3         DO_DOSSIER.V_DO_REFERENCE3%TYPE,
    V_DO_REFERENCE4         DO_DOSSIER.V_DO_REFERENCE4%TYPE,
    V_DO_REFERENCE5         DO_DOSSIER.V_DO_REFERENCE5%TYPE,
    C_DO_FONDE              DO_DOSSIER.C_DO_FONDE%TYPE,
    V_DO_REFERENCE6         DO_DOSSIER.V_DO_REFERENCE6%TYPE,
    V_DO_REFERENCE7         DO_DOSSIER.V_DO_REFERENCE7%TYPE,
    I_DO_FONDE              DO_DOSSIER.I_DO_FONDE%TYPE,
    I_RF_CLE                RF_REFERENCE_VIDEO.I_RF_CLE%TYPE,
    L_SU_CLE                SU_SUJET.L_SU_CLE%TYPE,
    SITE_SUJET              SU_SUJET.L_SI_CLE%TYPE,
    I_SX_CLE                SU_SUJET.I_SX_CLE%TYPE,
    STATUT_SUJET            SU_SUJET.I_ST_CLE%TYPE,
    I_NT_CLE                SU_SUJET.I_NT_CLE%TYPE,
    I_RA_CLE                SU_SUJET.I_RA_CLE%TYPE,
    I_LS_CLE                SU_SUJET.I_LS_CLE%TYPE,
    V_SU_NOM                SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM             SU_SUJET.V_SU_PRENOM%TYPE,
    V_SU_SURNOM             SU_SUJET.V_SU_SURNOM%TYPE,
    D_SU_DATE_NAISSANCE     SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
    B_SU_AGE_ESTIME         SU_SUJET.B_SU_AGE_ESTIME%TYPE,
    C_SU_ASSURANCE_SOCIALE  SU_SUJET.C_SU_ASSURANCE_SOCIALE%TYPE,
    V_SU_PERMIS_CONDUIRE    SU_SUJET.V_SU_PERMIS_CONDUIRE%TYPE,
    V_SU_GRANDEUR_METRIQUE  SU_SUJET.V_SU_GRANDEUR_METRIQUE%TYPE,
    V_SU_GRANDEUR_IMPERIAL  SU_SUJET.V_SU_GRANDEUR_IMPERIAL%TYPE,
    V_SU_POIDS_METRIQUE     SU_SUJET.V_SU_POIDS_METRIQUE%TYPE,
    V_SU_POIDS_IMPERIAL     SU_SUJET.V_SU_POIDS_IMPERIAL%TYPE,
    C_SU_SYSTEME            SU_SUJET.C_SU_SYSTEME%TYPE,
    CONDIFENTIALITE_SUJET   SU_SUJET.I_CC_CLE%TYPE,
    V_SU_MOT_PASSE          SU_SUJET.V_SU_MOT_PASSE%TYPE,
    V_SU_REFERENCE_1        SU_SUJET.V_SU_REFERENCE_1%TYPE,
    V_SU_REFERENCE_2        SU_SUJET.V_SU_REFERENCE_2%TYPE,
    V_SU_REFERENCE_3        SU_SUJET.V_SU_REFERENCE_3%TYPE,
    V_SU_CREE_PAR           SU_SUJET.V_SU_CREE_PAR%TYPE,
    D_SU_DATE_CREATION      SU_SUJET.D_SU_DATE_CREATION%TYPE,
    C_SU_SNDX_NOM           SU_SUJET.C_SU_SNDX_NOM%TYPE,
    C_SU_SNDX_PRENOM        SU_SUJET.C_SU_SNDX_PRENOM%TYPE,
    C_SU_SNDX_SURNOM        SU_SUJET.C_SU_SNDX_SURNOM%TYPE,
    SEVERITE_SUJET          SE_SEVERITE.I_SE_CLE%TYPE,
    V_SU_NO_PASSEPORT       SU_SUJET.V_SU_NO_PASSEPORT%TYPE,
    I_EN_CLE                SI_SITE.I_EN_CLE%TYPE,
    V_SU_ASSURANCE_MALADIE  SU_SUJET.V_SU_ASSURANCE_MALADIE%TYPE);
  TYPE DTS_DO_DOSSIER_RAPPORT IS REF CURSOR RETURN REC_DO_DOSSIER_RAPPORT;
  TYPE REC_RAPPORT_REPERAGE IS RECORD(
    V_DO_ANCIENNE_REFERENCE DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    V_DO_NUMERO_DOSSIER     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    D_DO_DATE_DEBUT         DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    D_DO_DATE_FIN           DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_SU_NOM                SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM             SU_SUJET.V_SU_PRENOM%TYPE,
    L_SU_CLE                SU_SUJET.L_SU_CLE%TYPE,
    L_SI_CLE                SU_SUJET.L_SI_CLE%TYPE,
    V_SU_REFERENCE_3        SU_SUJET.V_SU_REFERENCE_3%TYPE,
    TOTAL                   DO_DOSSIER.L_DO_CLE%TYPE);

  TYPE DTS_RAPPORT_REPERAGE IS REF CURSOR RETURN REC_RAPPORT_REPERAGE;
  PROCEDURE SP_RAP_REPERAGE_AU_TRI_NOMBRE(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          NEW_L_SI_CLE    IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          nombreReperages NUMBER,
                                          rc1             IN OUT DTS_RAPPORT_REPERAGE);
  PROCEDURE SP_RAP_REPERAGE_AU_TRI_NUMERO(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          NEW_L_SI_CLE    IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          nombreReperages NUMBER,
                                          rc1             IN OUT DTS_RAPPORT_REPERAGE);
  PROCEDURE SP_RAP_REP_ACCES_INTERDITS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       rc1            IN OUT DTS_RAPPORT_REPERAGE);
  PROCEDURE SP_RAP_REP_AI_TRI_NOMBRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                     NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                     NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                     rc1            IN OUT DTS_RAPPORT_REPERAGE);
  PROCEDURE SP_RAP_REPERAGE_AVIS_GUET(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_REPERAGE);

  TYPE REC_IMPRESSION_SUJET IS RECORD(
    V_SU_REFERENCE_3       SU_SUJET.V_SU_REFERENCE_3%TYPE,
    V_SU_NOM               SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM            SU_SUJET.V_SU_PRENOM%TYPE,
    V_SU_SURNOM            SU_SUJET.V_SU_SURNOM%TYPE,
    sexe                   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    ethnie                 TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    race                   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    langue                 TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    D_SU_DATE_NAISSANCE    SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
    L_SU_CLE               SU_SUJET.L_SU_CLE%TYPE,
    L_SI_CLE               SU_SUJET.L_SI_CLE%TYPE,
    V_SU_PERMIS_CONDUIRE   SU_SUJET.V_SU_PERMIS_CONDUIRE%TYPE,
    V_SU_NO_PASSEPORT      SU_SUJET.V_SU_NO_PASSEPORT%TYPE,
    C_SU_ASSURANCE_SOCIALE SU_SUJET.C_SU_ASSURANCE_SOCIALE%TYPE);
  TYPE DTS_IMPRESSION_SUJET IS REF CURSOR RETURN REC_IMPRESSION_SUJET;
  PROCEDURE SP_IMPRESSION_SUJET(NEW_L_SU_CLE IN SU_SUJET.L_SU_CLE%TYPE,
                                NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SUJET);
  PROCEDURE SP_RAP_SU_EPURATION(NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SUJET);

  TYPE REC_IMPRESSION_SOCIETE IS RECORD(
    V_SO_REFERENCE_NOM       SO_SOCIETE.V_SO_REFERENCE_NOM%TYPE,
    V_SO_REFERENCE_PRENOM    SO_SOCIETE.V_SO_REFERENCE_PRENOM%TYPE,
    V_SO_NOM                 SO_SOCIETE.V_SO_NOM%TYPE,
    statut                   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    classe                   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    V_SO_REFERENCE_1         SO_SOCIETE.V_SO_REFERENCE_1%TYPE,
    V_SO_REFERENCE_2         SO_SOCIETE.V_SO_REFERENCE_2%TYPE,
    V_SO_REFERENCE_4         SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
    V_SO_RAISON_SOCIALE      SO_SOCIETE.V_SO_RAISON_SOCIALE%TYPE,
    L_SO_CLE                 SO_SOCIETE.L_SO_CLE%TYPE,
    L_SI_CLE                 SO_SOCIETE.L_SI_CLE%TYPE,
    L_SO_CENTRE_REGIONAL     SO_SOCIETE.L_SO_CENTRE_REGIONAL%TYPE,
    V_SO_DISTRICT            SO_SOCIETE.V_SO_DISTRICT%TYPE,
    V_SO_CODE_COMPTE         SO_SOCIETE.V_SO_CODE_COMPTE%TYPE,
    B_SO_ACTIF               SO_SOCIETE.B_SO_ACTIF%TYPE,
    D_SO_DATE_INACTIVATION   SO_SOCIETE.D_SO_DATE_INACTIVATION%TYPE,
    B_SO_IND_RDD             SO_SOCIETE.B_SO_IND_RDD%TYPE,
    V_SO_COMMENTAIRE         SO_SOCIETE.V_SO_COMMENTAIRE%TYPE,
    V_SO_RAISON_INACTIVATION SO_SOCIETE.V_SO_RAISON_INACTIVATION%TYPE);
  TYPE DTS_IMPRESSION_SOCIETE IS REF CURSOR RETURN REC_IMPRESSION_SOCIETE;
  PROCEDURE SP_IMPRESSION_SOCIETE(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                                  NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                                  rc1          IN OUT DTS_IMPRESSION_SOCIETE);
  PROCEDURE SP_RAP_SO_EPURATION(NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SOCIETE);

  TYPE REC_IMPRESSION_DOSSIER IS RECORD(
    V_DO_ANCIENNE_REFERENCE       DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    V_DO_NUMERO_DOSSIER           DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    nature                        TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    type                          TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    categorie                     TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    statut                        TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    severite                      TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    endroit                       TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    localisation                  TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    V_DO_REFERENCE_VIDEO          DO_DOSSIER.V_DO_REFERENCE_VIDEO%TYPE,
    B_DO_ENREGISTREMENT_CONSERVE  DO_DOSSIER.B_DO_ENREGISTREMENT_CONSERVE%TYPE,
    B_DO_ENREGISTREMENT_NUMERIQUE DO_DOSSIER.B_DO_ENREGISTREMENT_NUMERIQUE%TYPE,
    D_DO_DATE_DEBUT               DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    D_DO_DATE_FIN                 DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_DO_REFERENCE1               DO_DOSSIER.V_DO_REFERENCE1%TYPE,
    V_DO_REFERENCE3               DO_DOSSIER.V_DO_REFERENCE3%TYPE,
    V_DO_REFERENCE5               DO_DOSSIER.V_DO_REFERENCE5%TYPE,
    DESCRIPTION                   IN_INTERVENANT.V_IN_NOM%TYPE,
    V_SI_SITE                     SI_SITE.V_SI_SITE%TYPE,
    V_DO_LIEU                     DO_DOSSIER.V_DO_LIEU%TYPE,
    ORIGINE                       TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    L_DO_CLE                      DO_DOSSIER.L_DO_CLE%TYPE,
    L_SI_CLE                      DO_DOSSIER.L_SI_CLE%TYPE);
  TYPE DTS_IMPRESSION_DOSSIER IS REF CURSOR RETURN REC_IMPRESSION_DOSSIER;
  PROCEDURE SP_IMPRESSION_DOSSIER(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                                  NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                  rc1          IN OUT DTS_IMPRESSION_DOSSIER);

  TYPE REC_RAP_ACTIVITES IS RECORD(
    V_EN_COMMENTAIRE     EN_ENTITE.V_EN_COMMENTAIRE%TYPE,
    V_SI_SITE            SI_SITE.V_SI_SITE%TYPE,
    D_DO_DATE_DEBUT      DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    V_DO_NUMERO_DOSSIER  DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    CLOB_CO_TEXTE_FORMAT CO_COMMENTAIRE2.CLOB_CO_TEXTE_FORMAT%TYPE,
    INTERVENANT          IN_INTERVENANT.V_IN_NOM%TYPE,
    GROUPE               TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    NATURE               TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_RAP_ACTIVITES IS REF CURSOR RETURN REC_RAP_ACTIVITES;
  PROCEDURE SP_GABARIT_NARRATION(NEW_DATE_DEBUT    IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                                 NEW_DATE_FIN      IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                                 NEW_L_SI_CLE      IN CO_COMMENTAIRE2.L_SI_CLE%TYPE,
                                 NEW_L_CO_GABARIT  IN CO_COMMENTAIRE2.L_CO_GABARIT%TYPE,
                                 rc1               IN OUT DTS_RAP_ACTIVITES);

  PROCEDURE SP_RAQ_NATURE(NEW_DATE_DEBUT IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                          NEW_DATE_FIN   IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                          NEW_I_NA_CLE   IN NA_NATURE.I_NA_CLE%TYPE,
                          rc1            IN OUT DTS_RAP_ACTIVITES);

  PROCEDURE SP_RAQ_SANS_NATURE(NEW_DATE_DEBUT IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                               NEW_DATE_FIN   IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                               NEW_I_NA_CLE   IN NA_NATURE.I_NA_CLE%TYPE,
                               rc1            IN OUT DTS_RAP_ACTIVITES);

  TYPE REC_RAPPORT_STATUT_DOSSIERS IS RECORD(
    I_CA_CLE           CA_CATEGORIE.I_CA_CLE%TYPE,
    I_NA_CLE           NA_NATURE.I_NA_CLE%TYPE,
    nature_description TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    categorie          TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_RAPPORT_STATUT_DOSSIERS IS REF CURSOR RETURN REC_RAPPORT_STATUT_DOSSIERS;
  PROCEDURE SP_RAP_STATUT_DOSSIERS(NEW_I_NA_CLE NA_NATURE.I_NA_CLE%TYPE,
                                   rc1          IN OUT DTS_RAPPORT_STATUT_DOSSIERS);

  TYPE REC_RAPPORT_JOURNAL IS RECORD(
    categorie TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_RAPPORT_JOURNAL IS REF CURSOR RETURN REC_RAPPORT_JOURNAL;
  PROCEDURE SP_RAP_JOURNAL_ENQUETES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                    NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                    NEW_I_NA_CLE   NA_NATURE.I_NA_CLE%TYPE,
                                    rc1            IN OUT DTS_RAPPORT_JOURNAL);

  TYPE REC_MENSUEL_AUTOEXCLUSIONS IS RECORD(
    V_SI_SITE           SI_SITE.V_SI_SITE%TYPE,
    contrats            TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    B_IS_AIDE_INITIALE  IS_INSCRIPTION.B_IS_AIDE_INITIALE%TYPE,
    B_IS_AIDE_IMMEDIATE IS_INSCRIPTION.B_IS_AIDE_IMMEDIATE%TYPE);
  TYPE DTS_MENSUEL_AUTOEXCLUSIONS IS REF CURSOR RETURN REC_MENSUEL_AUTOEXCLUSIONS;
  PROCEDURE SP_RAP_MENSUEL_AUTOEXCLUSIONS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          NEW_I_CA_CLE   IN DO_DOSSIER.I_CA_CLE%TYPE,
                                          rc1            IN OUT DTS_MENSUEL_AUTOEXCLUSIONS);

  TYPE REC_CUMUL_ANNUEL IS RECORD(
    nature TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    total  DO_DOSSIER.L_DO_CLE%TYPE);
  TYPE DTS_CUMUL_ANNUEL IS REF CURSOR RETURN REC_CUMUL_ANNUEL;
  PROCEDURE SP_RAP_CUMUL_ANNUEL(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                rc1            IN OUT DTS_CUMUL_ANNUEL);

  TYPE REC_CUMUL_HEBDO IS RECORD(
    I_NA_CLE NA_NATURE.I_NA_CLE%TYPE,
    nature   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    total    DO_DOSSIER.L_DO_CLE%TYPE);
  TYPE DTS_CUMUL_HEBDO IS REF CURSOR RETURN REC_CUMUL_HEBDO;
  PROCEDURE SP_RAP_CUMUL_HEBDO(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                               NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                               NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                               rc1            IN OUT DTS_CUMUL_HEBDO);

  TYPE REC_RAPPORT_PAR IS RECORD(
    type_par VARCHAR2(30),
    total    DO_DOSSIER.L_DO_CLE%TYPE);
  TYPE DTS_RAPPORT_PAR IS REF CURSOR RETURN REC_RAPPORT_PAR;
  PROCEDURE SP_RAPPORT_PAR(NEW_ANNEE_MOIS IN VARCHAR2,
                           rc1            IN OUT DTS_RAPPORT_PAR);

  TYPE REC_LISTES_PARTAGE IS RECORD(
    V_DO_NUMERO_DOSSIER     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    V_DO_ANCIENNE_REFERENCE DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    INTERVENANT_DOSSIER     IN_INTERVENANT.V_IN_NOM%TYPE,
    V_EN_COMMENTAIRE        EN_ENTITE.V_EN_COMMENTAIRE%TYPE,
    V_SI_SITE               SI_SITE.V_SI_SITE%TYPE,
    GENRE                   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    NATURE                  TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    TYPE                    TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    CATEGORIE               TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    STATUT                  TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    SECTEUR                 TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    INTERVENANT_AUTORISE    IN_INTERVENANT.V_IN_NOM%TYPE,
    INTERVENANT_RESPONSABLE IN_INTERVENANT.V_IN_NOM%TYPE,
    D_LPD_DATE_CREATION     LPD_PARTAGE_DOSSIER.D_LPD_DATE_CREATION%TYPE);
  TYPE DTS_LISTES_PARTAGE IS REF CURSOR RETURN REC_LISTES_PARTAGE;
  PROCEDURE SP_LISTES_PARTAGE(rc1 IN OUT DTS_LISTES_PARTAGE);

  TYPE REC_SUIVIS IS RECORD(
    DEMANDEUR            IN_INTERVENANT.V_IN_NOM%TYPE,
    INTERVENANT          IN_INTERVENANT.V_IN_NOM%TYPE,
    V_DO_NUMERO_DOSSIER  DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    D_DO_DATE_DEBUT      DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    ECART_DEBUT_PREVU    VARCHAR2(12),
    D_SV_DATE_PREVUE     SV_SUIVI.D_SV_DATE_PREVUE%TYPE,
    D_SV_DATE_COMPLETEE  SV_SUIVI.D_SV_DATE_COMPLETEE%TYPE,
    ECART_COMPLETE_PREVU VARCHAR2(12));
  TYPE DTS_SUIVIS IS REF CURSOR RETURN REC_SUIVIS;
  PROCEDURE SP_RAP_SUIVI_30_JOURS(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                 NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                 NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                 NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                 NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                  rc1                  IN OUT DTS_SUIVIS);
  PROCEDURE SP_RAP_30_JOURS_INTERVENANT(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                 NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                 NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                 NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                 NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                        rc1                  IN OUT DTS_SUIVIS);
  PROCEDURE SP_RAP_SUIVI_21_JOURS(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                 NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                 NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                 NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                 NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                  rc1                  IN OUT DTS_SUIVIS);
  PROCEDURE SP_RAP_SUIVI_24_HEURES(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                 NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                 NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                 NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                 NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                   rc1                  IN OUT DTS_SUIVIS);
  TYPE REC_SUIVIS_INVESTIGATION IS RECORD(
    V_SI_SITE               SI_SITE.V_SI_SITE%TYPE,
    V_DO_NUMERO_DOSSIER     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    V_DO_ANCIENNE_REFERENCE DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    INDIVIDU                VARCHAR(65),
    SUIVI                   VARCHAR(4),
    D_SV_DATE_PREVUE        SV_SUIVI.D_SV_DATE_PREVUE%TYPE,
    D_SV_DATE_COMPLETEE     SV_SUIVI.D_SV_DATE_COMPLETEE%TYPE,
    ECART_COMPLETE_PREVU    VARCHAR2(20));
  TYPE DTS_SUIVIS_INVESTIGATION IS REF CURSOR RETURN REC_SUIVIS_INVESTIGATION;
  PROCEDURE SP_RAP_SUIVI_INVESTIGATION(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                       NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                       rc1                  IN OUT DTS_SUIVIS_INVESTIGATION);
  TYPE REC_SUIVIS_RETARDS IS RECORD(
    V_SI_SITE               SI_SITE.V_SI_SITE%TYPE,
    V_DO_NUMERO_DOSSIER     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    V_DO_ANCIENNE_REFERENCE DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    INDIVIDU                VARCHAR(65),
    SUIVI                   VARCHAR(4),
    D_SV_DATE_PREVUE        SV_SUIVI.D_SV_DATE_PREVUE%TYPE,
    D_SV_DATE_COMPLETEE     SV_SUIVI.D_SV_DATE_COMPLETEE%TYPE,
    ECART_COMPLETE_PREVU    VARCHAR2(20),
    MOYENNE                 NUMBER(8, 2));
  TYPE DTS_SUIVIS_RETARDS IS REF CURSOR RETURN REC_SUIVIS_RETARDS;
  PROCEDURE SP_RAP_SUIVI_RETARDS(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                 NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                 NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                 NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                 NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                 rc1                  IN OUT DTS_SUIVIS_RETARDS);

  TYPE REC_ACCES IS RECORD(
    V_AC_NAME           AC_ACCES.V_AC_NAME%TYPE,
    DESCRIPTION         IN_INTERVENANT.V_IN_NOM%TYPE,
    V_TA_TYPE_ACCES     TA_TYPE_ACCES.V_TA_TYPE_ACCES%TYPE,
    V_DO_NUMERO_DOSSIER DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE);
  TYPE DTS_ACCES IS REF CURSOR RETURN REC_ACCES;
  PROCEDURE SP_RAPPORT_ACCES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                             NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                             NEW_L_SI_CLE   IN SI_SITE.L_SI_CLE%TYPE,
                             rc1            IN OUT DTS_ACCES);

  TYPE REC_ACCES_INTERVENANT IS RECORD(
    V_AC_NAME          AC_ACCES.V_AC_NAME%TYPE,
    DESCRIPTION        IN_INTERVENANT.V_IN_NOM%TYPE,
    V_TA_TYPE_ACCES    TA_TYPE_ACCES.V_TA_TYPE_ACCES%TYPE,
    V_GF_GENRE_FICHIER GF_GENRE_FICHIER.V_GF_GENRE_FICHIER%TYPE);
  TYPE DTS_ACCES_INTERVENANT IS REF CURSOR RETURN REC_ACCES_INTERVENANT;
  PROCEDURE SP_RAPPORT_ACCES_INTERVENANT(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                         NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                         NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                         rc1             IN OUT DTS_ACCES_INTERVENANT);
  PROCEDURE SP_RAP_ACCES_INTERVENANT_CREES(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                           NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                           NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                           rc1             IN OUT DTS_ACCES_INTERVENANT);
  PROCEDURE SP_RAP_ACCES_SUPERUTILISATEURS(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                           NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                           NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                           rc1             IN OUT DTS_ACCES_INTERVENANT);

  TYPE REC_DETAIL_ACCES IS RECORD(
    TYPE        VARCHAR2(50),
    CODE        IN_INTERVENANT.NAME%TYPE,
    INTERVENANT IN_INTERVENANT.V_IN_NOM%TYPE,
    FICHE       VARCHAR2(100),
    ACCES       TA_TYPE_ACCES.V_TA_TYPE_ACCES%TYPE,
    DATE_ACCES  AC_ACCES.D_AC_DATE_ACCES%TYPE);
  TYPE DTS_DETAIL_ACCES IS REF CURSOR RETURN REC_DETAIL_ACCES;
  PROCEDURE SP_RAPPORT_DETAIL_ACCES(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                    NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                    NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                    NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                    rc1             IN OUT DTS_DETAIL_ACCES);

  TYPE REC_RAPPORT_RENCONTRES IS RECORD(
    V_SI_SITE          SI_SITE.V_SI_SITE%TYPE,
    RENCONTRE_INITIALE IS_INSCRIPTION.L_IS_CLE%TYPE);
  TYPE DTS_RAPPORT_RENCONTRES IS REF CURSOR RETURN REC_RAPPORT_RENCONTRES;
  PROCEDURE SP_RAPPORT_RENCONTRES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                  NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                  rc1            IN OUT DTS_RAPPORT_RENCONTRES);

  TYPE REC_RAPPORT_RENCONTRES_FINALES IS RECORD(
    V_SI_SITE        SI_SITE.V_SI_SITE%TYPE,
    RENCONTRE_FINALE IS_INSCRIPTION.L_IS_CLE%TYPE);
  TYPE DTS_RAPPORT_RENCONTRES_FINALES IS REF CURSOR RETURN REC_RAPPORT_RENCONTRES_FINALES;
  PROCEDURE SP_RAPPORT_RENCONTRES_FINALES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          rc1            IN OUT DTS_RAPPORT_RENCONTRES_FINALES);

  TYPE REC_RAPPORT_RENCONTRES_DETAIL IS RECORD(
    V_SI_SITE           SI_SITE.V_SI_SITE%TYPE,
    V_DO_NUMERO_DOSSIER DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    RENCONTRE_INITIALE  IS_INSCRIPTION.D_IS_RENCONTRE_INITIALE%TYPE);
  TYPE DTS_RAPPORT_RENCONTRES_DETAIL IS REF CURSOR RETURN REC_RAPPORT_RENCONTRES_DETAIL;
  PROCEDURE SP_RAPPORT_RENCONTRES_DETAIL(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                         rc1            IN OUT DTS_RAPPORT_RENCONTRES_DETAIL);

  TYPE REC_RAP_RENC_FINALES_DETAIL IS RECORD(
    V_SI_SITE           SI_SITE.V_SI_SITE%TYPE,
    V_DO_NUMERO_DOSSIER DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    RENCONTRE_FINALE    IS_INSCRIPTION.D_IS_RENCONTRE_FINALE%TYPE);
  TYPE DTS_RAP_RENC_FINALES_DETAIL IS REF CURSOR RETURN REC_RAP_RENC_FINALES_DETAIL;
  PROCEDURE SP_MENSUEL_RENC_FINALES_DETAIL(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                           rc1            IN OUT DTS_RAP_RENC_FINALES_DETAIL);

  TYPE REC_DOSSIERS_ACTIFS IS RECORD(
    INTERVENANT IN_INTERVENANT.V_IN_NOM%TYPE,
    NATURE      TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    GENRE       TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    TOTAL       DO_DOSSIER.L_DO_CLE%TYPE);
  TYPE DTS_DOSSIERS_ACTIFS IS REF CURSOR RETURN REC_DOSSIERS_ACTIFS;
  PROCEDURE SP_RAP_DOSSIERS_ACTIFS(NEW_GENRE       IN GE_GENRE.I_GE_CLE%TYPE,
                                   NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                   NEW_L_SI_CLE    IN DO_DOSSIER.L_SI_CLE%TYPE,
                                   rc1             IN OUT DTS_DOSSIERS_ACTIFS);
  PROCEDURE SP_RAP_DOSSIERS_ACTIFS_ENQ_LQ(rc1 IN OUT DTS_DOSSIERS_ACTIFS);

  TYPE REC_REGISTRE_RFC_MAITRE IS RECORD(
    V_SU_NOM            SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM         SU_SUJET.V_SU_PRENOM%TYPE,
    SEXE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    V_DO_NUMERO_DOSSIER DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    V_DO_REFERENCE1     DO_DOSSIER.V_DO_REFERENCE1%TYPE);
  TYPE DTS_REGISTRE_RFC_MAITRE IS REF CURSOR RETURN REC_REGISTRE_RFC_MAITRE;
  PROCEDURE SP_RAP_REGISTRE_RFC_MAITRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       rc1            IN OUT DTS_REGISTRE_RFC_MAITRE);

  TYPE REC_RAP_COHERENCE IS RECORD(
    TYPE_COHERENCE VARCHAR(1000),
    DESCRIPTION    VARCHAR(1000));
  TYPE DTS_RAP_COHERENCE IS REF CURSOR RETURN REC_RAP_COHERENCE;
  PROCEDURE SP_RAP_COHERENCE(rc1 IN OUT DTS_RAP_COHERENCE);

  TYPE REC_DO_EPURATION IS RECORD(
    nature       TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    noDossier    DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    noCardex     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    type         TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    categorie    TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    statut       TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    severite     TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    noSequentiel DO_DOSSIER.V_DO_REFERENCE_VIDEO%TYPE,
    enrConserve  DO_DOSSIER.b_do_enregistrement_conserve%TYPE,
    enrNumerique DO_DOSSIER.b_do_enregistrement_NUMERIQUE%TYPE,
    dateDebut    DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    dateFin      DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    reference1   DO_DOSSIER.V_DO_REFERENCE1%TYPE,
    reference2   DO_DOSSIER.V_DO_REFERENCE2%TYPE,
    reference3   DO_DOSSIER.V_DO_REFERENCE3%TYPE,
    intervenant  IN_INTERVENANT.V_IN_NOM%TYPE,
    site         SI_SITE.v_si_site%TYPE,
    endroit      TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    localisation TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    lieu         DO_DOSSIER.V_DO_LIEU%TYPE,
    origine      DO_DOSSIER.v_do_reference2%TYPE,
    siteCle      DO_DOSSIER.L_SI_CLE%TYPE,
    dossierCle   DO_DOSSIER.L_DO_CLE%TYPE);
  TYPE DTS_DO_EPURATION IS REF CURSOR RETURN REC_DO_EPURATION;
  PROCEDURE SP_RAP_DO_EPURATION(NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_DO_EPURATION);
  PROCEDURE SP_RAP_DO_VIGILANCE_DETAILLE(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                                         NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                         rc1          IN OUT DTS_DO_EPURATION);
  PROCEDURE SP_RAP_DO_VIGILANCE_SOMMAIRE(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                                         NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                         rc1          IN OUT DTS_DO_EPURATION);

  TYPE REC_VE_VEHICULE IS RECORD(
    L_VE_CLE                 VE_VEHICULE.L_VE_CLE%TYPE,
    L_SI_CLE                 VE_VEHICULE.L_SI_CLE%TYPE,
    V_VE_IMMATRICULATION     VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
    V_VE_PROVINCE            VE_VEHICULE.V_VE_PROVINCE%TYPE,
    C_VE_ANNEE               VE_VEHICULE.C_VE_ANNEE%TYPE,
    V_VE_VIGNETTE            VE_VEHICULE.V_VE_VIGNETTE%TYPE,
    V_VE_NUMERO_SERIE        VE_VEHICULE.V_VE_NUMERO_SERIE%TYPE,
    V_VE_ASSUREUR            VE_VEHICULE.V_VE_ASSUREUR%TYPE,
    V_VE_POLICE              VE_VEHICULE.V_VE_POLICE%TYPE,
    D_VE_EXPIRATION_VIGNETTE VE_VEHICULE.D_VE_EXPIRATION_VIGNETTE%TYPE,
    D_VE_EXPIRATION_POLICE   VE_VEHICULE.D_VE_EXPIRATION_POLICE%TYPE,
    MODELE                   MD_MODELE.V_MD_MODELE%TYPE,
    MARQUE                   MA_MARQUE.V_MA_MARQUE%TYPE,
    PROVINCE                 TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    V_VE_COMMENTAIRE         VE_VEHICULE.V_VE_COMMENTAIRE%TYPE);
  TYPE DTS_VE_VEHICULE IS REF CURSOR RETURN REC_VE_VEHICULE;
  PROCEDURE SP_RAP_VE_EPURATION(NEW_L_SI_CLE IN VE_VEHICULE.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_VE_VEHICULE);

  TYPE REC_TEMPS_CONSACRE IS RECORD(
    SECTEUR           TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    INTERVENANT       IN_INTERVENANT.V_IN_NOM%TYPE,
    NATURE            TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    TYPE              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    CATEGORIE         TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    NUMERO_CARDEX     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    FONDE             VARCHAR2(20),
    NON_FONDE         VARCHAR2(20),
    INDETERMINE       VARCHAR2(20),
    TOTAL_FONDE       NUMBER,
    TOTAL_NON_FONDE   NUMBER,
    TOTAL_INDETERMINE NUMBER);
  TYPE DTS_TEMPS_CONSACRE IS REF CURSOR RETURN REC_TEMPS_CONSACRE;
  PROCEDURE SP_TEMPS_CONSACRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                              NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                              NEW_SITE       IN VARCHAR2,
                              NEW_I_GE_CLE   IN GE_GENRE.I_GE_CLE%TYPE,
                              rc1            IN OUT DTS_TEMPS_CONSACRE);

  TYPE REC_CUMMULATIF_HEBDOMADAIRE IS RECORD(
    CLE_CATEGORIE CA_CATEGORIE.I_CA_CLE%TYPE,
    TYPE          TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    CATEGORIE     TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    NUMERO_CARDEX NUMBER);
  TYPE DTS_CUMMULATIF_HEBDOMADAIRE IS REF CURSOR RETURN REC_CUMMULATIF_HEBDOMADAIRE;
  PROCEDURE SP_RAP_CUMMULATIF_HEBDOMADAIRE(NEW_L_SI_CLE        IN SI_SITE.L_SI_CLE%TYPE,
                                           NEW_I_GE_CLE        IN GE_GENRE.I_GE_CLE%TYPE,
                                           NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           rc1                 OUT DTS_CUMMULATIF_HEBDOMADAIRE);

  PROCEDURE SP_RAP_CUMMULATIF_HEBDO_EJ(NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       rc1                 OUT DTS_CUMMULATIF_HEBDOMADAIRE);

  PROCEDURE SP_RAP_NOMBRE_FONDE(NEW_L_SI_CLE        IN SI_SITE.L_SI_CLE%TYPE,
                                NEW_I_CA_CLE        IN CA_CATEGORIE.I_CA_CLE%TYPE,
                                NEW_I_DO_FONDE      IN DO_DOSSIER.I_DO_FONDE%TYPE,
                                NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                NOMBRE_FONDE        OUT NUMBER);

  PROCEDURE SP_RAP_NOMBRE_ENQUETES(NEW_L_SI_CLE        IN SI_SITE.L_SI_CLE%TYPE,
                                   NEW_I_CA_CLE        IN CA_CATEGORIE.I_CA_CLE%TYPE,
                                   NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                   NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                   NOMBRE_ENQUETES     OUT NUMBER);

  PROCEDURE SP_RAP_NOMBRE_DOSSIER_ANNUEL(NEW_L_SI_CLE          IN SI_SITE.L_SI_CLE%TYPE,
                                         NEW_I_CA_CLE          IN CA_CATEGORIE.I_CA_CLE%TYPE,
                                         NEW_D_DO_DATE_DEBUT   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NEW_D_DO_DATE_FIN     IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NOMBRE_DOSSIER_ANNUEL OUT NUMBER);

  TYPE REC_IMPRESSION_INSCRIPTION IS RECORD(
    ENTITE              EN_ENTITE.V_EN_ENTITE%TYPE,
    SITE                SI_SITE.V_SI_SITE%TYPE,
    NUMERO_CARDEX       DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    NUMERO_DOSSIER      DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    DUREE               IS_INSCRIPTION.V_IS_DUREE%TYPE,
    PERIODE             TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    STATUT              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    INTERVENANT_INITIAL IN_INTERVENANT.V_IN_NOM%TYPE,
    INTERVENANT_FINAL   IN_INTERVENANT.V_IN_NOM%TYPE,
    DATE_DEBUT          IS_INSCRIPTION.D_IS_DATE_DEBUT%TYPE,
    DATE_FIN            IS_INSCRIPTION.D_IS_DATE_FIN%TYPE,
    RENCONTRE_INITIALE  IS_INSCRIPTION.D_IS_RENCONTRE_INITIALE%TYPE,
    RENCONTRE_FINALE    IS_INSCRIPTION.D_IS_RENCONTRE_FINALE%TYPE,
    DATE_INSCRIPTION    IS_INSCRIPTION.D_IS_DATE_CREATION%TYPE,
    AIDE_INITIALE       IS_INSCRIPTION.B_IS_AIDE_INITIALE%TYPE,
    AIDE_IMMEDIATE      IS_INSCRIPTION.B_IS_AIDE_IMMEDIATE%TYPE);
  TYPE DTS_IMPRESSION_INSCRIPTION IS REF CURSOR RETURN REC_IMPRESSION_INSCRIPTION;
  PROCEDURE SP_IMPRESSION_INSCRIPTION(NEW_L_IS_CLE IN IS_INSCRIPTION.L_IS_CLE%TYPE,
                                      NEW_L_SI_CLE IN IS_INSCRIPTION.L_SI_CLE%TYPE,
                                      rc1          IN OUT DTS_IMPRESSION_INSCRIPTION);

  TYPE REC_RAP_INCIDENTS_DCSI IS RECORD(
    TRI             VARCHAR(2),
    PERIODE         VARCHAR(100),
    V_DO_REFERENCE5 DO_DOSSIER.V_DO_REFERENCE5%TYPE,
    TOTAL           NUMBER(8),
    SEVERITE        VARCHAR(5));
  TYPE DTS_RAP_INCIDENTS_DCSI IS REF CURSOR RETURN REC_RAP_INCIDENTS_DCSI;
  PROCEDURE SP_RAP_INCIDENTS_DCSI(NEW_YEAR IN VARCHAR2,
                                  rc1      IN OUT DTS_RAP_INCIDENTS_DCSI);

  TYPE REC_IMPRESSION_SUIVI IS RECORD(
    suivi                      SV_SUIVI.V_SV_SUIVI%TYPE,
    secteurAssigneDescription  VARCHAR(100),
    intervenantDescription     SV_SUIVI.V_SV_INTERVENANT%TYPE,
    dateCreation               VARCHAR(20),
    dateCompletee              VARCHAR(20),
    datePrevue                 VARCHAR(20),
    demandeurDescription       SV_SUIVI.V_SV_DEMANDEUR%TYPE,
    activiteDescription        VARCHAR(100),
    confidentialiteDescription VARCHAR(100),
    statutDescription          VARCHAR(100),
    numeroDossier              VARCHAR(100));
  TYPE DTS_IMPRESSION_SUIVI IS REF CURSOR RETURN REC_IMPRESSION_SUIVI;
  PROCEDURE SP_IMPRESSION_SUIVI(NEW_L_SV_CLE IN SV_SUIVI.L_SV_CLE%TYPE,
                                NEW_L_SI_CLE IN SV_SUIVI.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SUIVI);

  TYPE REC_RAPPORT_VIGILANCE IS RECORD(
    DESCRIPTION VARCHAR(1000),
    TOTAL       NUMBER(8));
  TYPE DTS_RAPPORT_VIGILANCE IS REF CURSOR RETURN REC_RAPPORT_VIGILANCE;
  PROCEDURE SP_RAP_VIGILANCE_SOMMAIRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_VIGILANCE);

  TYPE REC_RAPPORT_VIGILANCE_DETAIL IS RECORD(
    DESCRIPTION         VARCHAR(1000),
    V_SU_REFERENCE_3    SU_SUJET.V_SU_REFERENCE_3%TYPE,
    V_SU_NOM            SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM         SU_SUJET.V_SU_PRENOM%TYPE,
    V_SU_SURNOM         SU_SUJET.V_SU_SURNOM%TYPE,
    SEXE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    ETHNIE              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    LANGUE              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    TEINT               TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    D_SU_DATE_NAISSANCE SU_SUJET.D_SU_DATE_NAISSANCE%TYPE);
  TYPE DTS_RAPPORT_VIGILANCE_DETAIL IS REF CURSOR RETURN REC_RAPPORT_VIGILANCE_DETAIL;
  PROCEDURE SP_RAP_VIGILANCE_DETAILLE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_VIGILANCE_DETAIL);
  PROCEDURE SP_RAP_VIGILANCE_READMISSION(rc1 IN OUT DTS_RAPPORT_VIGILANCE_DETAIL);

  TYPE REC_RAPPORT_ANALYSE_ACCES IS RECORD(
    DESCRIPTION      VARCHAR(1000),
    INTERVENANT      VARCHAR(1000),
    V_SU_REFERENCE_3 SU_SUJET.V_SU_REFERENCE_3%TYPE,
    TOTAL            NUMBER);
  TYPE DTS_RAPPORT_ANALYSE_ACCES IS REF CURSOR RETURN REC_RAPPORT_ANALYSE_ACCES;
  PROCEDURE SP_RAP_ACCES_SU_INTERVENANT(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                        NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                        NEW_SITE        IN VARCHAR,
                                        NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                        NEW_NOMBRE_FOIS IN NUMBER,
                                        rc1             IN OUT DTS_RAPPORT_ANALYSE_ACCES);
  PROCEDURE SP_RAP_ACCES_SUJETS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                NEW_SITE        IN VARCHAR,
                                NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                NEW_NOMBRE_FOIS IN NUMBER,
                                rc1             IN OUT DTS_RAPPORT_ANALYSE_ACCES);
  PROCEDURE SP_RAP_ACCES_DOSSIERS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_SITE        IN VARCHAR,
                                  NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                  NEW_NOMBRE_FOIS IN NUMBER,
                                  NEW_GENRE       IN VARCHAR,
                                  NEW_NATURE      IN VARCHAR,
                                  rc1             IN OUT DTS_RAPPORT_ANALYSE_ACCES);

  TYPE REC_FACTURATION_INV IS RECORD(
    SITE  VARCHAR(1000),
    TYPE  VARCHAR(1000),
    TOTAL NUMBER);
  TYPE DTS_FACTURATION_INV IS REF CURSOR RETURN REC_FACTURATION_INV;
  PROCEDURE SP_RAP_FACTURATION_SQ(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                  NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                  rc1            IN OUT DTS_FACTURATION_INV);
  PROCEDURE SP_RAP_FACTURATION_ECHO(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                    NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                    rc1            IN OUT DTS_FACTURATION_INV);
  PROCEDURE SP_RAP_FACTURATION_SOQUIJ(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      rc1            IN OUT DTS_FACTURATION_INV);

  TYPE REC_ENQUETES_TRAITEES IS RECORD(
    SITE    VARCHAR(1000),
    NATURE  VARCHAR(1000),
    DOSSIER VARCHAR(1000),
    JEUX    VARCHAR(1000),
    TOTAL   NUMBER);
  TYPE DTS_ENQUETES_TRAITEES IS REF CURSOR RETURN REC_ENQUETES_TRAITEES;
  PROCEDURE SP_RAP_NOMBRE_ENQUETES_HS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      rc1            IN OUT DTS_ENQUETES_TRAITEES);

  TYPE REC_SO_VERIFICATION_LIVRET IS RECORD(
    V_DO_NUMERO_DOSSIER  DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    D_BI_DATE_CREATION   BI_BILLET.D_BI_DATE_CREATION%TYPE,
    V_BI_NUMERO_CONTROLE BI_BILLET.V_BI_NUMERO_CONTROLE%TYPE,
    V_SO_REFERENCE_3     SO_SOCIETE.V_SO_REFERENCE_3%TYPE);
  TYPE DTS_SO_VERIFICATION_LIVRET IS REF CURSOR RETURN REC_SO_VERIFICATION_LIVRET;

  PROCEDURE SP_L_VERIFICATION_LIVRET(rc1 IN OUT DTS_SO_VERIFICATION_LIVRET);

  TYPE REC_SO_CHANGEMENTS_DETAILLANTS IS RECORD(
    TITRE            VARCHAR(250),
    V_SO_REFERENCE_3 SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
    V_SO_NOM         SO_SOCIETE.V_SO_NOM%TYPE,
    DATE_CHANGEMENT  AUD_SO_SOCIETE.D_SO_DATE_CHANGEMENT%TYPE,
		DATE_ACTIVATION  SO_SOCIETE.D_SO_DATE_FONDATION%TYPE,
    DATE_FIN_ACTIVITE SO_SOCIETE.D_SO_DATE_INACTIVATION%TYPE);
  TYPE DTS_SO_CHANGEMENTS_DETAILLANTS IS REF CURSOR RETURN REC_SO_CHANGEMENTS_DETAILLANTS;

  PROCEDURE SP_L_CHANGEMENTS_DETAILLANTS(rc1 IN OUT DTS_SO_CHANGEMENTS_DETAILLANTS);

  TYPE REC_RAPPORT_SEVERITE_4_SUJETS IS RECORD(
    NOM             SU_SUJET.V_SU_NOM%TYPE,
    PRENON          SU_SUJET.V_SU_PRENOM%TYPE,
    NUMERO_DE_FICHE SU_SUJET.V_SU_REFERENCE_3%TYPE,
    SEVERITE        TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    SITE_APPLICABLE SI_SITE.V_SI_SITE%TYPE,
    DATE_DE_FIN     IS_INSCRIPTION.D_IS_DATE_FIN%TYPE);
  TYPE DTS_RAPPORT_SEVERITE_4_SUJETS IS REF CURSOR RETURN REC_RAPPORT_SEVERITE_4_SUJETS;
  PROCEDURE SP_RAP_SEVERITE_4_SUJETS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                     NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                     NEW_SITE       IN DO_DOSSIER.L_SI_CLE%TYPE,
                                     NEW_SEVERITE   IN SU_SUJET.I_SE_CLE%TYPE,
                                     rc1            IN OUT DTS_RAPPORT_SEVERITE_4_SUJETS);
  TYPE REC_RAPPORT_SEVERITE_4_SOCIETE IS RECORD(
    NOM             SO_SOCIETE.V_SO_NOM%TYPE,
    NUMERO_DE_FICHE SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
    SEVERITE        TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    SITE_APPLICABLE SI_SITE.V_SI_SITE%TYPE,
    DATE_DE_FIN     IS_INSCRIPTION.D_IS_DATE_FIN%TYPE);
  TYPE DTS_RAPPORT_SEVERITE_4_SOCIETE IS REF CURSOR RETURN REC_RAPPORT_SEVERITE_4_SOCIETE;
  PROCEDURE SP_RAP_SEVERITE_4_SOCIETE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_SITE       IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      NEW_SEVERITE   IN SU_SUJET.I_SE_CLE%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_SEVERITE_4_SOCIETE);

  TYPE REC_RECONNAISSANCE_PLAQUES IS RECORD(
    TITRE                   VARCHAR(100),
    V_VE_IMMATRICULATION    VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
    COULEUR                 TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    V_MA_MARQUE             MA_MARQUE.V_MA_MARQUE%TYPE,
    V_MD_MODELE             MD_MODELE.V_MD_MODELE%TYPE,
    PROVINCE                TR_TRADUCTION.V_TR_ABREVIATION%TYPE,
    C_VE_ANNEE              VE_VEHICULE.C_VE_ANNEE%TYPE,
    V_DO_NUMERO_DOSSIER     DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    V_DO_ANCIENNE_REFERENCE DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    V_SU_REFERENCE_3        SU_SUJET.V_SU_REFERENCE_3%TYPE);
  TYPE DTS_RECONNAISSANCE_PLAQUES IS REF CURSOR RETURN REC_RECONNAISSANCE_PLAQUES;
  PROCEDURE SP_RAP_RECONNAISSANCE_PLAQUES(NEW_SITE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          rc1      IN OUT DTS_RECONNAISSANCE_PLAQUES);
  PROCEDURE SP_RAP_RECONNAISSANCE_PLAQUES(NEW_TITRE  IN VARCHAR2,
                                          NEW_SITE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          NEW_NATURE IN NA_NATURE.I_NA_CLE%TYPE,
                                          rc1        IN OUT DTS_RECONNAISSANCE_PLAQUES);

  TYPE REC_VERIFICATION_MULTIMEDIA IS RECORD(
    L_EM_CLE        MM_MULTIMEDIA.L_EM_CLE%TYPE,
    L_EM_SI_CLE     MM_MULTIMEDIA.L_EM_SI_CLE%TYPE,
    V_MM_EXTENSION  MM_MULTIMEDIA.V_MM_EXTENSION%TYPE,
    I_TM_CLE        MM_MULTIMEDIA.I_TM_CLE%TYPE,
    C_LMM_REF_GENRE LMM_LIEN_MULTIMEDIA.C_LMM_REF_GENRE%TYPE,
    L_LMM_REFERENCE LMM_LIEN_MULTIMEDIA.L_LMM_REFERENCE%TYPE,
    L_LMM_REF_SITE  LMM_LIEN_MULTIMEDIA.L_LMM_REF_SITE%TYPE);
  TYPE DTS_VERIFICATION_MULTIMEDIA IS REF CURSOR RETURN REC_VERIFICATION_MULTIMEDIA;
  PROCEDURE SP_RAP_VERIFICATION_MULTIMEDIA(rc1 IN OUT DTS_VERIFICATION_MULTIMEDIA);

  TYPE REC_RAPPORT_ACCES_SUJETS IS RECORD(
    PARENT            IN_INTERVENANT.V_IN_NAME_PARENT%TYPE,
    CODE              IN_INTERVENANT.NAME%TYPE,
    INTERVENANT       VARCHAR(1000),
    FICHE             SU_SUJET.V_SU_REFERENCE_3%TYPE,
    NOM               SU_SUJET.V_SU_NOM%TYPE,
    PRENOM            SU_SUJET.V_SU_PRENOM%TYPE,
    NAISSANCE         SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
    GROUPE            GS_GROUPE_SECURITE.V_GS_NOM%TYPE,
    TOTAL             NUMBER);
  TYPE DTS_RAPPORT_ACCES_SUJETS IS REF CURSOR RETURN REC_RAPPORT_ACCES_SUJETS;
  PROCEDURE SP_RAPPORT_ACCES_SUJETS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_SITE        IN NUMBER,
                                  NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                  NEW_GROUPE      IN NUMBER,
                                  rc1             IN OUT DTS_RAPPORT_ACCES_SUJETS);
                                        
  PROCEDURE SP_RAPPORT_ACCES_FOURNISSEURS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_SITE        IN NUMBER,
                                  NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                  NEW_GROUPE      IN NUMBER,
                                  rc1             IN OUT DTS_RAPPORT_ACCES_SUJETS);

  TYPE REC_DEMANDES_INCOMPLETES IS RECORD(
    D_SV_DATE_CREATION            SV_SUIVI.D_SV_DATE_CREATION%TYPE,
    V_DO_REFERENCE1               DO_DOSSIER.V_DO_REFERENCE1%TYPE,
    V_SU_NOM                      SU_SUJET.V_SU_NOM%TYPE,
    V_SV_SUIVI                    SV_SUIVI.V_SV_SUIVI%TYPE);
  TYPE DTS_DEMANDES_INCOMPLETES IS REF CURSOR RETURN REC_DEMANDES_INCOMPLETES;
  PROCEDURE SP_DEMANDES_INCOMPLETES(rc1 IN OUT DTS_DEMANDES_INCOMPLETES);

  TYPE REC_RAPPORT_ACCES_NARRATIONS IS RECORD(
    PARENT            IN_INTERVENANT.V_IN_NAME_PARENT%TYPE,
    CODE              IN_INTERVENANT.NAME%TYPE,
    INTERVENANT       VARCHAR(1000),
    GROUPE            GS_GROUPE_SECURITE.V_GS_NOM%TYPE,
    DATE_ACCES        AUD_RECHERCHE_NARRATION.D_DATE_ACCES%TYPE,
    DOSSIER           AUD_RECHERCHE_NARRATION.V_DO_NUMERO_DOSSIER%TYPE,
    NARRATION         CO_COMMENTAIRE2.V_CO_CREE_PAR%TYPE,
    DATE_NARRATION    CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE);
  TYPE DTS_RAPPORT_ACCES_NARRATIONS IS REF CURSOR RETURN REC_RAPPORT_ACCES_NARRATIONS;
  PROCEDURE SP_RAPPORT_ACCES_NARRATIONS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_SITE        IN NUMBER,
                                  NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                  NEW_GROUPE      IN NUMBER,
                                  rc1             IN OUT DTS_RAPPORT_ACCES_NARRATIONS);

TYPE REC_RAPPORT_EMPLOYES_DOSSIERS IS RECORD(
     NUMERO_CARDEX       DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
     DOSSIER             DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE, 
     NOM                 SU_SUJET.V_SU_NOM%TYPE,
     PRENOM              SU_SUJET.V_SU_PRENOM%TYPE,
     ROLE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     GENRE               TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     NATURE              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     TYPE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     CATEGORIE           TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     STATUT              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     FONDE               TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_RAPPORT_EMPLOYES_DOSSIERS IS REF CURSOR RETURN REC_RAPPORT_EMPLOYES_DOSSIERS;
PROCEDURE SP_RAPPORT_EMPLOYES_DOSSIERS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_ENTITE      IN EN_ENTITE.I_EN_CLE%TYPE,
                              NEW_SITE        IN SI_SITE.L_SI_CLE%TYPE,
                              NEW_GENRE       IN GE_GENRE.I_GE_CLE%TYPE,
                              NEW_NATURE      IN NA_NATURE.I_NA_CLE%TYPE,
                              NEW_TYPE        IN TY_TYPE.I_TY_CLE%TYPE,
                              NEW_CATEGORIE   IN CA_CATEGORIE.I_CA_CLE%TYPE,
                              NEW_ROLE        IN RO_ROLE.I_RO_CLE%TYPE,
                              NEW_STATUT      IN ST_STATUT.I_ST_CLE%TYPE,
                              NEW_FONDE       IN FO_FONDE.I_FO_CLE%TYPE,
                              rc1             IN OUT DTS_RAPPORT_EMPLOYES_DOSSIERS);
                                     

  TYPE REC_RAPPORT_DELAI_TRAITEMENT IS RECORD(
    SITE            SI_SITE.V_SI_SITE%TYPE,
    NATURE          VARCHAR(30),
    DOSSIER         SI_SITE.V_SI_ABREVIATION%TYPE,
    DATE_COMPLETEE  SV_SUIVI.D_SV_DATE_COMPLETEE%TYPE,
    DATE_CREATION   SV_SUIVI.D_SV_DATE_CREATION%TYPE);
  TYPE DTS_RAPPORT_DELAI_TRAITEMENT IS REF CURSOR RETURN REC_RAPPORT_DELAI_TRAITEMENT;
PROCEDURE SP_RAPPORT_DELAI_TRAITEMENT(NEW_TYPE     IN SV_SUIVI.I_TC_CLE%TYPE,
                              NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                              NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      rc1             IN OUT DTS_RAPPORT_DELAI_TRAITEMENT);

  TYPE REC_RAPPORT_RETARD_TRAITEMENT IS RECORD(
    DOSSIER              DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    DATE_CREATION_SQ     SV_SUIVI.D_SV_DATE_CREATION%TYPE,
    DATE_PREVUE_SQ       SV_SUIVI.D_SV_DATE_PREVUE%TYPE,
    DATE_COMLETEE_SQ     SV_SUIVI.D_SV_DATE_COMPLETEE%TYPE,
    DATE_CREATION_RACJ   SV_SUIVI.D_SV_DATE_CREATION%TYPE,
    DATE_PREVUE_RACJ     SV_SUIVI.D_SV_DATE_PREVUE%TYPE,
    DATE_COMPLETEE_RACJ  SV_SUIVI.D_SV_DATE_COMPLETEE%TYPE,
    SUIVI_SQ             TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    SUIVI_RACJ           TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_RAPPORT_RETARD_TRAITEMENT IS REF CURSOR RETURN REC_RAPPORT_RETARD_TRAITEMENT;
PROCEDURE SP_RAPPORT_RETARD_TRAITEMENT(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       rc1 IN OUT DTS_RAPPORT_RETARD_TRAITEMENT);

PROCEDURE SP_RAPPORT_ENQUETES_RETARD(rc1 IN OUT DTS_RAPPORT_RETARD_TRAITEMENT);

  TYPE REC_LAISSEZ_PASSER_SUJETS IS RECORD(
    V_SU_REFERENCE_3     SU_SUJET.V_SU_REFERENCE_3%TYPE,
    V_SU_NOM             SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM          SU_SUJET.V_SU_PRENOM%TYPE,
    V_SO_NOM             SO_SOCIETE.V_SO_NOM%TYPE,
    L_SO_CLE             SO_SOCIETE.L_SO_CLE%TYPE,
    D_DO_DATE_DEBUT      DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    D_DO_DATE_FIN        DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_TR_TRADUCTION      TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_LAISSEZ_PASSER_SUJETS IS REF CURSOR RETURN REC_LAISSEZ_PASSER_SUJETS;
PROCEDURE SP_RAP_LAISSEZ_PASSER_SUJETS(rc1 IN OUT DTS_LAISSEZ_PASSER_SUJETS);

  TYPE REC_LAISSEZ_PASSER_SOCIETES IS RECORD(
    V_SO_NOM             SO_SOCIETE.V_SO_NOM%TYPE,
    L_SO_CLE             SO_SOCIETE.L_SO_CLE%TYPE,
    D_DO_DATE_DEBUT      DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    D_DO_DATE_FIN        DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_TR_TRADUCTION      TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_LAISSEZ_PASSER_SOCIETES  IS REF CURSOR RETURN REC_LAISSEZ_PASSER_SOCIETES;
PROCEDURE SP_RAP_LAISSEZ_PASSER_SOCIETES(rc1 IN OUT DTS_LAISSEZ_PASSER_SOCIETES);

  TYPE REC_RAP_SOCIETES_INACTIVES IS RECORD(
    V_SO_NOM                 SO_SOCIETE.V_SO_NOM%TYPE,
    V_SO_REFERENCE_3         SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
    V_DO_ANCIENNE_REFERENCE  DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,    
    NUMERO_VAGUE             VARCHAR(250));
  TYPE DTS_RAP_SOCIETES_INACTIVES IS REF CURSOR RETURN REC_RAP_SOCIETES_INACTIVES;
PROCEDURE SP_RAP_SOCIETES_INACTIVES(NEW_VAGUE IN DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
                                    rc1 IN OUT DTS_RAP_SOCIETES_INACTIVES);

  TYPE REC_RAPPORT_ESPACEJEUX IS RECORD(
    V_SO_NOM                 SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM              SU_SUJET.V_SU_PRENOM%TYPE,
    D_SU_DATE_NAISSANCE      SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,    
    V_AD_NUM_MUNICIPAL       AD_ADRESSE.V_AD_NUM_MUNICIPAL%TYPE,    
    V_AD_NOM_RUE             AD_ADRESSE.V_AD_NOM_RUE%TYPE,    
    V_VI_VILLE               VI_VILLE.V_VI_VILLE%TYPE,    
    V_AD_CODE_POSTAL         AD_ADRESSE.V_AD_CODE_POSTAL%TYPE,    
    V_DO_NUMERO_DOSSIER      DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,    
    TYPE                     TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    CATEGORIE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_RAPPORT_ESPACEJEUX IS REF CURSOR RETURN REC_RAPPORT_ESPACEJEUX;
PROCEDURE SP_RAP_EJ_AU_ACTIF(rc1 IN OUT DTS_RAPPORT_ESPACEJEUX);
PROCEDURE SP_RAP_EJ_FRAUDE_FONDE(rc1 IN OUT DTS_RAPPORT_ESPACEJEUX);
PROCEDURE SP_RAP_EJ_TRICHERIE_FONDE(rc1 IN OUT DTS_RAPPORT_ESPACEJEUX);

  TYPE REC_RAPPORT_AMBULANCE_SOMMAIRE IS RECORD(
    SITE SI_SITE.V_SI_SITE%TYPE,
    STATUT TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    TOTAL UR_URGENCE.L_UR_CLE%TYPE);
  TYPE DTS_RAPPORT_AMBULANCE_SOMMAIRE IS REF CURSOR RETURN REC_RAPPORT_AMBULANCE_SOMMAIRE;
PROCEDURE SP_RAPPORT_AMBULANCE_SOMMAIRE(NEW_DATE_DEBUT UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        NEW_DATE_FIN   UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        rc1 IN OUT DTS_RAPPORT_AMBULANCE_SOMMAIRE);

  TYPE REC_RAPPORT_AMBULANCE_DETAIL IS RECORD(
    statut TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    site SI_SITE.V_SI_SITE%TYPE,
    motif TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    cle UR_URGENCE.L_UR_CLE%TYPE);
  TYPE DTS_RAPPORT_AMBULANCE_DETAIL IS REF CURSOR RETURN REC_RAPPORT_AMBULANCE_DETAIL;
PROCEDURE SP_RAPPORT_AMBULANCE_DETAIL(NEW_DATE_DEBUT UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        NEW_DATE_FIN   UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        rc1 IN OUT DTS_RAPPORT_AMBULANCE_DETAIL);

  TYPE REC_RAPPORT_SUIVIS IS RECORD(
    NATURE                   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    TYPE_DOSSIER             TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    CATEGORIE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    TYPE_SUIVI               TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    NUMERO_CARDEX            DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    DATE_CREATION_DOSSIER    DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
    DATE_CREATION_SUIVI      SV_SUIVI.D_SV_DATE_CREATION%TYPE,    
    DATE_CREATION_COMPLETE   SV_SUIVI.D_SV_DATE_COMPLETEE%TYPE,    
    NOM                      IN_INTERVENANT.V_IN_NOM%TYPE,
    PRENOM                   IN_INTERVENANT.V_IN_PRENOM%TYPE,
    STATUT                   TR_TRADUCTION.V_TR_DESCRIPTION%TYPE);
  TYPE DTS_RAPPORT_SUIVIS IS REF CURSOR RETURN REC_RAPPORT_SUIVIS;
PROCEDURE SP_RAPPORT_SUIVIS(NEW_DATE_DEBUT DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_DATE_FIN   DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_SITE       SI_SITE.L_SI_CLE%TYPE,
                            NEW_NATURE     NA_NATURE.I_NA_CLE%TYPE,
                            NEW_TYPE_SUIVI TC_TYPE_ACTIVITE.I_TC_CLE%TYPE,
                            rc1 IN OUT DTS_RAPPORT_SUIVIS);

  TYPE REC_RAPPORT_ENDROITS_REGROUPES IS RECORD(
     SITE             SI_SITE.V_SI_SITE%TYPE,
     REGROUPEMENT     TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     GENRE            TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     NATURE           TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     TYPE_DESCRIPTION TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     CATEGORIE        TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     TOTAL            NUMBER(8));
  TYPE DTS_RAPPORT_ENDROITS_REGROUPES IS REF CURSOR RETURN REC_RAPPORT_ENDROITS_REGROUPES;
PROCEDURE SP_RAPPORT_ENDROITS_REGROUPES(NEW_DATE_DEBUT DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_DATE_FIN   DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_SITE       SI_SITE.L_SI_CLE%TYPE,
                            NEW_GENRE      GE_GENRE.I_GE_CLE%TYPE,
                            NEW_NATURE     NA_NATURE.I_NA_CLE%TYPE,
                            NEW_TYPE       TY_TYPE.I_TY_CLE%TYPE,
                            NEW_CATEGORIE  CA_CATEGORIE.I_CA_CLE%TYPE,
                            NEW_REGROUPEMENT OR_ORIENTATION.L_SR_CLE%TYPE,
                            rc1 IN OUT DTS_RAPPORT_ENDROITS_REGROUPES);
                      
  TYPE REC_TABLEAU_ENDROITS_REGROUPES IS RECORD(
     SITE             SI_SITE.V_SI_SITE%TYPE,
     ANNEE            VARCHAR2(4),
     REGROUPEMENT     TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
     TOTAL            NUMBER(8));
  TYPE DTS_TABLEAU_ENDROITS_REGROUPES IS REF CURSOR RETURN REC_TABLEAU_ENDROITS_REGROUPES;
PROCEDURE SP_TABLEAU_ENDROITS_REGROUPES(NEW_DATE_DEBUT DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_DATE_FIN   DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_SITE       SI_SITE.L_SI_CLE%TYPE,
                            NEW_GENRE      GE_GENRE.I_GE_CLE%TYPE,
                            NEW_NATURE     NA_NATURE.I_NA_CLE%TYPE,
                            NEW_TYPE       TY_TYPE.I_TY_CLE%TYPE,
                            NEW_CATEGORIE  CA_CATEGORIE.I_CA_CLE%TYPE,
                            NEW_REGROUPEMENT OR_ORIENTATION.L_SR_CLE%TYPE,
                            rc1 IN OUT DTS_TABLEAU_ENDROITS_REGROUPES);

TYPE REC_SOCIETE_SANS_VISITE IS RECORD(CLE_SOCIETE SO_SOCIETE.L_SO_CLE%TYPE,
                            SITE_SOCIETE          SO_SOCIETE.L_SI_CLE%TYPE,
                            CLE_ECHANTILLON       DO_DOSSIER.L_DO_CLE%TYPE,
                            SITE_ECHANTILLON      DO_DOSSIER.L_SI_CLE%TYPE,
                            VAGUE                 DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
                            DISTRICT              SO_SOCIETE.V_SO_DISTRICT%TYPE,
                            REGION_ADMINISTRATIVE SO_SOCIETE.V_SO_REFERENCE_1%TYPE,
                            NUMERO_DETAILLANT     SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
                            NOM_SOCIETE           SO_SOCIETE.V_SO_NOM%TYPE,
                            COMPTE_SOCIETE        SO_SOCIETE.V_SO_CODE_COMPTE%TYPE,
                            NOM_COMPTE            VEXI_CDX_DDS_CODE_COMPTE.NOM_COC%TYPE,
                            LANGUE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
                            CENTRE_REGIONAL       SO_SOCIETE.L_SO_CENTRE_REGIONAL%TYPE,
                            NUM_MUNICIPAL         AD_ADRESSE.V_AD_NUM_MUNICIPAL%TYPE,
                            TYPE_RUE              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
                            NOM_RUE               AD_ADRESSE.V_AD_NOM_RUE%TYPE,
                            VILLE                 VI_VILLE.V_VI_VILLE%TYPE,
                            CODE_POSTAL           AD_ADRESSE.V_AD_CODE_POSTAL%TYPE,
                            TELEPHONE_1           AD_ADRESSE.V_AD_TELEPHONE_1%TYPE);
  TYPE DTS_SOCIETE_SANS_VISITE IS REF CURSOR RETURN REC_SOCIETE_SANS_VISITE;
PROCEDURE SP_SOCIETE_SANS_VISITE(rc1 IN OUT DTS_SOCIETE_SANS_VISITE);
  TYPE REC_SOCIETE_CLIENT_MYSTERE IS RECORD(CLE_SOCIETE SO_SOCIETE.L_SO_CLE%TYPE,
                            SITE_SOCIETE          SO_SOCIETE.L_SI_CLE%TYPE,
                            CLE_ECHANTILLON       DO_DOSSIER.L_DO_CLE%TYPE,
                            SITE_ECHANTILLON      DO_DOSSIER.L_SI_CLE%TYPE,
                            VAGUE                 DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
                            DISTRICT              SO_SOCIETE.V_SO_DISTRICT%TYPE,
                            REGION_ADMINISTRATIVE SO_SOCIETE.V_SO_REFERENCE_1%TYPE,
                            NUMERO_DETAILLANT     SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
                            NOM_SOCIETE           SO_SOCIETE.V_SO_NOM%TYPE,
                            COMPTE_SOCIETE        SO_SOCIETE.V_SO_CODE_COMPTE%TYPE,
                            NOM_COMPTE            VEXI_CDX_DDS_CODE_COMPTE.NOM_COC%TYPE,
                            LANGUE                TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
                            CENTRE_REGIONAL       SO_SOCIETE.L_SO_CENTRE_REGIONAL%TYPE,
                            NUM_MUNICIPAL         AD_ADRESSE.V_AD_NUM_MUNICIPAL%TYPE,
                            TYPE_RUE              TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
                            NOM_RUE               AD_ADRESSE.V_AD_NOM_RUE%TYPE,
                            VILLE                 VI_VILLE.V_VI_VILLE%TYPE,
                            CODE_POSTAL           AD_ADRESSE.V_AD_CODE_POSTAL%TYPE,
                            TELEPHONE_1           AD_ADRESSE.V_AD_TELEPHONE_1%TYPE,
                            CATEGORIE             DO_DOSSIER.I_CA_CLE%TYPE,
                            DEBUT_DATE_DOSSIER    DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                            FIN_DATE_DOSSIER      DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                            AVIS_DATE             DO_DOSSIER.V_DO_REFERENCE3%TYPE,
                            TEXTE_NARRATION       CO_COMMENTAIRE2.CLOB_CO_TEXTE_NORMAL%TYPE,
                            NUMERO_BILLET         BI_BILLET.V_BI_NUMERO_CONTROLE%TYPE);
  TYPE DTS_SOCIETE_CLIENT_MYSTERE IS REF CURSOR RETURN REC_SOCIETE_CLIENT_MYSTERE;
PROCEDURE SP_SOCIETE_CLIENT_MYSTERE(rc1 IN OUT DTS_SOCIETE_CLIENT_MYSTERE);

END CARDEX_RAPPORT;
/
CREATE OR REPLACE PACKAGE BODY CARDEX_RAPPORT is
  PROCEDURE SP_RAP_REPERAGE_AU_TRI_NOMBRE(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          NEW_L_SI_CLE    IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          nombreReperages NUMBER,
                                          rc1             IN OUT DTS_RAPPORT_REPERAGE) IS
  begin
    OPEN rc1 FOR
      select d.v_do_ancienne_reference,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "V_DO_NUMERO_DOSSIER",
             d.d_do_date_debut,
             d.d_do_date_fin,
             s.v_su_nom,
             s.v_su_prenom,
             s.l_su_cle,
             s.l_si_cle,
             s.v_su_reference_3,
             count(d.l_do_cle)
        from v_do_dossier_ca_ty   d,
             v_do_dossier_ca_ty   d2,
             ldd_lien_dossier     l,
             ldd_lien_dossier     l2,
             su_sujet             s,
             sis_site_inscription sis,
             is_inscription       ist
       where ((d2.l_do_cle = l.L_LDD_DOSSIER_ASSOCIE and
             l.c_ldd_genre = 'DO' and l.l_ldd_site = d2.l_si_cle and
             l.l_do_cle = d.l_do_cle and l.l_do_site = d.l_si_cle and
             l.c_do_genre = 'DO') OR
             (d2.l_do_cle = l.l_do_cle and d2.l_si_cle = l.l_do_site and
             l.c_do_genre = 'DO' and d.l_do_cle = l.l_ldd_dossier_associe and
             d.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'DO'))
            -- Autoexclusion :
         and d.i_ca_cle = 112
         and d2.i_ca_cle = 220
         and d2.d_do_date_debut >= nvl(NEW_DATE_DEBUT, sysdate - 130)
         and d2.d_do_date_debut < nvl(NEW_DATE_FIN, sysdate) + 1
         and d.i_st_cle = 359
         and d2.l_si_cle = NEW_L_SI_CLE
         and (s.l_su_cle = l2.l_ldd_dossier_associe and
             s.l_si_cle = l2.l_ldd_site and l2.c_ldd_genre = 'SU' and
             d.l_do_cle = l2.l_do_cle and d.l_si_cle = l2.l_do_site and
             l2.c_do_genre = 'DO')
         and (sis.l_is_site = NEW_L_SI_CLE and ist.l_is_cle = sis.l_is_cle and
             ist.l_si_cle = sis.l_si_cle and ist.i_st_cle = d.i_st_cle and
             ist.l_is_reference = d.l_do_cle and
             ist.l_is_ref_site = d.l_si_cle)
       group by d.v_do_ancienne_reference,
                d.v_do_numero_dossier,
                d.d_do_date_debut,
                d.d_do_date_fin,
                s.v_su_nom,
                s.v_su_prenom,
                s.l_su_cle,
                s.l_si_cle,
                s.v_su_reference_3
      having count(d.l_do_cle) >= nombreReperages
       order by count(d.l_do_cle) desc, d.v_do_numero_dossier;
  END SP_RAP_REPERAGE_AU_TRI_NOMBRE;
  PROCEDURE SP_RAP_REPERAGE_AU_TRI_NUMERO(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          NEW_L_SI_CLE    IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          nombreReperages NUMBER,
                                          rc1             IN OUT DTS_RAPPORT_REPERAGE) IS
  begin
    OPEN rc1 FOR
      select d.v_do_ancienne_reference,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "V_DO_NUMERO_DOSSIER",
             d.d_do_date_debut,
             d.d_do_date_fin,
             s.v_su_nom,
             s.v_su_prenom,
             s.l_su_cle,
             s.l_si_cle,
             s.v_su_reference_3,
             count(d.l_do_cle)
        from v_do_dossier_ca_ty   d,
             v_do_dossier_ca_ty   d2,
             ldd_lien_dossier     l,
             ldd_lien_dossier     l2,
             su_sujet             s,
             sis_site_inscription sis,
             is_inscription       ist
       where ((d2.l_do_cle = l.L_LDD_DOSSIER_ASSOCIE and
             l.c_ldd_genre = 'DO' and l.l_ldd_site = d2.l_si_cle and
             l.l_do_cle = d.l_do_cle and l.l_do_site = d.l_si_cle and
             l.c_do_genre = 'DO') OR
             (d2.l_do_cle = l.l_do_cle and d2.l_si_cle = l.l_do_site and
             l.c_do_genre = 'DO' and d.l_do_cle = l.l_ldd_dossier_associe and
             d.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'DO'))
            -- Autoexclusion :
         and d.i_ca_cle = 112
         and d2.i_ca_cle = 220
         and d2.d_do_date_debut >= nvl(NEW_DATE_DEBUT, sysdate - 130)
         and d2.d_do_date_debut < nvl(NEW_DATE_FIN, sysdate) + 1
         and d.i_st_cle = 359
         and d2.l_si_cle = NEW_L_SI_CLE
         and (s.l_su_cle = l2.l_ldd_dossier_associe and
             s.l_si_cle = l2.l_ldd_site and l2.c_ldd_genre = 'SU' and
             d.l_do_cle = l2.l_do_cle and d.l_si_cle = l2.l_do_site and
             l2.c_do_genre = 'DO')
         and (sis.l_is_site = NEW_L_SI_CLE and ist.l_is_cle = sis.l_is_cle and
             ist.l_si_cle = sis.l_si_cle and ist.i_st_cle = d.i_st_cle and
             ist.l_is_reference = d.l_do_cle and
             ist.l_is_ref_site = d.l_si_cle)
       group by d.v_do_ancienne_reference,
                d.v_do_numero_dossier,
                d.d_do_date_debut,
                d.d_do_date_fin,
                s.v_su_nom,
                s.v_su_prenom,
                s.l_su_cle,
                s.l_si_cle,
                s.v_su_reference_3
      having count(d.l_do_cle) >= nombreReperages
       order by d.v_do_numero_dossier;
  END SP_RAP_REPERAGE_AU_TRI_NUMERO;
  PROCEDURE SP_RAP_REP_ACCES_INTERDITS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       rc1            IN OUT DTS_RAPPORT_REPERAGE) IS
  begin
    OPEN rc1 FOR
      select d.v_do_ancienne_reference,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "V_DO_NUMERO_DOSSIER",
             d.d_do_date_debut,
             d.d_do_date_fin,
             s.v_su_nom,
             s.v_su_prenom,
             s.l_su_cle,
             s.l_si_cle,
             s.v_su_reference_3,
             count(d.l_do_cle)
        from v_do_dossier_ca_ty   d,
             v_do_dossier_ca_ty   d2,
             ldd_lien_dossier     l,
             ldd_lien_dossier     l2,
             su_sujet             s,
             sis_site_inscription sis,
             is_inscription       ist
       where ((d2.l_do_cle = l.L_LDD_DOSSIER_ASSOCIE and
             l.c_ldd_genre = 'DO' and l.l_ldd_site = d2.l_si_cle and
             l.l_do_cle = d.l_do_cle and l.l_do_site = d.l_si_cle and
             l.c_do_genre = 'DO') OR
             (d2.l_do_cle = l.l_do_cle and d2.l_si_cle = l.l_do_site and
             l.c_do_genre = 'DO' and d.l_do_cle = l.l_ldd_dossier_associe and
             d.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'DO'))
         and d.i_na_cle = 417
         and d2.i_ca_cle = 239
         and d2.d_do_date_debut >= nvl(NEW_DATE_DEBUT, sysdate - 130)
         and d2.d_do_date_debut < nvl(NEW_DATE_FIN, sysdate) + 1
         and d.i_st_cle = 359
         and d2.l_si_cle = NEW_L_SI_CLE
         and (s.l_su_cle = l2.l_ldd_dossier_associe and
             s.l_si_cle = l2.l_ldd_site and l2.c_ldd_genre = 'SU' and
             d.l_do_cle = l2.l_do_cle and d.l_si_cle = l2.l_do_site and
             l2.c_do_genre = 'DO')
         and (sis.l_is_site = NEW_L_SI_CLE and ist.l_is_cle = sis.l_is_cle and
             ist.l_si_cle = sis.l_si_cle and ist.i_st_cle = d.i_st_cle and
             ist.l_is_reference = d.l_do_cle and
             ist.l_is_ref_site = d.l_si_cle)
       group by d.v_do_ancienne_reference,
                d.v_do_numero_dossier,
                d.d_do_date_debut,
                d.d_do_date_fin,
                s.v_su_nom,
                s.v_su_prenom,
                s.l_su_cle,
                s.l_si_cle,
                s.v_su_reference_3
       order by count(d.l_do_cle) desc;
  END SP_RAP_REP_ACCES_INTERDITS;
  PROCEDURE SP_RAP_REP_AI_TRI_NOMBRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                     NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                     NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                     rc1            IN OUT DTS_RAPPORT_REPERAGE) IS
  begin
    OPEN rc1 FOR
      select d.v_do_ancienne_reference,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "V_DO_NUMERO_DOSSIER",
             d.d_do_date_debut,
             d.d_do_date_fin,
             s.v_su_nom,
             s.v_su_prenom,
             s.l_su_cle,
             s.l_si_cle,
             s.v_su_reference_3,
             count(d.l_do_cle)
        from v_do_dossier_ca_ty   d,
             v_do_dossier_ca_ty   d2,
             ldd_lien_dossier     l,
             ldd_lien_dossier     l2,
             su_sujet             s,
             sis_site_inscription sis,
             is_inscription       ist
       where ((d2.l_do_cle = l.L_LDD_DOSSIER_ASSOCIE and
             l.c_ldd_genre = 'DO' and l.l_ldd_site = d2.l_si_cle and
             l.l_do_cle = d.l_do_cle and l.l_do_site = d.l_si_cle and
             l.c_do_genre = 'DO') OR
             (d2.l_do_cle = l.l_do_cle and d2.l_si_cle = l.l_do_site and
             l.c_do_genre = 'DO' and d.l_do_cle = l.l_ldd_dossier_associe and
             d.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'DO'))
         and d.i_na_cle = 417
         and d2.i_ca_cle = 239
         and d2.d_do_date_debut >= nvl(NEW_DATE_DEBUT, sysdate - 130)
         and d2.d_do_date_debut < nvl(NEW_DATE_FIN, sysdate) + 1
         and d.i_st_cle = 359
         and d2.l_si_cle = NEW_L_SI_CLE
         and (s.l_su_cle = l2.l_ldd_dossier_associe and
             s.l_si_cle = l2.l_ldd_site and l2.c_ldd_genre = 'SU' and
             d.l_do_cle = l2.l_do_cle and d.l_si_cle = l2.l_do_site and
             l2.c_do_genre = 'DO')
         and (sis.l_is_site = NEW_L_SI_CLE and ist.l_is_cle = sis.l_is_cle and
             ist.l_si_cle = sis.l_si_cle and ist.i_st_cle = d.i_st_cle and
             ist.l_is_reference = d.l_do_cle and
             ist.l_is_ref_site = d.l_si_cle)
       group by d.v_do_ancienne_reference,
                d.v_do_numero_dossier,
                d.d_do_date_debut,
                d.d_do_date_fin,
                s.v_su_nom,
                s.v_su_prenom,
                s.l_su_cle,
                s.l_si_cle,
                s.v_su_reference_3
       order by count(d.l_do_cle) desc;
  END SP_RAP_REP_AI_TRI_NOMBRE;
  PROCEDURE SP_RAP_REPERAGE_AVIS_GUET(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_REPERAGE) IS
  begin
    OPEN rc1 FOR
      select d.v_do_ancienne_reference,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "V_DO_NUMERO_DOSSIER",
             d.d_do_date_debut,
             d.d_do_date_fin,
             s.v_su_nom,
             s.v_su_prenom,
             s.l_su_cle,
             s.l_si_cle,
             s.v_su_reference_3,
             count(d.l_do_cle)
        from v_do_dossier_ca_ty   d,
             v_do_dossier_ca_ty   d2,
             ldd_lien_dossier     l,
             ldd_lien_dossier     l2,
             su_sujet             s,
             sis_site_inscription sis,
             is_inscription       ist
       where ((d2.l_do_cle = l.L_LDD_DOSSIER_ASSOCIE and
             l.c_ldd_genre = 'DO' and l.l_ldd_site = d2.l_si_cle and
             l.l_do_cle = d.l_do_cle and l.l_do_site = d.l_si_cle and
             l.c_do_genre = 'DO') OR
             (d2.l_do_cle = l.l_do_cle and d2.l_si_cle = l.l_do_site and
             l.c_do_genre = 'DO' and d.l_do_cle = l.l_ldd_dossier_associe and
             d.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'DO'))
         and d.i_na_cle = 78
         and d2.i_ca_cle = 263
         and d2.d_do_date_debut >= nvl(NEW_DATE_DEBUT, sysdate - 130)
         and d2.d_do_date_debut < nvl(NEW_DATE_FIN, sysdate) + 1
         and d.i_st_cle = 359
         and d2.l_si_cle = NEW_L_SI_CLE
         and (s.l_su_cle = l2.l_ldd_dossier_associe and
             s.l_si_cle = l2.l_ldd_site and l2.c_ldd_genre = 'SU' and
             d.l_do_cle = l2.l_do_cle and d.l_si_cle = l2.l_do_site and
             l2.c_do_genre = 'DO')
         and (sis.l_is_site = NEW_L_SI_CLE and ist.l_is_cle = sis.l_is_cle and
             ist.l_si_cle = sis.l_si_cle and ist.i_st_cle = d.i_st_cle and
             ist.l_is_reference = d.l_do_cle and
             ist.l_is_ref_site = d.l_si_cle)
       group by d.v_do_ancienne_reference,
                d.v_do_numero_dossier,
                d.d_do_date_debut,
                d.d_do_date_fin,
                s.v_su_nom,
                s.v_su_prenom,
                s.l_su_cle,
                s.l_si_cle,
                s.v_su_reference_3
       order by d.v_do_numero_dossier;
  END SP_RAP_REPERAGE_AVIS_GUET;
  --Impression de la fiche sujet
  PROCEDURE SP_IMPRESSION_SUJET(NEW_L_SU_CLE IN SU_SUJET.L_SU_CLE%TYPE,
                                NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SUJET) IS
  begin
    OPEN rc1 FOR
      SELECT sujet.v_su_reference_3 noFiche,
             sujet.v_su_nom nom,
             sujet.v_su_prenom prenom,
             sujet.v_su_surnom alias,
             tr_sexe.v_tr_description sexe,
             tr_ethnie.v_tr_description ethnie,
             tr_race.v_tr_description race,
             tr_langue.v_tr_description langue,
             sujet.d_su_date_naissance date_de_naissance,
             sujet.l_su_cle,
             sujet.l_si_cle,
             sujet.v_su_permis_conduire,
             sujet.v_su_no_passeport,
             sujet.c_su_assurance_sociale
        FROM su_sujet sujet
        LEFT OUTER JOIN tr_traduction tr_sexe ON (sujet.i_sx_cle =
                                                 tr_sexe.l_tr_cle AND
                                                 tr_sexe.i_la_cle = 1)
        LEFT OUTER JOIN tr_traduction tr_ethnie ON (sujet.i_nt_cle =
                                                   tr_ethnie.l_tr_cle AND
                                                   tr_ethnie.i_la_cle = 1)
        LEFT OUTER JOIN tr_traduction tr_race ON (sujet.i_ra_cle =
                                                 tr_race.l_tr_cle AND
                                                 tr_race.i_la_cle = 1)
        LEFT OUTER JOIN tr_traduction tr_langue ON (sujet.i_ls_cle =
                                                   tr_langue.l_tr_cle AND
                                                   tr_langue.i_la_cle = 1)
       WHERE sujet.l_su_cle = NEW_L_SU_CLE
         and sujet.l_si_cle = NEW_L_SI_CLE;
  END SP_IMPRESSION_SUJET;
  --Impression de la fiche socit
  PROCEDURE SP_IMPRESSION_SOCIETE(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                                  NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                                  rc1          IN OUT DTS_IMPRESSION_SOCIETE) IS
  begin
    OPEN rc1 FOR
      SELECT S.L_SO_CLE,
             S.L_SI_CLE,
             TRST.V_TR_DESCRIPTION AS "STATUT",
             S.V_SO_NOM,
             TRCL.V_TR_DESCRIPTION AS "CLASSE",
             S.V_SO_REFERENCE_NOM,
             S.V_SO_REFERENCE_PRENOM,
             S.V_SO_REFERENCE_1,
             S.V_SO_REFERENCE_2,
             S.V_SO_REFERENCE_3,
             S.V_SO_RAISON_SOCIALE,
             S.L_SO_CENTRE_REGIONAL,
             S.V_SO_DISTRICT,
             S.V_SO_CODE_COMPTE,
             S.B_SO_ACTIF,
             S.D_SO_DATE_INACTIVATION,
             S.B_SO_IND_RDD,
             S.V_SO_COMMENTAIRE,
             S.V_SO_RAISON_INACTIVATION
        FROM SO_SOCIETE S, TR_TRADUCTION TRST, TR_TRADUCTION TRCL
       WHERE S.I_ST_CLE = TRST.L_TR_CLE(+)
         AND TRST.I_LA_CLE(+) = 1
         AND S.I_CL_CLE = TRCL.L_TR_CLE(+)
         AND TRCL.I_LA_CLE(+) = 1
         AND S.L_SO_CLE = NEW_L_SO_CLE
         AND S.L_SI_CLE = NEW_L_SI_CLE
         AND (NVL(S.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
              Cardex_Special.g_code_confidentialite or S.V_SO_CREE_PAR = Cardex_Special.g_usager);
  END SP_IMPRESSION_SOCIETE;
  --Impression de la fiche dossier
  PROCEDURE SP_IMPRESSION_DOSSIER(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                                  NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                  rc1          IN OUT DTS_IMPRESSION_DOSSIER) IS
  begin
    OPEN rc1 FOR
      SELECT DOSSIER.V_DO_ANCIENNE_REFERENCE NODOSSIER,
             substr(dossier.v_do_numero_dossier, 1, 3) || '-' ||
             substr(dossier.v_do_numero_dossier, 4, 8) || '-' ||
             substr(dossier.v_do_numero_dossier, 12, 16) NOCARDEX,
             NATURE.V_TR_DESCRIPTION NATURE,
             TYPE.V_TR_DESCRIPTION TYPE,
             CATEGORIE.V_TR_DESCRIPTION CATEGORIE,
             STATUT.V_TR_DESCRIPTION STATUT,
             SEVERITE.V_TR_DESCRIPTION SEVERITE,
             DOSSIER.V_DO_REFERENCE_VIDEO NOSEQUENTIEL,
             DECODE(DOSSIER.B_DO_ENREGISTREMENT_CONSERVE,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'NULL') ENRCONSERVE,
             DECODE(DOSSIER.B_DO_ENREGISTREMENT_NUMERIQUE,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'NULL') ENRNUMERIQUE,
             DOSSIER.D_DO_DATE_DEBUT DATEDEBUT,
             DOSSIER.D_DO_DATE_FIN DATEFIN,
             DOSSIER.V_DO_REFERENCE1 REFERENCE1,
             DOSSIER.V_DO_REFERENCE3 REFERENCE2,
             DOSSIER.V_DO_REFERENCE5 REFERENCE3,
             INTERVENANTS.V_IN_NOM || ', ' || INTERVENANTS.V_IN_PRENOM INTERVENANT,
             SITE.V_SI_SITE SITE,
             ENDROIT.V_TR_DESCRIPTION ENDROIT,
             LOCALISATION.V_TR_DESCRIPTION LOCALISATION,
             DOSSIER.V_DO_LIEU LIEU,
             ORIGINE.V_TR_DESCRIPTION ORIGINE,
             DOSSIER.L_SI_CLE SITECLE,
             DOSSIER.L_DO_CLE DOSSIERCLE
        FROM V_DO_DOSSIER_CA_TY DOSSIER,
             TR_TRADUCTION      NATURE,
             TR_TRADUCTION      TYPE,
             TR_TRADUCTION      CATEGORIE,
             TR_TRADUCTION      STATUT,
             TR_TRADUCTION      SEVERITE,
             IN_INTERVENANT     INTERVENANTS,
             SI_SITE            SITE,
             TR_TRADUCTION      ENDROIT,
             TR_TRADUCTION      LOCALISATION,
             TR_TRADUCTION      ORIGINE
       WHERE DOSSIER.I_NA_CLE = NATURE.L_TR_CLE
         AND NATURE.I_LA_CLE = 1
         AND DOSSIER.I_TY_CLE = TYPE.L_TR_CLE
         AND TYPE.I_LA_CLE = 1
         AND DOSSIER.I_CA_CLE = CATEGORIE.L_TR_CLE
         AND CATEGORIE.I_LA_CLE = 1
         AND DOSSIER.I_ST_CLE = STATUT.L_TR_CLE
         AND STATUT.I_LA_CLE = 1
         AND DOSSIER.I_SE_CLE = SEVERITE.L_TR_CLE(+)
         AND SEVERITE.I_LA_CLE(+) = 1
         AND DOSSIER.V_DO_CREE_PAR = INTERVENANTS.NAME
         AND DOSSIER.L_SI_CLE = SITE.L_SI_CLE
         AND DOSSIER.I_OR_CLE = ENDROIT.L_TR_CLE(+)
         AND ENDROIT.I_LA_CLE(+) = 1
         AND DOSSIER.I_CR_CLE = LOCALISATION.L_TR_CLE(+)
         AND LOCALISATION.I_LA_CLE(+) = 1
         AND DOSSIER.L_DO_ORIGINE = ORIGINE.L_TR_CLE(+)
         AND ORIGINE.I_LA_CLE(+) = 1
         AND DOSSIER.L_DO_CLE = NEW_L_DO_CLE
         AND DOSSIER.L_SI_CLE = NEW_L_SI_CLE;
  END SP_IMPRESSION_DOSSIER;
  --Impression du rapport d'activits quotidienne
  PROCEDURE SP_GABARIT_NARRATION(NEW_DATE_DEBUT    IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                                 NEW_DATE_FIN      IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                                 NEW_L_SI_CLE      IN CO_COMMENTAIRE2.L_SI_CLE%TYPE,
                                 NEW_L_CO_GABARIT  IN CO_COMMENTAIRE2.L_CO_GABARIT%TYPE,
                                 rc1               IN OUT DTS_RAP_ACTIVITES) IS
  begin
    OPEN rc1 FOR
      SELECT E.V_EN_COMMENTAIRE,
             S.V_SI_SITE,
             D.D_DO_DATE_DEBUT,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "v_do_numero_dossier",
             C.CLOB_CO_TEXTE_FORMAT,
             SU.V_IN_NOM || ', ' || SU.V_IN_PRENOM INTERVENANT,
             SG.V_TR_DESCRIPTION GROUPE,
             TRTY.V_TR_DESCRIPTION || ' / ' || TRCA.V_TR_DESCRIPTION NATURE
        FROM EN_ENTITE          E,
             SI_SITE            S,
             V_DO_DOSSIER_CA_TY D,
             CO_COMMENTAIRE2    C,
             IN_INTERVENANT     SU,
             TR_TRADUCTION      SG,
             TR_TRADUCTION      TRTY,
             TR_TRADUCTION      TRCA
       WHERE C.L_CO_GABARIT = NEW_L_CO_GABARIT
         AND D.L_DO_CLE = C.L_CO_REFERENCE
         AND D.L_SI_CLE = C.L_CO_REF_SITE
         AND C.C_CO_REF_GENRE = 'DO'
         AND D.L_SI_CLE = S.L_SI_CLE
         AND (S.L_SI_CLE = NEW_L_SI_CLE OR NEW_L_SI_CLE = 0)
         AND S.I_EN_CLE = E.I_EN_CLE
         AND C.V_CO_CREE_PAR = SU.NAME
         AND SU.L_IN_SECTEUR = SG.L_TR_CLE
         AND SG.I_LA_CLE = 1
         AND C.D_CO_DATE_CREATION BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         AND D.I_CA_CLE = TRCA.L_TR_CLE
         AND TRCA.I_LA_CLE = 1
         AND D.I_TY_CLE = TRTY.L_TR_CLE
         AND TRTY.I_LA_CLE = 1
       order by E.V_EN_COMMENTAIRE,
                S.V_SI_SITE,
                D.D_DO_DATE_DEBUT,
                D.V_DO_NUMERO_DOSSIER,
                SU.V_IN_NOM || ', ' || SU.V_IN_PRENOM,
                SG.V_TR_DESCRIPTION;
  END SP_GABARIT_NARRATION;

  PROCEDURE SP_RAQ_NATURE(NEW_DATE_DEBUT IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                          NEW_DATE_FIN   IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                          NEW_I_NA_CLE   IN NA_NATURE.I_NA_CLE%TYPE,
                          rc1            IN OUT DTS_RAP_ACTIVITES) IS
  begin
    OPEN rc1 FOR
      SELECT E.V_EN_COMMENTAIRE,
             S.V_SI_SITE,
             D.D_DO_DATE_DEBUT,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "v_do_numero_dossier",
             C.CLOB_CO_TEXTE_FORMAT,
             SU.V_IN_NOM || ', ' || SU.V_IN_PRENOM INTERVENANT,
             SG.V_TR_DESCRIPTION GROUPE,
             TRTY.V_TR_DESCRIPTION || ' / ' || TRCA.V_TR_DESCRIPTION NATURE
        FROM EN_ENTITE          E,
             SI_SITE            S,
             V_DO_DOSSIER_CA_TY D,
             CO_COMMENTAIRE2    C,
             IN_INTERVENANT     SU,
             TR_TRADUCTION      SG,
             TR_TRADUCTION      TRTY,
             TR_TRADUCTION      TRCA
       WHERE C.L_CO_GABARIT = 1336
         AND D.L_DO_CLE = C.L_CO_REFERENCE
         AND D.L_SI_CLE = C.L_CO_REF_SITE
         AND C.C_CO_REF_GENRE = 'DO'
         AND D.L_SI_CLE = S.L_SI_CLE
         AND S.L_SI_CLE = 8
         AND D.i_na_cle = NEW_I_NA_CLE
         AND S.I_EN_CLE = E.I_EN_CLE
         AND C.V_CO_CREE_PAR = SU.NAME
         AND SU.L_IN_SECTEUR = SG.L_TR_CLE
         AND SG.I_LA_CLE = 1
         AND C.D_CO_DATE_CREATION BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         AND D.I_CA_CLE = TRCA.L_TR_CLE
         AND TRCA.I_LA_CLE = 1
         AND D.I_TY_CLE = TRTY.L_TR_CLE
         AND TRTY.I_LA_CLE = 1
       order by E.V_EN_COMMENTAIRE,
                S.V_SI_SITE,
                D.D_DO_DATE_DEBUT,
                D.V_DO_NUMERO_DOSSIER,
                SU.V_IN_NOM || ', ' || SU.V_IN_PRENOM,
                SG.V_TR_DESCRIPTION;
  END SP_RAQ_NATURE;

  PROCEDURE SP_RAQ_SANS_NATURE(NEW_DATE_DEBUT IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                               NEW_DATE_FIN   IN CO_COMMENTAIRE2.D_CO_DATE_CREATION%TYPE,
                               NEW_I_NA_CLE   IN NA_NATURE.I_NA_CLE%TYPE,
                               rc1            IN OUT DTS_RAP_ACTIVITES) IS
  begin
    OPEN rc1 FOR
      SELECT E.V_EN_COMMENTAIRE,
             S.V_SI_SITE,
             D.D_DO_DATE_DEBUT,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "v_do_numero_dossier",
             C.CLOB_CO_TEXTE_FORMAT,
             SU.V_IN_NOM || ', ' || SU.V_IN_PRENOM INTERVENANT,
             SG.V_TR_DESCRIPTION GROUPE,
             TRTY.V_TR_DESCRIPTION || ' / ' || TRCA.V_TR_DESCRIPTION NATURE
        FROM EN_ENTITE          E,
             SI_SITE            S,
             V_DO_DOSSIER_CA_TY D,
             CO_COMMENTAIRE2    C,
             IN_INTERVENANT     SU,
             TR_TRADUCTION      SG,
             TR_TRADUCTION      TRTY,
             TR_TRADUCTION      TRCA
       WHERE C.L_CO_GABARIT = 1336
         AND D.L_DO_CLE = C.L_CO_REFERENCE
         AND D.L_SI_CLE = C.L_CO_REF_SITE
         AND C.C_CO_REF_GENRE = 'DO'
         AND D.L_SI_CLE = S.L_SI_CLE
         AND D.i_na_cle != NEW_I_NA_CLE
         AND S.L_SI_CLE = 8
         AND S.I_EN_CLE = E.I_EN_CLE
         AND C.V_CO_CREE_PAR = SU.NAME
         AND SU.L_IN_SECTEUR = SG.L_TR_CLE
         AND SG.I_LA_CLE = 1
         AND C.D_CO_DATE_CREATION BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         AND D.I_CA_CLE = TRCA.L_TR_CLE
         AND TRCA.I_LA_CLE = 1
         AND D.I_TY_CLE = TRTY.L_TR_CLE
         AND TRTY.I_LA_CLE = 1
       order by E.V_EN_COMMENTAIRE,
                S.V_SI_SITE,
                D.D_DO_DATE_DEBUT,
                D.V_DO_NUMERO_DOSSIER,
                SU.V_IN_NOM || ', ' || SU.V_IN_PRENOM,
                SG.V_TR_DESCRIPTION;
  END SP_RAQ_SANS_NATURE;

  --Impression du rapport sur les statuts des dossiers (principalement enqutes)
  PROCEDURE SP_RAP_STATUT_DOSSIERS(NEW_I_NA_CLE IN NA_NATURE.I_NA_CLE%TYPE,
                                   rc1          IN OUT DTS_RAPPORT_STATUT_DOSSIERS) IS
  begin
    OPEN rc1 FOR
      SELECT CA.I_CA_CLE CLE_CATEGORIE,
             TY.I_NA_CLE NATURE,
             TRNA.V_TR_DESCRIPTION AS "NATURE_DESCRIPTION",
             TRTY.V_TR_DESCRIPTION || ' - ' || TRCA.V_TR_DESCRIPTION AS "CATEGORIE"
        FROM TR_TRADUCTION TRTY,
             TY_TYPE       TY,
             CA_CATEGORIE  CA,
             TR_TRADUCTION TRCA,
             TR_TRADUCTION TRNA
       WHERE TY.I_NA_CLE = NEW_I_NA_CLE
         AND CA.I_TY_CLE = TY.I_TY_CLE
         AND TY.I_TY_CLE = TRTY.L_TR_CLE
         AND TRTY.I_LA_CLE = 1
         AND CA.I_CA_CLE = TRCA.L_TR_CLE
         AND TRCA.I_LA_CLE = 1
         AND TY.I_NA_CLE = TRNA.L_TR_CLE
         AND TRNA.I_LA_CLE = 1
       order by TRTY.V_TR_DESCRIPTION || ' - ' || TRCA.V_TR_DESCRIPTION;
  END SP_RAP_STATUT_DOSSIERS;

  --Impression du rapport sur le journal des enquteurs
  PROCEDURE SP_RAP_JOURNAL_ENQUETES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                    NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                    NEW_I_NA_CLE   NA_NATURE.I_NA_CLE%TYPE,
                                    rc1            IN OUT DTS_RAPPORT_JOURNAL) IS
  begin
    OPEN rc1 FOR
      SELECT trty.v_tr_description || ' - ' || trca.v_tr_description as CATEGORIE
        from tr_traduction trty, tr_traduction trca, v_do_dossier_ca_ty d
       where d.i_na_cle = NEW_I_NA_CLE
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.i_ca_cle = trca.l_tr_cle
         and trca.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_cc_cle <> 14920
       order by trty.v_tr_description || ' - ' || trca.v_tr_description;
  END SP_RAP_JOURNAL_ENQUETES;

  --Impression du rapport mensuel sur les autoexclusions
  PROCEDURE SP_RAP_MENSUEL_AUTOEXCLUSIONS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          NEW_I_CA_CLE   IN DO_DOSSIER.I_CA_CLE%TYPE,
                                          rc1            IN OUT DTS_MENSUEL_AUTOEXCLUSIONS) IS
  begin
    OPEN rc1 FOR
      SELECT S.V_SI_SITE,
             DECODE(TPE.V_TR_DESCRIPTION,
                    'Fixe',
                    'Contrats sans conseiller  l''autoexclusion',
                    ' suivre (rencontre finale)',
                    'Contrat avec conseiller  l''autoexclusion',
                    'Avec conseiller  l''autoexclusion',
                    'Contrat avec conseiller  l''autoexclusion',
                    'Inconnus') CONTRATS,
             DECODE(I.B_IS_AIDE_INITIALE, 'yes', 'Oui', 'no ', 'Non', 'Non') AIDE_INITIALE,
             DECODE(I.B_IS_AIDE_IMMEDIATE,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'Non') AIDE_IMMEDIATE
        FROM V_DO_DOSSIER_CA_TY D,
             TR_TRADUCTION      TPE,
             SI_SITE            S,
             IS_INSCRIPTION     I
       WHERE D.D_DO_DATE_DEBUT >= NEW_DATE_DEBUT
         AND D.D_DO_DATE_DEBUT < NEW_DATE_FIN + 1
         AND D.I_CA_CLE = NEW_I_CA_CLE
         AND D.I_PE_CLE = TPE.L_TR_CLE(+)
         AND TPE.I_LA_CLE(+) = 1
         AND D.I_CC_CLE <> 14920
            --AND D.i_st_cle = 359
         AND D.L_DO_CLE = I.L_IS_REFERENCE
         AND D.L_SI_CLE = I.L_IS_REF_SITE
         AND I.D_IS_DATE_CREATION =
             (SELECT MAX(I2.D_IS_DATE_CREATION)
                FROM IS_INSCRIPTION I2
               WHERE D.L_DO_CLE = I2.L_IS_REFERENCE
                 AND D.L_SI_CLE = I2.L_IS_REF_SITE)
         AND D.L_SI_CLE = S.L_SI_CLE
       group by S.V_SI_SITE,
                d.v_do_numero_dossier,
                TPE.V_TR_DESCRIPTION,
                I.B_IS_AIDE_INITIALE,
                I.B_IS_AIDE_IMMEDIATE;
  END SP_RAP_MENSUEL_AUTOEXCLUSIONS;

  --Impression du cumul annuel des enqutes
  PROCEDURE SP_RAP_CUMUL_ANNUEL(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                rc1            IN OUT DTS_CUMUL_ANNUEL) IS
  begin
    OPEN rc1 FOR
      SELECT t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 16501
         and d.d_do_date_debut(+) >= NEW_DATE_DEBUT
         and d.d_do_date_debut(+) < NEW_DATE_FIN + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 16501
         and d.d_do_date_debut(+) >=
             to_date(to_char(to_number(to_char(NEW_DATE_DEBUT, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_DEBUT, 'MM-DD'),
                     'YYYY-MM-DD')
         and d.d_do_date_debut(+) <
             to_date(to_char(to_number(to_char(NEW_DATE_FIN, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_FIN, 'MM-DD'),
                     'YYYY-MM-DD') + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 16501
         and d.d_do_date_fin(+) >= NEW_DATE_DEBUT
         and d.d_do_date_fin(+) < NEW_DATE_FIN + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_st_cle(+) = 361
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 16501
         and d.d_do_date_fin(+) >=
             to_date(to_char(to_number(to_char(NEW_DATE_DEBUT, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_DEBUT, 'MM-DD'),
                     'YYYY-MM-DD')
         and d.d_do_date_fin(+) <
             to_date(to_char(to_number(to_char(NEW_DATE_FIN, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_FIN, 'MM-DD'),
                     'YYYY-MM-DD') + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_st_cle(+) = 361
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24468
         and d.d_do_date_debut(+) >= NEW_DATE_DEBUT
         and d.d_do_date_debut(+) < NEW_DATE_FIN
         and d.i_cc_cle(+) <> 14920
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24468
         and d.d_do_date_debut(+) >=
             to_date(to_char(to_number(to_char(NEW_DATE_DEBUT, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_DEBUT, 'MM-DD'),
                     'YYYY-MM-DD')
         and d.d_do_date_debut(+) <
             to_date(to_char(to_number(to_char(NEW_DATE_FIN, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_FIN, 'MM-DD'),
                     'YYYY-MM-DD') + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24468
         and d.d_do_date_fin(+) >= NEW_DATE_DEBUT
         and d.d_do_date_fin(+) < NEW_DATE_FIN + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_st_cle(+) = 361
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24468
         and d.d_do_date_fin(+) >=
             to_date(to_char(to_number(to_char(NEW_DATE_DEBUT, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_DEBUT, 'MM-DD'),
                     'YYYY-MM-DD')
         and d.d_do_date_fin(+) <
             to_date(to_char(to_number(to_char(NEW_DATE_FIN, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_FIN, 'MM-DD'),
                     'YYYY-MM-DD') + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_st_cle(+) = 361
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24424
         and d.d_do_date_debut(+) >= NEW_DATE_DEBUT
         and d.d_do_date_debut(+) < NEW_DATE_FIN + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24424
         and d.d_do_date_debut(+) >=
             to_date(to_char(to_number(to_char(NEW_DATE_DEBUT, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_DEBUT, 'MM-DD'),
                     'YYYY-MM-DD')
         and d.d_do_date_debut(+) <
             to_date(to_char(to_number(to_char(NEW_DATE_FIN, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_FIN, 'MM-DD'),
                     'YYYY-MM-DD') + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24424
         and d.d_do_date_fin(+) >= NEW_DATE_DEBUT
         and d.d_do_date_fin(+) < NEW_DATE_FIN + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_st_cle(+) = 361
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description
      union all
      select t.v_tr_description, count(d.l_do_cle)
        from v_do_dossier_ca_ty d, tr_traduction t
       where t.l_tr_cle = 24424
         and d.d_do_date_fin(+) >=
             to_date(to_char(to_number(to_char(NEW_DATE_DEBUT, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_DEBUT, 'MM-DD'),
                     'YYYY-MM-DD')
         and d.d_do_date_fin(+) <
             to_date(to_char(to_number(to_char(NEW_DATE_FIN, 'YYYY') - 1)) ||
                     to_char(NEW_DATE_FIN, 'MM-DD'),
                     'YYYY-MM-DD') + 1
         and d.i_cc_cle(+) <> 14920
         and d.i_st_cle(+) = 361
         and d.i_na_cle(+) = t.l_tr_cle
         and t.i_la_cle = 1
       group by t.v_tr_description;
  END SP_RAP_CUMUL_ANNUEL;

  PROCEDURE SP_RAP_CUMUL_HEBDO(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                               NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                               NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                               rc1            IN OUT DTS_CUMUL_HEBDO) IS
  begin
    OPEN rc1 FOR
      SELECT NA.I_NA_CLE,
             TRNA.V_TR_DESCRIPTION NATURE,
             COUNT(D.L_DO_CLE) TOTAL
        FROM TR_TRADUCTION TRNA,
             NA_NATURE     NA,
             TY_TYPE       TY,
             CA_CATEGORIE  CA,
             DO_DOSSIER    D
       WHERE NA.I_GE_CLE = 24423
         and na.i_na_cle <> 26707 -- Le journal est trait part.
         AND CA.I_TY_CLE = TY.I_TY_CLE
         AND TY.I_NA_CLE = NA.I_NA_CLE
         AND NA.I_NA_CLE = TRNA.L_TR_CLE
         AND TRNA.I_LA_CLE = 1
         AND CA.I_CA_CLE = D.I_CA_CLE(+)
         AND D.D_DO_DATE_DEBUT(+) >= NEW_DATE_DEBUT
         AND D.D_DO_DATE_DEBUT(+) < NEW_DATE_FIN + 1
         AND D.I_CC_CLE(+) <> 14920
       GROUP BY NA.I_NA_CLE, TRNA.V_TR_DESCRIPTION
       ORDER BY TRNA.V_TR_DESCRIPTION;
  END SP_RAP_CUMUL_HEBDO;
  --Rapport sur les enqutes de rclamations PAR (Personnes au registre)
  PROCEDURE SP_RAPPORT_PAR(NEW_ANNEE_MOIS IN VARCHAR2,
                           rc1            IN OUT DTS_RAPPORT_PAR) IS
  begin
    OPEN rc1 FOR
      select 'total', count(d.l_do_cle)
        from v_do_dossier_ca_ty d
       where d.i_na_cle = 24424
         and to_char(d.d_do_date_debut, 'YYYY-MM') = NEW_ANNEE_MOIS
      union all
      select 'PAR moins 10000', count(d.l_do_cle)
        from v_do_dossier_ca_ty d
       where d.i_ca_cle in (26098, 24442, 24444, 24454, 24455)
         and to_char(d.d_do_date_debut, 'YYYY-MM') = NEW_ANNEE_MOIS
      union all
      select 'PAR plus 10000', count(d.l_do_cle)
        from v_do_dossier_ca_ty d
       where d.i_ca_cle in (24441, 24443, 24445, 24446, 24456)
         and to_char(d.d_do_date_debut, 'YYYY-MM') = NEW_ANNEE_MOIS
      union all
      select 'Non PAR', count(d.l_do_cle)
        from v_do_dossier_ca_ty d
       where d.i_na_cle = 24424
         and d.i_ca_cle not in (26098, 24442, 24444, 24454, 24455, 24441,
              24443, 24445, 24446, 24456)
         and to_char(d.d_do_date_debut, 'YYYY-MM') = NEW_ANNEE_MOIS;
  END SP_RAPPORT_PAR;
  --Listes des dossiers partags
  PROCEDURE SP_LISTES_PARTAGE(rc1 IN OUT DTS_LISTES_PARTAGE) IS
  begin
    OPEN rc1 FOR
      SELECT substr(do.v_do_numero_dossier, 1, 3) || '-' ||
             substr(do.v_do_numero_dossier, 4, 8) || '-' ||
             substr(do.v_do_numero_dossier, 12, 16) AS "Numro Cardex",
             DO.V_DO_ANCIENNE_REFERENCE as "Numro dossier",
             SU2.V_IN_NOM || ', ' || SU2.V_IN_PRENOM || ' (' ||
             DO.v_do_assigne_a || ', ' || TRSC.V_TR_DESCRIPTION || ')' as "Intervenant du dossier",
             EN.V_EN_COMMENTAIRE as "Entit",
             SI.V_SI_SITE as "Site",
             TRGE.V_TR_DESCRIPTION as "Genre",
             TRNA.V_TR_DESCRIPTION as "Nature",
             TRTY.V_TR_DESCRIPTION as "Type",
             TRCA.V_TR_DESCRIPTION as "Catgorie",
             TRST.V_TR_DESCRIPTION as "Statut",
             TRSC.V_TR_DESCRIPTION as "Secteur",
             SU.V_IN_NOM || ', ' || SU.V_IN_PRENOM || ' (' || SU.NAME || ')' as "Intervenant autoris",
             SU3.V_IN_NOM || ', ' || SU3.V_IN_PRENOM || ' (' || SU3.NAME || ')' as "Responsable",
             LPD.D_LPD_DATE_CREATION as "Date dassignation"
        FROM V_DO_DOSSIER_CA_TY  DO,
             SI_SITE             SI,
             EN_ENTITE           EN,
             TR_TRADUCTION       TRGE,
             TR_TRADUCTION       TRNA,
             TR_TRADUCTION       TRTY,
             TR_TRADUCTION       TRCA,
             TR_TRADUCTION       TRST,
             TR_TRADUCTION       TRSC,
             LPD_PARTAGE_DOSSIER LPD,
             IN_INTERVENANT      SU,
             IN_INTERVENANT      SU2,
             IN_INTERVENANT      SU3
       WHERE DO.I_GE_CLE = TRGE.L_TR_CLE
         AND DO.I_NA_CLE = TRNA.L_TR_CLE
         AND DO.I_TY_CLE = TRTY.L_TR_CLE
         AND DO.I_CA_CLE = TRCA.L_TR_CLE
         AND TRGE.I_LA_CLE = 1
         AND TRNA.I_LA_CLE = 1
         AND TRTY.I_LA_CLE = 1
         AND TRCA.I_LA_CLE = 1
         AND DO.L_SI_CLE = SI.L_SI_CLE
         AND SI.I_EN_CLE = EN.I_EN_CLE
         AND DO.I_ST_CLE = TRST.L_TR_CLE
         AND TRST.I_LA_CLE = 1
         AND SU2.L_IN_SECTEUR = TRSC.L_TR_CLE
         AND TRSC.I_LA_CLE = 1
         AND LPD.V_LPD_NAME = SU.NAME
         AND DO.v_do_assigne_a = SU2.NAME
         AND LPD.v_Lpd_Cree_Par = SU3.NAME
         AND (LPD.L_LPD_REFERENCE = DO.L_DO_CLE AND
             LPD.L_LPD_REF_SITE = DO.L_SI_CLE);
  END SP_LISTES_PARTAGE;

  PROCEDURE SP_RAP_SUIVI_30_JOURS(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                       NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                  rc1                  IN OUT DTS_SUIVIS) IS
  begin
    OPEN rc1 FOR
      select su.v_in_nom || ', ' || su.v_in_prenom "Demandeur",
             su2.v_in_nom || ', ' || su2.v_in_prenom "Intervenant",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Dossier",
             d.d_do_date_debut "Date de dbut",
             trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) -
                 24 *
                 (trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) -
                 60 *
                 (trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60))) ||
             ' m ' "cart Dbut-Prvue",
             s.d_sv_date_completee "Date complte",
             s.d_sv_date_prevue "Date prvue",
             trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) -
                 24 *
                 (trunc((((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) -
                 60 *
                 (trunc(((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60))) ||
             ' m ' "cart Complte-Prvue"
        from v_do_dossier_ca_ty d,
             sv_suivi           s,
             in_intervenant     su,
             in_intervenant     su2
       where d.l_si_cle = NEW_L_SI_CLE
         and d.l_do_cle = s.l_sv_reference
         and d.l_si_cle = s.l_sv_ref_site
         and d.l_si_cle = 8
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle = 24468
         and s.d_sv_date_completee is not null
         and s.d_sv_date_prevue is not null
         and s.v_sv_demandeur = su.name
         and s.v_sv_intervenant = su2.name
         and s.i_tc_cle = 25088
         and trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue) / 60) / 60) / 24)) >= 30;
  END SP_RAP_SUIVI_30_JOURS;
  PROCEDURE SP_RAP_30_JOURS_INTERVENANT(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                       NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                        rc1                  IN OUT DTS_SUIVIS) IS
  begin
    OPEN rc1 FOR
      select su.v_in_nom || ', ' || su.v_in_prenom "Demandeur",
             su2.v_in_nom || ', ' || su2.v_in_prenom "Intervenant",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) "Dossier",
             d.d_do_date_debut "Date de dbut",
             trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) -
                 24 *
                 (trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) -
                 60 *
                 (trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60))) ||
             ' m ' "cart Dbut-Prvue",
             s.d_sv_date_completee "Date complte",
             s.d_sv_date_prevue "Date prvue",
             trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) -
                 24 *
                 (trunc((((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) -
                 60 *
                 (trunc(((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60))) ||
             ' m ' "cart Complte-Prvue"
        from v_do_dossier_ca_ty d,
             sv_suivi           s,
             in_intervenant     su,
             in_intervenant     su2
       where d.l_si_cle = NEW_L_SI_CLE
         and d.l_do_cle = s.l_sv_reference
         and d.l_si_cle = s.l_sv_ref_site
         and d.l_si_cle = 8
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle = 24468
         and s.d_sv_date_completee is not null
         and s.d_sv_date_prevue is not null
         and s.v_sv_intervenant like NEW_V_SV_INTERVENANT
         and s.v_sv_demandeur = su.name
         and s.v_sv_intervenant = su2.name
         and s.i_tc_cle = 25088
         and trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue) / 60) / 60) / 24)) >= 30;
  END SP_RAP_30_JOURS_INTERVENANT;
  PROCEDURE SP_RAP_SUIVI_24_HEURES(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                       NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                   rc1                  IN OUT DTS_SUIVIS) IS
  begin
    OPEN rc1 FOR
      select su.v_in_nom || ', ' || su.v_in_prenom "Demandeur",
             su2.v_in_nom || ', ' || su2.v_in_prenom "Intervenant",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Dossier",
             d.d_do_date_debut "Date de dbut",
             trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) -
                 24 *
                 (trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) -
                 60 *
                 (trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60))) ||
             ' m ' "cart Dbut-Prvue",
             s.d_sv_date_completee "Date complte",
             s.d_sv_date_prevue "Date prvue",
             trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) -
                 24 *
                 (trunc((((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) -
                 60 *
                 (trunc(((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60))) ||
             ' m ' "cart Complte-Prvue"
        from v_do_dossier_ca_ty d,
             sv_suivi           s,
             in_intervenant     su,
             in_intervenant     su2
       where d.l_si_cle = NEW_L_SI_CLE
         and d.l_do_cle = s.l_sv_reference
         and d.l_si_cle = s.l_sv_ref_site
         and d.l_si_cle = 8
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle = 24468
         and s.d_sv_date_completee is not null
         and s.d_sv_date_prevue is not null
         and s.v_sv_intervenant like NEW_V_SV_INTERVENANT
         and s.v_sv_demandeur = su.name
         and s.v_sv_intervenant = su2.name
         and s.i_tc_cle = 25086
         and trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue) / 60) / 60) / 24)) >= 1;
  END SP_RAP_SUIVI_24_HEURES;
  PROCEDURE SP_RAP_SUIVI_21_JOURS(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                       NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                  rc1                  IN OUT DTS_SUIVIS) IS
  begin
    OPEN rc1 FOR
      select su.v_in_nom || ', ' || su.v_in_prenom "Demandeur",
             su2.v_in_nom || ', ' || su2.v_in_prenom "Intervenant",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Dossier",
             d.d_do_date_debut "Date de dbut",
             trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) -
                 24 *
                 (trunc((((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) -
                 60 *
                 (trunc(((86400 * (s.d_sv_date_prevue - d.d_do_date_debut)) / 60) / 60))) ||
             ' m ' "cart Dbut-Prvue",
             s.d_sv_date_completee "Date complte",
             s.d_sv_date_prevue "Date prvue",
             trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) -
                 24 *
                 (trunc((((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 *
                       (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) -
                 60 *
                 (trunc(((86400 *
                        (s.d_sv_date_completee - s.d_sv_date_prevue)) / 60) / 60))) ||
             ' m ' "cart Complte-Prvue"
        from v_do_dossier_ca_ty d,
             sv_suivi           s,
             in_intervenant     su,
             in_intervenant     su2
       where d.l_si_cle = NEW_L_SI_CLE
         and d.l_do_cle = s.l_sv_reference
         and d.l_si_cle = s.l_sv_ref_site
         and d.l_si_cle = 8
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle = 24468
         and s.d_sv_date_completee is not null
         and s.d_sv_date_prevue is not null
         and s.v_sv_intervenant like NEW_V_SV_INTERVENANT
         and s.v_sv_demandeur = su.name
         and s.v_sv_intervenant = su2.name
         and s.i_tc_cle = 25087
         and trunc((((86400 * (s.d_sv_date_completee - s.d_sv_date_prevue) / 60) / 60) / 24)) >= 21;
  END SP_RAP_SUIVI_21_JOURS;

  --Rapport sur les suivis d'investigation (CDX_0094)
  PROCEDURE SP_RAP_SUIVI_INVESTIGATION(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                       NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                       NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                       rc1                  IN OUT DTS_SUIVIS_INVESTIGATION) IS
  begin
    OPEN rc1 FOR
      select si.v_si_site as "Site",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Dossier",
             d.v_do_ancienne_reference as "Provenance de la demande",
             s.v_su_nom || ', ' || s.v_su_prenom as "Individu",
             sv.v_sv_intervenant as "Suivi - Intervenant",
             sv.d_sv_date_prevue as "Suivi - date prvue",
             sv.d_sv_date_completee as "Suivi - date complte",
             trunc((((86400 *
                   (sv.d_sv_date_completee - sv.d_sv_date_prevue)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 *
                       (sv.d_sv_date_completee - sv.d_sv_date_prevue)) / 60) / 60) -
                 24 * (trunc((((86400 * (sv.d_sv_date_completee -
                             sv.d_sv_date_prevue)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 *
                       (sv.d_sv_date_completee - sv.d_sv_date_prevue)) / 60) -
                 60 * (trunc(((86400 * (sv.d_sv_date_completee -
                             sv.d_sv_date_prevue)) / 60) / 60))) || ' m ' as "Ecart"
        from do_dossier       d,
             ldd_lien_dossier l,
             su_sujet         s,
             sv_suivi         sv,
             si_site          si
       where d.l_si_cle = NEW_L_SI_CLE
         and d.l_si_cle = si.l_si_cle
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and (sv.i_tc_cle = NEW_I_TC_CLE or NEW_I_TC_CLE = 0)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.l_do_cle = sv.l_sv_reference
         and d.l_si_cle = sv.l_sv_ref_site
         and sv.d_sv_date_completee is not null
         and sv.v_sv_intervenant like NEW_V_SV_INTERVENANT
       order by d.l_si_cle desc, d.v_do_numero_dossier, sv.v_sv_intervenant;
  END SP_RAP_SUIVI_INVESTIGATION;

  --Rapport sur les retards des suivis d'investigation (CDX_0095)
  
  
  PROCEDURE SP_RAP_SUIVI_RETARDS(NEW_DATE_DEBUT       IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                 NEW_DATE_FIN         IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                 NEW_L_SI_CLE         IN DO_DOSSIER.L_SI_CLE%TYPE,
                                 NEW_V_SV_INTERVENANT SV_SUIVI.V_SV_INTERVENANT%TYPE,
                                 NEW_I_TC_CLE         SV_SUIVI.I_TC_CLE%TYPE,
                                 rc1                  IN OUT DTS_SUIVIS_RETARDS) IS
  begin
    OPEN rc1 FOR
      select si.v_si_site as "Site",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Dossier",
             d.v_do_ancienne_reference as "Provenance de la demande",
             s.v_su_nom || ', ' || s.v_su_prenom as "Individu",
             sv.v_sv_intervenant as "Suivi - Intervenant",
             sv.d_sv_date_prevue as "Suivi - date prvue",
             sv.d_sv_date_completee as "Suivi - date complte",
             trunc((((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60) / 24) ||
             ' j ' ||
             abs(trunc(((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60) -
                 24 *
                 (trunc((((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60) / 24))) ||
             ' h ' ||
             abs(trunc((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) -
                 60 *
                 (trunc(((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60))) ||
             ' m ' as "Ecart",
             round(avg(sysdate - sv.d_sv_date_prevue), 2) as "Moyenne"
        from do_dossier       d,
             ldd_lien_dossier l,
             su_sujet         s,
             sv_suivi         sv,
             si_site          si
       where d.l_si_cle = NEW_L_SI_CLE
         and d.l_si_cle = si.l_si_cle
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (sv.i_tc_cle = NEW_I_TC_CLE or NEW_I_TC_CLE = 0)
         and d.l_do_cle = sv.l_sv_reference
         and d.l_si_cle = sv.l_sv_ref_site
         and sv.d_sv_date_completee is null
         and sysdate > sv.d_sv_date_prevue
         and sv.v_sv_intervenant like NEW_V_SV_INTERVENANT
       group by si.v_si_site,
                substr(d.v_do_numero_dossier, 1, 3) || '-' ||
                substr(d.v_do_numero_dossier, 4, 8) || '-' ||
                substr(d.v_do_numero_dossier, 12, 16),
                d.v_do_ancienne_reference,
                s.v_su_nom || ', ' || s.v_su_prenom,
                sv.v_sv_intervenant,
                sv.d_sv_date_prevue,
                sv.d_sv_date_completee,
                trunc((((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60) / 24) ||
                ' j ' ||
                abs(trunc(((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60) -
                    24 *
                    (trunc((((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60) / 24))) ||
                ' h ' ||
                abs(trunc((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) -
                    60 *
                    (trunc(((86400 * (sysdate - sv.d_sv_date_prevue)) / 60) / 60))) ||
                ' m ',
                sv.d_sv_date_prevue;
  END SP_RAP_SUIVI_RETARDS;

  --Rapport sur les accs aux dossiers
  PROCEDURE SP_RAPPORT_ACCES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                             NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                             NEW_L_SI_CLE   IN SI_SITE.L_SI_CLE%TYPE,
                             rc1            IN OUT DTS_ACCES) IS
  begin
    OPEN rc1 FOR
      select a.v_ac_name,
             s.v_in_nom || ', ' || s.v_in_prenom "description",
             t.v_ta_type_acces,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "V_DO_NUMERO_DOSSIER"
        from ac_acces a, do_dossier d, ta_type_acces t, in_intervenant s
       where a.d_ac_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         and a.l_ori_cle = d.l_do_cle
         and a.l_ori_site = d.l_si_cle
         and a.c_gf_origine = 'DO'
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = s.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0);
  END SP_RAPPORT_ACCES;

  --Rapport sommaire sur les accs des intervenants
  PROCEDURE SP_RAPPORT_ACCES_INTERVENANT(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                         NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                         NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                         rc1             IN OUT DTS_ACCES_INTERVENANT) IS
  begin
    OPEN rc1 FOR
      select a.v_ac_name,
             s.v_in_nom || ', ' || s.v_in_prenom "description",
             g.v_gf_genre_fichier,
             t.v_ta_type_acces
        from ac_acces         a,
             ta_type_acces    t,
             in_intervenant   s,
             gf_genre_fichier g
       where a.d_ac_date_acces >= NEW_DATE_DEBUT
         and a.d_ac_date_acces < NEW_DATE_FIN + 1
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = s.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and a.v_ac_name like NEW_INTERVENANT
         and a.c_gf_origine = g.c_gf_cle;
  END SP_RAPPORT_ACCES_INTERVENANT;

  --Rapport sommaire pour les rencontres initiales
  PROCEDURE SP_RAPPORT_RENCONTRES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                  NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                  rc1            IN OUT DTS_RAPPORT_RENCONTRES) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site, COUNT(i.L_IS_CLE) RENCONTRE_INITIALE
        from v_do_dossier_ca_ty d, si_site s, is_inscription i
       where i.d_is_rencontre_initiale(+) >= NEW_DATE_DEBUT
         and i.d_is_rencontre_initiale(+) < NEW_DATE_FIN + 1
         and d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and d.l_do_cle = i.l_is_reference(+)
         and d.l_si_cle = i.l_is_ref_site(+)
         and d.l_si_cle = s.l_si_cle
       group by s.v_si_site;
  END SP_RAPPORT_RENCONTRES;

  --Rapport dtaill pour les rencontres initiales
  PROCEDURE SP_RAPPORT_RENCONTRES_DETAIL(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                         rc1            IN OUT DTS_RAPPORT_RENCONTRES_DETAIL) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) dossier,
             i.d_is_rencontre_initiale rencontre_initiale
        from v_do_dossier_ca_ty d, si_site s, is_inscription i
       where i.d_is_rencontre_initiale >= NEW_DATE_DEBUT
         and i.d_is_rencontre_initiale < NEW_DATE_FIN + 1
         and d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and d.l_si_cle = s.l_si_cle;
  END SP_RAPPORT_RENCONTRES_DETAIL;

  --Rapport sur les dossiers actifs par intervenant
  PROCEDURE SP_RAP_DOSSIERS_ACTIFS(NEW_GENRE       IN GE_GENRE.I_GE_CLE%TYPE,
                                   NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                   NEW_L_SI_CLE    IN DO_DOSSIER.L_SI_CLE%TYPE,
                                   rc1             IN OUT DTS_DOSSIERS_ACTIFS) IS
  BEGIN
    OPEN rc1 FOR
      SELECT u.V_IN_NOM || ', ' || u.V_IN_PRENOM as "INTERVENANT",
             tna.v_tr_description as "DOSSIER",
             v.l_do_cle as "TOTAL",
             tge.v_tr_description as "GENRE"
        FROM v_do_dossier_ca_ty v,
             tr_traduction      tna,
             in_intervenant     u,
             tr_traduction      tge
       where v.i_st_cle = 359
         and v.l_si_cle = NEW_L_SI_CLE
         and v.v_do_assigne_a like NEW_INTERVENANT
         and v.i_na_cle = tna.l_tr_cle
         and tna.i_la_cle = 1
         and v.i_ge_cle = tge.l_tr_cle
         and tge.i_la_cle = 1
         and (NEW_GENRE = 0 or v.i_ge_cle = NEW_GENRE)
            --and v.i_ge_cle = NEW_GENRE
         and v.v_do_assigne_a = u.name
         and v.i_cc_cle <> 14920
       order by tge.v_tr_description;
  END SP_RAP_DOSSIERS_ACTIFS;

  --Rapport sur les dossiers actifs par enquteur de Loto-Qubec
  PROCEDURE SP_RAP_DOSSIERS_ACTIFS_ENQ_LQ(rc1 IN OUT DTS_DOSSIERS_ACTIFS) IS
  BEGIN
    OPEN rc1 FOR
      SELECT u.V_IN_NOM || ', ' || u.V_IN_PRENOM as "INTERVENANT",
             tna.v_tr_description as "DOSSIER",
             v.l_do_cle as "TOTAL",
             tge.v_tr_description as "GENRE"
        FROM v_do_dossier_ca_ty v,
             tr_traduction      tna,
             in_intervenant     u,
             tr_traduction      tge
       where v.i_st_cle = 359
         and v.l_si_cle = 8
         and v.i_na_cle = tna.l_tr_cle
         and tna.i_la_cle = 1
         and v.i_ge_cle = tge.l_tr_cle
         and tge.i_la_cle = 1
         and v.i_na_cle not in (24024, 26542)
         and v.i_ge_cle <> 27073
         and v.v_do_assigne_a = u.name
         and v.i_cc_cle <> 14920
         and u.l_in_secteur in (262, 246)
       order by tge.v_tr_description;
  END SP_RAP_DOSSIERS_ACTIFS_ENQ_LQ;

  --Rapport sur le registre des RFC (rclamants frquents connus) matre
  PROCEDURE SP_RAP_REGISTRE_RFC_MAITRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       rc1            IN OUT DTS_REGISTRE_RFC_MAITRE) IS
  begin
    OPEN rc1 FOR
      select s.v_su_nom as "NOM",
             s.v_su_prenom as "PRENOM",
             trsx.v_tr_description as "SEXE",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "RFC_MAITRE",
             d.v_do_reference1 as "REFERENCE1"
        from do_dossier       d,
             ldd_lien_dossier ld2,
             su_sujet         s,
             tr_traduction    trsx
       where d.i_ca_cle = 26057
         and d.l_do_cle = ld2.l_do_cle
         and ld2.l_ldd_dossier_associe = s.l_su_cle
         and s.i_sx_cle = trsx.l_tr_cle
         and trsx.i_la_cle = 1
         and d.i_st_cle = 360
         AND D.D_DO_DATE_CREATION >= NEW_DATE_DEBUT
         and D.D_DO_DATE_CREATION < NEW_DATE_FIN + 1;
  END SP_RAP_REGISTRE_RFC_MAITRE;

  --Rapport sommaire pour les rencontres finales
  PROCEDURE SP_RAPPORT_RENCONTRES_FINALES(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                          NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                          rc1            IN OUT DTS_RAPPORT_RENCONTRES_FINALES) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site, COUNT(i.L_IS_CLE) RENCONTRE_FINALE
        from v_do_dossier_ca_ty d, si_site s, is_inscription i
       where i.d_is_rencontre_finale(+) >= NEW_DATE_DEBUT
         and i.d_is_rencontre_finale(+) < NEW_DATE_FIN + 1
         and d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and d.l_do_cle = i.l_is_reference(+)
         and d.l_si_cle = i.l_is_ref_site(+)
         and d.l_si_cle = s.l_si_cle
       group by s.v_si_site;
  END SP_RAPPORT_RENCONTRES_FINALES;

  --Rapport dtaill pour les rencontres finales
  PROCEDURE SP_MENSUEL_RENC_FINALES_DETAIL(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                           rc1            IN OUT DTS_RAP_RENC_FINALES_DETAIL) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site,
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) dossier,
             i.d_is_rencontre_finale rencontre_finale
        from v_do_dossier_ca_ty d, si_site s, is_inscription i
       where i.d_is_rencontre_finale >= NEW_DATE_DEBUT
         and i.d_is_rencontre_finale < NEW_DATE_FIN + 1
         and d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and d.l_si_cle = s.l_si_cle;
  END SP_MENSUEL_RENC_FINALES_DETAIL;

  --Rapport sur la cohrence des donnes (diffr)
  PROCEDURE SP_RAP_COHERENCE(rc1 IN OUT DTS_RAP_COHERENCE) IS
  BEGIN
    OPEN rc1 FOR
      select 'Dossiers d''autoexclusion sans inscription' as "Type",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Description"
        from do_dossier d
       where d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and not exists (select i.l_is_cle
                from is_inscription i
               where i.l_is_reference = d.l_do_cle
                 and i.l_is_ref_site = d.l_si_cle)
      union all
      select 'Dossiers d''autoexclusion sans sujet' as "Type",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Description"
        from do_dossier d
       where d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and not exists (select l.l_do_cle
                from ldd_lien_dossier l
               where d.l_do_cle = l.l_do_cle
                 and d.l_si_cle = l.l_do_site
                 and l.c_do_genre = 'DO'
                 and l.c_ldd_genre = 'SU')
      union all
      select 'Dossiers d''autoexclusion sans date de fin' as "Type",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Description"
        from do_dossier d
       where d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and d.d_do_date_fin is null
      union all
      select 'Sujets orphelins' as "Type",
             s.v_su_reference_3 as "Description"
        from su_sujet s
       where not exists
       (select l.l_do_cle
                from ldd_lien_dossier l
               where ((s.l_su_cle = l.l_do_cle and s.l_si_cle = l.l_do_site and
                     l.c_do_genre = 'SU') or
                     (s.l_su_cle = l.l_ldd_dossier_associe and
                     s.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'SU')))
         and s.i_cc_cle <> 14920
      union all
      select 'Socits orphelines' as "Type", so.v_so_nom as "Description"
        from so_societe so
       where not exists
       (select l.l_do_cle
                from ldd_lien_dossier l
               where ((so.l_so_cle = l.l_do_cle and
                     so.l_si_cle = l.l_do_site and l.c_do_genre = 'SO') or
                     (so.l_so_cle = l.l_ldd_dossier_associe and
                     so.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'SO')))
         and so.l_si_cle <> 8 --(Loto-Qubec)
         and so.i_cc_cle <> 14920
      union all
      select 'Vhicules orphelins' as "Type",
             v.v_ve_immatriculation as "Description"
        from ve_vehicule v
       where not exists
       (select l.l_do_cle
                from ldd_lien_dossier l
               where ((v.l_ve_cle = l.l_do_cle and v.l_si_cle = l.l_do_site and
                     l.c_do_genre = 'VE') or
                     (v.l_ve_cle = l.l_ldd_dossier_associe and
                     v.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'VE')))
         and v.i_cc_cle <> 14920
      union all
      select 'Doublons de dossiers' as "Type",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Description"
        from do_dossier d
       where d.i_cc_cle <> 14920
       group by d.v_do_numero_dossier
      having count(d.v_do_numero_dossier) > 1
      union all
      select 'Dossiers ambulance sans rfrence 3 et avec socit ambulance' as "Type",
             substr(vdo.v_do_numero_dossier, 1, 3) || '-' ||
             substr(vdo.v_do_numero_dossier, 4, 8) || '-' ||
             substr(vdo.v_do_numero_dossier, 12, 16) as "Description"
        from v_do_dossier_ca_ty vdo, co_commentaire2 c
       where vdo.i_ty_cle = 194
         and vdo.v_do_reference5 is null
         and vdo.l_do_cle = c.l_co_reference
         and vdo.l_si_cle = c.l_co_ref_site
         and c.c_co_ref_genre = 'DO'
         and contains(c.CLOB_CO_TEXTE_NORMAL, '$ambulance', 1) > 0
         and vdo.i_cc_cle < 14920
         and exists (select s.l_so_cle
                from ldd_lien_dossier l, so_societe s
               where vdo.l_do_cle = l.l_do_cle
                 and vdo.l_si_cle = l.l_do_site
                 and l.c_do_genre = 'DO'
                 and l.l_ldd_dossier_associe = s.l_so_cle
                 and l.l_ldd_site = s.l_si_cle
                 and l.c_ldd_genre = 'SO'
                 and s.i_cl_cle = 23910)
      union all
      select 'Dossiers ambulance avec rfrence 3 et sans socit ambulance' as "Type",
             substr(vdo.v_do_numero_dossier, 1, 3) || '-' ||
             substr(vdo.v_do_numero_dossier, 4, 8) || '-' ||
             substr(vdo.v_do_numero_dossier, 12, 16) as "Description"
        from v_do_dossier_ca_ty vdo, co_commentaire2 c
       where vdo.i_ty_cle = 194
         and vdo.v_do_reference5 is not null
         and vdo.l_do_cle = c.l_co_reference
         and vdo.l_si_cle = c.l_co_ref_site
         and c.c_co_ref_genre = 'DO'
         and contains(c.CLOB_CO_TEXTE_NORMAL, '$ambulance', 1) > 0
         and vdo.i_cc_cle < 14920
         and not exists (select s.l_so_cle
                from ldd_lien_dossier l, so_societe s
               where vdo.l_do_cle = l.l_do_cle
                 and vdo.l_si_cle = l.l_do_site
                 and l.c_do_genre = 'DO'
                 and l.l_ldd_dossier_associe = s.l_so_cle
                 and l.l_ldd_site = s.l_si_cle
                 and l.c_ldd_genre = 'SO'
                 and s.i_cl_cle = 23910)
      union all
      select 'Dossiers d''enqute fonds sans narration' as "Type",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Description"
        from v_do_dossier_ca_ty d
       where (d.i_ge_cle = 413 or d.i_ge_cle = 16500)
         and d.i_cc_cle <> 14920
         and d.i_st_cle <> 359
         and d.l_si_cle <> 25 --Acheteurs mystres
         and d.i_do_fonde = 16123 --Fonds
         and not exists (select c.l_co_cle
                from co_commentaire2 c
               where d.l_do_cle = c.l_co_reference
                 and d.l_si_cle = c.l_co_ref_site
                 and c.c_co_ref_genre = 'DO')
      union all
      select distinct 'Sujets en double' as "Type",
                      su1.v_su_nom || ', ' || su1.v_su_prenom as "Description"
        from su_sujet su1, su_sujet su2
       where (su1.v_su_nom, su1.v_su_prenom,
              to_char(su1.d_su_date_naissance, 'YYYY-MM-DD')) in
             (select su.v_su_nom,
                     su.v_su_prenom,
                     to_char(su.d_su_date_naissance, 'YYYY-MM-DD')
                from su_sujet su
               where su.i_cc_cle != 14920 and su.b_su_ind_rdd <> 'yes'
               group by su.v_su_nom, su.v_su_prenom, su.d_su_date_naissance
              having count(su.v_su_nom || su.v_su_prenom || su.d_su_date_naissance) > 1)
         and (su2.v_su_nom, su2.v_su_prenom,
              to_char(su2.d_su_date_naissance, 'YYYY-MM-DD')) in
             (select su.v_su_nom,
                     su.v_su_prenom,
                     to_char(su.d_su_date_naissance, 'YYYY-MM-DD')
                from su_sujet su
               where su.i_cc_cle != 14920 and nvl(su1.b_su_ind_rdd,'no') = 'no' and nvl(su2.b_su_ind_rdd,'no') = 'no'
               group by su.v_su_nom, su.v_su_prenom, su.d_su_date_naissance
              having count(su.v_su_nom || su.v_su_prenom || su.d_su_date_naissance) > 1)
         and (su1.l_su_cle != su2.l_su_cle or su1.l_si_cle != su2.l_si_cle)
         and su1.v_su_nom = su2.v_su_nom
         and su1.v_su_prenom = su2.v_su_prenom
         and su1.d_su_date_naissance = su2.d_su_date_naissance
      union all
      select 'Socits en double' as "Type",
             so.v_so_nom || ' (' || so.v_so_reference_3 || ')' as "Description"
        from so_societe so
       where so.i_cc_cle != 14920
       group by so.v_so_nom || ' (' || so.v_so_reference_3 || ')'
      having count(so.v_so_nom || so.v_so_reference_3) > 1
      union all
      select 'Vhicules en double' as "Type",
             ve.v_ve_immatriculation as "Description"
        from ve_vehicule ve
       where ve.i_cc_cle != 14920
       and ve.v_ve_immatriculation is not null
       group by ve.v_ve_immatriculation
      having count(ve.v_ve_immatriculation||ve.i_md_cle) > 1
      union all
       select 'Vhicules en double' as "Type",
              ve.v_ve_immatriculation as "Description"
         from ve_vehicule ve
        where ve.i_cc_cle != 14920
          and ve.v_ve_immatriculation is not null
        group by ve.v_ve_immatriculation, ve.v_ve_immatriculation||ve.c_ve_annee
       having count(ve.v_ve_immatriculation||ve.c_ve_annee) > 1
      union all
      SELECT 'Photos non cres' as "Type",
             to_char(m.l_em_cle) || '.' || m.v_mm_extension || ', ' ||
             m.v_mm_cree_par || ', ' || m.d_mm_date_creation as "Description"
        FROM mm_multimedia m
       where m.d_mm_date_creation >= sysdate - 10
         and cardex_lien.f_existe(to_char(m.l_em_cle) || '.' ||
                                  m.v_mm_extension) is null
      union all
      SELECT 'RFC rclamation non relis' as "Type",
             d.v_do_numero_dossier as "Description"
        from do_dossier d
       where d.i_ca_cle = 26058
         and d.i_cc_cle != 14920
         and not exists
       (select d2.v_do_numero_dossier
                from ldd_lien_dossier ld, do_dossier d2
               where (d.l_do_cle = ld.l_do_cle and d.l_si_cle = ld.l_do_site and
                     ld.c_do_genre = 'DO' and
                     ld.l_ldd_dossier_associe = d2.l_do_cle and
                     ld.l_ldd_site = d2.l_si_cle and ld.c_ldd_genre = 'DO' OR
                     d2.l_do_cle = ld.l_do_cle and d2.l_si_cle = ld.l_do_site and
                     ld.c_do_genre = 'DO' and
                     ld.l_ldd_dossier_associe = d.l_do_cle and
                     ld.l_ldd_site = d.l_si_cle and ld.c_ldd_genre = 'DO'))
      union all
      SELECT 'RFC rclamation relis au mauvais matre' as "Type",
             d.v_do_numero_dossier as "Description"
        from do_dossier d, ldd_lien_dossier l, su_sujet s
       where d.i_ca_cle = 26058
         and d.i_cc_cle != 14920
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and d.d_do_date_debut < sysdate -3
         and not exists
       (select d2.v_do_numero_dossier
                from ldd_lien_dossier ld,
                     do_dossier       d2,
                     ldd_lien_dossier ld2,
                     su_sujet         s2
               where ((d.l_do_cle = ld.l_do_cle and d.l_si_cle = ld.l_do_site and
                     ld.c_do_genre = 'DO' and
                     ld.l_ldd_dossier_associe = d2.l_do_cle and
                     ld.l_ldd_site = d2.l_si_cle and ld.c_ldd_genre = 'DO' OR
                     d2.l_do_cle = ld.l_do_cle and d2.l_si_cle = ld.l_do_site and
                     ld.c_do_genre = 'DO' and
                     ld.l_ldd_dossier_associe = d.l_do_cle and
                     ld.l_ldd_site = d.l_si_cle and ld.c_ldd_genre = 'DO') and
                     d2.i_ca_cle = 26057 and d2.l_do_cle = ld2.l_do_cle and
                     d2.l_si_cle = ld2.l_do_site and ld2.c_do_genre = 'DO' and
                     ld2.l_ldd_dossier_associe = s2.l_su_cle and
                     ld2.l_ldd_site = s2.l_si_cle and ld2.c_ldd_genre = 'SU' and
                     s.v_su_reference_3 = s2.v_su_reference_3))
      union all
      SELECT 'Reprages non relis au bon dossier' as "Type",
             d.v_do_numero_dossier as "Description"
        from v_do_dossier_ca_ty d
       where (d.i_ca_cle = 220 --Autoexclusion
             and d.l_si_cle != 75
             and d.i_cc_cle != 14920 and not exists
              (select ld.l_do_cle
                 from v_do_dossier_ca_ty d2, ldd_lien_dossier ld
                where ((d.l_do_cle = ld.l_do_cle and d.l_si_cle = ld.l_do_site and
                      ld.c_do_genre = 'DO' and
                      ld.l_ldd_dossier_associe = d2.l_do_cle and
                      ld.l_ldd_site = d2.l_si_cle and ld.c_ldd_genre = 'DO') OR
                      (d2.l_do_cle = ld.l_do_cle and d2.l_si_cle = ld.l_do_site and
                      ld.c_do_genre = 'DO' and
                      ld.l_ldd_dossier_associe = d.l_do_cle and
                      ld.l_ldd_site = d.l_si_cle and ld.c_ldd_genre = 'DO'))
                  and d2.i_ca_cle = 112))
          or (d.i_ca_cle = 239 -- Accs interdit
             and d.i_cc_cle != 14920 and not exists
              (select ld.l_do_cle
                 from v_do_dossier_ca_ty d2, ldd_lien_dossier ld
                where ((d.l_do_cle = ld.l_do_cle and d.l_si_cle = ld.l_do_site and
                      ld.c_do_genre = 'DO' and
                      ld.l_ldd_dossier_associe = d2.l_do_cle and
                      ld.l_ldd_site = d2.l_si_cle and ld.c_ldd_genre = 'DO') OR
                      (d2.l_do_cle = ld.l_do_cle and d2.l_si_cle = ld.l_do_site and
                      ld.c_do_genre = 'DO' and
                      ld.l_ldd_dossier_associe = d.l_do_cle and
                      ld.l_ldd_site = d.l_si_cle and ld.c_ldd_genre = 'DO'))
                  and (d2.i_na_cle = 417 or d2.i_na_cle = 27704)))
          or (d.i_ca_cle = 263 -- Avis de guet
             and d.i_cc_cle != 14920 and not exists
              (select ld.l_do_cle
                 from v_do_dossier_ca_ty d2, ldd_lien_dossier ld
                where ((d.l_do_cle = ld.l_do_cle and d.l_si_cle = ld.l_do_site and
                      ld.c_do_genre = 'DO' and
                      ld.l_ldd_dossier_associe = d2.l_do_cle and
                      ld.l_ldd_site = d2.l_si_cle and ld.c_ldd_genre = 'DO') OR
                      (d2.l_do_cle = ld.l_do_cle and d2.l_si_cle = ld.l_do_site and
                      ld.c_do_genre = 'DO' and
                      ld.l_ldd_dossier_associe = d.l_do_cle and
                      ld.l_ldd_site = d.l_si_cle and ld.c_ldd_genre = 'DO'))
                  and (d2.i_na_cle = 78 or d2.i_na_cle = 27704)))
      union all
      SELECT 'Autoexclusions sans numro de dossier' as "Type",
             d.v_do_numero_dossier as "Description"
        from do_dossier d
       where d.i_ca_cle = 112
         and d.i_cc_cle <> 14920
         and d.v_do_ancienne_reference is null
      union all
      select 'Sujets sans onglets', s.v_su_reference_3 as "Description"
        from su_sujet s
       where not exists
       (select l.l_do_cle
                from ldd_lien_dossier l
               where (s.l_su_cle = l.l_do_cle and s.l_si_cle = l.l_do_site and
                     l.c_do_genre = 'SU')
                  or (s.l_su_cle = l.l_ldd_dossier_associe and
                     s.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'SU'))
         and not exists (select lmm.l_lmm_reference
                from lmm_lien_multimedia lmm
               where s.l_su_cle = lmm.l_lmm_reference
                 and s.l_si_cle = lmm.l_lmm_ref_site
                 and lmm.c_lmm_ref_genre = 'SU')
         and not exists (select c.l_co_reference
                from co_commentaire2 c
               where s.l_su_cle = c.l_co_reference
                 and s.l_si_cle = c.l_co_ref_site
                 and c.c_co_ref_genre = 'SU')
         and not exists (select a.l_ad_reference
                from ad_adresse a
               where s.l_su_cle = a.l_ad_reference
                 and s.l_si_cle = a.l_ad_ref_site
                 and a.c_ad_ref_genre = 'SU')
         and s.i_cc_cle <> 14920
         and s.d_su_date_creation < sysdate -3
      union all
      select 'Vhicules sans onglets', v.v_ve_immatriculation as "Description"
        from ve_vehicule v
       where not exists
       (select l.l_do_cle
                from ldd_lien_dossier l
               where (v.l_ve_cle = l.l_do_cle and v.l_si_cle = l.l_do_site and
                     l.c_do_genre = 'VE')
                  or (v.l_ve_cle = l.l_ldd_dossier_associe and
                     v.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'VE'))
         and not exists (select lmm.l_lmm_reference
                from lmm_lien_multimedia lmm
               where v.l_ve_cle = lmm.l_lmm_reference
                 and v.l_si_cle = lmm.l_lmm_ref_site
                 and lmm.c_lmm_ref_genre = 'VE')
         and not exists (select c.l_co_reference
                from co_commentaire2 c
               where v.l_ve_cle = c.l_co_reference
                 and v.l_si_cle = c.l_co_ref_site
                 and c.c_co_ref_genre = 'VE')
         and v.i_cc_cle <> 14920
      union all
      SELECT 'Dossiers AE sans pice jointe' as "Type",
             d.v_do_numero_dossier as "Description"
        from v_do_dossier_ca_ty d
       where d.i_ca_cle = 112
         and d.i_st_cle = 359
         and d.i_cc_cle <> 14920
         and not exists (select l.l_lmm_reference
                from lmm_lien_multimedia l, mm_multimedia m
               where d.l_do_cle = l.l_lmm_reference
                 and d.l_si_cle = l.l_lmm_ref_site
                 and l.c_lmm_ref_genre = 'DO'
                 and l.l_mm_cle = m.l_mm_cle
                 and l.l_mm_ref_site = m.l_si_cle
                 and m.i_tm_cle = 18826)
         and d.d_do_date_debut < sysdate-3                 
      union all
      select 'Dossiers sans onglets', vdo.v_do_numero_dossier as "Description"
        from v_do_dossier_ca_ty vdo
       where vdo.i_na_cle not in (24024,23659) --On exclut chantillonage et vnement DCSI
       and not exists
       (select l.l_do_cle
                from ldd_lien_dossier l
               where (vdo.l_do_cle = l.l_do_cle and vdo.l_si_cle = l.l_do_site and
                     l.c_do_genre = 'DO')
                  or (vdo.l_do_cle = l.l_ldd_dossier_associe and
                     vdo.l_si_cle = l.l_ldd_site and l.c_ldd_genre = 'DO'))
         and not exists (select lmm.l_lmm_reference
                from lmm_lien_multimedia lmm
               where vdo.l_do_cle = lmm.l_lmm_reference
                 and vdo.l_si_cle = lmm.l_lmm_ref_site
                 and lmm.c_lmm_ref_genre = 'DO')
         and not exists (select c.l_co_reference
                from co_commentaire2 c
               where vdo.l_do_cle = c.l_co_reference
                 and vdo.l_si_cle = c.l_co_ref_site
                 and c.c_co_ref_genre = 'DO')
         and not exists (select cn.l_cn_ref_cle
                from cn_consignation cn
               where vdo.l_do_cle = cn.l_cn_ref_cle
                 and vdo.l_si_cle = cn.l_cn_ref_site
                 and cn.c_cn_ref_genre = 'DO')                 
         and not exists
       (select b.l_bi_ref_cle
                from bi_billet b
               where vdo.l_do_cle = b.l_bi_ref_cle
                 and vdo.l_si_cle = b.l_bi_ref_site)
         and vdo.i_cc_cle <> 14920
         and vdo.d_do_date_debut between to_date('2013-01-01', 'YYYY-MM_DD')
         and sysdate-3
         --Exclusion des dossiers de faux-billets qui ont moins de 60 jours
         and vdo.v_do_numero_dossier not in (select d.v_do_numero_dossier from do_dossier d
         where d.i_ca_cle in (221,25144,15539,229,20044,23776,19951)
         and d.d_do_date_debut > sysdate - 60)
         --Exclusion des dossiers traits dans la sections des dossiers sans narration
         and vdo.v_do_numero_dossier not in
               (select vd.v_do_numero_dossier 
        from v_do_dossier_ca_ty vd
       where not exists (select c.l_co_reference
                from co_commentaire2 c
               where vd.l_do_cle = c.l_co_reference
                 and vd.l_si_cle = c.l_co_ref_site
                 and c.c_co_ref_genre = 'DO')
         and vd.i_ge_cle <> 415
         and vd.i_na_cle <> 23659
         and vd.i_na_cle <> 24024
         and vd.l_si_cle <> 30
         and vd.l_si_cle <> 11
         and vd.l_si_cle <> 25
         and vd.i_cc_cle <> 14920
         and vd.d_do_date_debut between to_date('2013-01-01', 'YYYY-MM_DD')
         and sysdate-3)
      union all
      select 'Dossiers sans narrations', vd.v_do_numero_dossier as "Description"
        from v_do_dossier_ca_ty vd
       where not exists (select c.l_co_reference
                from co_commentaire2 c
               where vd.l_do_cle = c.l_co_reference
                 and vd.l_si_cle = c.l_co_ref_site
                 and c.c_co_ref_genre = 'DO')
         and vd.i_ge_cle <> 415
         and vd.i_na_cle <> 23659
         and vd.i_na_cle <> 24024
         and vd.l_si_cle <> 30
         and vd.l_si_cle <> 11
         and vd.l_si_cle <> 25
         and vd.i_cc_cle <> 14920
         and vd.d_do_date_debut between to_date('2013-01-01', 'YYYY-MM_DD')
         and sysdate-3 
         --Exclusion des dossiers de faux-billets qui ont moins de 60 jours
         and vd.v_do_numero_dossier not in (select d.v_do_numero_dossier from do_dossier d
         where d.i_ca_cle in (221,25144,15539,229,20044,23776,19951)
         and d.d_do_date_debut > sysdate - 60)
       union all
        select 'Sujets accdes avec le compte Autoexclusion Impartition' as "Type",
               s.v_su_reference_3 || ' (' || a.v_ac_name || ' - ' ||
               decode(a.c_ac_action,
                      'I',
                      'Insertion',
                      'S',
                      'Slection',
                      'U',
                      'Mise  jour',
                      a.c_ac_action) || ' - ' || a.d_ac_date_acces || ')' as "Description"
          from ac_acces                   a,
               in_intervenant             i,
               igs_intervenant_groupe_sec ig,
               su_sujet                   s
         where a.v_ac_name = i.name
           and i.name = ig.v_name
           and ig.l_gs_cle = 27085
           and a.l_ori_cle = s.l_su_cle
           and a.l_ori_site = s.l_si_cle
           and a.c_gf_origine = 'SU'
           and a.d_ac_date_acces > sysdate - 1
        union all
        select 'Dossiers crs avec le compte Autoexclusion Impartition' as "Type",
               d.v_do_numero_dossier || ' (' || a.v_ac_name || ' - ' ||
               a.d_ac_date_acces || ')' as "Description"
          from ac_acces                   a,
               in_intervenant             i,
               igs_intervenant_groupe_sec ig,
               do_dossier                 d
         where a.v_ac_name = i.name
           and i.name = ig.v_name
           and ig.l_gs_cle = 27085
           and a.l_ori_cle = d.l_do_cle
           and a.l_ori_site = d.l_si_cle
           and a.c_gf_origine = 'DO'
           and a.c_ac_action = 'I'
           and a.d_ac_date_acces > sysdate - 1
        union all
          select 'Dossiers Clients-Mystres avec numro de vague erron' as "Type",
          do.v_do_numero_dossier as "Description"
            from v_do_dossier_ca_ty doEBas,
                 ldd_lien_dossier   lddEBas,
                 so_societe         s,
                 v_do_dossier_ca_ty do,
                 ldd_lien_dossier   ldd
           where doEBas.l_do_cle = lddEBas.l_do_cle
             and doEBas.l_si_cle = lddEBas.l_do_site
             and lddEBas.c_do_genre = 'DO'
             and lddEBas.l_ldd_dossier_associe = s.l_so_cle
             and lddEBas.l_ldd_site = s.l_si_cle
             and lddEBas.c_ldd_genre = 'SO'
             and doEBas.l_si_cle = 25
             and doEBas.i_cc_cle <> 14920
             and doEBas.i_ca_cle = 662
             and s.i_cc_cle <> 14920
             and do.l_do_cle = ldd.l_do_cle
             and do.l_si_cle = ldd.l_do_site
             and ldd.c_do_genre = 'DO'
             and ldd.l_ldd_dossier_associe = s.l_so_cle
             and ldd.l_ldd_site = s.l_si_cle
             and ldd.c_ldd_genre = 'SO'
             and do.l_si_cle = 25
             and do.i_cc_cle <> 14920
             and do.i_ca_cle <> 662
             and do.v_do_reference1 <> doEBas.v_do_ancienne_reference
             and doEBas.d_do_date_debut =
             (select max(doddmax.d_do_date_debut) 
             from do_dossier doddmax, ldd_lien_dossier lddddmax
             where doddmax.i_ca_cle = 662
             and doddmax.d_do_date_debut <= do.d_do_date_debut
             and doddmax.l_do_cle = lddddmax.l_do_cle
             and doddmax.l_si_cle = lddddmax.l_do_site
             and lddddmax.c_do_genre = 'DO'
             and lddddmax.l_ldd_dossier_associe = s.l_so_cle
             and lddddmax.l_ldd_site = s.l_si_cle
             and lddddmax.c_ldd_genre = 'SO');
        
  END SP_RAP_COHERENCE;

  --Rapport dtaill sur les accs des intervenants
  PROCEDURE SP_RAPPORT_DETAIL_ACCES(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                    NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                    NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                    NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                    rc1             IN OUT DTS_DETAIL_ACCES) IS
  begin
    OPEN rc1 FOR
      select 'Dossiers' as "Type",
             a.v_ac_name as "Code",
             i.v_in_nom || ', ' || i.v_in_prenom as "Intervenant",
             substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "Fiche",
             t.v_ta_type_acces as "Accs",
             a.d_ac_date_acces as "Date_acces"
        from ac_acces a, do_dossier d, ta_type_acces t, in_intervenant i
       where a.d_ac_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         and a.l_ori_cle = d.l_do_cle
         and a.l_ori_site = d.l_si_cle
         and a.c_gf_origine = 'DO'
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = i.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and i.name like NEW_INTERVENANT
      union
      select 'Sujets' as "Type",
             a.v_ac_name as "Code",
             i.v_in_nom || ', ' || i.v_in_prenom as "Intervenant",
             s.v_su_reference_3 as "Fiche",
             t.v_ta_type_acces as "Accs",
             a.d_ac_date_acces as "Date_acces"
        from ac_acces a, su_sujet s, ta_type_acces t, in_intervenant i
       where a.d_ac_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         and a.l_ori_cle = s.l_su_cle
         and a.l_ori_site = s.l_si_cle
         and a.c_gf_origine = 'SU'
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = i.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and i.name like NEW_INTERVENANT
      union
      select 'Socits' as "Type",
             a.v_ac_name as "Code",
             i.v_in_nom || ', ' || i.v_in_prenom as "Intervenant",
             so.v_so_nom as "Fiche",
             t.v_ta_type_acces as "Accs",
             a.d_ac_date_acces as "Date_acces"
        from ac_acces a, so_societe so, ta_type_acces t, in_intervenant i
       where a.d_ac_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         and a.l_ori_cle = so.l_so_cle
         and a.l_ori_site = so.l_si_cle
         and a.c_gf_origine = 'SO'
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = i.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and i.name like NEW_INTERVENANT
      union
      select 'Vhicules' as "Type",
             a.v_ac_name as "Code",
             i.v_in_nom || ', ' || i.v_in_prenom as "Intervenant",
             v.v_ve_immatriculation as "Fiche",
             t.v_ta_type_acces as "Accs",
             a.d_ac_date_acces as "Date_acces"
        from ac_acces a, ve_vehicule v, ta_type_acces t, in_intervenant i
       where a.d_ac_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
         and a.l_ori_cle = v.l_ve_cle
         and a.l_ori_site = v.l_si_cle
         and a.c_gf_origine = 'VE'
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = i.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and i.name like NEW_INTERVENANT;
  END SP_RAPPORT_DETAIL_ACCES;

  --Rapport sur les dossiers  purer
  PROCEDURE SP_RAP_DO_EPURATION(NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_DO_EPURATION) IS
  BEGIN
    OPEN rc1 FOR
      SELECT nature.v_tr_description nature,
             dossier.v_do_ancienne_reference noDossier,
             substr(dossier.v_do_numero_dossier, 1, 3) || '-' ||
             substr(dossier.v_do_numero_dossier, 4, 8) || '-' ||
             substr(dossier.v_do_numero_dossier, 12, 16) noCardex,
             type.v_tr_description type,
             categorie.v_tr_description categorie,
             statut.v_tr_description statut,
             severite.v_tr_description severite,
             dossier.v_do_reference_video noSequentiel,
             decode(dossier.b_do_enregistrement_conserve,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'null') enrConserve,
             decode(dossier.b_do_enregistrement_numerique,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'null') enrNumerique,
             dossier.d_do_date_debut dateDebut,
             dossier.d_do_date_fin dateFin,
             dossier.v_do_reference1 reference1,
             dossier.v_do_reference3 reference2,
             dossier.v_do_reference5 reference3,
             intervenants.v_in_nom || ', ' || intervenants.v_in_prenom intervenant,
             site.v_si_site site,
             endroit.v_tr_description endroit,
             localisation.v_tr_description localisation,
             dossier.v_do_lieu lieu,
             ORIGINE.V_TR_DESCRIPTION ORIGINE,
             dossier.l_si_cle siteCle,
             dossier.l_do_cle dossierCle
        FROM v_do_dossier_ca_ty dossier,
             tr_traduction      nature,
             tr_traduction      type,
             tr_traduction      categorie,
             tr_traduction      statut,
             tr_traduction      severite,
             in_intervenant     intervenants,
             si_site            site,
             tr_traduction      endroit,
             tr_traduction      localisation,
             TR_TRADUCTION      ORIGINE
       WHERE dossier.l_si_cle = NEW_L_SI_CLE
         AND dossier.i_na_cle = nature.l_tr_cle
         AND nature.i_la_cle = 1
         AND dossier.i_ty_cle = type.l_tr_cle
         AND type.i_la_cle = 1
         AND dossier.i_ca_cle = categorie.l_tr_cle
         AND categorie.i_la_cle = 1
         AND dossier.i_st_cle = statut.l_tr_cle
         AND statut.i_la_cle = 1
         AND dossier.i_se_cle = severite.l_tr_cle(+)
         AND severite.i_la_cle(+) = 1
         AND dossier.v_do_cree_par = intervenants.name
         AND dossier.l_si_cle = site.l_si_cle
         AND dossier.i_or_cle = endroit.l_tr_cle(+)
         AND endroit.i_la_cle(+) = 1
         AND dossier.i_cr_cle = localisation.l_tr_cle(+)
         AND localisation.i_la_cle(+) = 1
         and dossier.i_cc_cle = 14920
         AND DOSSIER.L_DO_ORIGINE = ORIGINE.L_TR_CLE(+)
         AND ORIGINE.I_LA_CLE(+) = 1;
  END SP_RAP_DO_EPURATION;

  --Rapport sur les sujets  purer
  PROCEDURE SP_RAP_SU_EPURATION(NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SUJET) IS
  begin
    OPEN rc1 FOR
      SELECT sujet.v_su_reference_3 noFiche,
             sujet.v_su_nom nom,
             sujet.v_su_prenom prenom,
             sujet.v_su_surnom alias,
             tr_sexe.v_tr_description sexe,
             tr_ethnie.v_tr_description ethnie,
             tr_race.v_tr_description race,
             tr_langue.v_tr_description langue,
             sujet.d_su_date_naissance date_de_naissance,
             sujet.l_su_cle,
             sujet.l_si_cle,
             sujet.v_su_permis_conduire,
             sujet.v_su_no_passeport,
             sujet.c_su_assurance_sociale
        FROM su_sujet sujet
        LEFT OUTER JOIN tr_traduction tr_sexe ON (sujet.i_sx_cle =
                                                 tr_sexe.l_tr_cle AND
                                                 tr_sexe.i_la_cle = 1)
        LEFT OUTER JOIN tr_traduction tr_ethnie ON (sujet.i_nt_cle =
                                                   tr_ethnie.l_tr_cle AND
                                                   tr_ethnie.i_la_cle = 1)
        LEFT OUTER JOIN tr_traduction tr_race ON (sujet.i_ra_cle =
                                                 tr_race.l_tr_cle AND
                                                 tr_race.i_la_cle = 1)
        LEFT OUTER JOIN tr_traduction tr_langue ON (sujet.i_ls_cle =
                                                   tr_langue.l_tr_cle AND
                                                   tr_langue.i_la_cle = 1)
       WHERE sujet.l_si_cle = NEW_L_SI_CLE
         and sujet.i_cc_cle = 14920;
  END SP_RAP_SU_EPURATION;

  --Rapport sur les socits  purer
  PROCEDURE SP_RAP_SO_EPURATION(NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SOCIETE) IS
  begin
    OPEN rc1 FOR
      SELECT S.L_SO_CLE,
             S.L_SI_CLE,
             TRST.V_TR_DESCRIPTION AS "STATUT",
             S.V_SO_NOM,
             TRCL.V_TR_DESCRIPTION AS "CLASSE",
             S.V_SO_REFERENCE_NOM,
             S.V_SO_REFERENCE_PRENOM,
             S.V_SO_REFERENCE_1,
             S.V_SO_REFERENCE_2,
             S.V_SO_REFERENCE_3,
             S.V_SO_RAISON_SOCIALE,
             S.L_SO_CENTRE_REGIONAL,
             S.V_SO_DISTRICT,
             S.V_SO_CODE_COMPTE,
             S.B_SO_ACTIF,
             S.D_SO_DATE_INACTIVATION,
             S.B_SO_IND_RDD,
             S.V_SO_COMMENTAIRE,
             S.V_SO_RAISON_INACTIVATION
        FROM SO_SOCIETE S, TR_TRADUCTION TRST, TR_TRADUCTION TRCL
       WHERE S.I_ST_CLE = TRST.L_TR_CLE(+)
         AND TRST.I_LA_CLE(+) = 1
         AND S.I_CL_CLE = TRCL.L_TR_CLE(+)
         AND TRCL.I_LA_CLE(+) = 1
         AND S.l_si_cle = NEW_L_SI_CLE
         and S.i_cc_cle = 14920;
  END SP_RAP_SO_EPURATION;

  --Rapport sur les vhicules  purer
  PROCEDURE SP_RAP_VE_EPURATION(NEW_L_SI_CLE IN VE_VEHICULE.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_VE_VEHICULE) IS
  begin
    OPEN rc1 FOR
      SELECT P.L_VE_CLE,
             P.L_SI_CLE,
             P.V_VE_IMMATRICULATION,
             P.V_VE_PROVINCE,
             P.C_VE_ANNEE,
             P.V_VE_VIGNETTE,
             P.V_VE_NUMERO_SERIE,
             P.V_VE_ASSUREUR,
             P.V_VE_POLICE,
             P.D_VE_EXPIRATION_VIGNETTE,
             P.D_VE_EXPIRATION_POLICE,
             MD.V_MD_MODELE AS "modele",
             MA.V_MA_MARQUE AS "marque",
             T.V_TR_DESCRIPTION AS "PROVINCE",
             P.V_VE_COMMENTAIRE
        FROM VE_VEHICULE P, MD_MODELE MD, MA_MARQUE MA, TR_TRADUCTION T
       WHERE P.L_SI_CLE = NEW_L_SI_CLE
         AND MD.I_MD_CLE = P.I_MD_CLE
         AND MD.I_MA_CLE = MA.I_MA_CLE
         and P.I_CC_CLE = 14920
         AND P.L_PR_CLE = T.L_TR_CLE
         AND T.I_LA_CLE = 1;
  END SP_RAP_VE_EPURATION;

  --Rapport statistique sur le temps consacr aux dossiers.
  PROCEDURE SP_TEMPS_CONSACRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                              NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                              NEW_SITE       IN VARCHAR2,
                              NEW_I_GE_CLE   IN GE_GENRE.I_GE_CLE%TYPE,
                              rc1            IN OUT DTS_TEMPS_CONSACRE) IS
  begin
    OPEN rc1 FOR
      select trs.v_tr_description as SECTEUR,
             i.v_in_prenom || ' ' || i.v_in_nom as INTERVENANT,
             trna.v_tr_description as NATURE,
             trty.v_tr_description as TYPE,
             trca.v_tr_description as CATEGORIE,
             d.v_do_numero_dossier as NUMERO_CARDEX,
             decode(d.I_DO_FONDE,
                    16123,
                    TRUNC(sum(c.v_co_temps) / 60) || ' h ' ||
                    (sum(c.v_co_temps) - TRUNC(sum(c.v_co_temps) / 60) * 60) || ' m') as FONDE,
             decode(d.I_DO_FONDE,
                    16124,
                    TRUNC(sum(c.v_co_temps) / 60) || ' h ' ||
                    (sum(c.v_co_temps) - TRUNC(sum(c.v_co_temps) / 60) * 60) || ' m') as NON_FONDE,
             decode(d.I_DO_FONDE,
                    16122,
                    TRUNC(sum(c.v_co_temps) / 60) || ' h ' ||
                    (sum(c.v_co_temps) - TRUNC(sum(c.v_co_temps) / 60) * 60) || ' m') as INDETERMINE,
             decode(d.I_DO_FONDE, 16123, sum(c.v_co_temps)) as TOTAL_FONDE,
             decode(d.I_DO_FONDE, 16124, sum(c.v_co_temps)) as TOTAL_NON_FONDE,
             decode(d.I_DO_FONDE, 16122, sum(c.v_co_temps)) as TOTAL_INDETERMINE
        from v_do_dossier_ca_ty d,
             co_commentaire2    c,
             in_intervenant     i,
             tr_traduction      trs,
             tr_traduction      trna,
             tr_traduction      trty,
             tr_traduction      trca
       where d.l_do_cle = c.l_co_reference
         and d.l_si_cle = c.l_co_ref_site
         and c.c_co_ref_genre = 'DO'
         and to_char(d.l_si_cle) like NEW_SITE
         and d.i_ge_cle = NEW_I_GE_CLE
         and c.v_co_cree_par = i.name
         and i.l_in_secteur = trs.l_tr_cle
         and trs.i_la_cle = 1
         and d.i_na_cle = trna.l_tr_cle
         and trna.i_la_cle = 1
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.i_ca_cle = trca.l_tr_cle
         and trca.i_la_cle = 1
         and c.v_co_temps is not null
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
       group by trs.v_tr_description,
                i.v_in_prenom || ' ' || i.v_in_nom,
                trna.v_tr_description,
                trty.v_tr_description,
                trca.v_tr_description,
                d.v_do_numero_dossier,
                d.I_DO_FONDE
       order by trs.v_tr_description,
                i.v_in_prenom || ' ' || i.v_in_nom,
                trna.v_tr_description,
                trty.v_tr_description,
                trca.v_tr_description,
                d.v_do_numero_dossier;
  END SP_TEMPS_CONSACRE;

  PROCEDURE SP_RAP_CUMMULATIF_HEBDOMADAIRE(NEW_L_SI_CLE        IN SI_SITE.L_SI_CLE%TYPE,
                                           NEW_I_GE_CLE        IN GE_GENRE.I_GE_CLE%TYPE,
                                           NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           rc1                 OUT DTS_CUMMULATIF_HEBDOMADAIRE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT v.i_ca_cle as CLE_CATEGORIE,
             tty.v_tr_description as TYPE,
             tca.v_tr_description as CATEGORIE,
             count(v.l_do_cle) as NOMBRE_DOSSIER
        FROM v_do_dossier_ca_ty v, tr_traduction tca, tr_traduction tty
       where v.l_si_cle = NEW_L_SI_CLE
         and v.i_ge_cle = NEW_I_GE_CLE
         and v.i_ca_cle = tca.l_tr_cle
         and tca.i_la_cle = 1
         and v.i_ty_cle = tty.l_tr_cle
         and tty.i_la_cle = 1
         AND V.D_DO_DATE_DEBUT >= NEW_D_DO_DATE_DEBUT
         and V.D_DO_DATE_DEBUT < NEW_D_DO_DATE_FIN + 1
       GROUP BY v.i_ca_cle, tty.v_tr_description, tca.v_tr_description
       ORDER BY tty.v_tr_description, tca.v_tr_description;
  END SP_RAP_CUMMULATIF_HEBDOMADAIRE;

  PROCEDURE SP_RAP_CUMMULATIF_HEBDO_EJ(NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       rc1                 OUT DTS_CUMMULATIF_HEBDOMADAIRE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT v.i_ca_cle as CLE_CATEGORIE,
             tty.v_tr_description as TYPE,
             tca.v_tr_description as CATEGORIE,
             count(v.l_do_cle) as NOMBRE_DOSSIER
        FROM v_do_dossier_ca_ty v, tr_traduction tca, tr_traduction tty
       where v.l_si_cle = 75
         and (v.i_ge_cle = 414 or v.i_ge_cle = 18046)
         and v.i_ca_cle = tca.l_tr_cle
         and tca.i_la_cle = 1
         and v.i_ty_cle = tty.l_tr_cle
         and tty.i_la_cle = 1
         AND V.D_DO_DATE_DEBUT >= NEW_D_DO_DATE_DEBUT
         and V.D_DO_DATE_DEBUT < NEW_D_DO_DATE_FIN + 1
       GROUP BY v.i_ca_cle, tty.v_tr_description, tca.v_tr_description
       ORDER BY tty.v_tr_description, tca.v_tr_description;
  END SP_RAP_CUMMULATIF_HEBDO_EJ;

  PROCEDURE SP_RAP_NOMBRE_FONDE(NEW_L_SI_CLE        IN SI_SITE.L_SI_CLE%TYPE,
                                NEW_I_CA_CLE        IN CA_CATEGORIE.I_CA_CLE%TYPE,
                                NEW_I_DO_FONDE      IN DO_DOSSIER.I_DO_FONDE%TYPE,
                                NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                NOMBRE_FONDE        OUT NUMBER) IS
  BEGIN
    SELECT count(v.l_do_cle)
      INTO NOMBRE_FONDE
      FROM v_do_dossier_ca_ty v
     where v.l_si_cle = NEW_L_SI_CLE
       and v.i_ca_cle = NEW_I_CA_CLE
       and v.i_do_fonde = NEW_I_DO_FONDE
       AND V.D_DO_DATE_DEBUT >= NEW_D_DO_DATE_DEBUT
       and V.D_DO_DATE_DEBUT < NEW_D_DO_DATE_FIN + 1;
  END SP_RAP_NOMBRE_FONDE;

  PROCEDURE SP_RAP_NOMBRE_ENQUETES(NEW_L_SI_CLE        IN SI_SITE.L_SI_CLE%TYPE,
                                   NEW_I_CA_CLE        IN CA_CATEGORIE.I_CA_CLE%TYPE,
                                   NEW_D_DO_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                   NEW_D_DO_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                   NOMBRE_ENQUETES     OUT NUMBER) IS
  BEGIN
    SELECT count(v.l_do_cle)
      INTO NOMBRE_ENQUETES
      FROM v_do_dossier_ca_ty v
     where v.l_si_cle = NEW_L_SI_CLE
       and v.i_ca_cle = NEW_I_CA_CLE
       and trim(v.v_do_reference5) like 'ENQ'
       AND V.D_DO_DATE_DEBUT >= NEW_D_DO_DATE_DEBUT
       and V.D_DO_DATE_DEBUT < NEW_D_DO_DATE_FIN + 1;
  END SP_RAP_NOMBRE_ENQUETES;

  PROCEDURE SP_RAP_NOMBRE_DOSSIER_ANNUEL(NEW_L_SI_CLE          IN SI_SITE.L_SI_CLE%TYPE,
                                         NEW_I_CA_CLE          IN CA_CATEGORIE.I_CA_CLE%TYPE,
                                         NEW_D_DO_DATE_DEBUT   IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NEW_D_DO_DATE_FIN     IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                         NOMBRE_DOSSIER_ANNUEL OUT NUMBER) IS
  BEGIN
    SELECT count(v.l_do_cle)
      INTO NOMBRE_DOSSIER_ANNUEL
      FROM v_do_dossier_ca_ty v
     where v.l_si_cle = NEW_L_SI_CLE
       and v.i_ca_cle = NEW_I_CA_CLE
       AND V.D_DO_DATE_DEBUT >= NEW_D_DO_DATE_DEBUT
       and V.D_DO_DATE_DEBUT < NEW_D_DO_DATE_FIN + 1;
  END SP_RAP_NOMBRE_DOSSIER_ANNUEL;

  --Impression de la fiche inscription
  PROCEDURE SP_IMPRESSION_INSCRIPTION(NEW_L_IS_CLE IN IS_INSCRIPTION.L_IS_CLE%TYPE,
                                      NEW_L_SI_CLE IN IS_INSCRIPTION.L_SI_CLE%TYPE,
                                      rc1          IN OUT DTS_IMPRESSION_INSCRIPTION) IS
  begin
    OPEN rc1 FOR
      select e.v_en_entite as ENTITE,
             s.v_si_site as SITE,
             d.v_do_numero_dossier as NUMERO_CARDEX,
             d.v_do_ancienne_reference as NUMERO_DOSSIER,
             i.v_is_duree as DUREE,
             tpe.v_tr_description as PERIODE,
             decode(ini.name,
                    '',
                    '',
                    ini.v_in_nom || ', ' || ini.v_in_prenom || ' (' ||
                    ini.name || ', ' || tsini.v_tr_description || ')') as INTERVENANT_INITIAL,
             decode(fin.name,
                    '',
                    '',
                    fin.v_in_nom || ', ' || fin.v_in_prenom || ' (' ||
                    fin.name || ', ' || tsfin.v_tr_description || ')') as INTERVENANT_FINAL,
             i.d_is_date_debut as DATE_DEBUT,
             i.d_is_date_fin as DATE_FIN,
             i.d_is_rencontre_initiale as RENCONTRE_INITIALE,
             i.d_is_rencontre_finale as RENCONTRE_FINALE,
             i.d_is_date_creation as DATE_INSCRIPTION,
             tst.v_tr_description as STATUT,
             DECODE(I.B_IS_AIDE_INITIALE, 'yes', 'Oui', 'no ', 'Non', 'Non') AIDE_INITIALE,
             DECODE(I.B_IS_AIDE_IMMEDIATE,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'Non') AIDE_IMMEDIATE
        from is_inscription i,
             do_dossier     d,
             si_site        s,
             en_entite      e,
             tr_traduction  tpe,
             in_intervenant ini,
             in_intervenant fin,
             tr_traduction  tsini,
             tr_traduction  tsfin,
             tr_traduction  tst
       where i.l_is_cle = NEW_L_IS_CLE
         and i.l_si_cle = NEW_L_SI_CLE
         and i.l_is_reference = d.l_do_cle
         and i.l_is_ref_site = d.l_si_cle
         and d.l_si_cle = s.l_si_cle
         and s.i_en_cle = e.i_en_cle
         and i.i_is_periode = tpe.l_tr_cle
         and tpe.i_la_cle = 1
         and i.v_is_intervenant_initial = ini.name(+)
         and i.v_is_intervenant_final = fin.name(+)
         and ini.l_in_secteur = tsini.l_tr_cle(+)
         and tsini.i_la_cle(+) = 1
         and fin.l_in_secteur = tsfin.l_tr_cle(+)
         and tsfin.i_la_cle(+) = 1
         and i.i_st_cle = tst.l_tr_cle
         and tst.i_la_cle = 1;
  END SP_IMPRESSION_INSCRIPTION;

  --Rapport sur les incidents de la DCSI
  PROCEDURE SP_RAP_INCIDENTS_DCSI(NEW_YEAR IN VARCHAR2,
                                  rc1      IN OUT DTS_RAP_INCIDENTS_DCSI) IS
  begin
    OPEN rc1 FOR
      select '1' as "TRI",
             'Premier trimestre' as "PERIODE",
             D.v_do_reference5 AS "SITE",
             d.l_do_cle as "TOTAL",
             DECODE(D.i_se_cle, 561, 'Svrit 1', 'Autres svrits') AS "SEVERITE"
        from v_do_dossier_ca_ty d
       where d.i_na_cle = 24024
         AND D.d_do_date_debut >=
             TO_DATE(NEW_YEAR || '-01-01', 'YYYY-MM-DD')
         AND D.d_do_date_debut <
             TO_DATE(NEW_YEAR || '-03-31', 'YYYY-MM-DD') + 1
      union
      select '2' as "TRI",
             'Deuxime trimestre' as "PERIODE",
             D.v_do_reference5 AS "SITE",
             d.l_do_cle as "TOTAL",
             DECODE(D.i_se_cle, 561, 'Svrit 1', 'Autres svrits') AS "SEVERITE"
        from v_do_dossier_ca_ty d
       where d.i_na_cle = 24024
         AND D.d_do_date_debut >=
             TO_DATE(NEW_YEAR || '-01-01', 'YYYY-MM-DD')
         AND D.d_do_date_debut <
             TO_DATE(NEW_YEAR || '-03-31', 'YYYY-MM-DD') + 1
      union
      select '3' as "TRI",
             'Troisime trimestre' as "PERIODE",
             D.v_do_reference5 AS "SITE",
             d.l_do_cle as "TOTAL",
             DECODE(D.i_se_cle, 561, 'Svrit 1', 'Autres svrits') AS "SEVERITE"
        from v_do_dossier_ca_ty d
       where d.i_na_cle = 24024
         AND D.d_do_date_debut >=
             TO_DATE(NEW_YEAR || '-01-01', 'YYYY-MM-DD')
         AND D.d_do_date_debut <
             TO_DATE(NEW_YEAR || '-03-31', 'YYYY-MM-DD') + 1
      union
      select '4' as "TRI",
             'Quatrime trimestre' as "PERIODE",
             D.v_do_reference5 AS "SITE",
             d.l_do_cle as "TOTAL",
             DECODE(D.i_se_cle, 561, 'Svrit 1', 'Autres svrits') AS "SEVERITE"
        from v_do_dossier_ca_ty d
       where d.i_na_cle = 24024
         AND D.d_do_date_debut >=
             TO_DATE(NEW_YEAR || '-01-01', 'YYYY-MM-DD')
         AND D.d_do_date_debut <
             TO_DATE(NEW_YEAR || '-03-31', 'YYYY-MM-DD') + 1;
  END SP_RAP_INCIDENTS_DCSI;

  --Impression du suivi affich  l'cran
  PROCEDURE SP_IMPRESSION_SUIVI(NEW_L_SV_CLE IN SV_SUIVI.L_SV_CLE%TYPE,
                                NEW_L_SI_CLE IN SV_SUIVI.L_SI_CLE%TYPE,
                                rc1          IN OUT DTS_IMPRESSION_SUIVI) IS
  begin
    OPEN rc1 FOR
      SELECT S.V_SV_SUIVI AS "suivi",
             TRSA.V_TR_DESCRIPTION AS "secteurAssigneDescription",
             IA.V_IN_NOM || ', ' || IA.V_IN_PRENOM || ' (' || IA.NAME ||
             ' - ' || TRSA.V_TR_DESCRIPTION || ')' AS "intervenantDescription",
             TO_CHAR(S.D_SV_DATE_CREATION, 'YYYY-MM-DD HH24:MI:SS') AS "dateCreation",
             TO_CHAR(S.D_SV_DATE_COMPLETEE, 'YYYY-MM-DD HH24:MI:SS') AS "dateCompletee",
             TO_CHAR(S.D_SV_DATE_PREVUE, 'YYYY-MM-DD HH24:MI:SS') AS "datePrevue",
             ID.V_IN_NOM || ', ' || ID.V_IN_PRENOM || ' (' || ID.NAME ||
             ' - ' || TRSD.V_TR_DESCRIPTION || ')' AS "demandeurDescription",
             TRTC.V_TR_DESCRIPTION AS "activiteDescription",
             TRCC.V_TR_DESCRIPTION AS "confidentialiteDescription",
             TRST.V_TR_DESCRIPTION AS "statutDescription",
             SUBSTR(D.V_DO_NUMERO_DOSSIER, 1, 3) || '-' ||
             SUBSTR(D.V_DO_NUMERO_DOSSIER, 4, 8) || '-' ||
             SUBSTR(D.V_DO_NUMERO_DOSSIER, 12, 16) AS "numeroDossier"
        FROM SV_SUIVI       S,
             TR_TRADUCTION  TRTC,
             TR_TRADUCTION  TRST,
             TR_TRADUCTION  TRCC,
             IN_INTERVENANT ID,
             TR_TRADUCTION  TRSD,
             IN_INTERVENANT IA,
             TR_TRADUCTION  TRSA,
             DO_DOSSIER     D
       WHERE S.L_SV_CLE = NEW_L_SV_CLE
         AND S.L_SI_CLE = NEW_L_SI_CLE
         AND S.I_TC_CLE = TRTC.L_TR_CLE(+)
         AND TRTC.I_LA_CLE(+) = 1
         AND S.I_ST_CLE = TRST.L_TR_CLE(+)
         AND TRST.I_LA_CLE(+) = 1
         AND S.I_CC_SUIVI = TRCC.L_TR_CLE
         AND TRCC.I_LA_CLE = 1
         AND S.V_SV_DEMANDEUR = ID.NAME
         AND ID.L_IN_SECTEUR = TRSD.L_TR_CLE
         AND TRSD.I_LA_CLE = 1
         AND S.V_SV_INTERVENANT = IA.NAME(+)
         AND IA.L_IN_SECTEUR = TRSA.L_TR_CLE(+)
         AND TRSA.I_LA_CLE(+) = 1
         AND S.L_SV_REFERENCE = D.L_DO_CLE
         AND S.L_SV_REF_SITE = D.L_SI_CLE;
  END SP_IMPRESSION_SUIVI;

  --Rapport statistique sommaire du comit de vigilance (CDX_0235)
  PROCEDURE SP_RAP_VIGILANCE_SOMMAIRE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_VIGILANCE) IS
  begin
    OPEN rc1 FOR
      select '1. Dossiers ouverts en comit de vigilance' as "Description",
             count(d.l_do_cle) as "Total"
        from do_dossier d
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut between NEW_DATE_DEBUT and NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or
             trunc(d.d_do_date_fin) > NEW_DATE_DEBUT)
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
union
      select '2. Dossiers prsents au comit de vigilance' as "Description",
             count(d.l_do_cle) as "Total"
        from do_dossier d
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
                 and exists
               (select c.l_co_cle from co_commentaire2 c where
               c.l_co_gabarit = 1346
               and c.l_co_reference = d.l_do_cle
               and c.l_co_ref_site = d.l_si_cle
               and c.i_cc_commentaire <> 14920)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT)
union        
              select '3. Dossiers pour lesquels les sujets ont accept de s''autoexclure' as "Description",
             count(d.l_do_cle) as "Total"
        from do_dossier d
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and exists
               (select l2.l_ldd_dossier_associe
                        from ldd_lien_dossier l2, do_dossier d2
                       where ((l2.l_do_cle = d.l_do_cle
                         and l2.l_do_site = d.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d2.l_do_cle
                         and l2.l_ldd_site = d2.l_si_cle
                         and l2.c_ldd_genre = 'DO')
                         or
                         (l2.l_do_cle = d2.l_do_cle
                         and l2.l_do_site = d2.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d.l_do_cle
                         and l2.l_ldd_site = d.l_si_cle
                         and l2.c_ldd_genre = 'DO'))
                         and d2.i_ca_cle = 112
                         and d2.i_cc_cle <> 14920)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
union                         
      select '4. Dossiers pour lesquels le sujet fait l''objet d''un avis de guet (AG)*' as "Description",
             count(d.l_do_cle) as "Total"
        from do_dossier d
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and exists
               (select l2.l_ldd_dossier_associe
                        from ldd_lien_dossier l2, do_dossier d2
                       where ((l2.l_do_cle = d.l_do_cle
                         and l2.l_do_site = d.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d2.l_do_cle
                         and l2.l_ldd_site = d2.l_si_cle
                         and l2.c_ldd_genre = 'DO')
                         or
                         (l2.l_do_cle = d2.l_do_cle
                         and l2.l_do_site = d2.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d.l_do_cle
                         and l2.l_ldd_site = d.l_si_cle
                         and l2.c_ldd_genre = 'DO'))
                         and d2.i_ca_cle = 27750
                         and d2.i_cc_cle <> 14920)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
union
      select '5. Dossiers pour lesquels le sujet fait l''objet d''une interdiction d''accs (AI)*' as "Description",
             count(d.l_do_cle) as "Total"
        from do_dossier d
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and exists
               (select l2.l_ldd_dossier_associe
                        from ldd_lien_dossier l2, do_dossier d2
                       where ((l2.l_do_cle = d.l_do_cle
                         and l2.l_do_site = d.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d2.l_do_cle
                         and l2.l_ldd_site = d2.l_si_cle
                         and l2.c_ldd_genre = 'DO')
                         or
                         (l2.l_do_cle = d2.l_do_cle
                         and l2.l_do_site = d2.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d.l_do_cle
                         and l2.l_ldd_site = d.l_si_cle
                         and l2.c_ldd_genre = 'DO'))
                         and d2.i_ca_cle = 541
                         and d2.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT)
         and d.d_do_date_debut < NEW_DATE_FIN
   union
      select '6. Dossiers soumis au Comit consultatif vigilance' as "Description",
             count(d.l_do_cle) as "Total"
        from do_dossier d
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
                 and exists
               (select c.l_co_cle from co_commentaire2 c where
               c.l_co_gabarit = 1350
               and c.l_co_reference = d.l_do_cle
               and c.l_co_ref_site = d.l_si_cle
               and c.i_cc_commentaire <> 14920)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT);
  END SP_RAP_VIGILANCE_SOMMAIRE;

  --Rapport statistique dtaill du comit de vigilance (CDX_0236)
  PROCEDURE SP_RAP_VIGILANCE_DETAILLE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_L_SI_CLE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_VIGILANCE_DETAIL) IS
  begin
    OPEN rc1 FOR
      select '1. Dossiers analyss par le comit de vigilance' as "Description",
             s.v_su_reference_3 as "numeroFiche",
             s.v_su_nom as "nom",
             s.v_su_prenom as "prenom",
             s.v_su_surnom as "alias",
             trsx.v_tr_description as "sexe",
             tret.v_tr_description as "ethnie",
             trl.v_tr_description as "langue",
             trra.v_tr_description as "teint",
             s.d_su_date_naissance as "dateNaissance"
        from do_dossier       d,
             su_sujet         s,
             ldd_lien_dossier l,
             tr_traduction    trsx,
             tr_traduction    tret,
             tr_traduction    trl,
             tr_traduction    trra
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT)
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and l.l_do_cle = d.l_do_cle
         and l.l_do_site = d.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and s.i_sx_cle = trsx.l_tr_cle(+)
         and trsx.i_la_cle(+) = 1
         and s.i_nt_cle = tret.l_tr_cle(+)
         and tret.i_la_cle(+) = 1
         and s.i_ls_cle = trl.l_tr_cle(+)
         and trl.i_la_cle(+) = 1
         and s.i_ra_cle = trra.l_tr_cle(+)
         and trra.i_la_cle(+) = 1

      union
      select '2. Dossiers pour les sujets qui ont accept de s''autoexclure' as "Description",
             s.v_su_reference_3 as "numeroFiche",
             s.v_su_nom as "nom",
             s.v_su_prenom as "prenom",
             s.v_su_surnom as "alias",
             trsx.v_tr_description as "sexe",
             tret.v_tr_description as "ethnie",
             trl.v_tr_description as "langue",
             trra.v_tr_description as "teint",
             s.d_su_date_naissance as "dateNaissance"
        from do_dossier       d,
             su_sujet         s,
             ldd_lien_dossier l,
             tr_traduction    trsx,
             tr_traduction    tret,
             tr_traduction    trl,
             tr_traduction    trra
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT)
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and l.l_do_cle = d.l_do_cle
         and l.l_do_site = d.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and s.i_sx_cle = trsx.l_tr_cle(+)
         and trsx.i_la_cle(+) = 1
         and s.i_nt_cle = tret.l_tr_cle(+)
         and tret.i_la_cle(+) = 1
         and s.i_ls_cle = trl.l_tr_cle(+)
         and trl.i_la_cle(+) = 1
         and s.i_ra_cle = trra.l_tr_cle(+)
         and trra.i_la_cle(+) = 1
         and exists
               (select c.l_co_cle from co_commentaire2 c where
               c.l_co_gabarit = 1346
               and c.l_co_reference = d.l_do_cle
               and c.l_co_ref_site = d.l_si_cle
               and c.i_cc_commentaire <> 14920)
      union
      select '3. Dossiers analyss par le comit de vigilance et placs sous surveillance (prvention)' as "Description",
             s.v_su_reference_3 as "numeroFiche",
             s.v_su_nom as "nom",
             s.v_su_prenom as "prenom",
             s.v_su_surnom as "alias",
             trsx.v_tr_description as "sexe",
             tret.v_tr_description as "ethnie",
             trl.v_tr_description as "langue",
             trra.v_tr_description as "teint",
             s.d_su_date_naissance as "dateNaissance"
        from do_dossier       d,
             su_sujet         s,
             ldd_lien_dossier l,
             tr_traduction    trsx,
             tr_traduction    tret,
             tr_traduction    trl,
             tr_traduction    trra
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT)
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and l.l_do_cle = d.l_do_cle
         and l.l_do_site = d.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and s.i_sx_cle = trsx.l_tr_cle(+)
         and trsx.i_la_cle(+) = 1
         and s.i_nt_cle = tret.l_tr_cle(+)
         and tret.i_la_cle(+) = 1
         and s.i_ls_cle = trl.l_tr_cle(+)
         and trl.i_la_cle(+) = 1
         and s.i_ra_cle = trra.l_tr_cle(+)
         and trra.i_la_cle(+) = 1
         and exists
               (select l2.l_ldd_dossier_associe
                        from ldd_lien_dossier l2, do_dossier d2
                       where ((l2.l_do_cle = d.l_do_cle
                         and l2.l_do_site = d.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d2.l_do_cle
                         and l2.l_ldd_site = d2.l_si_cle
                         and l2.c_ldd_genre = 'DO')
                         or
                         (l2.l_do_cle = d2.l_do_cle
                         and l2.l_do_site = d2.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d.l_do_cle
                         and l2.l_ldd_site = d.l_si_cle
                         and l2.c_ldd_genre = 'DO'))
                         and d2.i_ca_cle = 112
                         and d2.i_cc_cle <> 14920)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
union
      select '4. Dossiers analyss par le comit de vigilance et placs sous accs interdit' as "Description",
             s.v_su_reference_3 as "numeroFiche",
             s.v_su_nom as "nom",
             s.v_su_prenom as "prenom",
             s.v_su_surnom as "alias",
             trsx.v_tr_description as "sexe",
             tret.v_tr_description as "ethnie",
             trl.v_tr_description as "langue",
             trra.v_tr_description as "teint",
             s.d_su_date_naissance as "dateNaissance"
        from do_dossier       d,
             su_sujet         s,
             ldd_lien_dossier l,
             tr_traduction    trsx,
             tr_traduction    tret,
             tr_traduction    trl,
             tr_traduction    trra
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT)
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and l.l_do_cle = d.l_do_cle
         and l.l_do_site = d.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and s.i_sx_cle = trsx.l_tr_cle(+)
         and trsx.i_la_cle(+) = 1
         and s.i_nt_cle = tret.l_tr_cle(+)
         and tret.i_la_cle(+) = 1
         and s.i_ls_cle = trl.l_tr_cle(+)
         and trl.i_la_cle(+) = 1
         and s.i_ra_cle = trra.l_tr_cle(+)
         and trra.i_la_cle(+) = 1
         and exists
               (select l2.l_ldd_dossier_associe
                        from ldd_lien_dossier l2, do_dossier d2
                       where ((l2.l_do_cle = d.l_do_cle
                         and l2.l_do_site = d.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d2.l_do_cle
                         and l2.l_ldd_site = d2.l_si_cle
                         and l2.c_ldd_genre = 'DO')
                         or
                         (l2.l_do_cle = d2.l_do_cle
                         and l2.l_do_site = d2.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d.l_do_cle
                         and l2.l_ldd_site = d.l_si_cle
                         and l2.c_ldd_genre = 'DO'))
                         and d2.i_ca_cle = 27750
                         and d2.i_cc_cle <> 27749)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
union
      select '5. Dossiers pour les sujets dont l''interdiction d''accs est maintenue' as "Description",
             s.v_su_reference_3 as "numeroFiche",
             s.v_su_nom as "nom",
             s.v_su_prenom as "prenom",
             s.v_su_surnom as "alias",
             trsx.v_tr_description as "sexe",
             tret.v_tr_description as "ethnie",
             trl.v_tr_description as "langue",
             trra.v_tr_description as "teint",
             s.d_su_date_naissance as "dateNaissance"
        from do_dossier       d,
             su_sujet         s,
             ldd_lien_dossier l,
             tr_traduction    trsx,
             tr_traduction    tret,
             tr_traduction    trl,
             tr_traduction    trra
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT)
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and l.l_do_cle = d.l_do_cle
         and l.l_do_site = d.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and s.i_sx_cle = trsx.l_tr_cle(+)
         and trsx.i_la_cle(+) = 1
         and s.i_nt_cle = tret.l_tr_cle(+)
         and tret.i_la_cle(+) = 1
         and s.i_ls_cle = trl.l_tr_cle(+)
         and trl.i_la_cle(+) = 1
         and s.i_ra_cle = trra.l_tr_cle(+)
         and trra.i_la_cle(+) = 1
         and exists    
                    (select l2.l_ldd_dossier_associe
                        from ldd_lien_dossier l2, do_dossier d2
                       where ((l2.l_do_cle = d.l_do_cle
                         and l2.l_do_site = d.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d2.l_do_cle
                         and l2.l_ldd_site = d2.l_si_cle
                         and l2.c_ldd_genre = 'DO')
                         or
                         (l2.l_do_cle = d2.l_do_cle
                         and l2.l_do_site = d2.l_si_cle
                         and l2.c_do_genre = 'DO'
                         and l2.l_ldd_dossier_associe = d.l_do_cle
                         and l2.l_ldd_site = d.l_si_cle
                         and l2.c_ldd_genre = 'DO'))
                         and d2.i_ca_cle = 541
                         and d2.i_cc_cle <> 14920)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
      union
      select '6. Dossiers pour les sujets pour lesquels l''interdiction d''accs est finalement leve' as "Description",
             s.v_su_reference_3 as "numeroFiche",
             s.v_su_nom as "nom",
             s.v_su_prenom as "prenom",
             s.v_su_surnom as "alias",
             trsx.v_tr_description as "sexe",
             tret.v_tr_description as "ethnie",
             trl.v_tr_description as "langue",
             trra.v_tr_description as "teint",
             s.d_su_date_naissance as "dateNaissance"
        from do_dossier       d,
             su_sujet         s,
             ldd_lien_dossier l,
             tr_traduction    trsx,
             tr_traduction    tret,
             tr_traduction    trl,
             tr_traduction    trra
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT)
         and (d.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and l.l_do_cle = d.l_do_cle
         and l.l_do_site = d.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and s.i_sx_cle = trsx.l_tr_cle(+)
         and trsx.i_la_cle(+) = 1
         and s.i_nt_cle = tret.l_tr_cle(+)
         and tret.i_la_cle(+) = 1
         and s.i_ls_cle = trl.l_tr_cle(+)
         and trl.i_la_cle(+) = 1
         and s.i_ra_cle = trra.l_tr_cle(+)
         and trra.i_la_cle(+) = 1
         and exists
                (select c.l_co_cle from co_commentaire2 c where
               c.l_co_gabarit = 1350
               and c.l_co_reference = d.l_do_cle
               and c.l_co_ref_site = d.l_si_cle
               and c.i_cc_commentaire <> 14920)
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and (d.d_do_date_fin is null or d.d_do_date_fin > NEW_DATE_DEBUT);
                  
  END SP_RAP_VIGILANCE_DETAILLE;

  --Rapport diffr pour l'valuation des radmissions
  PROCEDURE SP_RAP_VIGILANCE_READMISSION(rc1 IN OUT DTS_RAPPORT_VIGILANCE_DETAIL) IS
  begin
    OPEN rc1 FOR
    
      select 'Rappel pour l''valuation des radmissions' as "Description",
             s.v_su_reference_3 as "numeroFiche",
             s.v_su_nom as "nom",
             s.v_su_prenom as "prenom",
             s.v_su_surnom as "alias",
             trsx.v_tr_description as "sexe",
             tret.v_tr_description as "ethnie",
             trl.v_tr_description as "langue",
             trra.v_tr_description as "teint",
             s.d_su_date_naissance
        from do_dossier       d,
             su_sujet         s,
             ldd_lien_dossier l,
             tr_traduction    trsx,
             tr_traduction    tret,
             tr_traduction    trl,
             tr_traduction    trra
       where d.i_ca_cle = 539
         and d.i_cc_cle <> 14920
         and l.l_do_cle = d.l_do_cle
         and l.l_do_site = d.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and s.i_sx_cle = trsx.l_tr_cle(+)
         and trsx.i_la_cle(+) = 1
         and s.i_nt_cle = tret.l_tr_cle(+)
         and tret.i_la_cle(+) = 1
         and s.i_ls_cle = trl.l_tr_cle(+)
         and trl.i_la_cle(+) = 1
         and s.i_ra_cle = trra.l_tr_cle(+)
         and trra.i_la_cle(+) = 1
         and exists (select l2.l_ldd_dossier_associe
                from ldd_lien_dossier l2, v_do_dossier_ca_ty d2
               where l2.l_do_cle = d2.l_do_cle
                 and l2.l_do_site = d2.l_si_cle
                 and l2.c_do_genre = 'DO'
                 and l2.l_ldd_dossier_associe = s.l_su_cle
                 and l2.l_ldd_site = s.l_si_cle
                 and l2.c_ldd_genre = 'SU'
                 and d2.i_na_cle = 417
                 and d2.i_st_cle = 359
                 and to_char(d2.d_do_date_debut, 'MM-DD') =
                     to_char(sysdate, 'MM-DD'));
  END SP_RAP_VIGILANCE_READMISSION;

  --Impression dtaills d'un dossier de vigilance
  PROCEDURE SP_RAP_DO_VIGILANCE_DETAILLE(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                                         NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                         rc1          IN OUT DTS_DO_EPURATION) IS
  BEGIN
    OPEN rc1 FOR
      SELECT nature.v_tr_description nature,
             dossier.v_do_ancienne_reference noDossier,
             dossier.v_do_numero_dossier noCardex,
             type.v_tr_description type,
             categorie.v_tr_description categorie,
             statut.v_tr_description statut,
             severite.v_tr_description severite,
             dossier.v_do_reference_video noSequentiel,
             decode(dossier.b_do_enregistrement_conserve,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'null') enrConserve,
             decode(dossier.b_do_enregistrement_numerique,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'null') enrNumerique,
             dossier.d_do_date_debut dateDebut,
             dossier.d_do_date_fin dateFin,
             dossier.v_do_reference1 reference1,
             dossier.v_do_reference3 reference2,
             dossier.v_do_reference5 reference3,
             intervenants.v_in_nom || ', ' || intervenants.v_in_prenom intervenant,
             site.v_si_site site,
             endroit.v_tr_description endroit,
             localisation.v_tr_description localisation,
             dossier.v_do_lieu lieu,
             dossier.v_do_reference2 origine,
             dossier.l_si_cle siteCle,
             dossier.l_do_cle dossierCle
        FROM v_do_dossier_ca_ty dossier,
             tr_traduction      nature,
             tr_traduction      type,
             tr_traduction      categorie,
             tr_traduction      statut,
             tr_traduction      severite,
             in_intervenant     intervenants,
             si_site            site,
             tr_traduction      endroit,
             tr_traduction      localisation
       WHERE dossier.i_na_cle = nature.l_tr_cle
         AND nature.i_la_cle = 1
         AND dossier.i_ty_cle = type.l_tr_cle
         AND type.i_la_cle = 1
         AND dossier.i_ca_cle = categorie.l_tr_cle
         AND categorie.i_la_cle = 1
         AND dossier.i_st_cle = statut.l_tr_cle
         AND statut.i_la_cle = 1
         AND dossier.i_se_cle = severite.l_tr_cle(+)
         AND severite.i_la_cle(+) = 1
         AND dossier.v_do_cree_par = intervenants.name
         AND dossier.l_si_cle = site.l_si_cle
         AND dossier.i_or_cle = endroit.l_tr_cle(+)
         AND endroit.i_la_cle(+) = 1
         AND dossier.i_cr_cle = localisation.l_tr_cle(+)
         AND localisation.i_la_cle(+) = 1
         AND dossier.l_do_cle = NEW_L_DO_CLE
         AND dossier.l_si_cle = NEW_L_SI_CLE;
  END SP_RAP_DO_VIGILANCE_DETAILLE;

  --Impression sommaire d'un dossier de vigilance
  PROCEDURE SP_RAP_DO_VIGILANCE_SOMMAIRE(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                                         NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                         rc1          IN OUT DTS_DO_EPURATION) IS
  BEGIN
    OPEN rc1 FOR
      SELECT nature.v_tr_description nature,
             dossier.v_do_ancienne_reference noDossier,
             dossier.v_do_numero_dossier noCardex,
             type.v_tr_description type,
             categorie.v_tr_description categorie,
             statut.v_tr_description statut,
             severite.v_tr_description severite,
             dossier.v_do_reference_video noSequentiel,
             decode(dossier.b_do_enregistrement_conserve,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'null') enrConserve,
             decode(dossier.b_do_enregistrement_numerique,
                    'yes',
                    'Oui',
                    'no ',
                    'Non',
                    'null') enrNumerique,
             dossier.d_do_date_debut dateDebut,
             dossier.d_do_date_fin dateFin,
             dossier.v_do_reference1 reference1,
             dossier.v_do_reference3 reference2,
             dossier.v_do_reference5 reference3,
             intervenants.v_in_nom || ', ' || intervenants.v_in_prenom intervenant,
             site.v_si_site site,
             endroit.v_tr_description endroit,
             localisation.v_tr_description localisation,
             dossier.v_do_lieu lieu,
             dossier.v_do_reference2 origine,
             dossier.l_si_cle siteCle,
             dossier.l_do_cle dossierCle
        FROM v_do_dossier_ca_ty dossier,
             tr_traduction      nature,
             tr_traduction      type,
             tr_traduction      categorie,
             tr_traduction      statut,
             tr_traduction      severite,
             in_intervenant     intervenants,
             si_site            site,
             tr_traduction      endroit,
             tr_traduction      localisation
       WHERE dossier.i_na_cle = nature.l_tr_cle
         AND nature.i_la_cle = 1
         AND dossier.i_ty_cle = type.l_tr_cle
         AND type.i_la_cle = 1
         AND dossier.i_ca_cle = categorie.l_tr_cle
         AND categorie.i_la_cle = 1
         AND dossier.i_st_cle = statut.l_tr_cle
         AND statut.i_la_cle = 1
         AND dossier.i_se_cle = severite.l_tr_cle(+)
         AND severite.i_la_cle(+) = 1
         AND dossier.v_do_cree_par = intervenants.name
         AND dossier.l_si_cle = site.l_si_cle
         AND dossier.i_or_cle = endroit.l_tr_cle(+)
         AND endroit.i_la_cle(+) = 1
         AND dossier.i_cr_cle = localisation.l_tr_cle(+)
         AND localisation.i_la_cle(+) = 1
         AND dossier.l_do_cle = NEW_L_DO_CLE
         AND dossier.l_si_cle = NEW_L_SI_CLE;
  END SP_RAP_DO_VIGILANCE_SOMMAIRE;

  --Rapport d'analyse des accs (nombre de sujets consults par intervenant)
  PROCEDURE SP_RAP_ACCES_SU_INTERVENANT(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                        NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                        NEW_SITE        IN VARCHAR,
                                        NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                        NEW_NOMBRE_FOIS IN NUMBER,
                                        rc1             IN OUT DTS_RAPPORT_ANALYSE_ACCES) IS
  begin
    OPEN rc1 FOR
      select 'Sujets consults plus de ' || NEW_NOMBRE_FOIS ||
             ' fois par intervenant' as "Description",
             i.v_in_nom || ', ' || i.v_in_prenom || ' (' || i.name || ', ' ||
             tsc.v_tr_description || ')' as "Intervenant",
             s.v_su_reference_3 as "Donnee",
             count(a.l_ac_cle) as "Total"
        from in_intervenant i, ac_acces a, tr_traduction tsc, su_sujet s
       where i.name = a.v_ac_name
         and a.c_gf_origine = 'SU'
         and a.d_ac_date_acces between NEW_DATE_DEBUT and NEW_DATE_FIN
         and a.c_ac_action = 'S'
         and i.l_in_secteur = tsc.l_tr_cle
         and tsc.i_la_cle = 1
         and a.l_ori_cle = s.l_su_cle
         and a.l_ori_site = s.l_si_cle
         and i.name like NEW_INTERVENANT
         and to_char(a.l_si_cle) like NEW_SITE
       group by i.name,
                i.v_in_nom,
                i.v_in_prenom,
                tsc.v_tr_description,
                s.v_su_reference_3
      having count(a.l_ac_cle) > NEW_NOMBRE_FOIS;
  END SP_RAP_ACCES_SU_INTERVENANT;

  --Rapport d'analyse des accs (nombre de sujets consults)
  PROCEDURE SP_RAP_ACCES_SUJETS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                NEW_SITE        IN VARCHAR,
                                NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                NEW_NOMBRE_FOIS IN NUMBER,
                                rc1             IN OUT DTS_RAPPORT_ANALYSE_ACCES) IS
  begin
    OPEN rc1 FOR
      select 'Sujets consults plus de ' || NEW_NOMBRE_FOIS || ' fois' as "Description",
             '' as "Intervenant",
             s.v_su_reference_3 as "Donnee",
             count(a.l_ac_cle) as "Total"
        from ac_acces a, su_sujet s
       where a.c_gf_origine = 'SU'
         and a.d_ac_date_acces >= NEW_DATE_DEBUT
         and a.d_ac_date_acces < NEW_DATE_FIN + 1
         and a.c_ac_action = 'S'
         and a.l_ori_cle = s.l_su_cle
         and a.l_ori_site = s.l_si_cle
         and to_char(a.l_si_cle) like NEW_SITE
       group by s.v_su_reference_3
      having count(a.l_ac_cle) > NEW_NOMBRE_FOIS;
  END SP_RAP_ACCES_SUJETS;

  --Rapport sommaire sur les accs des intervenants nouvellement crs
  PROCEDURE SP_RAP_ACCES_INTERVENANT_CREES(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                           NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                           NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                           rc1             IN OUT DTS_ACCES_INTERVENANT) IS
  begin
    OPEN rc1 FOR
      select a.v_ac_name,
             s.v_in_nom || ', ' || s.v_in_prenom "description",
             g.v_gf_genre_fichier,
             t.v_ta_type_acces
        from ac_acces         a,
             ta_type_acces    t,
             in_intervenant   s,
             gf_genre_fichier g
       where s.d_in_date_creation >= NEW_DATE_DEBUT
         and s.d_in_date_creation < NEW_DATE_FIN + 1
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = s.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and a.v_ac_name like NEW_INTERVENANT
         and a.c_gf_origine = g.c_gf_cle;
  END SP_RAP_ACCES_INTERVENANT_CREES;

  --Rapport sommaire sur les accs des superutilisateurs
  PROCEDURE SP_RAP_ACCES_SUPERUTILISATEURS(NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                           NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                           NEW_L_SI_CLE    IN SI_SITE.L_SI_CLE%TYPE,
                                           NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                           rc1             IN OUT DTS_ACCES_INTERVENANT) IS
  begin
    OPEN rc1 FOR
      select a.v_ac_name,
             s.v_in_nom || ', ' || s.v_in_prenom "description",
             g.v_gf_genre_fichier,
             t.v_ta_type_acces
        from ac_acces         a,
             ta_type_acces    t,
             in_intervenant   s,
             gf_genre_fichier g
       where a.d_ac_date_acces >= NEW_DATE_DEBUT
         and a.d_ac_date_acces < NEW_DATE_FIN + 1
         and a.c_ac_action = t.c_ta_abreviation
         and a.v_ac_name = s.name
         and (a.l_si_cle = NEW_L_SI_CLE or NEW_L_SI_CLE = 0)
         and a.v_ac_name like NEW_INTERVENANT
         and a.c_gf_origine = g.c_gf_cle
         and s.l_in_secteur = 249;
  END SP_RAP_ACCES_SUPERUTILISATEURS;

  --Rapport d'analyse des accs aux dossiers, selon genre et nature
  PROCEDURE SP_RAP_ACCES_DOSSIERS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                                  NEW_SITE        IN VARCHAR,
                                  NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                                  NEW_NOMBRE_FOIS IN NUMBER,
                                  NEW_GENRE       IN VARCHAR,
                                  NEW_NATURE      IN VARCHAR,
                                  rc1             IN OUT DTS_RAPPORT_ANALYSE_ACCES) IS
  begin
    OPEN rc1 FOR
      select 'Dossiers consults plus de ' || NEW_NOMBRE_FOIS || ' fois' as "Description",
             trge.v_tr_description || ' - ' || trna.v_tr_description as "Intervenant",
             d.v_do_numero_dossier as "Donnee",
             count(a.l_ac_cle) as "Total"
        from ac_acces           a,
             v_do_dossier_ca_ty d,
             tr_traduction      trge,
             tr_traduction      trna
       where a.c_gf_origine = 'DO'
         and a.d_ac_date_acces >= NEW_DATE_DEBUT
         and a.d_ac_date_acces < NEW_DATE_FIN + 1
         and a.c_ac_action = 'S'
         and a.l_ori_cle = d.l_do_cle
         and a.l_ori_site = d.l_si_cle
         and to_char(d.l_si_cle) like NEW_SITE
         and to_char(d.i_ge_cle) like NEW_GENRE
         and to_char(d.i_na_cle) like NEW_NATURE
         and d.i_ge_cle = trge.l_tr_cle
         and trge.i_la_cle = 1
         and d.i_na_cle = trna.l_tr_cle
         and trna.i_la_cle = 1
       group by trge.v_tr_description,
                trna.v_tr_description,
                d.v_do_numero_dossier
      having count(a.l_ac_cle) > NEW_NOMBRE_FOIS;
  END SP_RAP_ACCES_DOSSIERS;

  --Rapport sur la facturation SQ pour Habilitation scuritaire
  PROCEDURE SP_RAP_FACTURATION_SQ(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                  NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                  rc1            IN OUT DTS_FACTURATION_INV) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site           as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle            as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_si_cle <> 30
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in
             (21885, 21886, 21889, 21892, 21895, 21898, 21899)
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site
                 and sv.d_sv_date_completee is not null)
      union
      select s.v_si_site           as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle            as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_si_cle <> 30
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (21887, 21890, 21893, 21896, 26689, 26724)
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site
                 and sv.d_sv_date_completee is not null)
      union
      select s.v_si_site as "Site",
             'Niveau 3' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_si_cle <> 30
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (21888, 21891, 21893, 21894, 21897, 21901, 21903,
              25992, 26017, 26020, 26296, 26297, 26298)
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site
                 and sv.d_sv_date_completee is not null)
      union
      select s.v_si_site as "Site",
             'Niveau 4' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_si_cle <> 30
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (26296, 26297, 26298)
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site
                 and sv.d_sv_date_completee is not null);
  END SP_RAP_FACTURATION_SQ;
  --Rapport sur la facturation ECHO pour Habilitation scuritaire
  PROCEDURE SP_RAP_FACTURATION_ECHO(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                    NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                    rc1            IN OUT DTS_FACTURATION_INV) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site           as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle            as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in
             (21885, 21886, 21889, 21892, 21895, 21898, 21899)
         and d.i_ca_cle <> 22632 --Sans les grossistes
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 2491322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select 'Grossistes' as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ca_cle = 22632 --Grossistes seulement
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 2491322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      
      union
      select s.v_si_site           as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle            as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (21887, 21890, 21893, 21896, 26689, 26724)
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 2491322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select s.v_si_site as "Site",
             'Niveau 3' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (21888, 21891, 21893, 21894, 21897, 21901, 21903,
              26017, 26020, 26296, 26297, 26298)
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 2491322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select 'Dtaillants' as "Site",
             'Niveau 3' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle = 25992 --Dtaillants
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 2491322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select s.v_si_site as "Site",
             'Niveau 4' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (26296, 26297, 26298)
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 2491322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO');
  END SP_RAP_FACTURATION_ECHO;
  --Rapport sur la facturation SOQUIJ pour Habilitation scuritaire
  PROCEDURE SP_RAP_FACTURATION_SOQUIJ(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      rc1            IN OUT DTS_FACTURATION_INV) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site           as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle            as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in
             (21885, 21886, 21889, 21892, 21895, 21898, 21899)
         and d.i_ca_cle <> 22632 --Sans les grossistes
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 4834322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select 'Grossistes' as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ca_cle = 22632 --Grossistes seulement
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 4834322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      
      union
      select s.v_si_site           as "Site",
             trty.v_tr_description as "Type",
             d.l_do_cle            as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (21887, 21890, 21893, 21896, 26689, 26724)
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 4834322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select s.v_si_site as "Site",
             'Niveau 3' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (21888, 21891, 21893, 21894, 21897, 21901, 21903,
              26017, 26020, 26296, 26297, 26298)
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 4834322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select 'Dtaillants' as "Site",
             'Niveau 3' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle = 25992 --Dtaillants
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 4834322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO')
      union
      select s.v_si_site as "Site",
             'Niveau 4' as "Type",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             tr_traduction        trty
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.i_ty_cle = trty.l_tr_cle
         and trty.i_la_cle = 1
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_ty_cle in (26296, 26297, 26298)
         and exists (select ldd.l_do_cle
                from ldd_lien_dossier ldd
               where d.l_do_cle = ldd.l_do_cle
                 and d.l_si_cle = ldd.l_do_site
                 and ldd.c_do_genre = 'DO'
                 and ldd.l_ldd_dossier_associe = 4834322
                 and ldd.l_ldd_site = 30
                 and ldd.c_ldd_genre = 'SO');
  END SP_RAP_FACTURATION_SOQUIJ;

  --Rapport sur les le nombre d'enqutes traites Habilitation scuritaire
  PROCEDURE SP_RAP_NOMBRE_ENQUETES_HS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      rc1            IN OUT DTS_ENQUETES_TRAITEES) IS
  begin
    OPEN rc1 FOR
      select s.v_si_site as "Site",
             'Employs' as "Nature",
             'Jeux SQ' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (21877, 21878, 21881, 21879)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select s.v_si_site as "Site",
             'Employs' as "Nature",
             'Non jeux' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (21877, 21878, 21881, 21879)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and not exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select s.v_si_site as "Site",
             'Salaris' as "Nature",
             'Jeux SQ' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (21884, 21880, 21883)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select s.v_si_site as "Site",
             'Salaris' as "Nature",
             'Non jeux' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (21884, 21880, 21883)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and not exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select s.v_si_site as "Site",
             'Fournisseurs' as "Nature",
             'Jeux SQ' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (21882)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select s.v_si_site as "Site",
             'Fournisseurs' as "Nature",
             'Non jeux' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (21882)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and not exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select 'Dtaillants LQ' as "Site",
             'Salaris' as "Nature",
             'Non jeux' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (25991)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and not exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select 'Dtaillants LQ' as "Site",
             'Salaris' as "Nature",
             'Jeux SQ' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle in (25991)
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and exists (select sv.l_sv_reference
                from sv_suivi sv
               where d.l_do_cle = sv.l_sv_reference
                 and d.l_si_cle = sv.l_sv_ref_site)
      union
      select 'Autres' as "Site",
             'Autres' as "Nature",
             'Divers' as "Jeux",
             s2.v_si_abreviation as "Dossier",
             d.l_do_cle as "Total"
        from v_do_dossier_ca_ty d, si_site s2, is_inscription i
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and d.l_si_cle = s2.l_si_cle
         and d.i_cc_cle <> 14920
         and d.d_do_date_debut >= NEW_DATE_DEBUT
         and d.d_do_date_debut < NEW_DATE_FIN + 1
         and d.i_na_cle not in
             (21882, 21884, 21880, 21883, 21877, 21878, 21881, 21879, 25991);
  
  END SP_RAP_NOMBRE_ENQUETES_HS;

  --Lecture des numros de livret qui ne correspondent pas au dtaillant inscrit
  PROCEDURE SP_L_VERIFICATION_LIVRET(rc1 IN OUT DTS_SO_VERIFICATION_LIVRET) IS
  BEGIN
    OPEN rc1 FOR
      select substr(d.v_do_numero_dossier, 1, 3) || '-' ||
             substr(d.v_do_numero_dossier, 4, 8) || '-' ||
             substr(d.v_do_numero_dossier, 12, 16) as "V_DO_NUMERO_DOSSIER",
             b.d_bi_date_creation,
             b.v_bi_numero_controle,
             s.v_so_reference_3
        from bi_billet b, so_societe s, do_dossier d
       where b.l_so_cle_provenance = s.l_so_cle
         and b.l_so_site_provenance = s.l_si_cle
         and replace(replace(b.v_bi_numero_controle, '-', ''), ' ', '') ||
             s.v_so_reference_3 not in
             (select v1.NUMERO || v1.REF_NO_DET_FM
                from vexi_cdx_alx_livret v1
               where v1.REF_NO_DET_FM = s.v_so_reference_3
                 and v1.NUMERO =
                     replace(replace(b.v_bi_numero_controle, '-', ''),
                             ' ',
                             ''))
         and b.l_si_cle = 25
         and s.l_si_cle = 8
         and b.l_bi_ref_cle = d.l_do_cle
         and b.l_bi_ref_site = d.l_si_cle
         and d.d_do_date_debut >= sysdate - 7;
  
  END SP_L_VERIFICATION_LIVRET;

  --Vrification des changements apports aux dtaillants RDD dans Cardex
  PROCEDURE SP_L_CHANGEMENTS_DETAILLANTS(rc1 IN OUT DTS_SO_CHANGEMENTS_DETAILLANTS) IS
  BEGIN
    OPEN rc1 FOR
      select 'Dtaillants qui ont chang de nom de commerce' as "TITRE",
             s2.v_so_reference_3 as "NUMERO",
             s2.v_so_nom as "NOM",
             s.d_so_date_changement as "DATE_CHANGEMENT",
						 null as "DATE_ACTIVATION",
             null as "DATE_FIN_ACTIVITE"
        from do_dossier       d,
             ldd_lien_dossier l,
             aud_so_societe   s,
             so_societe       s2,
						 vexi_cdx_dds_detaillant v
       where d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s2.l_so_cle
         and l.l_ldd_site = s2.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.d_do_date_fin is null
         and s.l_so_cle = s2.l_so_cle
         and s.l_si_cle = s2.l_si_cle
         and trim(s.v_so_nom) <> trim(s2.v_so_nom)
         and s.d_so_date_changement > sysdate - 1
         and d.i_st_cle = 359
				 and trim(s.v_so_reference_3) = v.NO_DETAILLANT
         and not exists (
         select l2.l_do_cle
          from v_do_dossier_ca_ty d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s2.l_so_cle
           and l2.l_ldd_site = s2.l_si_cle
           and l2.c_ldd_genre = 'SO'
           and d2.i_ca_cle in (23667, 653, 654, 655)
           and d2.v_do_reference1 = d.v_do_ancienne_reference)
      union
      select 'Dtaillants avec un changement de coordonnes' as "TITRE",
             s.v_so_reference_3 as "NUMERO",
             s.v_so_nom as "NOM",
             a.d_ad_date_changement as "DATE_CHANGEMENT",
						 null as "DATE_ACTIVATION",
             null as "DATE_FIN_ACTIVITE"
        from do_dossier       d,
             ldd_lien_dossier l,
             so_societe       s,
             aud_ad_adresse   a,
             ad_adresse       a2,
             vexi_cdx_dds_detaillant v
       where d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_so_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.d_do_date_fin is null
         and a.l_ad_cle = a2.l_ad_cle
         and a.l_si_cle = a2.l_si_cle
         and a.d_ad_date_changement > sysdate - 1
         and d.i_st_cle = 359
         and a.l_ad_reference = s.l_so_cle
         and a.l_ad_ref_site = s.l_si_cle
         and s.v_so_reference_3 = v.NO_DETAILLANT
         and not exists (
         select l2.l_do_cle
          from v_do_dossier_ca_ty d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s.l_so_cle
           and l2.l_ldd_site = s.l_si_cle
           and l2.c_ldd_genre = 'SO'
           and d2.i_ca_cle in (23667, 653, 654, 655)
           and d2.v_do_reference1 = d.v_do_ancienne_reference)
      union
      select 'Dtaillants qui ont chang de responsable-socit morale' as "TITRE",
             s.v_so_reference_3 as "NUMERO",
             s.v_so_nom as "NOM",
             l2.d_ldd_date_creation as "DATE_CHANGEMENT",
             v.MOR_DATE_DEBUT_ACTV_RP as "DATE_ACTIVATION",
             v.DATE_FIN_ACTV_ER as "DATE_FIN_ACTIVITE"
        from do_dossier       d,
             ldd_lien_dossier l,
             so_societe       s,
             ldd_lien_dossier l2,
             vexi_cdx_dds_detaillant v
       where d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_so_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.d_do_date_fin is null
         and l2.l_do_cle = s.l_so_cle
         and l2.l_do_site = s.l_si_cle
         and l2.c_do_genre = 'SO'
         and l2.c_ldd_genre = 'SO'
         and l2.d_ldd_date_creation > sysdate - 1
         and l2.i_ro_cle = 659
         and d.i_st_cle = 359
         and s.v_so_reference_3 = v.NO_DETAILLANT
         and not exists (
         select l2.l_do_cle
          from v_do_dossier_ca_ty d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s.l_so_cle
           and l2.l_ldd_site = s.l_si_cle
           and l2.c_ldd_genre = 'SO'
           and d2.i_ca_cle in (23667, 653, 654, 655)
           and d2.v_do_reference1 = d.v_do_ancienne_reference)
      union
      select 'Dtaillants qui ont chang de responsable-sujet' as "TITRE",
             s.v_so_reference_3 as "NUMERO",
             s.v_so_nom as "NOM",
             l2.d_ldd_date_creation as "DATE_CHANGEMENT",
             v.DATE_DEBUT_ACTV_PP as "DATE_ACTIVATION",
             null as "DATE_FIN_ACTIVITE"
        from do_dossier       d,
             ldd_lien_dossier l,
             so_societe       s,
             ldd_lien_dossier l2,
             su_sujet         su,
             vexi_cdx_dds_detaillant v
       where d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_so_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.d_do_date_fin is null
         and su.l_su_cle = l2.l_do_cle
         and su.l_si_cle = l2.l_do_site
         and l2.l_ldd_dossier_associe = s.l_so_cle
         and l2.l_ldd_site = s.l_si_cle
         and l2.c_do_genre = 'SU'
         and l2.c_ldd_genre = 'SO'
         and l2.d_ldd_date_creation > sysdate - 1
         and l2.i_ro_cle = 659
         and d.i_st_cle = 359
         and s.v_so_reference_3 = v.NO_DETAILLANT
         and not exists (
         select l2.l_do_cle
          from v_do_dossier_ca_ty d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s.l_so_cle
           and l2.l_ldd_site = s.l_si_cle
           and l2.c_ldd_genre = 'SO'
           and d2.i_ca_cle in (23667, 653, 654, 655)
           and d2.v_do_reference1 = d.v_do_ancienne_reference)
      union
      select 'Dtaillants qui sont devenus inactifs' as "TITRE",
             s2.v_so_reference_3 as "NUMERO",
             s2.v_so_nom as "NOM",
             s.d_so_date_changement as "DATE_CHANGEMENT",
             null as "DATE_ACTIVATION",
             v.DATE_DEBUT_ACTV_PP as "DATE_FIN_ACTIVITE"
        from do_dossier       d,
             ldd_lien_dossier l,
             aud_so_societe   s,
             so_societe       s2,
             vexi_cdx_dds_detaillant v
       where d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s2.l_so_cle
         and l.l_ldd_site = s2.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.d_do_date_fin is null
         and s.l_so_cle = s2.l_so_cle
         and s.l_si_cle = s2.l_si_cle
         and s2.b_so_actif = 'no '
         and s.b_so_actif = 'yes'
         and s.d_so_date_changement > sysdate - 1
         and d.i_st_cle = 359
         and s.v_so_reference_3 = v.NO_DETAILLANT
         and not exists (
         select l2.l_do_cle
          from v_do_dossier_ca_ty d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s2.l_so_cle
           and l2.l_ldd_site = s2.l_si_cle
           and l2.c_ldd_genre = 'SO'
           and d2.i_ca_cle in (23667, 653, 654, 655)
           and d2.v_do_reference1 = d.v_do_ancienne_reference)
      union
      select distinct 'Dtaillants qui ont chang de code de commerce' as "TITRE",
             s2.v_so_reference_3 as "NUMERO",
             s2.v_so_nom as "NOM",
             s.d_so_date_changement as "DATE_CHANGEMENT",
             v.DATE_DEBUT_ACTV_ER as "DATE_ACTIVATION",
             v.DATE_FIN_ACTV_ER as "DATE_FIN_ACTIVITE"
        from do_dossier       d,
             ldd_lien_dossier l,
             aud_so_societe   s,
             so_societe       s2,
             vexi_cdx_dds_detaillant v
       where d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s2.l_so_cle
         and l.l_ldd_site = s2.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.d_do_date_fin is null
         and s.l_so_cle = s2.l_so_cle
         and s.l_si_cle = s2.l_si_cle
         and s.v_so_code_compte <> s2.v_so_code_compte
         and s.d_so_date_changement > sysdate - 1
         and d.i_st_cle = 359
         and s.v_so_reference_3 = v.NO_DETAILLANT
         and not exists (
         select l2.l_do_cle
          from v_do_dossier_ca_ty d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s2.l_so_cle
           and l2.l_ldd_site = s2.l_si_cle
           and l2.c_ldd_genre = 'SO'
           and d2.i_ca_cle in (23667, 653, 654, 655)
           and d2.v_do_reference1 = d.v_do_ancienne_reference)
      union
      select distinct 'Dtaillants sans adresse' as "TITRE",
             s.v_so_reference_3 as "NUMERO",
             s.v_so_nom as "NOM",
             S.D_SO_DATE_CREATION as "DATE_CHANGEMENT",
             null as "DATE_ACTIVATION",
             null as "DATE_FIN_ACTIVITE"
        FROM VEXI_CDX_DDS_DETAILLANT V, 
             SO_SOCIETE              S,
             do_dossier              d,
             ldd_lien_dossier        l
       WHERE d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_so_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.d_do_date_fin is null
         and S.V_SO_REFERENCE_3 = V.NO_DETAILLANT
         AND not exists
       (select vi.v_vi_ville
                from vi_ville vi
               where convert(upper('%' || v.VILLE || '%'), 'US7ASCII') =
                     convert(upper('%' || vi.v_vi_ville(+) || '%'),
                             'US7ASCII'))
         and S.D_SO_DATE_INACTIVATION is null
         and s.b_so_ind_rdd = 'yes'
          AND not exists
         (select a.l_ad_reference from ad_adresse a
         where a.l_ad_reference = s.l_so_cle
         and a.l_ad_ref_site = s.l_si_cle
         and a.c_ad_ref_genre = 'SO')
      union
      select distinct 'Dtaillants avec un changement d''adresse' as "TITRE",
             s.v_so_reference_3 as "NUMERO",
             s.v_so_nom as "NOM",
             a.d_ad_date_creation as "DATE_CHANGEMENT",
             null as "DATE_ACTIVATION",
             null as "DATE_FIN_ACTIVITE"
        FROM do_dossier              d,
             ldd_lien_dossier        l,
             VEXI_CDX_DDS_DETAILLANT V,
             SO_SOCIETE              S,
             AD_ADRESSE              A
       WHERE d.i_ca_cle = 662
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_do_site
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_so_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SO'
         and S.V_SO_REFERENCE_3 = V.NO_DETAILLANT
         AND S.D_SO_DATE_CREATION < SYSDATE - 1
         AND S.L_SO_CLE = A.L_AD_REFERENCE
         AND S.L_SI_CLE = A.L_AD_REF_SITE
         AND A.D_AD_DATE_CREATION > SYSDATE - 1
         and d.i_st_cle = 359
         and s.v_so_reference_3 = v.NO_DETAILLANT
         and not exists (
         select l2.l_do_cle
          from v_do_dossier_ca_ty d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s.l_so_cle
           and l2.l_ldd_site = s.l_si_cle
           and l2.c_ldd_genre = 'SO'
           and d2.i_ca_cle in (23667, 653, 654, 655)
           and d2.v_do_reference1 = d.v_do_ancienne_reference);
  END SP_L_CHANGEMENTS_DETAILLANTS;

  --Rapport d'investigation sur les svrits 4 des sujets.
  PROCEDURE SP_RAP_SEVERITE_4_SUJETS(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                     NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                     NEW_SITE       IN DO_DOSSIER.L_SI_CLE%TYPE,
                                     NEW_SEVERITE   IN SU_SUJET.i_Se_Cle%TYPE,
                                     rc1            IN OUT DTS_RAPPORT_SEVERITE_4_SUJETS) IS
  begin
    OPEN rc1 FOR
      select s.v_su_nom            as "NOM",
             s.v_su_prenom         as "PRENOM",
             s.v_su_reference_3    as "NUMERO_DE_FICHE",
             trse.v_tr_description as "SEVERITE",
             si.v_si_site          as "SITE_APPLICABLE",
             i.d_is_date_fin       as "DATE_DE_FIN"
        from su_sujet             s,
             tr_traduction        trse,
             do_dossier           d,
             Ldd_Lien_Dossier     l,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              si
       where (s.i_se_cle = NEW_SEVERITE or NEW_SEVERITE = 0)
         and s.i_se_cle is not null
         and s.i_se_cle = trse.l_tr_cle
         and trse.i_la_cle = 1
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_su_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SU'
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = si.l_si_cle
         and i.i_st_cle = 359
         and i.d_is_date_debut >= NEW_DATE_DEBUT
         and i.d_is_date_debut < NEW_DATE_FIN + 1
         AND (sis.l_is_site = NEW_SITE or NEW_SITE = 0)
       ORDER BY s.v_su_nom, s.v_su_prenom, si.v_si_site;
  END SP_RAP_SEVERITE_4_SUJETS;

  --Rapport d'investigation sur les svrits 4 des socits.
  PROCEDURE SP_RAP_SEVERITE_4_SOCIETE(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                      NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                      NEW_SITE       IN DO_DOSSIER.L_SI_CLE%TYPE,
                                      NEW_SEVERITE   IN SU_SUJET.i_Se_Cle%TYPE,
                                      rc1            IN OUT DTS_RAPPORT_SEVERITE_4_SOCIETE) IS
  begin
    OPEN rc1 FOR
      select s.v_so_nom            as "NOM",
             s.v_so_reference_3    as "NUMERO_DE_FICHE",
             trse.v_tr_description as "SEVERITE",
             si.v_si_site          as "SITE_APPLICABLE",
             i.d_is_date_fin       as "DATE_DE_FIN"
        from so_societe           s,
             tr_traduction        trse,
             do_dossier           d,
             Ldd_Lien_Dossier     l,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              si
       where (s.i_se_cle = NEW_SEVERITE or NEW_SEVERITE = 0)
         and s.i_se_cle is not null
         and s.i_se_cle = trse.l_tr_cle
         and trse.i_la_cle = 1
         and d.l_do_cle = l.l_do_cle
         and d.l_si_cle = l.l_si_cle
         and l.c_do_genre = 'DO'
         and l.l_ldd_dossier_associe = s.l_so_cle
         and l.l_ldd_site = s.l_si_cle
         and l.c_ldd_genre = 'SO'
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = si.l_si_cle
         and i.i_st_cle = 359
         and i.d_is_date_debut >= NEW_DATE_DEBUT
         and i.d_is_date_debut < NEW_DATE_FIN + 1
         AND (sis.l_is_site = NEW_SITE or NEW_SITE = 0)
       order by s.v_so_nom;
  END SP_RAP_SEVERITE_4_SOCIETE;

  --Production des fichiers pour le systme de reconnaissance de plaques  partir du diffr.
  PROCEDURE SP_RAP_RECONNAISSANCE_PLAQUES(NEW_SITE IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          rc1      IN OUT DTS_RECONNAISSANCE_PLAQUES) IS
  begin
    OPEN rc1 FOR
select *
  from (
          select convert(tna.v_tr_description, 'US7ASCII') as "Titre",
                v.v_ve_immatriculation as "Immatriculation",
                '' as "Couleur",
                ma.v_ma_marque as "Marque",
                convert(md.v_md_modele, 'US7ASCII') as "Modle",
                convert(tpr.v_tr_abreviation, 'US7ASCII') as "Province",
                v.c_ve_annee as "Anne",
                substr(d.v_do_numero_dossier, 1, 3) || '-' ||
                substr(d.v_do_numero_dossier, 4, 8) || '-' ||
                substr(d.v_do_numero_dossier, 12, 16) as "Numro cardex",
                d.v_do_ancienne_reference as "Numro de dossier",
                s.v_su_reference_3 as "Numro de fiche sujet"
          from ve_vehicule        v,
                v_do_dossier_ca_ty d,
                ldd_lien_dossier   l,
                md_modele          md,
                ma_marque          ma,
                tr_traduction      tpr,
                tr_traduction      tna,
                ldd_lien_dossier   ldd,
                su_sujet           s
         where d.i_cc_cle <> 14920
           and d.i_st_cle = 359
           and d.i_na_cle in (416, 417, 78)
           and ((d.l_do_cle = l.l_do_cle and d.l_si_cle = l.l_do_site and
               l.c_do_genre = 'DO' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE') or
               (s.l_su_cle = l.l_do_cle and s.l_si_cle = l.l_do_site and
               l.c_do_genre = 'SU' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE'))
           and v.v_ve_immatriculation is not null
           and v.i_md_cle = md.i_md_cle
           and md.i_ma_cle = ma.i_ma_cle
           and v.l_pr_cle = tpr.l_tr_cle(+)
           and tpr.i_la_cle(+) = 1
           and d.i_na_cle = tna.l_tr_cle
           and tna.i_la_cle = 1
           and d.l_do_cle = ldd.l_do_cle
           and d.l_si_cle = ldd.l_do_site
           and ldd.c_do_genre = 'DO'
           and ldd.l_ldd_dossier_associe = s.l_su_cle
           and ldd.l_ldd_site = s.l_si_cle
           and ldd.c_ldd_genre = 'SU'
           and exists
         (select ins.l_is_reference
                  from is_inscription ins, sis_site_inscription sis
                 where d.l_do_cle = ins.l_is_reference
                   and d.l_si_cle = ins.l_is_ref_site
                   and ins.l_is_cle = sis.l_is_cle
                   and ins.l_si_cle = sis.l_si_cle
                   and ins.i_st_cle = 359
                   and sis.l_is_site = NEW_SITE)
           and v.v_ve_immatriculation in
               (select v.v_ve_immatriculation
                  from ve_vehicule        v,
                       v_do_dossier_ca_ty d,
                       ldd_lien_dossier   l,
                       md_modele          md,
                       ma_marque          ma,
                       tr_traduction      tpr,
                       tr_traduction      tna,
                       ldd_lien_dossier   ldd,
                       su_sujet           s
                 where d.i_cc_cle <> 14920
                   and d.i_st_cle = 359
                   and d.i_na_cle in (416, 417, 78)
                   and s.l_su_cle = l.l_do_cle
                   and s.l_si_cle = l.l_do_site
                   and l.c_do_genre = 'SU'
                   and l.l_ldd_dossier_associe = v.l_ve_cle
                   and l.l_ldd_site = v.l_si_cle
                   and l.c_ldd_genre = 'VE'
                   and v.v_ve_immatriculation is not null
                   and v.i_md_cle = md.i_md_cle
                   and md.i_ma_cle = ma.i_ma_cle
                   and v.l_pr_cle = tpr.l_tr_cle(+)
                   and tpr.i_la_cle(+) = 1
                   and d.i_na_cle = tna.l_tr_cle
                   and tna.i_la_cle = 1
                   and d.l_do_cle = ldd.l_do_cle
                   and d.l_si_cle = ldd.l_do_site
                   and ldd.c_do_genre = 'DO'
                   and ldd.l_ldd_dossier_associe = s.l_su_cle
                   and ldd.l_ldd_site = s.l_si_cle
                   and ldd.c_ldd_genre = 'SU'
                   and exists
                 (select ins.l_is_reference
                          from is_inscription ins, sis_site_inscription sis
                         where d.l_do_cle = ins.l_is_reference
                           and d.l_si_cle = ins.l_is_ref_site
                           and ins.l_is_cle = sis.l_is_cle
                           and ins.l_si_cle = sis.l_si_cle
                           and ins.i_st_cle = 359
                           and sis.l_is_site = NEW_SITE)
                
                 group by v.v_ve_immatriculation
                having count(v.v_ve_immatriculation) = 1)
        union
        select convert(tna.v_tr_description, 'US7ASCII') as "Titre",
               v.v_ve_immatriculation as "Immatriculation",
               '' as "Couleur",
               ma.v_ma_marque as "Marque",
               convert(md.v_md_modele, 'US7ASCII') as "Modle",
               convert(tpr.v_tr_abreviation, 'US7ASCII') as "Province",
               v.c_ve_annee as "Anne",
               substr(d.v_do_numero_dossier, 1, 3) || '-' ||
               substr(d.v_do_numero_dossier, 4, 8) || '-' ||
               substr(d.v_do_numero_dossier, 12, 16) as "Numro cardex",
               d.v_do_ancienne_reference || '*' as "Numro de dossier",
               s.v_su_reference_3 as "Numro de fiche sujet"
          from ve_vehicule        v,
               v_do_dossier_ca_ty d,
               ldd_lien_dossier   l,
               md_modele          md,
               ma_marque          ma,
               tr_traduction      tpr,
               tr_traduction      tna,
               ldd_lien_dossier   ldd,
               su_sujet           s
         where d.i_cc_cle <> 14920
           and d.i_st_cle = 359
           and d.i_na_cle in (416, 417, 78)
           and ((d.l_do_cle = l.l_do_cle and d.l_si_cle = l.l_do_site and
               l.c_do_genre = 'DO' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE') or
               (s.l_su_cle = l.l_do_cle and s.l_si_cle = l.l_do_site and
               l.c_do_genre = 'SU' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE'))
           and v.v_ve_immatriculation is not null
           and v.i_md_cle = md.i_md_cle
           and md.i_ma_cle = ma.i_ma_cle
           and v.l_pr_cle = tpr.l_tr_cle(+)
           and tpr.i_la_cle(+) = 1
           and d.i_na_cle = tna.l_tr_cle
           and tna.i_la_cle = 1
           and d.l_do_cle = ldd.l_do_cle
           and d.l_si_cle = ldd.l_do_site
           and ldd.c_do_genre = 'DO'
           and ldd.l_ldd_dossier_associe = s.l_su_cle
           and ldd.l_ldd_site = s.l_si_cle
           and ldd.c_ldd_genre = 'SU'
           and exists
         (select ins.l_is_reference
                  from is_inscription ins, sis_site_inscription sis
                 where d.l_do_cle = ins.l_is_reference
                   and d.l_si_cle = ins.l_is_ref_site
                   and ins.l_is_cle = sis.l_is_cle
                   and ins.l_si_cle = sis.l_si_cle
                   and ins.i_st_cle = 359
                   and sis.l_is_site = NEW_SITE)
           and v.v_ve_immatriculation in
               (select v.v_ve_immatriculation
                  from ve_vehicule        v,
                       v_do_dossier_ca_ty d,
                       ldd_lien_dossier   l,
                       md_modele          md,
                       ma_marque          ma,
                       tr_traduction      tpr,
                       tr_traduction      tna,
                       ldd_lien_dossier   ldd,
                       su_sujet           s
                 where d.i_cc_cle <> 14920
                   and d.i_st_cle = 359
                   and d.i_na_cle in (416, 417, 78)
                   and s.l_su_cle = l.l_do_cle
                   and s.l_si_cle = l.l_do_site
                   and l.c_do_genre = 'SU'
                   and l.l_ldd_dossier_associe = v.l_ve_cle
                   and l.l_ldd_site = v.l_si_cle
                   and l.c_ldd_genre = 'VE'
                   and v.v_ve_immatriculation is not null
                   and v.i_md_cle = md.i_md_cle
                   and md.i_ma_cle = ma.i_ma_cle
                   and v.l_pr_cle = tpr.l_tr_cle(+)
                   and tpr.i_la_cle(+) = 1
                   and d.i_na_cle = tna.l_tr_cle
                   and tna.i_la_cle = 1
                   and d.l_do_cle = ldd.l_do_cle
                   and d.l_si_cle = ldd.l_do_site
                   and ldd.c_do_genre = 'DO'
                   and ldd.l_ldd_dossier_associe = s.l_su_cle
                   and ldd.l_ldd_site = s.l_si_cle
                   and ldd.c_ldd_genre = 'SU'
                   and exists
                 (select ins.l_is_reference
                          from is_inscription ins, sis_site_inscription sis
                         where d.l_do_cle = ins.l_is_reference
                           and d.l_si_cle = ins.l_is_ref_site
                           and ins.l_is_cle = sis.l_is_cle
                           and ins.l_si_cle = sis.l_si_cle
                           and ins.i_st_cle = 359
                           and sis.l_is_site = NEW_SITE)
                
                 group by v.v_ve_immatriculation
                having count(v.v_ve_immatriculation) > 1));
  END SP_RAP_RECONNAISSANCE_PLAQUES;

  --Production manuelle des fichiers pour le systme de reconnaissance de plaques.
  PROCEDURE SP_RAP_RECONNAISSANCE_PLAQUES(NEW_TITRE  IN VARCHAR2,
                                          NEW_SITE   IN DO_DOSSIER.L_SI_CLE%TYPE,
                                          NEW_NATURE IN NA_NATURE.I_NA_CLE%TYPE,
                                          rc1        IN OUT DTS_RECONNAISSANCE_PLAQUES) IS
  begin
    OPEN rc1 FOR
select *
  from (
          select NEW_TITRE as "Titre",
                v.v_ve_immatriculation as "Immatriculation",
                '' as "Couleur",
                ma.v_ma_marque as "Marque",
                convert(md.v_md_modele, 'US7ASCII') as "Modle",
                convert(tpr.v_tr_abreviation, 'US7ASCII') as "Province",
                v.c_ve_annee as "Anne",
                substr(d.v_do_numero_dossier, 1, 3) || '-' ||
                substr(d.v_do_numero_dossier, 4, 8) || '-' ||
                substr(d.v_do_numero_dossier, 12, 16) as "Numro cardex",
                d.v_do_ancienne_reference as "Numro de dossier",
                s.v_su_reference_3 as "Numro de fiche sujet"
          from ve_vehicule        v,
                v_do_dossier_ca_ty d,
                ldd_lien_dossier   l,
                md_modele          md,
                ma_marque          ma,
                tr_traduction      tpr,
                tr_traduction      tna,
                ldd_lien_dossier   ldd,
                su_sujet           s
         where d.i_cc_cle <> 14920
           and d.i_st_cle = 359
           and d.i_na_cle in (416, 417, 78)
           and ((d.l_do_cle = l.l_do_cle and d.l_si_cle = l.l_do_site and
               l.c_do_genre = 'DO' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE') or
               (s.l_su_cle = l.l_do_cle and s.l_si_cle = l.l_do_site and
               l.c_do_genre = 'SU' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE'))
           and v.v_ve_immatriculation is not null
           and v.i_md_cle = md.i_md_cle
           and md.i_ma_cle = ma.i_ma_cle
           and v.l_pr_cle = tpr.l_tr_cle(+)
           and tpr.i_la_cle(+) = 1
           and d.i_na_cle = tna.l_tr_cle
           and tna.i_la_cle = 1
           and d.l_do_cle = ldd.l_do_cle
           and d.l_si_cle = ldd.l_do_site
           and ldd.c_do_genre = 'DO'
           and ldd.l_ldd_dossier_associe = s.l_su_cle
           and ldd.l_ldd_site = s.l_si_cle
           and ldd.c_ldd_genre = 'SU'
           and exists
         (select ins.l_is_reference
                  from is_inscription ins, sis_site_inscription sis
                 where d.l_do_cle = ins.l_is_reference
                   and d.l_si_cle = ins.l_is_ref_site
                   and ins.l_is_cle = sis.l_is_cle
                   and ins.l_si_cle = sis.l_si_cle
                   and ins.i_st_cle = 359
                   and sis.l_is_site = NEW_SITE)
           and v.v_ve_immatriculation in
               (select v.v_ve_immatriculation
                  from ve_vehicule        v,
                       v_do_dossier_ca_ty d,
                       ldd_lien_dossier   l,
                       md_modele          md,
                       ma_marque          ma,
                       tr_traduction      tpr,
                       tr_traduction      tna,
                       ldd_lien_dossier   ldd,
                       su_sujet           s
                 where d.i_na_cle = NEW_NATURE
                   and d.i_cc_cle <> 14920
                   and d.i_st_cle = 359
                   and d.i_na_cle in (416, 417, 78)
                   and s.l_su_cle = l.l_do_cle
                   and s.l_si_cle = l.l_do_site
                   and l.c_do_genre = 'SU'
                   and l.l_ldd_dossier_associe = v.l_ve_cle
                   and l.l_ldd_site = v.l_si_cle
                   and l.c_ldd_genre = 'VE'
                   and v.v_ve_immatriculation is not null
                   and v.i_md_cle = md.i_md_cle
                   and md.i_ma_cle = ma.i_ma_cle
                   and v.l_pr_cle = tpr.l_tr_cle(+)
                   and tpr.i_la_cle(+) = 1
                   and d.i_na_cle = tna.l_tr_cle
                   and tna.i_la_cle = 1
                   and d.l_do_cle = ldd.l_do_cle
                   and d.l_si_cle = ldd.l_do_site
                   and ldd.c_do_genre = 'DO'
                   and ldd.l_ldd_dossier_associe = s.l_su_cle
                   and ldd.l_ldd_site = s.l_si_cle
                   and ldd.c_ldd_genre = 'SU'
                   and exists
                 (select ins.l_is_reference
                          from is_inscription ins, sis_site_inscription sis
                         where d.l_do_cle = ins.l_is_reference
                           and d.l_si_cle = ins.l_is_ref_site
                           and ins.l_is_cle = sis.l_is_cle
                           and ins.l_si_cle = sis.l_si_cle
                           and ins.i_st_cle = 359
                           and sis.l_is_site = NEW_SITE)
                
                 group by v.v_ve_immatriculation
                having count(v.v_ve_immatriculation) = 1)
        union
        select NEW_TITRE as "Titre",
               v.v_ve_immatriculation as "Immatriculation",
               '' as "Couleur",
               ma.v_ma_marque as "Marque",
               convert(md.v_md_modele, 'US7ASCII') as "Modle",
               convert(tpr.v_tr_abreviation, 'US7ASCII') as "Province",
               v.c_ve_annee as "Anne",
               substr(d.v_do_numero_dossier, 1, 3) || '-' ||
               substr(d.v_do_numero_dossier, 4, 8) || '-' ||
               substr(d.v_do_numero_dossier, 12, 16) as "Numro cardex",
               d.v_do_ancienne_reference || '*' as "Numro de dossier",
               s.v_su_reference_3 as "Numro de fiche sujet"
          from ve_vehicule        v,
               v_do_dossier_ca_ty d,
               ldd_lien_dossier   l,
               md_modele          md,
               ma_marque          ma,
               tr_traduction      tpr,
               tr_traduction      tna,
               ldd_lien_dossier   ldd,
               su_sujet           s
         where d.i_na_cle = NEW_NATURE
           and d.i_cc_cle <> 14920
           and d.i_st_cle = 359
           and d.i_na_cle in (416, 417, 78)
           and ((d.l_do_cle = l.l_do_cle and d.l_si_cle = l.l_do_site and
               l.c_do_genre = 'DO' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE') or
               (s.l_su_cle = l.l_do_cle and s.l_si_cle = l.l_do_site and
               l.c_do_genre = 'SU' and l.l_ldd_dossier_associe = v.l_ve_cle and
               l.l_ldd_site = v.l_si_cle and l.c_ldd_genre = 'VE'))
           and v.v_ve_immatriculation is not null
           and v.i_md_cle = md.i_md_cle
           and md.i_ma_cle = ma.i_ma_cle
           and v.l_pr_cle = tpr.l_tr_cle(+)
           and tpr.i_la_cle(+) = 1
           and d.i_na_cle = tna.l_tr_cle
           and tna.i_la_cle = 1
           and d.l_do_cle = ldd.l_do_cle
           and d.l_si_cle = ldd.l_do_site
           and ldd.c_do_genre = 'DO'
           and ldd.l_ldd_dossier_associe = s.l_su_cle
           and ldd.l_ldd_site = s.l_si_cle
           and ldd.c_ldd_genre = 'SU'
           and exists
         (select ins.l_is_reference
                  from is_inscription ins, sis_site_inscription sis
                 where d.l_do_cle = ins.l_is_reference
                   and d.l_si_cle = ins.l_is_ref_site
                   and ins.l_is_cle = sis.l_is_cle
                   and ins.l_si_cle = sis.l_si_cle
                   and ins.i_st_cle = 359
                   and (sis.l_is_site = NEW_SITE OR NEW_SITE = 0))
           and v.v_ve_immatriculation in
               (select v.v_ve_immatriculation
                  from ve_vehicule        v,
                       v_do_dossier_ca_ty d,
                       ldd_lien_dossier   l,
                       md_modele          md,
                       ma_marque          ma,
                       tr_traduction      tpr,
                       tr_traduction      tna,
                       ldd_lien_dossier   ldd,
                       su_sujet           s
                 where d.i_cc_cle <> 14920
                   and d.i_st_cle = 359
                   and d.i_na_cle in (416, 417, 78)
                   and s.l_su_cle = l.l_do_cle
                   and s.l_si_cle = l.l_do_site
                   and l.c_do_genre = 'SU'
                   and l.l_ldd_dossier_associe = v.l_ve_cle
                   and l.l_ldd_site = v.l_si_cle
                   and l.c_ldd_genre = 'VE'
                   and v.v_ve_immatriculation is not null
                   and v.i_md_cle = md.i_md_cle
                   and md.i_ma_cle = ma.i_ma_cle
                   and v.l_pr_cle = tpr.l_tr_cle(+)
                   and tpr.i_la_cle(+) = 1
                   and d.i_na_cle = tna.l_tr_cle
                   and tna.i_la_cle = 1
                   and d.l_do_cle = ldd.l_do_cle
                   and d.l_si_cle = ldd.l_do_site
                   and ldd.c_do_genre = 'DO'
                   and ldd.l_ldd_dossier_associe = s.l_su_cle
                   and ldd.l_ldd_site = s.l_si_cle
                   and ldd.c_ldd_genre = 'SU'
                   and exists
                 (select ins.l_is_reference
                          from is_inscription ins, sis_site_inscription sis
                         where d.l_do_cle = ins.l_is_reference
                           and d.l_si_cle = ins.l_is_ref_site
                           and ins.l_is_cle = sis.l_is_cle
                           and ins.l_si_cle = sis.l_si_cle
                           and ins.i_st_cle = 359
                           and (sis.l_is_site = NEW_SITE OR NEW_SITE = 0))
                 group by v.v_ve_immatriculation
                having count(v.v_ve_immatriculation) > 1));
 END SP_RAP_RECONNAISSANCE_PLAQUES;

  -- Extraction des liens multimdia pour vrifier si l'lment est bien prsent (diffr CDX_00016)
  PROCEDURE SP_RAP_VERIFICATION_MULTIMEDIA(rc1 IN OUT DTS_VERIFICATION_MULTIMEDIA) IS
  begin
    OPEN rc1 FOR
      SELECT M.L_EM_CLE,
             M.L_EM_SI_CLE,
             M.V_MM_EXTENSION,
             M.I_TM_CLE,
             L.C_LMM_REF_GENRE,
             L.L_LMM_REFERENCE,
             L.L_LMM_REF_SITE
        FROM LMM_LIEN_MULTIMEDIA L, MM_MULTIMEDIA M
       WHERE L.L_MM_CLE = M.L_MM_CLE
         AND L.L_MM_REF_SITE = M.L_SI_CLE
         AND L.D_LMM_DATE_CREATION > SYSDATE - 10;
  END SP_RAP_VERIFICATION_MULTIMEDIA;

--Rapport des accs aux sujets (CDX_0124)
PROCEDURE SP_RAPPORT_ACCES_SUJETS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_SITE        IN NUMBER,
                              NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                              NEW_GROUPE      IN NUMBER,
                              rc1             IN OUT DTS_RAPPORT_ACCES_SUJETS) IS
begin
  OPEN rc1 FOR
    select i.v_in_name_parent parent,
       i.name code,
       i.v_in_nom || ', ' || i.v_in_prenom intervenant,
       s.v_su_reference_3 fiche,
       s.v_su_nom nom,
       s.v_su_prenom prenom,
       s.d_su_date_naissance naissance,
       gs.v_gs_nom groupe,
       count(s.v_su_reference_3) total
  from ac_acces                   a,
       su_sujet                   s,
       in_intervenant             i,
       igs_intervenant_groupe_sec igs,
       gs_groupe_securite         gs
 where a.d_ac_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
   and a.l_ori_cle = s.l_su_cle
   and a.l_ori_site = s.l_si_cle
   and a.c_gf_origine = 'SU'
   and a.v_ac_name = i.name
   and i.name = igs.v_name
   and igs.l_gs_cle = gs.l_gs_cle
   and (a.l_si_cle = NEW_SITE OR NEW_SITE = 0)
   and (gs.l_gs_cle = NEW_GROUPE or NEW_GROUPE = 0)
   and a.v_ac_name like NEW_INTERVENANT
      --On ne prend que les employs
   and exists
 (select ls.l_do_cle
          from so_societe so, ldd_lien_dossier ls
         where s.l_su_cle = ls.l_do_cle and s.l_si_cle = ls.l_do_site and
          ls.c_do_genre = 'SU' and
          ls.l_ldd_dossier_associe = so.l_so_cle and
          ls.l_ldd_site = so.l_si_cle and ls.c_ldd_genre = 'SO' and
          so.i_cl_cle = 24004)
   and exists
   (select l.l_ldd_dossier_associe from ldd_lien_dossier l, do_dossier d
   where s.l_su_cle = l.l_ldd_dossier_associe
       and s.l_si_cle = l.l_ldd_site
       and l.c_ldd_genre = 'SU'
       and l.l_do_cle = d.l_do_cle
       and l.l_do_site = d.l_si_cle
       and l.c_do_genre = 'DO'
       and (d.l_si_cle = 30 or d.l_si_cle = 11))          
 group by i.v_in_name_parent,
          i.name,
          i.v_in_nom || ', ' || i.v_in_prenom,
          s.v_su_reference_3,
          s.v_su_nom,
          s.v_su_prenom,
          s.d_su_date_naissance,
          gs.v_gs_nom;
END SP_RAPPORT_ACCES_SUJETS;

--Rapport des accs aux sujets fournisseurs (CDX_0125)
PROCEDURE SP_RAPPORT_ACCES_FOURNISSEURS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_SITE        IN NUMBER,
                              NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                              NEW_GROUPE      IN NUMBER,
                              rc1             IN OUT DTS_RAPPORT_ACCES_SUJETS) IS
begin
  OPEN rc1 FOR
    select i.v_in_name_parent parent,
       i.name code,
       i.v_in_nom || ', ' || i.v_in_prenom intervenant,
       s.v_su_reference_3 fiche,
       s.v_su_nom nom,
       s.v_su_prenom prenom,
       s.d_su_date_naissance naissance,
       gs.v_gs_nom groupe,
       count(s.v_su_reference_3) total
  from ac_acces                   a,
       su_sujet                   s,
       in_intervenant             i,
       igs_intervenant_groupe_sec igs,
       gs_groupe_securite         gs,
       ldd_lien_dossier           l,
       do_dossier                 d
 where a.d_ac_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
   and a.l_ori_cle = s.l_su_cle
   and a.l_ori_site = s.l_si_cle
   and a.c_gf_origine = 'SU'
   and a.v_ac_name = i.name
   and i.name = igs.v_name
   and igs.l_gs_cle = gs.l_gs_cle
   and (a.l_si_cle = NEW_SITE OR NEW_SITE = 0)
   and (gs.l_gs_cle = NEW_GROUPE or NEW_GROUPE = 0)
   and a.v_ac_name like NEW_INTERVENANT
      --On ne prend pas les employs de Loto-Qubec et ses filiales
   and exists
 (select ls.l_do_cle
          from so_societe so, ldd_lien_dossier ls
         where s.l_su_cle = ls.l_do_cle and s.l_si_cle = ls.l_do_site and
          ls.c_do_genre = 'SU' and
          ls.l_ldd_dossier_associe = so.l_so_cle and
          ls.l_ldd_site = so.l_si_cle and ls.c_ldd_genre = 'SO' and
          so.i_cl_cle <> 24004)
       --On prend ceux avec un dossier d'enqute.
       and s.l_su_cle = l.l_ldd_dossier_associe
       and s.l_si_cle = l.l_ldd_site
       and l.c_ldd_genre = 'SU'
       and l.l_do_cle = d.l_do_cle
       and l.l_do_site = d.l_si_cle
       and l.c_do_genre = 'DO'
       and (d.l_si_cle = 30 or d.l_si_cle = 11)
          
 group by i.v_in_name_parent,
          i.name,
          i.v_in_nom || ', ' || i.v_in_prenom,
          s.v_su_reference_3,
          s.v_su_nom,
          s.v_su_prenom,
          s.d_su_date_naissance,
          gs.v_gs_nom;
END SP_RAPPORT_ACCES_FOURNISSEURS;

--Liste des demandes incompltes (diffr 17)
PROCEDURE SP_DEMANDES_INCOMPLETES(rc1 IN OUT DTS_DEMANDES_INCOMPLETES) IS
begin
  OPEN rc1 FOR
    select sv.d_sv_date_creation as "Date du suivi",
           d.v_do_reference1 as "Demandeur",
           s.v_su_nom || ', ' || s.v_su_prenom as "Personne enqute",
           sv.v_sv_suivi as "Suivi"
      from sv_suivi sv, do_dossier d, ldd_lien_dossier l, su_sujet s
     where sv.l_sv_reference = d.l_do_cle
       and sv.l_sv_ref_site = d.l_si_cle
       and d.l_do_cle = l.l_do_cle
       and d.l_si_cle = l.l_do_site
       and l.c_do_genre = 'DO'
       and l.l_ldd_dossier_associe = s.l_su_cle
       and l.l_ldd_site = s.l_si_cle
       and l.c_ldd_genre = 'SU'
       and sv.d_sv_date_completee is null
       and sv.d_sv_date_creation > sysdate - 20
       and sv.i_tc_cle = 27422;

END SP_DEMANDES_INCOMPLETES;

--Rapport des accs aux narrations (CDX_0126)
PROCEDURE SP_RAPPORT_ACCES_NARRATIONS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_SITE        IN NUMBER,
                              NEW_INTERVENANT IN IN_INTERVENANT.NAME%TYPE,
                              NEW_GROUPE      IN NUMBER,
                              rc1             IN OUT DTS_RAPPORT_ACCES_NARRATIONS) IS
begin
  OPEN rc1 FOR
select i.v_in_name_parent parent,
       i.name code,
       i.v_in_nom || ', ' || i.v_in_prenom intervenant,
       gs.v_gs_nom groupe,
       a.d_date_acces date_acces,
       a.v_do_numero_dossier dossier,
       c.v_co_cree_par narration,
       c.d_co_date_creation date_narration
  from aud_recherche_narration    a,
        co_commentaire2 c,
       in_intervenant             i,
       igs_intervenant_groupe_sec igs,
       gs_groupe_securite         gs
 where a.d_date_acces BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
 and a.l_co_cle = c.l_co_cle and a.l_si_cle = c.l_si_cle
   and a.v_accede_par = i.name
   and i.name = igs.v_name
   and igs.l_gs_cle = gs.l_gs_cle
   and (a.l_si_cle = NEW_SITE OR NEW_SITE = 0)
   and (gs.l_gs_cle = NEW_GROUPE or NEW_GROUPE = 0)
   and a.v_accede_par like NEW_INTERVENANT;   

END SP_RAPPORT_ACCES_NARRATIONS;

--Rapport des employs lis  des dossiers (CDX_0042)
PROCEDURE SP_RAPPORT_EMPLOYES_DOSSIERS(NEW_DATE_DEBUT  IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_DATE_FIN    IN AC_ACCES.D_AC_DATE_ACCES%TYPE,
                              NEW_ENTITE      IN EN_ENTITE.I_EN_CLE%TYPE,
                              NEW_SITE        IN SI_SITE.L_SI_CLE%TYPE,
                              NEW_GENRE       IN GE_GENRE.I_GE_CLE%TYPE,
                              NEW_NATURE      IN NA_NATURE.I_NA_CLE%TYPE,
                              NEW_TYPE        IN TY_TYPE.I_TY_CLE%TYPE,
                              NEW_CATEGORIE   IN CA_CATEGORIE.I_CA_CLE%TYPE,
                              NEW_ROLE        IN RO_ROLE.I_RO_CLE%TYPE,
                              NEW_STATUT      IN ST_STATUT.I_ST_CLE%TYPE,
                              NEW_FONDE       IN FO_FONDE.I_FO_CLE%TYPE,
                              rc1             IN OUT DTS_RAPPORT_EMPLOYES_DOSSIERS) IS
begin
  OPEN rc1 FOR
select d.v_do_numero_dossier     numero_cardex,
       d.v_do_ancienne_reference dossier,
       s.v_su_nom                nom,
       s.v_su_prenom             prenom,
       tro.v_tr_description      role,
       tge.v_tr_description      genre,
       tna.v_tr_description      nature,
       tty.v_tr_description      type,
       tca.v_tr_description      categorie,
       tst.v_tr_description      statut,
       tfo.v_tr_description      fonde
  from v_do_dossier_ca_ty d,
       si_site            si,
       su_sujet           s,
       ldd_lien_dossier   l,
       so_societe         so,
       ldd_lien_dossier   ls,
       tr_traduction      tge,
       tr_traduction      tna,
       tr_traduction      tty,
       tr_traduction      tca,
       tr_traduction      tst,
       tr_traduction      tfo,
       tr_traduction      tro
 where d.d_do_date_debut BETWEEN NEW_DATE_DEBUT and NEW_DATE_FIN
   and d.l_si_cle = si.l_si_cle
   and (si.i_en_cle = NEW_ENTITE or NEW_ENTITE = 0)
   and (d.l_si_cle = NEW_SITE or NEW_SITE = 0)
   and d.l_do_cle = l.l_do_cle
   and d.l_si_cle = l.l_do_site
   and l.c_do_genre = 'DO'
   and l.l_ldd_dossier_associe = s.l_su_cle
   and l.l_ldd_site = s.l_si_cle
   and l.c_ldd_genre = 'SU'
   and s.l_su_cle = ls.l_do_cle
   and s.l_si_cle = ls.l_do_site
   and ls.c_do_genre = 'SU'
   and ls.l_ldd_dossier_associe = so.l_so_cle
   and ls.l_ldd_site = so.l_si_cle
   and ls.c_ldd_genre = 'SO'
   and so.i_cl_cle = 24004
   and (d.i_ge_cle = NEW_GENRE or NEW_GENRE = 0)
   and (d.i_na_cle = NEW_NATURE or NEW_NATURE = 0)
   and (d.i_ty_cle = NEW_TYPE or NEW_TYPE = 0)
   and (d.i_ca_cle = NEW_CATEGORIE or NEW_CATEGORIE = 0)
   and (d.i_st_cle = NEW_STATUT or NEW_STATUT = 0)
   and (d.I_DO_FONDE = NEW_FONDE or NEW_FONDE = 0)
   and (l.i_ro_cle = NEW_ROLE or NEW_ROLE = 0)
   and d.i_ge_cle = tge.l_tr_cle
   and tge.i_la_cle = 1
   and d.i_na_cle = tna.l_tr_cle
   and tna.i_la_cle = 1
   and d.i_ty_cle = tty.l_tr_cle
   and tty.i_la_cle = 1
   and d.i_ca_cle = tca.l_tr_cle
   and tca.i_la_cle = 1
   and d.i_st_cle = tst.l_tr_cle
   and tst.i_la_cle = 1
   and d.I_DO_FONDE = tfo.l_tr_cle
   and tfo.i_la_cle = 1
   and l.i_ro_cle = tro.l_tr_cle
   and tro.i_la_cle = 1
   and exists
   (select l2.l_ldd_dossier_associe from ldd_lien_dossier l2, do_dossier d2
   where s.l_su_cle = l2.l_ldd_dossier_associe
       and s.l_si_cle = l2.l_ldd_site
       and l2.c_ldd_genre = 'SU'
       and l2.l_do_cle = d2.l_do_cle
       and l2.l_do_site = d2.l_si_cle
       and l2.c_do_genre = 'DO'
       and (d2.l_si_cle = 30 or d2.l_si_cle = 11));
END SP_RAPPORT_EMPLOYES_DOSSIERS;

--Rapport sur les dlais de traitement des enqutes d'habilitation scuritaire (CDX_0246)
PROCEDURE SP_RAPPORT_DELAI_TRAITEMENT(NEW_TYPE     IN SV_SUIVI.I_TC_CLE%TYPE,
                              NEW_DATE_DEBUT  IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                              NEW_DATE_FIN    IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                              rc1             IN OUT DTS_RAPPORT_DELAI_TRAITEMENT) IS
begin
  OPEN rc1 FOR
select s.v_si_site as "Site",
             'Employs' as "Nature",
             s2.v_si_abreviation as "Dossier",
             sv.d_sv_date_completee as "Date_completee",
             sv.d_sv_date_creation as "Date_creation"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2,
             sv_suivi             sv
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut between NEW_DATE_DEBUT AND NEW_DATE_FIN
         and d.i_na_cle in (21877, 21878, 21881, 21879)
         and d.l_si_cle = s2.l_si_cle
         and d.l_do_cle = sv.l_sv_reference
         and d.l_si_cle = sv.l_sv_ref_site
         and (sv.i_tc_cle = NEW_TYPE or NEW_TYPE = 0)
         and sv.d_sv_date_completee is not null
      union
      select s.v_si_site as "Site",
             'Salaris' as "Nature",
             s2.v_si_abreviation as "Dossier",
             sv.d_sv_date_completee as "Date_completee",
             sv.d_sv_date_creation as "Date_creation"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2,
             sv_suivi             sv
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut between NEW_DATE_DEBUT AND NEW_DATE_FIN
         and d.i_na_cle in (21884, 21880, 21883)
         and d.l_si_cle = s2.l_si_cle
         and d.l_do_cle = sv.l_sv_reference
         and d.l_si_cle = sv.l_sv_ref_site
         and (sv.i_tc_cle = NEW_TYPE or NEW_TYPE = 0)
         and sv.d_sv_date_completee is not null
      union
      select s.v_si_site as "Site",
             'Fournisseurs' as "Nature",
             s2.v_si_abreviation as "Dossier",
             sv.d_sv_date_completee as "Date_completee",
             sv.d_sv_date_creation as "Date_creation"
        from v_do_dossier_ca_ty   d,
             is_inscription       i,
             sis_site_inscription sis,
             si_site              s,
             si_site              s2,
             sv_suivi             sv
       where d.i_ge_cle = 21876
         and d.l_do_cle = i.l_is_reference
         and d.l_si_cle = i.l_is_ref_site
         and i.l_is_cle = sis.l_is_cle
         and i.l_si_cle = sis.l_si_cle
         and sis.l_is_site = s.l_si_cle
         and d.d_do_date_debut between NEW_DATE_DEBUT AND NEW_DATE_FIN
         and d.i_na_cle in (21882)
         and d.l_si_cle = s2.l_si_cle
         and d.l_do_cle = sv.l_sv_reference
         and d.l_si_cle = sv.l_sv_ref_site
         and (sv.i_tc_cle = NEW_TYPE or NEW_TYPE = 0)
         and sv.d_sv_date_completee is not null;
END SP_RAPPORT_DELAI_TRAITEMENT;

--Rapport sur les retards de traitement des enqutes d'habilitation scuritaire (CDX_0247)
PROCEDURE SP_RAPPORT_ENQUETES_RETARD(rc1 IN OUT DTS_RAPPORT_RETARD_TRAITEMENT) IS
begin
  OPEN rc1 FOR
  --Retards SQ
    select d.v_do_numero_dossier  AS "DOSSIER",
           sq.d_sv_date_creation  AS "DATE_CREATION_SQ",
           sq.d_sv_date_prevue    AS "DATE_PREVUE_SQ",
           sysdate                AS "DATE_COMPLETEE_SQ",
           r.d_sv_date_creation   AS "DATE_CREATION_RACJ",
           r.d_sv_date_prevue     AS "DATE_PREVUE_RACJ",
           null                   AS "DATE_COMPLETEE_RACJ",
           ts.v_tr_description    AS "SUIVI_SQ",
           tr.v_tr_description    AS "SUIVI_RACJ"
      from do_dossier    d,
           sv_suivi      sq,
           sv_suivi      r,
           tr_traduction ts,
           tr_traduction tr
     where d.l_do_cle = sq.l_sv_reference
       and d.l_si_cle = sq.l_sv_ref_site
       and sq.i_tc_cle = 551
       and d.l_do_cle = r.l_sv_reference
       and d.l_si_cle = r.l_sv_ref_site
       and r.i_tc_cle = 552
       and sq.i_tc_cle = ts.l_tr_cle
       and ts.i_la_cle = 1
       and r.i_tc_cle = tr.l_tr_cle
       and tr.i_la_cle = 1
       and sq.d_sv_date_completee is null
       and r.d_sv_date_completee is null
union
--Retards RACJ (quand SQ est termin)
    select d.v_do_numero_dossier  AS "DOSSIER",
           sq.d_sv_date_creation  AS "DATE_CREATION_SQ",
           sq.d_sv_date_completee AS "DATE_COMPLETEE_SQ",
           sq.d_sv_date_prevue    AS "DATE_PREVUE_SQ",
           r.d_sv_date_creation   AS "DATE_CREATION_RACJ",
           r.d_sv_date_prevue     AS "DATE_PREVUE_RACJ",
           sysdate                AS "DATE_COMPLETEE_RACJ",
           ts.v_tr_description    AS "SUIVI_SQ",
           tr.v_tr_description    AS "SUIVI_RACJ"
      from do_dossier    d,
           sv_suivi      sq,
           sv_suivi      r,
           tr_traduction ts,
           tr_traduction tr
     where d.l_do_cle = sq.l_sv_reference
       and d.l_si_cle = sq.l_sv_ref_site
       and sq.i_tc_cle = 551
       and d.l_do_cle = r.l_sv_reference
       and d.l_si_cle = r.l_sv_ref_site
       and r.i_tc_cle = 552
       and sq.i_tc_cle = ts.l_tr_cle
       and ts.i_la_cle = 1
       and r.i_tc_cle = tr.l_tr_cle
       and tr.i_la_cle = 1
       and sq.d_sv_date_completee is not null
       and r.d_sv_date_completee is null;
END SP_RAPPORT_ENQUETES_RETARD;

--Rapport sur les enqutes d'habilitation scuritaire qui ont t traites en retard (CDX_0248)
PROCEDURE SP_RAPPORT_RETARD_TRAITEMENT(NEW_DATE_DEBUT IN DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
                                       NEW_DATE_FIN   IN DO_DOSSIER.D_DO_DATE_FIN%TYPE,
                                       rc1 IN OUT DTS_RAPPORT_RETARD_TRAITEMENT) IS
begin
  OPEN rc1 FOR
    select d.v_do_numero_dossier  AS "DOSSIER",
           sq.d_sv_date_creation  AS "DATE_CREATION_SQ",
           sq.d_sv_date_prevue    AS "DATE_PREVUE_SQ",
           sq.d_sv_date_completee AS "DATE_COMPLETEE_SQ",
           r.d_sv_date_creation   AS "DATE_CREATION_RACJ",
           r.d_sv_date_prevue     AS "DATE_PREVUE_RACJ",
           r.d_sv_date_completee  AS "DATE_COMPLETEE_RACJ",
           ts.v_tr_description    AS "SUIVI_SQ",
           tr.v_tr_description    AS "SUIVI_RACJ"
      from do_dossier    d,
           sv_suivi      sq,
           sv_suivi      r,
           tr_traduction ts,
           tr_traduction tr
     where d.d_do_date_debut between NEW_DATE_DEBUT AND NEW_DATE_FIN
       and d.l_do_cle = sq.l_sv_reference
       and d.l_si_cle = sq.l_sv_ref_site
       and sq.i_tc_cle = 551
       and d.l_do_cle = r.l_sv_reference
       and d.l_si_cle = r.l_sv_ref_site
       and r.i_tc_cle = 552
       and sq.i_tc_cle = ts.l_tr_cle
       and ts.i_la_cle = 1
       and r.i_tc_cle = tr.l_tr_cle
       and tr.i_la_cle = 1
       and sq.d_sv_date_completee is not null
       and r.d_sv_date_completee is not null
       order by d.v_do_numero_dossier;
END SP_RAPPORT_RETARD_TRAITEMENT;

--Rapport pour les laissez-passer des sujets (CDX_0077)
PROCEDURE SP_RAP_LAISSEZ_PASSER_SUJETS(rc1 IN OUT DTS_LAISSEZ_PASSER_SUJETS) IS
begin
  OPEN rc1 FOR
select distinct s.v_su_reference_3 as "Fiche",
       s.v_su_nom as "Nom",
       s.v_su_prenom as "Prnom",
       so.v_so_nom as "Socit",
       so.l_so_cle || so.l_si_cle as "Cle_societe",
       d.d_do_date_debut as "Date de dbut",
       d.d_do_date_fin as "Date de fin",
       t.v_tr_description as "Svrit"
  from su_sujet             s,
       ldd_lien_dossier     l,
       do_dossier           d,
       is_inscription       i,
       sis_site_inscription sis,
       ldd_lien_dossier     l2,
       so_societe           so,
       tr_traduction        t
where d.l_do_cle = l.l_do_cle
   and d.l_si_cle = l.l_do_site
   and l.c_do_genre = 'DO'
   and l.l_ldd_dossier_associe = s.l_su_cle
   and l.l_ldd_site = s.l_si_cle
   and l.c_ldd_genre = 'SU'
   and (d.l_si_cle = 30 or d.l_si_cle = 11)
   and d.d_do_date_fin >= to_date('2011-01-01', 'YYYY-MM-DD')
   and d.l_do_cle = i.l_is_reference
   and d.l_si_cle = i.l_is_ref_site
   and i.l_is_cle = sis.l_is_cle
   and i.l_si_cle = sis.l_si_cle
   and (sis.l_is_site in (46, 17, 19, 18, 49, 53, 15, 22)
    or (sis.l_is_site = 45 and d.l_si_cle = 11))
   and i.d_is_date_creation =
       (select max(imax2.d_is_date_creation)
          from is_inscription imax2
         where d.l_do_cle = imax2.l_is_reference
           and d.l_si_cle = imax2.l_is_ref_site)
   and d.l_do_cle =
       (select max(d4.l_do_cle)
          from do_dossier           d4,
               ldd_lien_dossier     l4,
               is_inscription       i4,
               sis_site_inscription sis4
         where d4.l_do_cle = l4.l_do_cle
           and d4.l_si_cle = l4.l_do_site
           and l4.c_do_genre = 'DO'
           and l4.l_ldd_dossier_associe = s.l_su_cle
           and l4.l_ldd_site = s.l_si_cle
           and l4.c_ldd_genre = 'SU'
           and (d4.l_si_cle = 30 or d4.l_si_cle = 11)
           and d4.l_do_cle = i4.l_is_reference
           and d4.l_si_cle = i4.l_is_ref_site
           and i4.l_is_cle = sis4.l_is_cle
           and i4.l_si_cle = sis4.l_si_cle
           and (sis4.l_is_site in (46, 17, 19, 18, 49, 53, 15, 22)
              or (sis4.l_is_site = 45 and d4.l_si_cle = 11)))
   and s.l_su_cle = l2.l_do_cle
   and s.l_si_cle = l2.l_do_site
   and l2.c_do_genre = 'SU'
   and l2.l_ldd_dossier_associe = so.l_so_cle
   and l2.l_ldd_site = so.l_si_cle
   and l2.c_ldd_genre = 'SO'
   and so.i_cl_cle <> 24004
   and s.i_se_cle_casino = t.l_tr_cle
   and t.i_la_cle = 1
   and d.i_cc_cle <> 14920
   and s.i_cc_cle <> 14920
   and so.i_cc_cle <> 14920
   and exists
(select ldso.l_ldd_cle
          from ldd_lien_dossier     ldso,
               do_dossier           d2,
               is_inscription       idso,
               sis_site_inscription sisdso
         where d2.l_do_cle = ldso.l_do_cle
           and d2.l_si_cle = ldso.l_do_site
           and ldso.c_do_genre = 'DO'
           and ldso.l_ldd_dossier_associe = so.l_so_cle
           and ldso.l_ldd_site = so.l_si_cle
           and ldso.c_ldd_genre = 'SO'
           and d2.i_cc_cle <> 14920
           and (d2.l_si_cle = 30 or d2.l_si_cle = 11)
           and d2.d_do_date_fin >= to_date('2011-01-01', 'YYYY-MM-DD')
           and d2.l_do_cle = idso.l_is_reference
           and d2.l_si_cle = idso.l_is_ref_site
           and idso.l_is_cle = sisdso.l_is_cle
           and idso.l_si_cle = sisdso.l_si_cle
           and (sisdso.l_is_site in (46, 17, 19, 18, 49, 53, 15, 22)
              or (sisdso.l_is_site = 45 and d2.l_si_cle = 11)));
END SP_RAP_LAISSEZ_PASSER_SUJETS;

--Rapport pour les laissez-passer des socits (CDX_0078)
PROCEDURE SP_RAP_LAISSEZ_PASSER_SOCIETES(rc1 IN OUT DTS_LAISSEZ_PASSER_SOCIETES) IS
begin
  OPEN rc1 FOR
select distinct s.v_so_nom         as "Socit",
       s.l_so_cle||s.l_si_cle as "Cle_societe",
       d2.d_do_date_debut as "Date de dbut",
       d2.d_do_date_fin   as "Date de fin",
       t.v_tr_description as "Svrit"
  from so_societe           s,
       ldd_lien_dossier     l2,
       do_dossier           d2,
       is_inscription       i2,
       sis_site_inscription sis2,
       tr_traduction        t
where d2.l_do_cle = l2.l_do_cle
   and d2.l_si_cle = l2.l_do_site
   and l2.c_do_genre = 'DO'
   and l2.l_ldd_dossier_associe = s.l_so_cle
   and l2.l_ldd_site = s.l_si_cle
   and l2.c_ldd_genre = 'SO'
   and (d2.l_si_cle = 30 or d2.l_si_cle = 11)
   and d2.d_do_date_fin >= to_date('2011-01-01','YYYY-MM-DD')
   and d2.l_do_cle = i2.l_is_reference
   and d2.l_si_cle = i2.l_is_ref_site
   and i2.l_is_cle = sis2.l_is_cle
   and i2.l_si_cle = sis2.l_si_cle
   and (sis2.l_is_site in (46, 17, 19, 18, 49, 53, 15, 22)
    or (sis2.l_is_site = 45 and d2.l_si_cle = 11))
   and i2.d_is_date_creation =
       (select max(imax2.d_is_date_creation)
          from is_inscription imax2
         where d2.l_do_cle = imax2.l_is_reference
           and d2.l_si_cle = imax2.l_is_ref_site)
   and d2.l_do_cle =
       (select max(d4.l_do_cle)
          from do_dossier           d4,
               ldd_lien_dossier     l4,
               is_inscription       i4,
               sis_site_inscription sis4
         where d4.l_do_cle = l4.l_do_cle
           and d4.l_si_cle = l4.l_do_site
           and l4.c_do_genre = 'DO'
           and l4.l_ldd_dossier_associe = s.l_so_cle
           and l4.l_ldd_site = s.l_si_cle
           and l4.c_ldd_genre = 'SO'
           and (d4.l_si_cle = 30 or d4.l_si_cle = 11)
           and d4.l_do_cle = i4.l_is_reference
           and d4.l_si_cle = i4.l_is_ref_site
           and i4.l_is_cle = sis4.l_is_cle
           and i4.l_si_cle = sis4.l_si_cle
           and (sis4.l_is_site in (46, 17, 19, 18, 49, 53, 15, 22)
               or (sis4.l_is_site = 45 and d4.l_si_cle = 11)))
   and s.i_se_cle_casino = t.l_tr_cle
   and t.i_la_cle = 1
   and d2.i_cc_cle <> 14920
   and s.i_cc_cle <> 14920
   and s.i_cl_cle <> 24004;
END SP_RAP_LAISSEZ_PASSER_SOCIETES;

--Rapport sur les dtaillants inactifs
PROCEDURE SP_RAP_SOCIETES_INACTIVES(NEW_VAGUE IN DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
                                    rc1 IN OUT DTS_RAP_SOCIETES_INACTIVES) IS
begin
  OPEN rc1 FOR
  select s.d_so_date_inactivation  DATE_INACTIVATION,
         s.v_so_nom                NOM_SOCIETE,
         s.v_so_reference_3        FICHE,
         d.v_do_ancienne_reference NUMERO_VAGUE
    from do_dossier d, so_societe s, ldd_lien_dossier l
   where d.l_do_cle = l.l_do_cle
     and d.l_si_cle = d.l_si_cle
     and l.c_do_genre = 'DO'
     and l.l_ldd_dossier_associe = s.l_so_cle
     and l.l_ldd_site = s.l_si_cle
     and l.c_ldd_genre = 'SO'
     and d.i_ca_cle = 662
     and d.i_st_cle = 359
     and d.i_cc_cle <> 14920
     and s.i_cc_cle <> 14920
     and s.d_so_date_inactivation is not null
     and d.v_do_ancienne_reference like NEW_VAGUE;
END SP_RAP_SOCIETES_INACTIVES;

--Rapport sur les contrats d'autoexclusion actifs d'Espacejeux CDX_0260
PROCEDURE SP_RAP_EJ_AU_ACTIF(rc1 IN OUT DTS_RAPPORT_ESPACEJEUX) IS
begin
  OPEN rc1 FOR
  select s.v_su_nom            as "Nom",
       s.v_su_prenom         as "Prnom",
       s.d_su_date_naissance as "Date de naissance",
       a.v_ad_num_municipal  as "Numro municipal",
       a.v_ad_nom_rue        as "Rue",
       v.v_vi_ville          as "Ville",
       a.v_ad_code_postal    as "Code postal",
       d.v_do_numero_dossier as "Numro Cardex",
       trty.v_tr_description as "Type",
       trca.v_tr_description as "Catgorie"
  from v_do_dossier_ca_ty d,
       ldd_lien_dossier   l,
       su_sujet           s,
       ad_adresse         a,
       vi_ville           v,
       tr_traduction      trty,
       tr_traduction      trca
 where (d.i_ca_cle = 112 or d.i_ca_cle = 26722)
   and d.l_do_cle = l.l_do_cle
   and d.l_si_cle = l.l_do_site
   and l.c_do_genre = 'DO'
   and l.l_ldd_dossier_associe = s.l_su_cle
   and l.l_ldd_site = s.l_si_cle
   and l.c_ldd_genre = 'SU'
   and d.i_st_cle = 359
   and s.l_su_cle = a.l_ad_reference
   and s.l_si_cle = a.l_ad_ref_site
   and a.l_vi_cle = v.l_vi_cle
   and d.i_ty_cle = trty.l_tr_cle
   and trty.i_la_cle = 1
   and d.i_ca_cle = trca.l_tr_cle
   and trca.i_la_cle = 1
   and d.i_cc_cle <> 14920
   and s.i_cc_cle <> 14920;
END SP_RAP_EJ_AU_ACTIF;

--Rapport sur les dossiers de fraude fonds d'Espacejeux CDX_0261
PROCEDURE SP_RAP_EJ_FRAUDE_FONDE(rc1 IN OUT DTS_RAPPORT_ESPACEJEUX) IS
begin
  OPEN rc1 FOR
select s.v_su_nom as "Nom",
       s.v_su_prenom as "Prnom",
       s.d_su_date_naissance as "Date de naissance",
       a.v_ad_num_municipal as "Numro municipal",
       a.v_ad_nom_rue as "Rue",
       v.v_vi_ville as "Ville",
       a.v_ad_code_postal as "Code postal",
       d.v_do_numero_dossier as "Numro Cardex",
       trty.v_tr_description as "Type",
       trca.v_tr_description as "Catgorie"
  from v_do_dossier_ca_ty d,
       ldd_lien_dossier   l,
       su_sujet           s,
       ad_adresse         a,
       vi_ville           v,
       tr_traduction      trty,
       tr_traduction      trca       
 where d.i_ca_cle = 222
   and d.l_do_cle = l.l_do_cle
   and d.l_si_cle = l.l_do_site
   and l.c_do_genre = 'DO'
   and l.l_ldd_dossier_associe = s.l_su_cle
   and l.l_ldd_site = s.l_si_cle
   and l.c_ldd_genre = 'SU'
   and d.I_DO_FONDE = 16123
   and s.l_su_cle = a.l_ad_reference
   and s.l_si_cle = a.l_ad_ref_site
   and a.l_vi_cle = v.l_vi_cle
   and d.i_ty_cle = trty.l_tr_cle and trty.i_la_cle = 1
   and d.i_ca_cle = trca.l_tr_cle and trca.i_la_cle = 1 
   and d.i_cc_cle <> 14920;
END SP_RAP_EJ_FRAUDE_FONDE;          

--Rapport sur les dossiers de tricherie fonds d'Espacejeux CDX_0262
PROCEDURE SP_RAP_EJ_TRICHERIE_FONDE(rc1 IN OUT DTS_RAPPORT_ESPACEJEUX) IS
begin
  OPEN rc1 FOR
select s.v_su_nom as "Nom",
       s.v_su_prenom as "Prnom",
       s.d_su_date_naissance as "Date de naissance",
       a.v_ad_num_municipal as "Numro municipal",
       a.v_ad_nom_rue as "Rue",
       v.v_vi_ville as "Ville",
       a.v_ad_code_postal as "Code postal",
       d.v_do_numero_dossier as "Numro Cardex",
       trty.v_tr_description as "Type",
       trca.v_tr_description as "Catgorie"
  from v_do_dossier_ca_ty d,
       ldd_lien_dossier   l,
       su_sujet           s,
       ad_adresse         a,
       vi_ville           v,
       tr_traduction      trty,
       tr_traduction      trca       
 where d.i_ty_cle = 26061
   and d.l_do_cle = l.l_do_cle
   and d.l_si_cle = l.l_do_site
   and l.c_do_genre = 'DO'
   and l.l_ldd_dossier_associe = s.l_su_cle
   and l.l_ldd_site = s.l_si_cle
   and l.c_ldd_genre = 'SU'
   and d.I_DO_FONDE = 16123
   and s.l_su_cle = a.l_ad_reference
   and s.l_si_cle = a.l_ad_ref_site
   and a.l_vi_cle = v.l_vi_cle
   and d.i_ty_cle = trty.l_tr_cle and trty.i_la_cle = 1
   and d.i_ca_cle = trca.l_tr_cle and trca.i_la_cle = 1 
   and d.i_cc_cle <> 14920;
END SP_RAP_EJ_TRICHERIE_FONDE;

--Rapport sur les dossiers d'ambulance sommaire CDX_0270
PROCEDURE SP_RAPPORT_AMBULANCE_SOMMAIRE(NEW_DATE_DEBUT UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        NEW_DATE_FIN   UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        rc1 IN OUT DTS_RAPPORT_AMBULANCE_SOMMAIRE) IS
begin
  OPEN rc1 FOR
    select s.v_si_site SITE, t.v_tr_description STATUT, count(u.l_ur_cle) TOTAL
      from ur_urgence u, si_site s, tr_traduction t
     where u.i_cl_cle = 23910
       and u.l_si_cle = s.l_si_cle
       and u.i_st_cle = t.l_tr_cle and t.i_la_cle = 1
       and trunc(u.d_ur_date_creation) between NEW_DATE_DEBUT and NEW_DATE_FIN
     group by s.v_si_site, t.v_tr_description;
END SP_RAPPORT_AMBULANCE_SOMMAIRE;     

--Rapport sur les dossiers d'ambulance dtaill CDX_0271
PROCEDURE SP_RAPPORT_AMBULANCE_DETAIL(NEW_DATE_DEBUT UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        NEW_DATE_FIN   UR_URGENCE.D_UR_DATE_CREATION%TYPE,
                                        rc1 IN OUT DTS_RAPPORT_AMBULANCE_DETAIL) IS
begin
  OPEN rc1 FOR
select tst.v_tr_description as "statut",
       s.v_si_site          as "site",
       tmo.v_tr_description as "motif",
       u.l_ur_cle           as "cle"
  from ur_urgence u, tr_traduction tst, tr_traduction tmo, si_site s
 where u.i_cl_cle = 23910
   and u.i_st_cle = tst.l_tr_cle
   and tst.i_la_cle = 1
   and u.l_ur_motif = tmo.l_tr_cle
   and tmo.i_la_cle = 1
   and u.l_si_cle = s.l_si_cle
   and trunc(u.d_ur_date_creation) between NEW_DATE_DEBUT and NEW_DATE_FIN;
END SP_RAPPORT_AMBULANCE_DETAIL;


--Rapport sur les suivis CDX_0098
PROCEDURE SP_RAPPORT_SUIVIS(NEW_DATE_DEBUT DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_DATE_FIN   DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_SITE       SI_SITE.L_SI_CLE%TYPE,
                            NEW_NATURE     NA_NATURE.I_NA_CLE%TYPE,
                            NEW_TYPE_SUIVI TC_TYPE_ACTIVITE.I_TC_CLE%TYPE,
                            rc1 IN OUT DTS_RAPPORT_SUIVIS) IS
begin
  OPEN rc1 FOR
    select t.v_tr_description Nature,
           tty.v_tr_description Type_dossier,
           tca.v_tr_description Categorie,
           d.v_do_numero_dossier Numero_Cardex,
           tsv.v_tr_description Type_suivi,
           d.d_do_date_creation Date_creation_dossier,
           s.d_sv_date_creation Date_creation_suivi,
           s.d_sv_date_completee Date_suivi_completee,
           i.v_in_nom Nom,
           i.v_in_prenom Prenom,
           tst.v_tr_description Statut
      from v_do_dossier_ca_ty d,
           sv_suivi           s,
           in_intervenant     i,
           tr_traduction      t,
           tr_traduction      tty,
           tr_traduction      tca,
           tr_traduction      tsv,
           tr_traduction      tst
     where (d.i_na_cle = NEW_NATURE OR NEW_NATURE = 0)
       and (s.i_tc_cle = NEW_TYPE_SUIVI OR NEW_TYPE_SUIVI = 0)
       and (d.l_si_cle = NEW_SITE or NEW_SITE = 0)
       and d.i_na_cle = t.l_tr_cle
       and t.i_la_cle = 1
       and d.i_ty_cle = tty.l_tr_cle
       and tty.i_la_cle = 1
       and d.i_ca_cle = tca.l_tr_cle
       and tca.i_la_cle = 1
       and d.i_st_cle = tst.l_tr_cle
       and tst.i_la_cle = 1
       and d.l_do_cle = s.l_sv_reference
       and d.l_si_cle = s.l_sv_ref_site
       and s.i_tc_cle = tsv.l_tr_cle
       and tsv.i_la_cle = 1
       and d.v_do_assigne_a = i.name
       and d.d_do_date_creation between NEW_DATE_DEBUT AND NEW_DATE_FIN + 1
    union
    select t.v_tr_description Nature,
           tty.v_tr_description Type_dossier,
           tca.v_tr_description Categorie,
           d.v_do_numero_dossier Numero_Cardex,
           '' Type_suivi,
           d.d_do_date_creation Date_creation_dossier,
           null Date_creation_suivi,
           null Date_suivi_completee,
           i.v_in_nom Nom,
           i.v_in_prenom Prenom,
           tst.v_tr_description Statut
      from v_do_dossier_ca_ty d,
           in_intervenant     i,
           tr_traduction      t,
           tr_traduction      tty,
           tr_traduction      tca,
           tr_traduction      tst
     where (d.i_na_cle = NEW_NATURE OR NEW_NATURE = 0)
       and (d.l_si_cle = NEW_SITE or NEW_SITE = 0)
       and d.i_na_cle = t.l_tr_cle
       and t.i_la_cle = 1
       and d.i_ty_cle = tty.l_tr_cle
       and tty.i_la_cle = 1
       and d.i_ca_cle = tca.l_tr_cle
       and tca.i_la_cle = 1
       and d.i_st_cle = tst.l_tr_cle
       and tst.i_la_cle = 1
       and d.v_do_assigne_a = i.name
       and d.d_do_date_creation between NEW_DATE_DEBUT AND NEW_DATE_FIN + 1
       and not exists
     (select d2.v_do_numero_dossier
              from v_do_dossier_ca_ty d2, sv_suivi s2
             where d2.l_do_cle = s2.l_sv_reference
               and d2.l_si_cle = s2.l_sv_ref_site
               and d2.v_do_numero_dossier = d.v_do_numero_dossier)
     order by Nom, Prenom, Date_creation_dossier;
END SP_RAPPORT_SUIVIS;

--Rapport statistique par endroits regroups CDX_0149
--On prend les catgories principales fondes et les sous-catgories, fondes ou non.
PROCEDURE SP_RAPPORT_ENDROITS_REGROUPES(NEW_DATE_DEBUT DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_DATE_FIN   DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_SITE       SI_SITE.L_SI_CLE%TYPE,
                            NEW_GENRE      GE_GENRE.I_GE_CLE%TYPE,
                            NEW_NATURE     NA_NATURE.I_NA_CLE%TYPE,
                            NEW_TYPE       TY_TYPE.I_TY_CLE%TYPE,
                            NEW_CATEGORIE  CA_CATEGORIE.I_CA_CLE%TYPE,
                            NEW_REGROUPEMENT OR_ORIENTATION.L_SR_CLE%TYPE,
                            rc1 IN OUT DTS_RAPPORT_ENDROITS_REGROUPES) IS
begin
  OPEN rc1 FOR
SELECT ENDROITS_REGOUPES.SITE AS "SITE",
       ENDROITS_REGOUPES.REGROUPEMENT AS "REGROUPEMENT",
       ENDROITS_REGOUPES.GENRE AS "GENRE",
       ENDROITS_REGOUPES.NATURE AS "NATURE",
       ENDROITS_REGOUPES.TYPE_DESCRIPTION AS "TYPE_DESCRIPTION",
       ENDROITS_REGOUPES.CATEGORIE AS "CATEGORIE",
       COUNT(*) AS "TOTAL"
FROM(
    SELECT S.V_SI_SITE          SITE,
           TSR.V_TR_DESCRIPTION REGROUPEMENT,
           TR1.V_TR_DESCRIPTION GENRE,
           TR2.V_TR_DESCRIPTION NATURE,
           TR3.V_TR_DESCRIPTION TYPE_DESCRIPTION,
           TR4.V_TR_DESCRIPTION CATEGORIE
      FROM V_DO_DOSSIER_CA_TY D,
           TR_TRADUCTION  TR1,
           TR_TRADUCTION  TR2,
           TR_TRADUCTION  TR3,
           TR_TRADUCTION  TR4,
           OR_ORIENTATION O,
           TR_TRADUCTION  TSR,
           SI_SITE        S
     WHERE D.I_GE_CLE = TR1.L_TR_CLE
       AND D.I_NA_CLE = TR2.L_TR_CLE
       AND D.I_TY_CLE = TR3.L_TR_CLE
       AND D.I_CA_CLE = TR4.L_TR_CLE
       AND TR1.I_LA_CLE = 1
       AND TR2.I_LA_CLE = 1
       AND TR3.I_LA_CLE = 1
       AND TR4.I_LA_CLE = 1
       AND D.I_OR_CLE = O.I_OR_CLE 
       AND O.L_SR_CLE = TSR.L_TR_CLE
       AND TSR.I_LA_CLE = 1
       AND D.L_SI_CLE = S.L_SI_CLE
       AND D.I_DO_FONDE = 16123
       AND D.D_DO_DATE_DEBUT >= NEW_DATE_DEBUT AND D.D_DO_DATE_DEBUT < NEW_DATE_FIN + 1
       AND (D.I_GE_CLE = NEW_GENRE OR NEW_GENRE = 0)
       AND (D.i_na_cle = NEW_NATURE OR NEW_NATURE = 0)
       AND (D.i_ty_cle = NEW_TYPE OR NEW_TYPE = 0)
       AND (D.i_ca_cle = NEW_CATEGORIE OR NEW_CATEGORIE = 0)
       AND (D.l_si_cle = NEW_SITE OR NEW_SITE = 0)
       AND (O.L_SR_CLE = NEW_REGROUPEMENT OR NEW_REGROUPEMENT = 0)
UNION ALL
    SELECT S.V_SI_SITE          SITE,
           TSR.V_TR_DESCRIPTION REGROUPEMENT,
           TR1.V_TR_DESCRIPTION GENRE,
           TR2.V_TR_DESCRIPTION NATURE,
           TR3.V_TR_DESCRIPTION TYPE_DESCRIPTION,
           decode(NEW_CATEGORIE,0,TRSousCat.V_TR_DESCRIPTION,TRCat.V_TR_DESCRIPTION) CATEGORIE
      FROM V_DO_DOSSIER_CA_TY D,
           TR_TRADUCTION  TR1,
           TR_TRADUCTION  TR2,
           TR_TRADUCTION  TR3,
           TR_TRADUCTION  TRCat,
           TR_TRADUCTION  TRSousCat,
           OR_ORIENTATION O,
           TR_TRADUCTION  TSR,
           SI_SITE        S,
           LDC_LIEN_DOSSIER_CATEGORIE L,
           CA_CATEGORIE CA_SousCat, 
           TY_TYPE      TY_SousCat,
           NA_NATURE    NA_SousCat,
           GE_GENRE     GE_SousCat
     WHERE D.I_GE_CLE = TR1.L_TR_CLE
       AND D.I_NA_CLE = TR2.L_TR_CLE
       AND D.I_TY_CLE = TR3.L_TR_CLE
       AND D.I_CA_CLE = TRCat.L_TR_CLE
       AND L.I_CA_CLE = TRSousCat.L_TR_CLE
       AND L.I_CA_CLE = CA_SousCat.I_CA_CLE
       AND CA_SousCat.i_Ty_Cle = TY_SousCat.i_Ty_Cle
       AND TY_SousCat.i_Na_Cle = NA_SousCat.i_Na_Cle
       AND NA_SousCat.i_Ge_Cle = GE_SousCat.i_Ge_Cle
       AND TR1.I_LA_CLE = 1
       AND TR2.I_LA_CLE = 1
       AND TR3.I_LA_CLE = 1
       AND TRCat.I_LA_CLE = 1
       and TRSousCat.i_La_Cle = 1
       AND D.I_OR_CLE = O.I_OR_CLE 
       AND O.L_SR_CLE = TSR.L_TR_CLE
       AND TSR.I_LA_CLE = 1
       AND D.L_SI_CLE = S.L_SI_CLE
       AND D.L_DO_CLE = L.L_DO_CLE AND D.L_SI_CLE = L.L_SI_CLE
       AND D.D_DO_DATE_DEBUT >= NEW_DATE_DEBUT AND D.D_DO_DATE_DEBUT < NEW_DATE_FIN + 1
       AND (GE_SousCat.I_GE_CLE = NEW_GENRE OR NEW_GENRE = 0)      -- Le GENRE de la sous-catgorie
       AND (NA_SousCat.i_na_cle = NEW_NATURE OR NEW_NATURE = 0)    -- La NATURE de la sous-catgorie
       AND (TY_SousCat.i_ty_cle = NEW_TYPE OR NEW_TYPE = 0)        -- Le TYPE de la sous-catgorie
       AND (L.i_ca_cle = NEW_CATEGORIE OR NEW_CATEGORIE = 0)
       AND (D.l_si_cle = NEW_SITE OR NEW_SITE = 0)
       AND (O.L_SR_CLE = NEW_REGROUPEMENT OR NEW_REGROUPEMENT = 0)
      ) ENDROITS_REGOUPES
GROUP BY ENDROITS_REGOUPES.SITE,
       ENDROITS_REGOUPES.REGROUPEMENT,
       ENDROITS_REGOUPES.GENRE,
       ENDROITS_REGOUPES.NATURE,
       ENDROITS_REGOUPES.TYPE_DESCRIPTION,
       ENDROITS_REGOUPES.CATEGORIE;
END SP_RAPPORT_ENDROITS_REGROUPES;

--Tableau statistique par endroits regroups CDX_0280
PROCEDURE SP_TABLEAU_ENDROITS_REGROUPES(NEW_DATE_DEBUT DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_DATE_FIN   DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
                            NEW_SITE       SI_SITE.L_SI_CLE%TYPE,
                            NEW_GENRE      GE_GENRE.I_GE_CLE%TYPE,
                            NEW_NATURE     NA_NATURE.I_NA_CLE%TYPE,
                            NEW_TYPE       TY_TYPE.I_TY_CLE%TYPE,
                            NEW_CATEGORIE  CA_CATEGORIE.I_CA_CLE%TYPE,
                            NEW_REGROUPEMENT OR_ORIENTATION.L_SR_CLE%TYPE,
                            rc1 IN OUT DTS_TABLEAU_ENDROITS_REGROUPES) IS
begin
  OPEN rc1 FOR
    SELECT S.V_SI_SITE          SITE,
           to_char(d.d_do_date_debut,'YYYY') ANNEE,
           TSR.V_TR_DESCRIPTION REGROUPEMENT,
           COUNT(D.L_DO_CLE) TOTAL
      FROM V_DO_DOSSIER_CA_TY D,
           TR_TRADUCTION  TR1,
           TR_TRADUCTION  TR2,
           TR_TRADUCTION  TR3,
           TR_TRADUCTION  TR4,
           OR_ORIENTATION O,
           TR_TRADUCTION  TSR,
           SI_SITE        S
     WHERE D.I_GE_CLE = TR1.L_TR_CLE
       AND D.I_NA_CLE = TR2.L_TR_CLE
       AND D.I_TY_CLE = TR3.L_TR_CLE
       AND D.I_CA_CLE = TR4.L_TR_CLE
       AND TR1.I_LA_CLE = 1
       AND TR2.I_LA_CLE = 1
       AND TR3.I_LA_CLE = 1
       AND TR4.I_LA_CLE = 1
       AND D.I_OR_CLE = O.I_OR_CLE 
       AND O.L_SR_CLE = TSR.L_TR_CLE
       AND TSR.I_LA_CLE = 1
       AND D.L_SI_CLE = S.L_SI_CLE
       AND D.I_DO_FONDE = 16123
       AND D.D_DO_DATE_DEBUT >= NEW_DATE_DEBUT AND D.D_DO_DATE_DEBUT < NEW_DATE_FIN + 1
       AND (D.I_GE_CLE = NEW_GENRE OR NEW_GENRE = 0)
       AND (D.i_na_cle = NEW_NATURE OR NEW_NATURE = 0)
       AND (D.i_ty_cle = NEW_TYPE OR NEW_TYPE = 0)
       AND (D.i_ca_cle = NEW_CATEGORIE OR NEW_CATEGORIE = 0)
       AND (D.l_si_cle = NEW_SITE OR NEW_SITE = 0)
       AND (O.L_SR_CLE = NEW_REGROUPEMENT OR NEW_REGROUPEMENT = 0)
       GROUP BY S.V_SI_SITE,
             to_char(d.d_do_date_debut,'YYYY'),
             TSR.V_TR_DESCRIPTION
     UNION ALL
         SELECT S.V_SI_SITE          SITE,
           to_char(d.d_do_date_debut,'YYYY') ANNEE,
           TSR.V_TR_DESCRIPTION REGROUPEMENT,
           COUNT(D.L_DO_CLE) TOTAL
      FROM V_DO_DOSSIER_CA_TY D,
           TR_TRADUCTION  TR1,
           TR_TRADUCTION  TR2,
           TR_TRADUCTION  TR3,
           TR_TRADUCTION  TR4,
           OR_ORIENTATION O,
           TR_TRADUCTION  TSR,
           SI_SITE        S,
           LDC_LIEN_DOSSIER_CATEGORIE L
     WHERE D.I_GE_CLE = TR1.L_TR_CLE
       AND D.I_NA_CLE = TR2.L_TR_CLE
       AND D.I_TY_CLE = TR3.L_TR_CLE
       AND L.I_CA_CLE = TR4.L_TR_CLE
       AND TR1.I_LA_CLE = 1
       AND TR2.I_LA_CLE = 1
       AND TR3.I_LA_CLE = 1
       AND TR4.I_LA_CLE = 1
       AND D.I_OR_CLE = O.I_OR_CLE 
       AND O.L_SR_CLE = TSR.L_TR_CLE
       AND TSR.I_LA_CLE = 1
       AND D.L_SI_CLE = S.L_SI_CLE
       AND D.L_DO_CLE = L.L_DO_CLE AND D.L_SI_CLE = L.L_SI_CLE
       AND D.D_DO_DATE_DEBUT >= NEW_DATE_DEBUT AND D.D_DO_DATE_DEBUT < NEW_DATE_FIN + 1
       AND (L.i_ca_cle = NEW_CATEGORIE OR NEW_CATEGORIE = 0)
       AND (D.l_si_cle = NEW_SITE OR NEW_SITE = 0)
       AND (O.L_SR_CLE = NEW_REGROUPEMENT OR NEW_REGROUPEMENT = 0)
       GROUP BY S.V_SI_SITE,
             to_char(d.d_do_date_debut,'YYYY'),
             TSR.V_TR_DESCRIPTION;
 END SP_TABLEAU_ENDROITS_REGROUPES;

PROCEDURE SP_SOCIETE_SANS_VISITE(rc1 IN OUT DTS_SOCIETE_SANS_VISITE) IS
begin
  OPEN rc1 FOR
    SELECT SO.L_SO_CLE as CLE_SOCIETE,
           SO.L_SI_CLE as SITE_SOCIETE,
           DOECHANTILLON.L_DO_CLE as CLE_ECHANTILLON,
           DOECHANTILLON.L_SI_CLE as SITE_ECHANTILLON,           
           DOECHANTILLON.V_DO_ANCIENNE_REFERENCE as VAGUE,
           SO.V_SO_DISTRICT as DISTRICT,
           SO.V_SO_REFERENCE_1 as REGION_ADMINISTRATIVE,
           SO.V_SO_REFERENCE_3 as NUMERO_DETAILLANT,
           SO.V_SO_NOM as NOM_SOCIETE,
           SO.V_SO_CODE_COMPTE as COMPTE_SOCIETE,
           CC.NOM_COC as NOM_COMPTE,
           TRLS.V_TR_DESCRIPTION as LANGUE,
           SO.L_SO_CENTRE_REGIONAL as CENTRE_REGIONAL,
           AD.V_AD_NUM_MUNICIPAL as NUM_MUNICIPAL,
           TRTR.V_TR_DESCRIPTION as TYPE_RUE,
           AD.V_AD_NOM_RUE as NOM_RUE,
           VI.V_VI_VILLE as VILLE,
           AD.V_AD_CODE_POSTAL as CODE_POSTAL,
           AD.V_AD_TELEPHONE_1 as TELEPHONE_1           
      FROM SO_SOCIETE       SO,
           VEXI_CDX_DDS_CODE_COMPTE CC,
           AD_ADRESSE       AD,
           VI_VILLE         VI,
           TR_TRADUCTION    TRLS,
           TR_TRADUCTION    TRTR,
           LDD_LIEN_DOSSIER LDDDOSOECHANTILLON,
           DO_DOSSIER       DOECHANTILLON
     WHERE SO.B_SO_IND_RDD = 'yes'
       AND SO.I_CC_CLE <> 14920
       AND SO.L_SO_CLE = AD.L_AD_REFERENCE(+)
       AND SO.L_SI_CLE = AD.L_AD_REF_SITE(+)
          -- CODE COMPTE
       AND SO.V_SO_CODE_COMPTE = CC.CODE_CPTE_COC(+)
          -- ADRESSE       
       AND AD.C_AD_REF_GENRE(+) = 'SO'
       AND AD.L_VI_CLE = VI.L_VI_CLE(+)
       AND AD.I_ST_CLE(+) = 621
       AND AD.L_AD_TYPE_RUE = TRTR.L_TR_CLE(+)
       AND TRTR.I_LA_CLE(+) = 1
       AND SO.I_LS_CLE = TRLS.L_TR_CLE(+)
       AND TRLS.I_LA_CLE(+) = 1
       AND DOECHANTILLON.I_CA_CLE = 662
       AND DOECHANTILLON.I_ST_CLE = 359
       AND DOECHANTILLON.I_CC_CLE <> 14920
       AND DOECHANTILLON.L_DO_CLE = LDDDOSOECHANTILLON.L_DO_CLE
       AND DOECHANTILLON.L_SI_CLE = LDDDOSOECHANTILLON.L_DO_SITE
       AND LDDDOSOECHANTILLON.C_DO_GENRE = 'DO'
       AND LDDDOSOECHANTILLON.L_LDD_DOSSIER_ASSOCIE = SO.L_SO_CLE
       AND LDDDOSOECHANTILLON.L_LDD_SITE = SO.L_SI_CLE
       AND LDDDOSOECHANTILLON.C_LDD_GENRE = 'SO'
       AND (SO.L_SO_CLE, SO.L_SI_CLE) NOT IN
       -- sans rfrence  un dossier mystre
           (SELECT DISTINCT LDDSODO.L_LDD_DOSSIER_ASSOCIE,
                            LDDSODO.L_LDD_SITE
              FROM LDD_LIEN_DOSSIER LDDSODO, DO_DOSSIER DO, LDD_LIEN_DOSSIER   LDDDODOECHANTILLON
             WHERE DO.L_DO_CLE = LDDSODO.L_DO_CLE
               AND DO.L_SI_CLE = LDDSODO.L_DO_SITE
               AND LDDSODO.C_DO_GENRE = 'DO'
               AND LDDSODO.C_LDD_GENRE = 'SO'
               AND DO.I_CC_CLE <> 14920
               -- AND DOECHANTILLON.V_DO_ANCIENNE_REFERENCE = DO.V_DO_REFERENCE1
               AND ((DOECHANTILLON.L_DO_CLE = LDDDODOECHANTILLON.l_do_cle
               and DOECHANTILLON.L_SI_CLE = LDDDODOECHANTILLON.l_do_site
               and LDDDODOECHANTILLON.c_do_genre = 'DO'
               and LDDDODOECHANTILLON.l_ldd_dossier_associe = DO.L_DO_CLE
               and LDDDODOECHANTILLON.l_ldd_site = DO.L_SI_CLE
               and LDDDODOECHANTILLON.c_ldd_genre = 'DO'
               )or(DOECHANTILLON.L_DO_CLE = LDDDODOECHANTILLON.l_ldd_dossier_associe
               and DOECHANTILLON.L_SI_CLE = LDDDODOECHANTILLON.l_ldd_site
               and LDDDODOECHANTILLON.c_do_genre = 'DO'
               and LDDDODOECHANTILLON.l_do_cle = DO.L_DO_CLE
               and LDDDODOECHANTILLON.l_do_site = DO.L_SI_CLE
               and LDDDODOECHANTILLON.c_ldd_genre = 'DO'))               
               AND DO.I_CA_CLE IN (653, 654, 655, 656, 657, 23667, 23668, 23669, 23670, 23735, 24863))
     ORDER BY SO.D_SO_DATE_CREATION, AD.D_AD_DATE_CREATION;
END SP_SOCIETE_SANS_VISITE;
 
PROCEDURE SP_SOCIETE_CLIENT_MYSTERE(rc1 IN OUT DTS_SOCIETE_CLIENT_MYSTERE) IS
begin
  OPEN rc1 FOR
    SELECT SO.L_SO_CLE as CLE_SOCIETE,
           SO.L_SI_CLE as SITE_SOCIETE,
           DOECHANTILLON.L_DO_CLE as CLE_ECHANTILLON,
           DOECHANTILLON.L_SI_CLE as SITE_ECHANTILLON,           
           DOECHANTILLON.V_DO_ANCIENNE_REFERENCE as VAGUE,
           SO.V_SO_DISTRICT as DISTRICT,
           SO.V_SO_REFERENCE_1 as REGION_ADMINISTRATIVE,
           SO.V_SO_REFERENCE_3 as NUMERO_DETAILLANT,
           SO.V_SO_NOM as NOM_SOCIETE,
           SO.V_SO_CODE_COMPTE as COMPTE_SOCIETE,
           CC.NOM_COC as NOM_COMPTE,
           TRLS.V_TR_DESCRIPTION as LANGUE,
           SO.L_SO_CENTRE_REGIONAL as CENTRE_REGIONAL,
           AD.V_AD_NUM_MUNICIPAL as NUM_MUNICIPAL,
           TRTR.V_TR_DESCRIPTION as TYPE_RUE,
           AD.V_AD_NOM_RUE as NOM_RUE,
           VI.V_VI_VILLE as VILLE,
           AD.V_AD_CODE_POSTAL as CODE_POSTAL,
           AD.V_AD_TELEPHONE_1 as TELEPHONE_1,
           DO.I_CA_CLE as CATEGORIE,
           DO.D_DO_DATE_DEBUT as DEBUT_DATE_DOSSIER,
           DO.D_DO_DATE_FIN as FIN_DATE_DOSSIER,
           DO.V_DO_REFERENCE3 as AVIS_DATE,
           NA.CLOB_CO_TEXTE_NORMAL as TEXTE_NARRATION,
           BI.V_BI_NUMERO_CONTROLE as NUMERO_BILLET
      FROM SO_SOCIETE         SO,
           VEXI_CDX_DDS_CODE_COMPTE CC,
           AD_ADRESSE         AD,
           VI_VILLE           VI,
           TR_TRADUCTION      TRLS,
           TR_TRADUCTION      TRTR,
           LDD_LIEN_DOSSIER   LDDSODO,
           V_DO_DOSSIER_CA_TY DO,
           LDD_LIEN_DOSSIER   LDDDOSOECHANTILLON,
           DO_DOSSIER         DOECHANTILLON,
           LDD_LIEN_DOSSIER   LDDDODOECHANTILLON,
           CO_COMMENTAIRE2    NA,
           BI_BILLET          BI
     WHERE SO.B_SO_IND_RDD = 'yes'
       AND SO.I_CC_CLE <> 14920
          -- CODE COMPTE
       AND SO.V_SO_CODE_COMPTE = CC.CODE_CPTE_COC(+)
          -- ADRESSE
       AND SO.L_SO_CLE = AD.L_AD_REFERENCE(+)
       AND SO.L_SI_CLE = AD.L_AD_REF_SITE(+)
       AND AD.C_AD_REF_GENRE(+) = 'SO'
       AND AD.L_VI_CLE = VI.L_VI_CLE(+)
       AND AD.I_ST_CLE(+) = 621
       AND AD.L_AD_TYPE_RUE = TRTR.L_TR_CLE(+)
          -- LANGUE
       AND TRTR.I_LA_CLE(+) = 1
       AND SO.I_LS_CLE = TRLS.L_TR_CLE(+)
       AND TRLS.I_LA_CLE(+) = 1
          -- DOSSIERS
       AND DOECHANTILLON.I_CA_CLE = 662
       AND DOECHANTILLON.I_ST_CLE = 359
       AND DOECHANTILLON.I_CC_CLE <> 14920
       AND DOECHANTILLON.L_DO_CLE = LDDDOSOECHANTILLON.L_DO_CLE
       AND DOECHANTILLON.L_SI_CLE = LDDDOSOECHANTILLON.L_DO_SITE
       AND LDDDOSOECHANTILLON.C_DO_GENRE = 'DO'
       AND LDDDOSOECHANTILLON.L_LDD_DOSSIER_ASSOCIE = SO.L_SO_CLE
       AND LDDDOSOECHANTILLON.L_LDD_SITE = SO.L_SI_CLE
       AND LDDDOSOECHANTILLON.C_LDD_GENRE = 'SO'
--       AND DO.V_DO_REFERENCE1 = DOECHANTILLON.V_DO_ANCIENNE_REFERENCE
       AND ((DOECHANTILLON.L_DO_CLE = LDDDODOECHANTILLON.l_do_cle
       and DOECHANTILLON.L_SI_CLE = LDDDODOECHANTILLON.l_do_site
       and LDDDODOECHANTILLON.c_do_genre = 'DO'
       and LDDDODOECHANTILLON.l_ldd_dossier_associe = DO.L_DO_CLE
       and LDDDODOECHANTILLON.l_ldd_site = DO.L_SI_CLE
       and LDDDODOECHANTILLON.c_ldd_genre = 'DO'
       )or(DOECHANTILLON.L_DO_CLE = LDDDODOECHANTILLON.l_ldd_dossier_associe
       and DOECHANTILLON.L_SI_CLE = LDDDODOECHANTILLON.l_ldd_site
       and LDDDODOECHANTILLON.c_do_genre = 'DO'
       and LDDDODOECHANTILLON.l_do_cle = DO.L_DO_CLE
       and LDDDODOECHANTILLON.l_do_site = DO.L_SI_CLE
       and LDDDODOECHANTILLON.c_ldd_genre = 'DO'))

       AND DO.D_DO_DATE_DEBUT > DOECHANTILLON.D_DO_DATE_DEBUT
       AND DO.V_DO_REFERENCE1 IS NOT NULL
       AND DO.I_CA_CLE IN (653, 654, 655, 656, 657, 23667, 23668, 23669, 23670, 23735, 24863, 27769)
       AND DO.I_GE_CLE = 16500
       AND DO.I_CC_CLE <> 14920
       AND DO.L_DO_CLE = LDDSODO.L_DO_CLE
       AND DO.L_SI_CLE = LDDSODO.L_DO_SITE
       AND LDDSODO.C_DO_GENRE = 'DO'
       AND LDDSODO.L_LDD_DOSSIER_ASSOCIE = SO.L_SO_CLE
       AND LDDSODO.L_LDD_SITE = SO.L_SI_CLE
       AND LDDSODO.C_LDD_GENRE = 'SO'
          -- NARRATION
       AND DO.L_DO_CLE = NA.L_CO_REFERENCE(+)
       AND DO.L_SI_CLE = NA.L_CO_REF_SITE(+)
       AND NA.C_CO_REF_GENRE(+) = 'DO'
       AND NA.I_CC_COMMENTAIRE(+) <> 14920
          -- BILLET
       AND DO.L_DO_CLE = BI.L_BI_REF_CLE(+)
       AND DO.L_SI_CLE = BI.L_BI_REF_SITE(+)
       AND BI.C_BI_REF_GENRE(+) = 'DO'
     ORDER BY SO.D_SO_DATE_CREATION,
              AD.D_AD_DATE_CREATION,
              DO.D_DO_DATE_DEBUT,
              NA.D_CO_DATE_CREATION,
              BI.D_BI_DATE_CREATION;
END SP_SOCIETE_CLIENT_MYSTERE;

END CARDEX_RAPPORT;
/
