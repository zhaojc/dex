CREATE OR REPLACE PACKAGE Cardex_Lire_Doc AS
  TYPE REC_SO_SOCIETE_ENTITE IS RECORD(
    L_SO_CLE                 SO_SOCIETE.L_SO_CLE%TYPE,
    L_SI_CLE                 SO_SOCIETE.L_SI_CLE%TYPE,
    I_EN_CLE                 SI_SITE.I_EN_CLE%TYPE,
    I_ST_CLE                 SO_SOCIETE.I_ST_CLE%TYPE,
    I_LS_CLE                 SO_SOCIETE.I_LS_CLE%TYPE,
    V_SO_RAISON_SOCIALE      SO_SOCIETE.V_SO_RAISON_SOCIALE%TYPE,
    V_SO_NOM                 SO_SOCIETE.V_SO_NOM%TYPE,
    I_CL_CLE                 SO_SOCIETE.I_CL_CLE%TYPE,
    D_SO_DATE_FONDATION      SO_SOCIETE.D_SO_DATE_FONDATION%TYPE,
    I_CC_CLE                 SO_SOCIETE.I_CC_CLE%TYPE,
    V_SO_MOT_PASSE           SO_SOCIETE.V_SO_MOT_PASSE%TYPE,
    V_SO_REFERENCE_NOM       SO_SOCIETE.V_SO_REFERENCE_NOM%TYPE,
    V_SO_REFERENCE_PRENOM    SO_SOCIETE.V_SO_REFERENCE_PRENOM%TYPE,
    V_SO_REFERENCE_1         SO_SOCIETE.V_SO_REFERENCE_1%TYPE,
    V_SO_REFERENCE_2         SO_SOCIETE.V_SO_REFERENCE_2%TYPE,
    V_SO_REFERENCE_3         SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
    V_SO_CREE_PAR            SO_SOCIETE.V_SO_CREE_PAR%TYPE,
    D_SO_DATE_CREATION       SO_SOCIETE.D_SO_DATE_CREATION%TYPE,
    C_SO_SNDX_RAISON_SOCIALE SO_SOCIETE.C_SO_SNDX_RAISON_SOCIALE%TYPE,
    C_SO_SNDX_NOM            SO_SOCIETE.C_SO_SNDX_NOM%TYPE,
    I_SE_CLE                 SE_SEVERITE.I_SE_CLE%TYPE,
    L_SO_CENTRE_REGIONAL     SO_SOCIETE.L_SO_CENTRE_REGIONAL%TYPE,
    V_SO_DISTRICT            SO_SOCIETE.V_SO_DISTRICT%TYPE,
    V_SO_CODE_COMPTE         SO_SOCIETE.V_SO_CODE_COMPTE%TYPE,
    B_SO_ACTIF               SO_SOCIETE.B_SO_ACTIF%TYPE,
    D_SO_DATE_INACTIVATION   SO_SOCIETE.D_SO_DATE_INACTIVATION%TYPE,
    B_SO_IND_RDD             SO_SOCIETE.B_SO_IND_RDD%TYPE,
    V_SO_COMMENTAIRE         SO_SOCIETE.V_SO_COMMENTAIRE%TYPE,
    V_SO_RAISON_INACTIVATION SO_SOCIETE.V_SO_RAISON_INACTIVATION%TYPE,
    NOM_CENTREREG            VARCHAR(60),
    NOM_COC                  VARCHAR(60),
    NOM_DISTRICT             VARCHAR(60),
    I_SE_CLE_CASINO          SO_SOCIETE.I_SE_CLE_CASINO%TYPE,
    I_SO_ECHANTILLONAGE      SO_SOCIETE.I_SO_ECHANTILLONAGE%TYPE);
  TYPE DTS_SO_SOCIETE_ENTITE IS REF CURSOR RETURN REC_SO_SOCIETE_ENTITE;

  PROCEDURE SP_L_SO_SOCIETE(rc1 IN OUT DTS_SO_SOCIETE_ENTITE);
  PROCEDURE SP_L_SO_SOCIETE(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                            NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                            rc1          IN OUT DTS_SO_SOCIETE_ENTITE);
  PROCEDURE SP_L_SO_SOCIETE(NEW_L_SO_CLE       IN SO_SOCIETE.L_SO_CLE%TYPE,
                            NEW_L_SI_CLE       IN SO_SOCIETE.L_SI_CLE%TYPE,
                            NEW_V_SO_MOT_PASSE IN SO_SOCIETE.V_SO_MOT_PASSE%TYPE,
                            rc1                IN OUT DTS_SO_SOCIETE_ENTITE);
  PROCEDURE SP_L_SO_RDD(rc1 IN OUT DTS_SO_SOCIETE_ENTITE);

  TYPE REC_SO_SOCIETE_ROLE IS RECORD(
    L_SO_CLE                 SO_SOCIETE.L_SO_CLE%TYPE,
    L_SI_CLE                 SO_SOCIETE.L_SI_CLE%TYPE,
    I_EN_CLE                 SI_SITE.I_EN_CLE%TYPE,
    I_ST_CLE                 SO_SOCIETE.I_ST_CLE%TYPE,
    I_LS_CLE                 SO_SOCIETE.I_LS_CLE%TYPE,
    V_SO_RAISON_SOCIALE      SO_SOCIETE.V_SO_RAISON_SOCIALE%TYPE,
    V_SO_NOM                 SO_SOCIETE.V_SO_NOM%TYPE,
    I_CL_CLE                 SO_SOCIETE.I_CL_CLE%TYPE,
    D_SO_DATE_FONDATION      SO_SOCIETE.D_SO_DATE_FONDATION%TYPE,
    I_CC_CLE                 SO_SOCIETE.I_CC_CLE%TYPE,
    V_SO_MOT_PASSE           SO_SOCIETE.V_SO_MOT_PASSE%TYPE,
    V_SO_REFERENCE_NOM       SO_SOCIETE.V_SO_REFERENCE_NOM%TYPE,
    V_SO_REFERENCE_PRENOM    SO_SOCIETE.V_SO_REFERENCE_PRENOM%TYPE,
    V_SO_REFERENCE_1         SO_SOCIETE.V_SO_REFERENCE_1%TYPE,
    V_SO_REFERENCE_2         SO_SOCIETE.V_SO_REFERENCE_2%TYPE,
    V_SO_REFERENCE_3         SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
    V_SO_CREE_PAR            SO_SOCIETE.V_SO_CREE_PAR%TYPE,
    D_SO_DATE_CREATION       SO_SOCIETE.D_SO_DATE_CREATION%TYPE,
    C_SO_SNDX_RAISON_SOCIALE SO_SOCIETE.C_SO_SNDX_RAISON_SOCIALE%TYPE,
    C_SO_SNDX_NOM            SO_SOCIETE.C_SO_SNDX_NOM%TYPE,
    I_RO_CLE                 RO_ROLE.I_RO_CLE%TYPE,
    L_LDD_CLE                LDD_LIEN_DOSSIER.L_LDD_CLE%TYPE,
    L_LDD_SI_CLE             LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    I_SE_CLE                 SE_SEVERITE.I_SE_CLE%TYPE,
    L_SO_CENTRE_REGIONAL     SO_SOCIETE.L_SO_CENTRE_REGIONAL%TYPE,
    V_SO_DISTRICT            SO_SOCIETE.V_SO_DISTRICT%TYPE,
    V_SO_CODE_COMPTE         SO_SOCIETE.V_SO_CODE_COMPTE%TYPE,
    B_SO_ACTIF               SO_SOCIETE.B_SO_ACTIF%TYPE,
    D_SO_DATE_INACTIVATION   SO_SOCIETE.D_SO_DATE_INACTIVATION%TYPE,
    B_SO_IND_RDD             SO_SOCIETE.B_SO_IND_RDD%TYPE,
    V_SO_COMMENTAIRE         SO_SOCIETE.V_SO_COMMENTAIRE%TYPE,
    V_SO_RAISON_INACTIVATION SO_SOCIETE.V_SO_RAISON_INACTIVATION%TYPE,
    NOM_CENTREREG            VARCHAR(60),
    NOM_COC                  VARCHAR(60),
    NOM_DISTRICT             VARCHAR(60),
    I_SE_CLE_CASINO          SO_SOCIETE.I_SE_CLE_CASINO%TYPE,
    I_SO_ECHANTILLONAGE      SO_SOCIETE.I_SO_ECHANTILLONAGE%TYPE);
  TYPE DTS_SO_SOCIETE_ROLE IS REF CURSOR RETURN REC_SO_SOCIETE_ROLE;
  PROCEDURE SP_L_SO_SOCIETE(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                            NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                            NEW_C_GF_CLE IN GF_GENRE_FICHIER.C_GF_CLE%TYPE,
                            rc1          IN OUT DTS_SO_SOCIETE_ROLE);

  TYPE REC_VE_VEHICULE_MARQUE IS RECORD(
    L_VE_CLE                 VE_VEHICULE.L_VE_CLE%TYPE,
    L_SI_CLE                 VE_VEHICULE.L_SI_CLE%TYPE,
    I_EN_CLE                 SI_SITE.I_EN_CLE%TYPE,
    I_MD_CLE                 VE_VEHICULE.I_MD_CLE%TYPE,
    I_CC_CLE                 VE_VEHICULE.I_CC_CLE%TYPE,
    V_VE_IMMATRICULATION     VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
    V_VE_PROVINCE            VE_VEHICULE.V_VE_PROVINCE%TYPE,
    C_VE_ANNEE               VE_VEHICULE.C_VE_ANNEE%TYPE,
    V_VE_VIGNETTE            VE_VEHICULE.V_VE_VIGNETTE%TYPE,
    V_VE_NUMERO_SERIE        VE_VEHICULE.V_VE_NUMERO_SERIE%TYPE,
    V_VE_ASSUREUR            VE_VEHICULE.V_VE_ASSUREUR%TYPE,
    V_VE_POLICE              VE_VEHICULE.V_VE_POLICE%TYPE,
    D_VE_EXPIRATION_VIGNETTE VE_VEHICULE.D_VE_EXPIRATION_VIGNETTE%TYPE,
    D_VE_EXPIRATION_POLICE   VE_VEHICULE.D_VE_EXPIRATION_POLICE%TYPE,
    V_VE_CREE_PAR            VE_VEHICULE.V_VE_CREE_PAR%TYPE,
    D_VE_DATE_CREATION       VE_VEHICULE.D_VE_DATE_CREATION%TYPE,
    V_VE_MOT_PASSE           VE_VEHICULE.V_VE_MOT_PASSE%TYPE,
    I_MA_CLE                 MD_MODELE.I_MA_CLE%TYPE,
    V_VE_COMMENTAIRE         VE_VEHICULE.V_VE_COMMENTAIRE%TYPE,
    L_PR_CLE                 VE_VEHICULE.L_PR_CLE%TYPE);
  TYPE DTS_VE_VEHICULE IS REF CURSOR RETURN REC_VE_VEHICULE_MARQUE;
  PROCEDURE SP_L_VE_VEHICULE(rc1 IN OUT DTS_VE_VEHICULE);
  PROCEDURE SP_L_VE_VEHICULE(NEW_L_VE_CLE IN VE_VEHICULE.L_VE_CLE%TYPE,
                             NEW_L_SI_CLE IN VE_VEHICULE.L_SI_CLE%TYPE,
                             rc1          IN OUT DTS_VE_VEHICULE);
  PROCEDURE SP_L_VE_VEHICULE(NEW_L_VE_CLE       IN VE_VEHICULE.L_VE_CLE%TYPE,
                             NEW_L_SI_CLE       IN VE_VEHICULE.L_SI_CLE%TYPE,
                             NEW_V_VE_MOT_PASSE IN VE_VEHICULE.V_VE_MOT_PASSE%TYPE,
                             rc1                IN OUT DTS_VE_VEHICULE);
  PROCEDURE SP_L_VE_VEHICULE_DIRECT(NEW_V_VE_IMMATRICULATION IN VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
                                    rc1                      IN OUT DTS_VE_VEHICULE);

  TYPE REC_VE_VEHICULE_ROLE IS RECORD(
    L_VE_CLE                 VE_VEHICULE.L_VE_CLE%TYPE,
    L_SI_CLE                 VE_VEHICULE.L_SI_CLE%TYPE,
    I_EN_CLE                 SI_SITE.I_EN_CLE%TYPE,
    I_MD_CLE                 VE_VEHICULE.I_MD_CLE%TYPE,
    I_CC_CLE                 VE_VEHICULE.I_CC_CLE%TYPE,
    V_VE_IMMATRICULATION     VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
    V_VE_PROVINCE            VE_VEHICULE.V_VE_PROVINCE%TYPE,
    C_VE_ANNEE               VE_VEHICULE.C_VE_ANNEE%TYPE,
    V_VE_VIGNETTE            VE_VEHICULE.V_VE_VIGNETTE%TYPE,
    V_VE_NUMERO_SERIE        VE_VEHICULE.V_VE_NUMERO_SERIE%TYPE,
    V_VE_ASSUREUR            VE_VEHICULE.V_VE_ASSUREUR%TYPE,
    V_VE_POLICE              VE_VEHICULE.V_VE_POLICE%TYPE,
    D_VE_EXPIRATION_VIGNETTE VE_VEHICULE.D_VE_EXPIRATION_VIGNETTE%TYPE,
    D_VE_EXPIRATION_POLICE   VE_VEHICULE.D_VE_EXPIRATION_POLICE%TYPE,
    V_VE_CREE_PAR            VE_VEHICULE.V_VE_CREE_PAR%TYPE,
    D_VE_DATE_CREATION       VE_VEHICULE.D_VE_DATE_CREATION%TYPE,
    V_VE_MOT_PASSE           VE_VEHICULE.V_VE_MOT_PASSE%TYPE,
    I_MA_CLE                 MD_MODELE.I_MA_CLE%TYPE,
    I_RO_CLE                 RO_ROLE.I_RO_CLE%TYPE,
    L_LDD_CLE                LDD_LIEN_DOSSIER.L_LDD_CLE%TYPE,
    L_LDD_SI_CLE             LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    V_VE_COMMENTAIRE         VE_VEHICULE.V_VE_COMMENTAIRE%TYPE,
    L_PR_CLE                 VE_VEHICULE.L_PR_CLE%TYPE);
  TYPE DTS_VE_VEHICULE_ROLE IS REF CURSOR RETURN REC_VE_VEHICULE_ROLE;
  PROCEDURE SP_L_VE_VEHICULE(NEW_L_VE_CLE IN VE_VEHICULE.L_VE_CLE%TYPE,
                             NEW_L_SI_CLE IN VE_VEHICULE.L_SI_CLE%TYPE,
                             NEW_C_GF_CLE IN GF_GENRE_FICHIER.C_GF_CLE%TYPE,
                             rc1          IN OUT DTS_VE_VEHICULE_ROLE);
  PROCEDURE SP_L_VE_VEHICULE(IMMATRICULATION IN VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
                             MARQUE          IN MD_MODELE.I_MA_CLE%TYPE,
                             MODELE          IN VE_VEHICULE.I_MD_CLE%TYPE,
                             PROVINCE        IN VE_VEHICULE.V_VE_PROVINCE%TYPE,
                             INTERVENANT     IN VE_VEHICULE.V_VE_CREE_PAR%TYPE,
                             PARTA           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTB           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTC           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTD           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTE           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             CONFIDENTIALITE IN VE_VEHICULE.I_CC_CLE%TYPE);
  TYPE REC_DO_DOSSIER IS RECORD(
    L_DO_CLE                      DO_DOSSIER.L_DO_CLE%TYPE,
    L_SI_CLE                      DO_DOSSIER.L_SI_CLE%TYPE,
    V_DO_NUMERO_DOSSIER           DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    I_CA_CLE                      DO_DOSSIER.I_CA_CLE%TYPE,
    I_SE_CLE                      DO_DOSSIER.I_SE_CLE%TYPE,
    I_CC_CLE                      DO_DOSSIER.I_CC_CLE%TYPE,
    I_NH_CLE                      DO_DOSSIER.I_NH_CLE%TYPE,
    I_PE_CLE                      DO_DOSSIER.I_PE_CLE%TYPE,
    I_ST_CLE                      DO_DOSSIER.I_ST_CLE%TYPE,
    V_DO_MOT_PASSE                DO_DOSSIER.V_DO_MOT_PASSE%TYPE,
    D_DO_DATE_DEBUT               DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    D_DO_DATE_FIN                 DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_DO_DUREE                    DO_DOSSIER.V_DO_DUREE%TYPE,
    V_DO_ANCIENNE_REFERENCE       DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    V_DO_REFERENCE_VIDEO          DO_DOSSIER.V_DO_REFERENCE_VIDEO%TYPE,
    D_DO_DATE_RAPPORTEE           DO_DOSSIER.D_DO_DATE_RAPPORTEE%TYPE,
    I_DO_CLASSE                   DO_DOSSIER.I_DO_CLASSE%TYPE,
    I_DO_RACE                     DO_DOSSIER.I_DO_RACE%TYPE,
    V_DO_LIEU                     DO_DOSSIER.V_DO_LIEU%TYPE,
    I_OR_CLE                      DO_DOSSIER.I_OR_CLE%TYPE,
    I_CR_CLE                      DO_DOSSIER.I_CR_CLE%TYPE,
    V_DO_REFERENCE1               DO_DOSSIER.V_DO_REFERENCE1%TYPE,
    V_DO_REFERENCE2               DO_DOSSIER.V_DO_REFERENCE2%TYPE,
    V_DO_ASSIGNE_A                DO_DOSSIER.V_DO_ASSIGNE_A%TYPE,
    D_DO_DATE_ASSIGNATION         DO_DOSSIER.D_DO_DATE_ASSIGNATION%TYPE,
    D_DO_DATE_EVENEMENT           DO_DOSSIER.D_DO_DATE_EVENEMENT%TYPE,
    V_DO_CREE_PAR                 DO_DOSSIER.V_DO_CREE_PAR%TYPE,
    D_DO_DATE_CREATION            DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
    I_TY_CLE                      TY_TYPE.I_TY_CLE%TYPE,
    I_NA_CLE                      NA_NATURE.I_NA_CLE%TYPE,
    I_GE_CLE                      GE_GENRE.I_GE_CLE%TYPE,
    I_GE_ENTITE                   GE_GENRE.I_GE_ENTITE%TYPE,
    V_DO_REFERENCE3               DO_DOSSIER.V_DO_REFERENCE3%TYPE,
    V_DO_REFERENCE4               DO_DOSSIER.V_DO_REFERENCE4%TYPE,
    V_DO_REFERENCE5               DO_DOSSIER.V_DO_REFERENCE5%TYPE,
    C_DO_FONDE                    DO_DOSSIER.C_DO_FONDE%TYPE,
    V_DO_REFERENCE6               DO_DOSSIER.V_DO_REFERENCE6%TYPE,
    V_DO_REFERENCE7               DO_DOSSIER.V_DO_REFERENCE7%TYPE,
    I_DO_FONDE                    DO_DOSSIER.I_DO_FONDE%TYPE,
    I_RF_CLE                      RF_REFERENCE_VIDEO.I_RF_CLE%TYPE,
    B_DO_ENREGISTREMENT_CONSERVE  DO_DOSSIER.B_DO_ENREGISTREMENT_CONSERVE%TYPE,
    B_DO_ENREGISTREMENT_NUMERIQUE DO_DOSSIER.B_DO_ENREGISTREMENT_NUMERIQUE%TYPE,
    L_DO_ORIGINE                  DO_DOSSIER.L_DO_ORIGINE%TYPE);
  TYPE DTS_DO_DOSSIER IS REF CURSOR RETURN REC_DO_DOSSIER;
  PROCEDURE SP_L_DO_DOSSIER(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                            NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                            rc1          IN OUT DTS_DO_DOSSIER);
  PROCEDURE SP_L_DO_DOSSIER_DIRECT(NEW_V_DO_NUMERO_DOSSIER IN DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
                                   rc1                     IN OUT DTS_DO_DOSSIER);
  TYPE REC_DO_DOSSIER_LDD IS RECORD(
    L_DO_CLE                      DO_DOSSIER.L_DO_CLE%TYPE,
    L_SI_CLE                      DO_DOSSIER.L_SI_CLE%TYPE,
    V_DO_NUMERO_DOSSIER           DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    I_CA_CLE                      DO_DOSSIER.I_CA_CLE%TYPE,
    I_SE_CLE                      DO_DOSSIER.I_SE_CLE%TYPE,
    I_CC_CLE                      DO_DOSSIER.I_CC_CLE%TYPE,
    I_NH_CLE                      DO_DOSSIER.I_NH_CLE%TYPE,
    I_PE_CLE                      DO_DOSSIER.I_PE_CLE%TYPE,
    I_ST_CLE                      DO_DOSSIER.I_ST_CLE%TYPE,
    V_DO_MOT_PASSE                DO_DOSSIER.V_DO_MOT_PASSE%TYPE,
    D_DO_DATE_DEBUT               DO_DOSSIER.D_DO_DATE_DEBUT%TYPE,
    D_DO_DATE_FIN                 DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_DO_DUREE                    DO_DOSSIER.V_DO_DUREE%TYPE,
    V_DO_ANCIENNE_REFERENCE       DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE,
    V_DO_REFERENCE_VIDEO          DO_DOSSIER.V_DO_REFERENCE_VIDEO%TYPE,
    D_DO_DATE_RAPPORTEE           DO_DOSSIER.D_DO_DATE_RAPPORTEE%TYPE,
    I_DO_CLASSE                   DO_DOSSIER.I_DO_CLASSE%TYPE,
    I_DO_RACE                     DO_DOSSIER.I_DO_RACE%TYPE,
    V_DO_LIEU                     DO_DOSSIER.V_DO_LIEU%TYPE,
    I_OR_CLE                      DO_DOSSIER.I_OR_CLE%TYPE,
    I_CR_CLE                      DO_DOSSIER.I_CR_CLE%TYPE,
    V_DO_REFERENCE1               DO_DOSSIER.V_DO_REFERENCE1%TYPE,
    V_DO_REFERENCE2               DO_DOSSIER.V_DO_REFERENCE2%TYPE,
    V_DO_ASSIGNE_A                DO_DOSSIER.V_DO_ASSIGNE_A%TYPE,
    D_DO_DATE_ASSIGNATION         DO_DOSSIER.D_DO_DATE_ASSIGNATION%TYPE,
    D_DO_DATE_EVENEMENT           DO_DOSSIER.D_DO_DATE_EVENEMENT%TYPE,
    V_DO_CREE_PAR                 DO_DOSSIER.V_DO_CREE_PAR%TYPE,
    D_DO_DATE_CREATION            DO_DOSSIER.D_DO_DATE_CREATION%TYPE,
    I_TY_CLE                      TY_TYPE.I_TY_CLE%TYPE,
    I_NA_CLE                      NA_NATURE.I_NA_CLE%TYPE,
    I_GE_CLE                      GE_GENRE.I_GE_CLE%TYPE,
    I_GE_ENTITE                   GE_GENRE.I_GE_ENTITE%TYPE,
    V_DO_REFERENCE3               DO_DOSSIER.V_DO_REFERENCE3%TYPE,
    V_DO_REFERENCE4               DO_DOSSIER.V_DO_REFERENCE4%TYPE,
    V_DO_REFERENCE5               DO_DOSSIER.V_DO_REFERENCE5%TYPE,
    L_LDD_CLE                     LDD_LIEN_DOSSIER.L_LDD_CLE%TYPE,
    L_LDD_SI_CLE                  LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    C_DO_FONDE                    DO_DOSSIER.C_DO_FONDE%TYPE,
    V_DO_REFERENCE6               DO_DOSSIER.V_DO_REFERENCE6%TYPE,
    V_DO_REFERENCE7               DO_DOSSIER.V_DO_REFERENCE7%TYPE,
    I_DO_FONDE                    DO_DOSSIER.I_DO_FONDE%TYPE,
    I_RF_CLE                      RF_REFERENCE_VIDEO.I_RF_CLE%TYPE,
    B_DO_ENREGISTREMENT_CONSERVE  DO_DOSSIER.B_DO_ENREGISTREMENT_CONSERVE%TYPE,
    B_DO_ENREGISTREMENT_NUMERIQUE DO_DOSSIER.B_DO_ENREGISTREMENT_NUMERIQUE%TYPE);
  TYPE DTS_DO_DOSSIER_LDD IS REF CURSOR RETURN REC_DO_DOSSIER_LDD;

  PROCEDURE SP_LY_DO_DOSSIER(NEW_V_SU_REFERENCE_3 IN SU_SUJET.V_SU_REFERENCE_3%TYPE,
                             rc1                  IN OUT DTS_DO_DOSSIER);

  TYPE DTS_SU_SUJET IS REF CURSOR RETURN SU_SUJET%ROWTYPE;
  PROCEDURE SP_L_SU_SUJET(rc1 IN OUT DTS_SU_SUJET);
  TYPE REC_SU_SUJET_ENTITE IS RECORD(
    L_SU_CLE               SU_SUJET.L_SU_CLE%TYPE,
    L_SI_CLE               SU_SUJET.L_SI_CLE%TYPE,
    I_SX_CLE               SU_SUJET.I_SX_CLE%TYPE,
    I_ST_CLE               SU_SUJET.I_ST_CLE%TYPE,
    I_NT_CLE               SU_SUJET.I_NT_CLE%TYPE,
    I_RA_CLE               SU_SUJET.I_RA_CLE%TYPE,
    I_LS_CLE               SU_SUJET.I_LS_CLE%TYPE,
    V_SU_NOM               SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM            SU_SUJET.V_SU_PRENOM%TYPE,
    V_SU_SURNOM            SU_SUJET.V_SU_SURNOM%TYPE,
    D_SU_DATE_NAISSANCE    SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
    L_SU_TYPE_AGE          SU_SUJET.L_SU_TYPE_AGE%TYPE,
    C_SU_ASSURANCE_SOCIALE SU_SUJET.C_SU_ASSURANCE_SOCIALE%TYPE,
    V_SU_PERMIS_CONDUIRE   SU_SUJET.V_SU_PERMIS_CONDUIRE%TYPE,
    V_SU_GRANDEUR_METRIQUE SU_SUJET.V_SU_GRANDEUR_METRIQUE%TYPE,
    V_SU_GRANDEUR_IMPERIAL SU_SUJET.V_SU_GRANDEUR_IMPERIAL%TYPE,
    V_SU_POIDS_METRIQUE    SU_SUJET.V_SU_POIDS_METRIQUE%TYPE,
    V_SU_POIDS_IMPERIAL    SU_SUJET.V_SU_POIDS_IMPERIAL%TYPE,
    C_SU_SYSTEME           SU_SUJET.C_SU_SYSTEME%TYPE,
    I_CC_CLE               SU_SUJET.I_CC_CLE%TYPE,
    V_SU_MOT_PASSE         SU_SUJET.V_SU_MOT_PASSE%TYPE,
    V_SU_REFERENCE_1       SU_SUJET.V_SU_REFERENCE_1%TYPE,
    V_SU_REFERENCE_2       SU_SUJET.V_SU_REFERENCE_2%TYPE,
    V_SU_REFERENCE_3       SU_SUJET.V_SU_REFERENCE_3%TYPE,
    V_SU_CREE_PAR          SU_SUJET.V_SU_CREE_PAR%TYPE,
    D_SU_DATE_CREATION     SU_SUJET.D_SU_DATE_CREATION%TYPE,
    C_SU_SNDX_NOM          SU_SUJET.C_SU_SNDX_NOM%TYPE,
    C_SU_SNDX_PRENOM       SU_SUJET.C_SU_SNDX_PRENOM%TYPE,
    C_SU_SNDX_SURNOM       SU_SUJET.C_SU_SNDX_SURNOM%TYPE,
    I_SE_CLE               SE_SEVERITE.I_SE_CLE%TYPE,
    I_SE_CLE_AUTRES        SE_SEVERITE.I_SE_CLE%TYPE,
    V_SU_NO_PASSEPORT      SU_SUJET.V_SU_NO_PASSEPORT%TYPE,
    I_EN_CLE               SI_SITE.I_EN_CLE%TYPE,
    V_SU_ASSURANCE_MALADIE SU_SUJET.V_SU_ASSURANCE_MALADIE%TYPE,
    B_SU_IND_RDD           SU_SUJET.B_SU_IND_RDD%TYPE,
    I_SE_CLE_CASINO        SU_SUJET.I_SE_CLE_CASINO%TYPE,
    D_SU_DATE_FIN_EMPLOI   SU_SUJET.D_SU_DATE_FIN_EMPLOI%TYPE);
  TYPE DTS_SU_SUJET_ENTITE IS REF CURSOR RETURN REC_SU_SUJET_ENTITE;
  PROCEDURE SP_L_SU_SUJET(NEW_L_SU_CLE IN SU_SUJET.L_SU_CLE%TYPE,
                          NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                          rc1          IN OUT DTS_SU_SUJET_ENTITE);
  PROCEDURE SP_L_SU_SUJET(NEW_L_SU_CLE       IN SU_SUJET.L_SU_CLE%TYPE,
                          NEW_L_SI_CLE       IN SU_SUJET.L_SI_CLE%TYPE,
                          NEW_V_SU_MOT_PASSE IN SU_SUJET.V_SU_MOT_PASSE%TYPE,
                          rc1                IN OUT DTS_SU_SUJET_ENTITE);
  PROCEDURE SP_L_SU_SUJET_DIRECT(NEW_V_SU_REFERENCE_3 IN SU_SUJET.V_SU_REFERENCE_3%TYPE,
                                 rc1                  IN OUT DTS_SU_SUJET_ENTITE);
  TYPE REC_SU_SUJET_ROLE IS RECORD(
    L_SU_CLE               SU_SUJET.L_SU_CLE%TYPE,
    L_SI_CLE               SU_SUJET.L_SI_CLE%TYPE,
    I_SX_CLE               SU_SUJET.I_SX_CLE%TYPE,
    I_ST_CLE               SU_SUJET.I_ST_CLE%TYPE,
    I_NT_CLE               SU_SUJET.I_NT_CLE%TYPE,
    I_RA_CLE               SU_SUJET.I_RA_CLE%TYPE,
    I_LS_CLE               SU_SUJET.I_LS_CLE%TYPE,
    V_SU_NOM               SU_SUJET.V_SU_NOM%TYPE,
    V_SU_PRENOM            SU_SUJET.V_SU_PRENOM%TYPE,
    V_SU_SURNOM            SU_SUJET.V_SU_SURNOM%TYPE,
    D_SU_DATE_NAISSANCE    SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
    L_SU_TYPE_AGE          SU_SUJET.L_SU_TYPE_AGE%TYPE,
    C_SU_ASSURANCE_SOCIALE SU_SUJET.C_SU_ASSURANCE_SOCIALE%TYPE,
    V_SU_PERMIS_CONDUIRE   SU_SUJET.V_SU_PERMIS_CONDUIRE%TYPE,
    V_SU_GRANDEUR_METRIQUE SU_SUJET.V_SU_GRANDEUR_METRIQUE%TYPE,
    V_SU_GRANDEUR_IMPERIAL SU_SUJET.V_SU_GRANDEUR_IMPERIAL%TYPE,
    V_SU_POIDS_METRIQUE    SU_SUJET.V_SU_POIDS_METRIQUE%TYPE,
    V_SU_POIDS_IMPERIAL    SU_SUJET.V_SU_POIDS_IMPERIAL%TYPE,
    C_SU_SYSTEME           SU_SUJET.C_SU_SYSTEME%TYPE,
    I_CC_CLE               SU_SUJET.I_CC_CLE%TYPE,
    V_SU_MOT_PASSE         SU_SUJET.V_SU_MOT_PASSE%TYPE,
    V_SU_REFERENCE_1       SU_SUJET.V_SU_REFERENCE_1%TYPE,
    V_SU_REFERENCE_2       SU_SUJET.V_SU_REFERENCE_2%TYPE,
    V_SU_REFERENCE_3       SU_SUJET.V_SU_REFERENCE_3%TYPE,
    V_SU_CREE_PAR          SU_SUJET.V_SU_CREE_PAR%TYPE,
    D_SU_DATE_CREATION     SU_SUJET.D_SU_DATE_CREATION%TYPE,
    C_SU_SNDX_NOM          SU_SUJET.C_SU_SNDX_NOM%TYPE,
    C_SU_SNDX_PRENOM       SU_SUJET.C_SU_SNDX_PRENOM%TYPE,
    C_SU_SNDX_SURNOM       SU_SUJET.C_SU_SNDX_SURNOM%TYPE,
    I_RO_CLE               RO_ROLE.I_RO_CLE%TYPE,
    L_LDD_CLE              LDD_LIEN_DOSSIER.L_LDD_CLE%TYPE,
    L_LDD_SI_CLE           LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    I_SE_CLE               SE_SEVERITE.I_SE_CLE%TYPE,
    I_SE_CLE_AUTRES        SE_SEVERITE.I_SE_CLE%TYPE,
    V_SU_NO_PASSEPORT      SU_SUJET.V_SU_NO_PASSEPORT%TYPE,
    I_EN_CLE               SI_SITE.I_EN_CLE%TYPE,
    V_SU_ASSURANCE_MALADIE SU_SUJET.V_SU_ASSURANCE_MALADIE%TYPE,
    B_SU_IND_RDD           SU_SUJET.B_SU_IND_RDD%TYPE,
    I_SE_CLE_CASINO        SU_SUJET.I_SE_CLE_CASINO%TYPE,
    D_SU_DATE_FIN_EMPLOI   SU_SUJET.D_SU_DATE_FIN_EMPLOI%TYPE);
  TYPE DTS_SU_SUJET_ROLE IS REF CURSOR RETURN REC_SU_SUJET_ROLE;
  PROCEDURE SP_L_SU_SUJET(NEW_L_SU_CLE IN SU_SUJET.L_SU_CLE%TYPE,
                          NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                          NEW_C_GF_CLE IN GF_GENRE_FICHIER.C_GF_CLE%TYPE,
                          rc1          IN OUT DTS_SU_SUJET_ROLE);

  TYPE REC_RG_REGROUPEMENT IS RECORD(
    I_RG_CLE         RG_REGROUPEMENT.I_RG_CLE%TYPE,
    NOM_REGROUPEMENT TR_TRADUCTION.V_TR_DESCRIPTION%TYPE,
    NAME             RG_REGROUPEMENT.NAME%TYPE,
    I_RG_QUOTA       RG_REGROUPEMENT.I_RG_QUOTA%TYPE,
    I_RG_QUOTA_MIN   RG_REGROUPEMENT.I_RG_QUOTA_MIN%TYPE);
  TYPE DTS_RG_REGROUPEMENT IS REF CURSOR RETURN REC_RG_REGROUPEMENT;
  PROCEDURE SP_RG_REGROUPEMENT(NEW_NAME RG_REGROUPEMENT.NAME%TYPE,
                               rc1      IN OUT DTS_RG_REGROUPEMENT);

  TYPE REC_SU_SUJET_GRP IS RECORD(
    L_SU_CLE            SU_SUJET.L_SU_CLE%TYPE,
    L_SI_CLE            SU_SUJET.L_SI_CLE%TYPE,
    V_SU_PRENOM         SU_SUJET.V_SU_PRENOM%TYPE,
    V_SU_NOM            SU_SUJET.V_SU_NOM%TYPE,
    D_SU_DATE_NAISSANCE SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
    I_CC_CLE            SU_SUJET.I_CC_CLE%TYPE);
  TYPE DTS_SU_SUJET_GRP IS REF CURSOR RETURN REC_SU_SUJET_GRP;

  -- Recherche pour GRP
  procedure SP_L_SU_SUJET_GRP(NEW_V_SU_PRENOM         IN SU_SUJET.V_SU_PRENOM%TYPE,
                              NEW_V_SU_NOM            IN SU_SUJET.V_SU_NOM%TYPE,
                              NEW_D_SU_DATE_NAISSANCE IN SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
                              rc1                     IN OUT DTS_SU_SUJET_GRP);

  TYPE REC_SU_SUJET_JEL IS RECORD(
    NUMERO_FICHE       SU_SUJET.V_SU_REFERENCE_3%TYPE,
    I_PE_CLE           DO_DOSSIER.I_PE_CLE%TYPE,
    D_DO_DATE_FIN      DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_AD_NUM_MUNICIPAL AD_ADRESSE.V_AD_NUM_MUNICIPAL%TYPE,
    V_AD_CODE_POSTAL   AD_ADRESSE.V_AD_CODE_POSTAL%TYPE);
  TYPE DTS_SU_SUJET_JEL IS REF CURSOR RETURN REC_SU_SUJET_JEL;

  -- Recherche Action / JEL / ePoker
  PROCEDURE SP_L_SUJET_EXCLU_JEL(NEW_V_SU_PRENOM         IN SU_SUJET.V_SU_PRENOM%TYPE,
                                 NEW_V_SU_NOM            IN SU_SUJET.V_SU_NOM%TYPE,
                                 NEW_D_SU_DATE_NAISSANCE IN SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
                                 rc1                     OUT DTS_SU_SUJET_JEL);

  TYPE REC_DOSSIER_PREVENTION IS RECORD(
    L_DO_CLE            DO_DOSSIER.L_DO_CLE%TYPE,
    L_DO_SI_CLE         DO_DOSSIER.L_SI_CLE%TYPE,
    D_DO_DATE_FIN       DO_DOSSIER.D_DO_DATE_FIN%TYPE,
    V_DO_NUMERO_DOSSIER DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    L_SU_CLE            SU_SUJET.L_SU_CLE%TYPE,
    L_SU_SI_CLE         SU_SUJET.L_SI_CLE%TYPE,
    V_SU_REFERENCE_3    SU_SUJET.V_SU_REFERENCE_3%TYPE);
  TYPE DTS_DOSSIER_PREVENTION IS REF CURSOR RETURN REC_DOSSIER_PREVENTION;

  PROCEDURE SP_L_DOSSIER_PreventFinContrat(rc1 OUT DTS_DOSSIER_PREVENTION);

  PROCEDURE SP_L_DOSSIER_PreveAideInitiale(rc1 OUT DTS_DOSSIER_PREVENTION);

  PROCEDURE SP_L_SUJET_MouvRechNoEmploye(NUMERO_EMPLOYE SU_SUJET.V_SU_REFERENCE_2%TYPE,
                                         rc1            OUT DTS_SU_SUJET);

  PROCEDURE SP_L_SUJET_MouvRechDNNomPrenom(NEW_V_SU_NOM            SU_SUJET.V_SU_NOM%TYPE,
                                           NEW_V_SU_PRENOM         SU_SUJET.V_SU_PRENOM%TYPE,
                                           NEW_D_SU_DATE_NAISSANCE SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
                                           rc1                     OUT DTS_SU_SUJET);

  PROCEDURE SP_L_DOSSIER_Bonifies(rc1 OUT DTS_DOSSIER_PREVENTION);

  TYPE REC_PERSONNE_PHYSIQUE IS RECORD(
    L_SO_CLE              SO_SOCIETE.L_SO_CLE%TYPE,
    L_DO_SI_CLE           SO_SOCIETE.L_SI_CLE%TYPE,
    V_SO_REFERENCE_NOM    SO_SOCIETE.V_SO_REFERENCE_NOM%TYPE,
    V_SO_REFERENCE_PRENOM SO_SOCIETE.V_SO_REFERENCE_PRENOM%TYPE,
    V_SO_REFERENCE_3      SO_SOCIETE.V_SO_REFERENCE_3%TYPE);
  TYPE DTS_PERSONNE_PHYSIQUE IS REF CURSOR RETURN REC_PERSONNE_PHYSIQUE;

  PROCEDURE SP_L_SO_PERSONNE_PHYSIQUE(rc1 IN OUT DTS_PERSONNE_PHYSIQUE);

  TYPE REC_SOCIETE_MORALE IS RECORD(
    NOM_PM                 SO_SOCIETE.V_SO_NOM%TYPE,
    NOM_REPRESENTANT_PM    SO_SOCIETE.V_SO_REFERENCE_NOM%TYPE,
    PRENOM_REPRESENTANT_PM SO_SOCIETE.V_SO_REFERENCE_PRENOM%TYPE);
  TYPE DTS_SOCIETE_MORALE IS REF CURSOR RETURN REC_SOCIETE_MORALE;

  PROCEDURE SP_L_SO_SOCIETE_MORALE(rc1 IN OUT DTS_SOCIETE_MORALE);

  TYPE REC_SOCIETE_MORALE_LIEE IS RECORD(
    SOURCE  SO_SOCIETE.L_SO_CLE%TYPE,
    LIAISON SO_SOCIETE.L_SO_CLE%TYPE);
  TYPE DTS_SOCIETE_MORALE_LIEE IS REF CURSOR RETURN REC_SOCIETE_MORALE_LIEE;

  PROCEDURE SP_L_SO_SOCIETE_MORALE_LIEE(rc1 IN OUT DTS_SOCIETE_MORALE_LIEE);

  TYPE REC_SU_DATE_FIN_ENQUETE IS RECORD(
    DATE_FIN_ENQUETE VARCHAR(10));
  TYPE DTS_SU_DATE_FIN_ENQUETE IS REF CURSOR RETURN REC_SU_DATE_FIN_ENQUETE;

  TYPE REC_SU_SEVERITE IS RECORD(
    L_SU_CLE              SU_SUJET.L_SU_CLE%TYPE,
    L_SI_CLE              SU_SUJET.L_SI_CLE%TYPE,
    V_SU_REFERENCE_3      SU_SUJET.V_SU_REFERENCE_3%TYPE,    
    SEVERITE              SE_SEVERITE.I_SE_CLE%TYPE,
    V_DO_NUMERO_DOSSIER   DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,    
    SEVERITE_DOSSIER      SE_SEVERITE.I_SE_CLE%TYPE);
  TYPE DTS_SU_SEVERITE IS REF CURSOR RETURN REC_SU_SEVERITE;

  PROCEDURE SP_L_SU_SEVERITE_CASINO(rc1 IN OUT DTS_SU_SEVERITE);
  PROCEDURE SP_L_SU_SEVERITE_AUTRE(rc1 IN OUT DTS_SU_SEVERITE);

  TYPE REC_SO_SEVERITE IS RECORD(
    L_SO_CLE                 SO_SOCIETE.L_SO_CLE%TYPE,
    L_SI_CLE                 SO_SOCIETE.L_SI_CLE%TYPE,
    V_SO_REFERENCE_3         SO_SOCIETE.V_SO_REFERENCE_3%TYPE,
    SEVERITE                 SE_SEVERITE.I_SE_CLE%TYPE,
    V_DO_NUMERO_DOSSIER      DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
    SEVERITE_DOSSIER         SE_SEVERITE.I_SE_CLE%TYPE);
  TYPE DTS_SO_SEVERITE IS REF CURSOR RETURN REC_SO_SEVERITE;

  PROCEDURE SP_L_SO_SEVERITE_CASINO(rc1 IN OUT DTS_SO_SEVERITE);
  PROCEDURE SP_L_SO_SEVERITE_AUTRE(rc1 IN OUT DTS_SO_SEVERITE);

  TYPE REC_DERNIER_DOSSIER IS RECORD(
    I_CA_CLE         DO_DOSSIER.I_CA_CLE%TYPE,
    V_DO_REFERENCE1  DO_DOSSIER.V_DO_REFERENCE1%TYPE,
    V_DO_ANCIENNE_REFERENCE  DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE);
  TYPE DTS_DERNIER_DOSSIER IS REF CURSOR RETURN REC_DERNIER_DOSSIER;
  
  PROCEDURE SP_DERNIER_DOSSIER(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                               NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                               rc1 IN OUT DTS_DERNIER_DOSSIER);

  TYPE REC_DERNIER_ECHANTILLION IS RECORD(
    L_DO_CLE                      DO_DOSSIER.L_DO_CLE%TYPE,
    L_SI_CLE                      DO_DOSSIER.L_SI_CLE%TYPE,
    v_do_ancienne_reference       DO_DOSSIER.v_do_ancienne_reference%TYPE);
  TYPE DTS_DERNIER_ECHANTILLION IS REF CURSOR RETURN REC_DERNIER_ECHANTILLION;
                                 
  PROCEDURE SP_DERNIER_ECHANTILLION(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                               NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                               rc1 IN OUT DTS_DERNIER_ECHANTILLION);

  TYPE REC_ENTITE_LIAISON IS RECORD(
    L_DO_CLE                      LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
    L_SI_CLE                      LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    -- Premiere liaison
    LIAISON1_L_LDD_CLE            LDD_LIEN_DOSSIER.L_LDD_CLE%TYPE,
    LIAISON1_L_LDD_SI_CLE         LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    LIAISON1_C_DO_GENRE           LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
    LIAISON1_L_DO_CLE             LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
    LIAISON1_L_SI_CLE             LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    -- Deuxième liaison
    LIAISON2_L_LDD_CLE            LDD_LIEN_DOSSIER.L_LDD_CLE%TYPE,
    LIAISON2_L_LDD_SI_CLE         LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    LIAISON2_C_DO_GENRE           LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
    LIAISON2_L_DO_CLE             LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
    LIAISON2_L_SI_CLE             LDD_LIEN_DOSSIER.L_SI_CLE%TYPE);
  TYPE DTS_ENTITE_LIAISON IS REF CURSOR RETURN REC_ENTITE_LIAISON;                             
  PROCEDURE SP_L_ENTITE_LIAISON(NEW_L_EN1_CLE IN LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
                            NEW_L_EN1_SI_CLE IN LDD_LIEN_DOSSIER.L_DO_SITE%TYPE,
                            NEW_C_EN1_DO_GENRE IN LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
                            NEW_C_EN1_LDD_GENRE IN LDD_LIEN_DOSSIER.C_LDD_GENRE%TYPE,
                            NEW_L_EN2_CLE IN LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
                            NEW_L_EN2_SI_CLE IN LDD_LIEN_DOSSIER.L_DO_SITE%TYPE,
                            NEW_C_EN2_DO_GENRE IN LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
                            NEW_C_EN2_LDD_GENRE IN LDD_LIEN_DOSSIER.C_LDD_GENRE%TYPE,
                            rc1 IN OUT DTS_ENTITE_LIAISON);
  TYPE REC_DOSSIER_ECHANTILLON_ACTIF IS RECORD(
     CLE              DO_DOSSIER.L_DO_CLE%TYPE,
     SITE             DO_DOSSIER.L_SI_CLE%TYPE,
     REFERENCE        DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE);
  TYPE DTS_DOSSIER_ECHANTILLON_ACTIF IS REF CURSOR RETURN REC_DOSSIER_ECHANTILLON_ACTIF;
PROCEDURE SP_DOSSIER_ECHANTILLON_ACTIF(rc1 IN OUT DTS_DOSSIER_ECHANTILLON_ACTIF);

  TYPE REC_LIAISON IS RECORD(
    L_DO_CLE                      LDD_LIEN_DOSSIER.L_LDD_CLE%TYPE,
    L_SI_CLE                      LDD_LIEN_DOSSIER.L_SI_CLE%TYPE,
    I_RO_CLE                      LDD_LIEN_DOSSIER.I_RO_CLE%TYPE);
  TYPE DTS_LIAISON IS REF CURSOR RETURN REC_LIAISON;   
procedure SP_L_LIAISON(NEW_L_DO_CLE               IN LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
                       NEW_L_DO_SITE              IN LDD_LIEN_DOSSIER.L_DO_SITE%TYPE,
                       NEW_C_DO_GENRE             IN LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
                       NEW_L_LDD_DOSSIER_ASSOCIE  IN LDD_LIEN_DOSSIER.L_LDD_DOSSIER_ASSOCIE%TYPE,
                       NEW_L_LDD_SITE             IN LDD_LIEN_DOSSIER.L_LDD_SITE%TYPE,
                       NEW_C_LDD_GENRE            IN LDD_LIEN_DOSSIER.c_Ldd_Genre%TYPE,
                       rc1 IN OUT DTS_LIAISON);

TYPE REC_SU_GALERIE_ANCIENNE_REF IS RECORD(
  L_SU_CLE                      SU_SUJET.L_SU_CLE%TYPE,
  SU_L_SI_CLE                   SU_SUJET.L_SI_CLE%TYPE,
  L_DO_CLE                      DO_DOSSIER.L_DO_CLE%TYPE, 
  DO_L_SI_CLE                   DO_DOSSIER.L_SI_CLE%TYPE,
  I_NA_CLE                      NA_NATURE.I_NA_CLE%TYPE,
  V_DO_ANCIENNE_REFERENCE       DO_DOSSIER.V_DO_ANCIENNE_REFERENCE%TYPE);
TYPE DTS_SU_GALERIE_ANCIENNE_REF IS REF CURSOR RETURN REC_SU_GALERIE_ANCIENNE_REF; 
procedure SP_L_SU_SI_GALERIE_ACTIF(rc1 IN OUT DTS_SU_GALERIE_ANCIENNE_REF);
procedure SP_L_SU_SI_GALERIE_INACTIF(rc1 IN OUT DTS_SU_GALERIE_ANCIENNE_REF);

END Cardex_Lire_Doc;
/
CREATE OR REPLACE PACKAGE BODY Cardex_Lire_Doc AS
  PROCEDURE SP_L_SO_SOCIETE(rc1 IN OUT DTS_SO_SOCIETE_ENTITE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SO_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_ST_CLE,
             P.I_LS_CLE,
             P.V_SO_RAISON_SOCIALE,
             P.V_SO_NOM,
             P.I_CL_CLE,
             P.D_SO_DATE_FONDATION,
             P.I_CC_CLE,
             P.V_SO_MOT_PASSE,
             P.V_SO_REFERENCE_NOM,
             P.V_SO_REFERENCE_PRENOM,
             P.V_SO_REFERENCE_1,
             P.V_SO_REFERENCE_2,
             P.V_SO_REFERENCE_3,
             P.V_SO_CREE_PAR,
             P.D_SO_DATE_CREATION,
             P.C_SO_SNDX_RAISON_SOCIALE,
             P.C_SO_SNDX_NOM,
             P.I_SE_CLE,
             P.L_SO_CENTRE_REGIONAL,
             P.V_SO_DISTRICT,
             P.V_SO_CODE_COMPTE,
             P.B_SO_ACTIF,
             P.D_SO_DATE_INACTIVATION,
             P.B_SO_IND_RDD,
             P.V_SO_COMMENTAIRE,
             P.V_SO_RAISON_INACTIVATION,
             CR.NOM_CENTREREG,
             CC.NOM_COC,
             D.NOM_DISTRICT,
             P.I_SE_CLE_CASINO,
             P.I_SO_ECHANTILLONAGE
        FROM SO_SOCIETE                 P,
             SI_SITE                    S,
             VEXI_CDX_DDS_CENTRE_REGION CR,
             VEXI_CDX_DDS_CODE_COMPTE   CC,
             VEXI_CDX_DDS_DISTRICT      D
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND (( --P.V_SO_MOT_PASSE IS NULL AND
              NVL(P.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
              Cardex_Special.g_code_confidentialite AND
              P.D_SO_DATE_CREATION >= SYSDATE - 2) OR
             ((P.V_SO_CREE_PAR = Cardex_Special.g_usager) AND
             P.D_SO_DATE_CREATION >= SYSDATE - 2))
         AND P.L_SO_CENTRE_REGIONAL = CR.NO_CENTREREG(+)
         AND P.V_SO_DISTRICT = D.NO_DISTRICT(+)
         AND P.V_SO_CODE_COMPTE = CC.code_cpte_coc(+);
    --order by P.V_SO_NOM;
  END SP_L_SO_SOCIETE;
  PROCEDURE SP_L_SO_SOCIETE(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                            NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                            rc1          IN OUT DTS_SO_SOCIETE_ENTITE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SO_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_ST_CLE,
             P.I_LS_CLE,
             P.V_SO_RAISON_SOCIALE,
             P.V_SO_NOM,
             P.I_CL_CLE,
             P.D_SO_DATE_FONDATION,
             P.I_CC_CLE,
             P.V_SO_MOT_PASSE,
             P.V_SO_REFERENCE_NOM,
             P.V_SO_REFERENCE_PRENOM,
             P.V_SO_REFERENCE_1,
             P.V_SO_REFERENCE_2,
             P.V_SO_REFERENCE_3,
             P.V_SO_CREE_PAR,
             P.D_SO_DATE_CREATION,
             P.C_SO_SNDX_RAISON_SOCIALE,
             P.C_SO_SNDX_NOM,
             P.I_SE_CLE,
             P.L_SO_CENTRE_REGIONAL,
             P.V_SO_DISTRICT,
             P.V_SO_CODE_COMPTE,
             P.B_SO_ACTIF,
             P.D_SO_DATE_INACTIVATION,
             P.B_SO_IND_RDD,
             P.V_SO_COMMENTAIRE,
             P.V_SO_RAISON_INACTIVATION,
             CR.NOM_CENTREREG,
             CC.NOM_COC,
             D.NOM_DISTRICT,
             P.I_SE_CLE_CASINO,
             P.I_SO_ECHANTILLONAGE
        FROM SO_SOCIETE                 P,
             SI_SITE                    S,
             VEXI_CDX_DDS_CENTRE_REGION CR,
             VEXI_CDX_DDS_CODE_COMPTE   CC,
             VEXI_CDX_DDS_DISTRICT      D
       WHERE P.L_SO_CLE = NEW_L_SO_CLE
         AND P.L_SI_CLE = NEW_L_SI_CLE
         AND P.L_SI_CLE = S.L_SI_CLE
         AND P.L_SO_CENTRE_REGIONAL = CR.NO_CENTREREG(+)
         AND P.V_SO_DISTRICT = D.NO_DISTRICT(+)
         AND P.V_SO_CODE_COMPTE = CC.code_cpte_coc(+);
    Cardex_Special.sp_e_ac_acces('S',
                                 'SO',
                                 NEW_L_SO_CLE,
                                 NEW_L_SI_CLE,
                                 'SO',
                                 NEW_L_SO_CLE,
                                 NEW_L_SI_CLE,
                                 'SO',
                                 NEW_L_SO_CLE,
                                 NEW_L_SI_CLE);
  END SP_L_SO_SOCIETE;
  PROCEDURE SP_L_SO_SOCIETE(NEW_L_SO_CLE       IN SO_SOCIETE.L_SO_CLE%TYPE,
                            NEW_L_SI_CLE       IN SO_SOCIETE.L_SI_CLE%TYPE,
                            NEW_V_SO_MOT_PASSE IN SO_SOCIETE.V_SO_MOT_PASSE%TYPE,
                            rc1                IN OUT DTS_SO_SOCIETE_ENTITE) IS
    MDP VARCHAR2(255);
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SO_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_ST_CLE,
             P.I_LS_CLE,
             P.V_SO_RAISON_SOCIALE,
             P.V_SO_NOM,
             P.I_CL_CLE,
             P.D_SO_DATE_FONDATION,
             P.I_CC_CLE,
             P.V_SO_MOT_PASSE,
             P.V_SO_REFERENCE_NOM,
             P.V_SO_REFERENCE_PRENOM,
             P.V_SO_REFERENCE_1,
             P.V_SO_REFERENCE_2,
             P.V_SO_REFERENCE_3,
             P.V_SO_CREE_PAR,
             P.D_SO_DATE_CREATION,
             P.C_SO_SNDX_RAISON_SOCIALE,
             P.C_SO_SNDX_NOM,
             P.I_SE_CLE,
             P.L_SO_CENTRE_REGIONAL,
             P.V_SO_DISTRICT,
             P.V_SO_CODE_COMPTE,
             P.B_SO_ACTIF,
             P.D_SO_DATE_INACTIVATION,
             P.B_SO_IND_RDD,
             P.V_SO_COMMENTAIRE,
             P.V_SO_RAISON_INACTIVATION,
             CR.NOM_CENTREREG,
             CC.NOM_COC,
             D.NOM_DISTRICT,
             P.I_SE_CLE_CASINO,
             P.I_SO_ECHANTILLONAGE
        FROM SO_SOCIETE                 P,
             SI_SITE                    S,
             VEXI_CDX_DDS_CENTRE_REGION CR,
             VEXI_CDX_DDS_CODE_COMPTE   CC,
             VEXI_CDX_DDS_DISTRICT      D
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND P.V_SO_MOT_PASSE = NEW_V_SO_MOT_PASSE
         AND P.L_SO_CLE = NEW_L_SO_CLE
         AND P.L_SI_CLE = NEW_L_SI_CLE
         AND P.L_SO_CENTRE_REGIONAL = CR.NO_CENTREREG(+)
         AND P.V_SO_DISTRICT = D.NO_DISTRICT(+)
         AND P.V_SO_CODE_COMPTE = CC.code_cpte_coc(+);
    Cardex_Special.sp_e_ac_acces('S',
                                 'SO',
                                 NEW_L_SO_CLE,
                                 NEW_L_SI_CLE,
                                 'SO',
                                 NEW_L_SO_CLE,
                                 NEW_L_SI_CLE,
                                 'SO',
                                 NEW_L_SO_CLE,
                                 NEW_L_SI_CLE);
  END SP_L_SO_SOCIETE;
  PROCEDURE SP_L_SO_SOCIETE(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                            NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                            NEW_C_GF_CLE IN GF_GENRE_FICHIER.C_GF_CLE%TYPE,
                            rc1          IN OUT DTS_SO_SOCIETE_ROLE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SO_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_ST_CLE,
             P.I_LS_CLE,
             P.V_SO_RAISON_SOCIALE,
             P.V_SO_NOM,
             P.I_CL_CLE,
             P.D_SO_DATE_FONDATION,
             P.I_CC_CLE,
             P.V_SO_MOT_PASSE,
             P.V_SO_REFERENCE_NOM,
             P.V_SO_REFERENCE_PRENOM,
             P.V_SO_REFERENCE_1,
             P.V_SO_REFERENCE_2,
             P.V_SO_REFERENCE_3,
             P.V_SO_CREE_PAR,
             P.D_SO_DATE_CREATION,
             P.C_SO_SNDX_RAISON_SOCIALE,
             P.C_SO_SNDX_NOM, --Ajout pour sujet et societe
             LDD.I_RO_CLE,
             LDD.L_LDD_CLE,
             LDD.L_SI_CLE,
             P.I_SE_CLE,
             P.L_SO_CENTRE_REGIONAL,
             P.V_SO_DISTRICT,
             P.V_SO_CODE_COMPTE,
             P.B_SO_ACTIF,
             P.D_SO_DATE_INACTIVATION,
             P.B_SO_IND_RDD,
             P.V_SO_COMMENTAIRE,
             P.V_SO_RAISON_INACTIVATION,
             CR.NOM_CENTREREG,
             CC.NOM_COC,
             D.NOM_DISTRICT,
             P.I_SE_CLE_CASINO,
             P.I_SO_ECHANTILLONAGE
        FROM LDD_LIEN_DOSSIER           LDD,
             SO_SOCIETE                 P,
             SI_SITE                    S,
             VEXI_CDX_DDS_CENTRE_REGION CR,
             VEXI_CDX_DDS_CODE_COMPTE   CC,
             VEXI_CDX_DDS_DISTRICT      D
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND ((LDD.L_DO_CLE = P.L_SO_CLE AND LDD.L_DO_SITE = P.L_SI_CLE AND
             LDD.C_DO_GENRE = 'SO' AND
             LDD.L_LDD_DOSSIER_ASSOCIE = NEW_L_SO_CLE AND
             LDD.L_LDD_SITE = NEW_L_SI_CLE AND
             LDD.C_LDD_GENRE = NEW_C_GF_CLE) OR
             (LDD.L_DO_CLE = NEW_L_SO_CLE AND LDD.L_DO_SITE = NEW_L_SI_CLE AND
             LDD.C_DO_GENRE = NEW_C_GF_CLE AND
             LDD.L_LDD_DOSSIER_ASSOCIE = P.L_SO_CLE AND
             LDD.L_LDD_SITE = P.L_SI_CLE AND LDD.C_LDD_GENRE = 'SO'))
         AND ((P.V_SO_CREE_PAR = Cardex_Special.g_usager) OR
             (NVL(P.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
             Cardex_Special.g_code_confidentialite
             --AND P.V_SO_MOT_PASSE IS NULL
             ))
         AND P.L_SO_CENTRE_REGIONAL = CR.NO_CENTREREG(+)
         AND P.V_SO_DISTRICT = D.NO_DISTRICT(+)
         AND P.V_SO_CODE_COMPTE = CC.code_cpte_coc(+);
  END SP_L_SO_SOCIETE;

  PROCEDURE SP_L_VE_VEHICULE(rc1 IN OUT DTS_VE_VEHICULE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_VE_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_MD_CLE,
             P.I_CC_CLE,
             P.V_VE_IMMATRICULATION,
             P.V_VE_PROVINCE,
             P.C_VE_ANNEE,
             P.V_VE_VIGNETTE,
             P.V_VE_NUMERO_SERIE,
             P.V_VE_ASSUREUR,
             P.V_VE_POLICE,
             P.D_VE_EXPIRATION_VIGNETTE,
             P.D_VE_EXPIRATION_POLICE,
             P.V_VE_CREE_PAR,
             P.D_VE_DATE_CREATION,
             P.V_VE_MOT_PASSE,
             M.I_MA_CLE,
             P.V_VE_COMMENTAIRE,
             P.L_PR_CLE
        FROM VE_VEHICULE P, MD_MODELE M, SI_SITE S
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND (M.I_MD_CLE(+) = P.I_MD_CLE)
         AND (( --P.V_VE_MOT_PASSE IS NULL AND
              NVL(P.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
              Cardex_Special.g_code_confidentialite AND
              P.D_VE_DATE_CREATION >= SYSDATE - 2) OR
             ((P.V_VE_CREE_PAR = Cardex_Special.g_usager) AND
             P.D_VE_DATE_CREATION >= SYSDATE - 2));
    --order by P.V_VE_NOM;
  END SP_L_VE_VEHICULE;
  PROCEDURE SP_L_VE_VEHICULE(NEW_L_VE_CLE IN VE_VEHICULE.L_VE_CLE%TYPE,
                             NEW_L_SI_CLE IN VE_VEHICULE.L_SI_CLE%TYPE,
                             rc1          IN OUT DTS_VE_VEHICULE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_VE_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_MD_CLE,
             P.I_CC_CLE,
             P.V_VE_IMMATRICULATION,
             P.V_VE_PROVINCE,
             P.C_VE_ANNEE,
             P.V_VE_VIGNETTE,
             P.V_VE_NUMERO_SERIE,
             P.V_VE_ASSUREUR,
             P.V_VE_POLICE,
             P.D_VE_EXPIRATION_VIGNETTE,
             P.D_VE_EXPIRATION_POLICE,
             P.V_VE_CREE_PAR,
             P.D_VE_DATE_CREATION,
             P.V_VE_MOT_PASSE,
             M.I_MA_CLE,
             P.V_VE_COMMENTAIRE,
             P.L_PR_CLE
        FROM VE_VEHICULE P, MD_MODELE M, SI_SITE S
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND (M.I_MD_CLE(+) = P.I_MD_CLE)
         AND P.L_VE_CLE = NEW_L_VE_CLE
         AND P.L_SI_CLE = NEW_L_SI_CLE;
    Cardex_Special.sp_e_ac_acces('S',
                                 'VE',
                                 NEW_L_VE_CLE,
                                 NEW_L_SI_CLE,
                                 'VE',
                                 NEW_L_VE_CLE,
                                 NEW_L_SI_CLE,
                                 'VE',
                                 NEW_L_VE_CLE,
                                 NEW_L_SI_CLE);
  END SP_L_VE_VEHICULE;

  PROCEDURE SP_L_VE_VEHICULE_DIRECT(NEW_V_VE_IMMATRICULATION IN VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
                                    rc1                      IN OUT DTS_VE_VEHICULE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_VE_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_MD_CLE,
             P.I_CC_CLE,
             P.V_VE_IMMATRICULATION,
             P.V_VE_PROVINCE,
             P.C_VE_ANNEE,
             P.V_VE_VIGNETTE,
             P.V_VE_NUMERO_SERIE,
             P.V_VE_ASSUREUR,
             P.V_VE_POLICE,
             P.D_VE_EXPIRATION_VIGNETTE,
             P.D_VE_EXPIRATION_POLICE,
             P.V_VE_CREE_PAR,
             P.D_VE_DATE_CREATION,
             P.V_VE_MOT_PASSE,
             M.I_MA_CLE,
             P.V_VE_COMMENTAIRE,
             P.L_PR_CLE
        FROM VE_VEHICULE P, MD_MODELE M, SI_SITE S
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND (M.I_MD_CLE(+) = P.I_MD_CLE)
         AND P.V_VE_IMMATRICULATION = NEW_V_VE_IMMATRICULATION;
  END SP_L_VE_VEHICULE_DIRECT;

  PROCEDURE SP_L_VE_VEHICULE(NEW_L_VE_CLE       IN VE_VEHICULE.L_VE_CLE%TYPE,
                             NEW_L_SI_CLE       IN VE_VEHICULE.L_SI_CLE%TYPE,
                             NEW_V_VE_MOT_PASSE IN VE_VEHICULE.V_VE_MOT_PASSE%TYPE,
                             rc1                IN OUT DTS_VE_VEHICULE) IS
    MDP VARCHAR2(255);
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_VE_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_MD_CLE,
             P.I_CC_CLE,
             P.V_VE_IMMATRICULATION,
             P.V_VE_PROVINCE,
             P.C_VE_ANNEE,
             P.V_VE_VIGNETTE,
             P.V_VE_NUMERO_SERIE,
             P.V_VE_ASSUREUR,
             P.V_VE_POLICE,
             P.D_VE_EXPIRATION_VIGNETTE,
             P.D_VE_EXPIRATION_POLICE,
             P.V_VE_CREE_PAR,
             P.D_VE_DATE_CREATION,
             P.V_VE_MOT_PASSE,
             M.I_MA_CLE,
             P.V_VE_COMMENTAIRE,
             P.L_PR_CLE
        FROM VE_VEHICULE P, MD_MODELE M, SI_SITE S
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND (M.I_MD_CLE(+) = P.I_MD_CLE)
         AND P.V_VE_MOT_PASSE = NEW_V_VE_MOT_PASSE
         AND P.L_VE_CLE = NEW_L_VE_CLE
         AND P.L_SI_CLE = NEW_L_SI_CLE;
    Cardex_Special.sp_e_ac_acces('S',
                                 'VE',
                                 NEW_L_VE_CLE,
                                 NEW_L_SI_CLE,
                                 'VE',
                                 NEW_L_VE_CLE,
                                 NEW_L_SI_CLE,
                                 'VE',
                                 NEW_L_VE_CLE,
                                 NEW_L_SI_CLE);
  END SP_L_VE_VEHICULE;
  PROCEDURE SP_L_VE_VEHICULE(NEW_L_VE_CLE IN VE_VEHICULE.L_VE_CLE%TYPE,
                             NEW_L_SI_CLE IN VE_VEHICULE.L_SI_CLE%TYPE,
                             NEW_C_GF_CLE IN GF_GENRE_FICHIER.C_GF_CLE%TYPE,
                             rc1          IN OUT DTS_VE_VEHICULE_ROLE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_VE_CLE,
             P.L_SI_CLE,
             S.I_EN_CLE,
             P.I_MD_CLE,
             P.I_CC_CLE,
             P.V_VE_IMMATRICULATION,
             P.V_VE_PROVINCE,
             P.C_VE_ANNEE,
             P.V_VE_VIGNETTE,
             P.V_VE_NUMERO_SERIE,
             P.V_VE_ASSUREUR,
             P.V_VE_POLICE,
             P.D_VE_EXPIRATION_VIGNETTE,
             P.D_VE_EXPIRATION_POLICE,
             P.V_VE_CREE_PAR,
             P.D_VE_DATE_CREATION,
             P.V_VE_MOT_PASSE,
             M.I_MA_CLE,
             LDD.I_RO_CLE,
             LDD.L_LDD_CLE,
             LDD.L_SI_CLE,
             P.V_VE_COMMENTAIRE,
             P.L_PR_CLE
        FROM LDD_LIEN_DOSSIER LDD, VE_VEHICULE P, MD_MODELE M, SI_SITE S
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND ((LDD.L_DO_CLE = P.L_VE_CLE AND LDD.L_DO_SITE = P.L_SI_CLE AND
             LDD.C_DO_GENRE = 'VE' AND
             LDD.L_LDD_DOSSIER_ASSOCIE = NEW_L_VE_CLE AND
             LDD.L_LDD_SITE = NEW_L_SI_CLE AND
             LDD.C_LDD_GENRE = NEW_C_GF_CLE) OR
             (LDD.L_DO_CLE = NEW_L_VE_CLE AND LDD.L_DO_SITE = NEW_L_SI_CLE AND
             LDD.C_DO_GENRE = NEW_C_GF_CLE AND
             LDD.L_LDD_DOSSIER_ASSOCIE = P.L_VE_CLE AND
             LDD.L_LDD_SITE = P.L_SI_CLE AND LDD.C_LDD_GENRE = 'VE'))
         AND (M.I_MD_CLE = P.I_MD_CLE)
         AND ((P.V_VE_CREE_PAR = Cardex_Special.g_usager) OR
             (NVL(P.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
             Cardex_Special.g_code_confidentialite
             --AND P.V_VE_MOT_PASSE IS NULL
             ));
  END SP_L_VE_VEHICULE;
  PROCEDURE SP_L_VE_VEHICULE(IMMATRICULATION IN VE_VEHICULE.V_VE_IMMATRICULATION%TYPE,
                             MARQUE          IN MD_MODELE.I_MA_CLE%TYPE,
                             MODELE          IN VE_VEHICULE.I_MD_CLE%TYPE,
                             PROVINCE        IN VE_VEHICULE.V_VE_PROVINCE%TYPE,
                             INTERVENANT     IN VE_VEHICULE.V_VE_CREE_PAR%TYPE,
                             PARTA           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTB           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTC           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTD           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             PARTE           IN PT_PARTICULARITE.I_PT_CLE%TYPE,
                             CONFIDENTIALITE IN VE_VEHICULE.I_CC_CLE%TYPE) IS
    LIEN  VARCHAR2(2) := '';
    LIGNE VARCHAR2(255) := '';
  BEGIN
    Pbdbms.PUT_LINE('SELECT VE.L_VE_CLE, VE.L_SI_CLE,VE.I_MD_CLE, VE.I_CC_CLE,VE.V_VE_IMMATRICULATION, ');
    Pbdbms.PUT_LINE('VE.V_VE_PROVINCE,VE.C_VE_ANNEE,VE.V_VE_VIGNETTE,VE.V_VE_NUMERO_SERIE,VE.V_VE_ASSUREUR,  ');
    Pbdbms.PUT_LINE('VE.V_VE_POLICE,VE.D_VE_EXPIRATION_VIGNETTE,VE.D_VE_EXPIRATION_POLICE,VE.V_VE_CREE_PAR,  ');
    Pbdbms.PUT_LINE('VE.D_VE_DATE_CREATION,VE.V_VE_MOT_PASSE,MD.I_MA_CLE ');
    LIGNE := 'FROM VE_VEHICULE VE, MD_MODELE MD ';
    IF PARTA != -1 THEN
      LIGNE := LIGNE || ',LPV_LIEN_PARTICULARITE LPV1 ';
    END IF;
    IF PARTB != -1 THEN
      LIGNE := LIGNE || ',LPV_LIEN_PARTICULARITE LPV2 ';
    END IF;
    IF PARTC != -1 THEN
      LIGNE := LIGNE || ',LPV_LIEN_PARTICULARITE LPV3 ';
    END IF;
    IF PARTD != -1 THEN
      LIGNE := LIGNE || ',LPV_LIEN_PARTICULARITE LPV4 ';
    END IF;
    IF PARTE != -1 THEN
      LIGNE := LIGNE || ',LPV_LIEN_PARTICULARITE LPV5 ';
    END IF;
    Pbdbms.PUT_LINE(LIGNE);
    IF CONFIDENTIALITE != -1 THEN
      Pbdbms.PUT_LINE('WHERE (NVL(VE.I_CC_CLE,' ||
                      Cardex_Special.G_CODE_CONFIDENTIALITE || ') = ' ||
                      CONFIDENTIALITE || ' AND ' ||
                      Cardex_Special.G_CODE_CONFIDENTIALITE || ' >= ' ||
                      CONFIDENTIALITE ||
                      ' AND  VE.V_VE_MOT_PASSE is null)  ');
    ELSE
      Pbdbms.PUT_LINE('WHERE ((NVL(VE.I_CC_CLE,' ||
                      Cardex_Special.G_CODE_CONFIDENTIALITE || ') <= ' ||
                      Cardex_Special.G_CODE_CONFIDENTIALITE ||
                      ' AND VE.V_VE_MOT_PASSE is null) OR VE.V_VE_CREE_PAR = ' ||
                      CHR(39) || Cardex_Special.G_USAGER || CHR(39) || ') ');
    END IF;
    Pbdbms.PUT_LINE(' AND MD.I_MD_CLE (+) = VE.I_MD_CLE ');
    IF INTERVENANT != '*' THEN
      Pbdbms.PUT_LINE(' AND VE.V_VE_CREE_PAR = ' || CHR(39) || INTERVENANT ||
                      CHR(39));
    END IF;
    IF IMMATRICULATION != '*' THEN
      --Changement apporté le 21 juillet 1999 pour permettre l'utilisation de caractères étendues dans la recherche.
      Pbdbms.PUT_LINE(' AND UPPER(VE.V_VE_IMMATRICULATION) LIKE UPPER(' ||
                      CHR(39) || IMMATRICULATION || CHR(39) || ') ');
      --              PBDBMS.PUT_LINE(' AND VE.V_VE_IMMATRICULATION = '||CHR(39)||IMMATRICULATION||CHR(39));
    END IF;
    IF PROVINCE != '*' THEN
      Pbdbms.PUT_LINE(' AND VE.V_VE_PROVINCE = ' || CHR(39) || PROVINCE ||
                      CHR(39));
    END IF;
    IF MODELE != -1 THEN
      Pbdbms.PUT_LINE(' AND VE.I_MD_CLE = ' || MODELE);
    END IF;
    IF PARTA != -1 THEN
      Pbdbms.PUT_LINE('and ( VE.L_VE_CLE = LPV1.L_VE_CLE ) and ( VE.l_si_cle = LPV1.L_LPV_REF_SITE ) and LPV1.I_PT_CLE = ' ||
                      PARTA);
    END IF;
    IF PARTB != -1 THEN
      Pbdbms.PUT_LINE('and ( VE.L_VE_CLE = LPV2.L_VE_CLE ) and ( VE.l_si_cle = LPV2.L_LPV_REF_SITE ) and LPV2.I_PT_CLE = ' ||
                      PARTB);
    END IF;
    IF PARTC != -1 THEN
      Pbdbms.PUT_LINE('and ( VE.L_VE_CLE = LPV3.L_VE_CLE ) and ( VE.l_si_cle = LPV3.L_LPV_REF_SITE ) and LPV3.I_PT_CLE = ' ||
                      PARTC);
    END IF;
    IF PARTD != -1 THEN
      Pbdbms.PUT_LINE('and ( VE.L_VE_CLE = LPV4.L_VE_CLE ) and ( VE.l_si_cle = LPV4.L_LPV_REF_SITE ) and LPV4.I_PT_CLE = ' ||
                      PARTD);
    END IF;
    IF PARTE != -1 THEN
      Pbdbms.PUT_LINE('and ( VE.L_VE_CLE = LPV5.L_VE_CLE ) and ( VE.l_si_cle = LPV5.L_LPV_REF_SITE ) and LPV5.I_PT_CLE = ' ||
                      PARTE);
    END IF;
    IF MARQUE != -1 AND MODELE = -1 THEN
      Pbdbms.PUT_LINE(' AND MD.I_MA_CLE = ' || MARQUE);
    END IF;
  END SP_L_VE_VEHICULE;

  PROCEDURE SP_L_DO_DOSSIER(NEW_L_DO_CLE IN DO_DOSSIER.L_DO_CLE%TYPE,
                            NEW_L_SI_CLE IN DO_DOSSIER.L_SI_CLE%TYPE,
                            rc1          IN OUT DTS_DO_DOSSIER) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_DO_CLE,
             P.L_SI_CLE,
             P.V_DO_NUMERO_DOSSIER,
             P.I_CA_CLE,
             P.I_SE_CLE,
             P.I_CC_CLE,
             P.I_NH_CLE,
             P.I_PE_CLE,
             P.I_ST_CLE,
             P.V_DO_MOT_PASSE,
             P.D_DO_DATE_DEBUT,
             P.D_DO_DATE_FIN,
             P.V_DO_DUREE,
             P.V_DO_ANCIENNE_REFERENCE,
             P.V_DO_REFERENCE_VIDEO,
             P.D_DO_DATE_RAPPORTEE,
             P.I_DO_CLASSE,
             P.I_DO_RACE,
             P.V_DO_LIEU,
             P.I_OR_CLE,
             P.I_CR_CLE,
             P.V_DO_REFERENCE1,
             P.V_DO_REFERENCE2,
             P.V_DO_ASSIGNE_A,
             P.D_DO_DATE_ASSIGNATION,
             P.D_DO_DATE_EVENEMENT,
             P.V_DO_CREE_PAR,
             P.D_DO_DATE_CREATION, --Ajout pour dossier
             C.I_TY_CLE,
             T.I_NA_CLE,
             N.I_GE_CLE,
             GE.I_GE_ENTITE,
             P.V_DO_REFERENCE3,
             P.V_DO_REFERENCE4,
             P.V_DO_REFERENCE5,
             P.C_DO_FONDE,
             P.V_DO_REFERENCE6,
             P.V_DO_REFERENCE7,
             P.I_DO_FONDE,
             P.I_RF_CLE,
             P.B_DO_ENREGISTREMENT_CONSERVE,
             P.B_DO_ENREGISTREMENT_NUMERIQUE,
             P.L_DO_ORIGINE
        FROM DO_DOSSIER   P,
             CA_CATEGORIE C,
             TY_TYPE      T,
             NA_NATURE    N,
             GE_GENRE     GE
       WHERE (C.I_CA_CLE = P.I_CA_CLE AND T.I_TY_CLE = C.I_TY_CLE AND
             N.I_NA_CLE = T.I_NA_CLE AND N.I_GE_CLE = GE.I_GE_CLE)
         AND P.L_DO_CLE = NEW_L_DO_CLE
         AND P.L_SI_CLE = NEW_L_SI_CLE;
    Cardex_Special.sp_e_ac_acces('S',
                                 'DO',
                                 NEW_L_DO_CLE,
                                 NEW_L_SI_CLE,
                                 'DO',
                                 NEW_L_DO_CLE,
                                 NEW_L_SI_CLE,
                                 'DO',
                                 NEW_L_DO_CLE,
                                 NEW_L_SI_CLE);
  END SP_L_DO_DOSSIER;

  PROCEDURE SP_L_DO_DOSSIER_DIRECT(NEW_V_DO_NUMERO_DOSSIER IN DO_DOSSIER.V_DO_NUMERO_DOSSIER%TYPE,
                                   rc1                     IN OUT DTS_DO_DOSSIER) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_DO_CLE,
             P.L_SI_CLE,
             P.V_DO_NUMERO_DOSSIER,
             P.I_CA_CLE,
             P.I_SE_CLE,
             P.I_CC_CLE,
             P.I_NH_CLE,
             P.I_PE_CLE,
             P.I_ST_CLE,
             P.V_DO_MOT_PASSE,
             P.D_DO_DATE_DEBUT,
             P.D_DO_DATE_FIN,
             P.V_DO_DUREE,
             P.V_DO_ANCIENNE_REFERENCE,
             P.V_DO_REFERENCE_VIDEO,
             P.D_DO_DATE_RAPPORTEE,
             P.I_DO_CLASSE,
             P.I_DO_RACE,
             P.V_DO_LIEU,
             P.I_OR_CLE,
             P.I_CR_CLE,
             P.V_DO_REFERENCE1,
             P.V_DO_REFERENCE2,
             P.V_DO_ASSIGNE_A,
             P.D_DO_DATE_ASSIGNATION,
             P.D_DO_DATE_EVENEMENT,
             P.V_DO_CREE_PAR,
             P.D_DO_DATE_CREATION, --Ajout pour dossier
             C.I_TY_CLE,
             T.I_NA_CLE,
             N.I_GE_CLE,
             GE.I_GE_ENTITE,
             P.V_DO_REFERENCE3,
             P.V_DO_REFERENCE4,
             P.V_DO_REFERENCE5,
             P.C_DO_FONDE,
             P.V_DO_REFERENCE6,
             P.V_DO_REFERENCE7,
             P.I_DO_FONDE,
             P.I_RF_CLE,
             P.B_DO_ENREGISTREMENT_CONSERVE,
             P.B_DO_ENREGISTREMENT_NUMERIQUE,
             P.L_DO_ORIGINE
        FROM DO_DOSSIER   P,
             CA_CATEGORIE C,
             TY_TYPE      T,
             NA_NATURE    N,
             GE_GENRE     GE
       WHERE (C.I_CA_CLE = P.I_CA_CLE AND T.I_TY_CLE = C.I_TY_CLE AND
             N.I_NA_CLE = T.I_NA_CLE AND N.I_GE_CLE = GE.I_GE_CLE)
         AND P.V_DO_NUMERO_DOSSIER = NEW_V_DO_NUMERO_DOSSIER;
  END SP_L_DO_DOSSIER_DIRECT;

  PROCEDURE SP_LY_DO_DOSSIER(NEW_V_SU_REFERENCE_3 IN SU_SUJET.V_SU_REFERENCE_3%TYPE,
                             rc1                  IN OUT DTS_DO_DOSSIER) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_DO_CLE,
             P.L_SI_CLE,
             P.V_DO_NUMERO_DOSSIER,
             P.I_CA_CLE,
             P.I_SE_CLE,
             P.I_CC_CLE,
             P.I_NH_CLE,
             P.I_PE_CLE,
             P.I_ST_CLE,
             P.V_DO_MOT_PASSE,
             P.D_DO_DATE_DEBUT,
             P.D_DO_DATE_FIN,
             P.V_DO_DUREE,
             P.V_DO_ANCIENNE_REFERENCE,
             P.V_DO_REFERENCE_VIDEO,
             P.D_DO_DATE_RAPPORTEE,
             P.I_DO_CLASSE,
             P.I_DO_RACE,
             P.V_DO_LIEU,
             P.I_OR_CLE,
             P.I_CR_CLE,
             P.V_DO_REFERENCE1,
             P.V_DO_REFERENCE2,
             P.V_DO_ASSIGNE_A,
             P.D_DO_DATE_ASSIGNATION,
             P.D_DO_DATE_EVENEMENT,
             P.V_DO_CREE_PAR,
             P.D_DO_DATE_CREATION, --Ajout pour dossier
             C.I_TY_CLE,
             T.I_NA_CLE,
             N.I_GE_CLE,
             GE.I_GE_ENTITE,
             P.V_DO_REFERENCE3,
             P.V_DO_REFERENCE4,
             P.V_DO_REFERENCE5,
             P.C_DO_FONDE,
             P.V_DO_REFERENCE6,
             P.V_DO_REFERENCE7,
             P.I_DO_FONDE,
             P.I_RF_CLE,
             P.B_DO_ENREGISTREMENT_CONSERVE,
             P.B_DO_ENREGISTREMENT_NUMERIQUE,
             L_DO_ORIGINE
        FROM LDD_LIEN_DOSSIER LDD,
             DO_DOSSIER       P,
             CA_CATEGORIE     C,
             TY_TYPE          T,
             NA_NATURE        N,
             SU_SUJET         SU,
             GE_GENRE         GE
       WHERE UPPER(SU.V_SU_REFERENCE_3) = UPPER(NEW_V_SU_REFERENCE_3)
         AND ((LDD.L_DO_CLE = P.L_DO_CLE AND LDD.L_DO_SITE = P.L_SI_CLE AND
              LDD.C_DO_GENRE = 'DO' AND
              LDD.L_LDD_DOSSIER_ASSOCIE = SU.L_SU_CLE AND
              LDD.L_LDD_SITE = SU.L_SI_CLE AND LDD.C_LDD_GENRE = 'SU') OR
              (LDD.L_DO_CLE = SU.L_SU_CLE AND LDD.L_DO_SITE = SU.L_SI_CLE AND
              LDD.C_DO_GENRE = 'SU' AND
              LDD.L_LDD_DOSSIER_ASSOCIE = P.L_DO_CLE AND
              LDD.L_LDD_SITE = P.L_SI_CLE AND LDD.C_LDD_GENRE = 'DO'))
         AND (C.I_CA_CLE = P.I_CA_CLE AND T.I_TY_CLE = C.I_TY_CLE AND
              N.I_NA_CLE = T.I_NA_CLE AND N.I_GE_CLE = GE.I_GE_CLE)
         AND ((P.V_DO_ASSIGNE_A = Cardex_Special.g_usager) OR
              ((NOT EXISTS
               (SELECT *
                   FROM LPD_PARTAGE_DOSSIER LPD
                  WHERE LPD.L_LPD_REFERENCE = P.L_DO_CLE
                    AND LPD.L_LPD_REF_SITE = P.L_SI_CLE
                    AND LPD.C_LPD_GENRE = 'RES') AND
               NVL(P.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
               Cardex_Special.g_code_confidentialite AND
               P.V_DO_MOT_PASSE IS NULL AND
               ((SU.V_SU_CREE_PAR = Cardex_Special.g_usager) OR
               (NVL(SU.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
               Cardex_Special.g_code_confidentialite AND
               SU.V_SU_MOT_PASSE IS NULL)))));
  
  END SP_LY_DO_DOSSIER;

  PROCEDURE SP_L_SU_SUJET(rc1 IN OUT DTS_SU_SUJET) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.*
        FROM SU_SUJET P
       WHERE (( --P.V_SU_MOT_PASSE IS NULL AND
              NVL(P.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
              Cardex_Special.g_code_confidentialite AND
              P.D_SU_DATE_CREATION >= SYSDATE - 2) OR
             ((P.V_SU_CREE_PAR = Cardex_Special.g_usager) AND
             P.D_SU_DATE_CREATION >= SYSDATE - 2));
    --order by P.V_SU_NOM;
  END SP_L_SU_SUJET;
  -- Modification le 16 novemnre 2006 pour ramener l'entité du site.
  -- Cette valeur détermine qui peut modifier une fiche sujet (tous les
  -- utilisateurs d'une même entité au lieu d'un même site).
  PROCEDURE SP_L_SU_SUJET(NEW_L_SU_CLE IN SU_SUJET.L_SU_CLE%TYPE,
                          NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                          rc1          IN OUT DTS_SU_SUJET_ENTITE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SU_CLE,
             P.L_SI_CLE,
             P.I_SX_CLE,
             P.I_ST_CLE,
             P.I_NT_CLE,
             P.I_RA_CLE,
             P.I_LS_CLE,
             P.V_SU_NOM,
             P.V_SU_PRENOM,
             P.V_SU_SURNOM,
             P.D_SU_DATE_NAISSANCE,
             P.L_SU_TYPE_AGE,
             P.C_SU_ASSURANCE_SOCIALE,
             P.V_SU_PERMIS_CONDUIRE,
             P.V_SU_GRANDEUR_METRIQUE,
             P.V_SU_GRANDEUR_IMPERIAL,
             P.V_SU_POIDS_METRIQUE,
             P.V_SU_POIDS_IMPERIAL,
             P.C_SU_SYSTEME,
             P.I_CC_CLE,
             P.V_SU_MOT_PASSE,
             P.V_SU_REFERENCE_1,
             P.V_SU_REFERENCE_2,
             P.V_SU_REFERENCE_3,
             P.V_SU_CREE_PAR,
             P.D_SU_DATE_CREATION,
             P.C_SU_SNDX_NOM,
             P.C_SU_SNDX_PRENOM,
             P.C_SU_SNDX_SURNOM,
             P.I_SE_CLE,
             P.I_SE_CLE_AUTRES,
             P.V_SU_NO_PASSEPORT,
             S.I_EN_CLE,
             P.V_SU_ASSURANCE_MALADIE,
             P.B_SU_IND_RDD,
             P.I_SE_CLE_CASINO,
             P.D_SU_DATE_FIN_EMPLOI
        FROM SU_SUJET P, SI_SITE S
       WHERE P.L_SU_CLE = NEW_L_SU_CLE
         AND P.L_SI_CLE = NEW_L_SI_CLE
         AND P.L_SI_CLE = S.L_SI_CLE;
    Cardex_Special.sp_e_ac_acces('S',
                                 'SU',
                                 NEW_L_SU_CLE,
                                 NEW_L_SI_CLE,
                                 'SU',
                                 NEW_L_SU_CLE,
                                 NEW_L_SI_CLE,
                                 'SU',
                                 NEW_L_SU_CLE,
                                 NEW_L_SI_CLE);
  END SP_L_SU_SUJET;
  PROCEDURE SP_L_SU_SUJET(NEW_L_SU_CLE       IN SU_SUJET.L_SU_CLE%TYPE,
                          NEW_L_SI_CLE       IN SU_SUJET.L_SI_CLE%TYPE,
                          NEW_V_SU_MOT_PASSE IN SU_SUJET.V_SU_MOT_PASSE%TYPE,
                          rc1                IN OUT DTS_SU_SUJET_ENTITE) IS
    MDP VARCHAR2(255);
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SU_CLE,
             P.L_SI_CLE,
             P.I_SX_CLE,
             P.I_ST_CLE,
             P.I_NT_CLE,
             P.I_RA_CLE,
             P.I_LS_CLE,
             P.V_SU_NOM,
             P.V_SU_PRENOM,
             P.V_SU_SURNOM,
             P.D_SU_DATE_NAISSANCE,
             P.C_SU_ASSURANCE_SOCIALE,
             P.V_SU_PERMIS_CONDUIRE,
             P.V_SU_GRANDEUR_METRIQUE,
             P.V_SU_GRANDEUR_IMPERIAL,
             P.V_SU_POIDS_METRIQUE,
             P.V_SU_POIDS_IMPERIAL,
             P.C_SU_SYSTEME,
             P.I_CC_CLE,
             P.V_SU_MOT_PASSE,
             P.V_SU_REFERENCE_1,
             P.V_SU_REFERENCE_2,
             P.V_SU_REFERENCE_3,
             P.V_SU_CREE_PAR,
             P.D_SU_DATE_CREATION,
             P.C_SU_SNDX_NOM,
             P.C_SU_SNDX_PRENOM,
             P.C_SU_SNDX_SURNOM,
             P.I_SE_CLE,
             P.I_SE_CLE_AUTRES,
             P.V_SU_NO_PASSEPORT,
             L_SU_TYPE_AGE,
             S.I_EN_CLE,
             P.V_SU_ASSURANCE_MALADIE,
             P.B_SU_IND_RDD,
             P.I_SE_CLE_CASINO,
             P.D_SU_DATE_FIN_EMPLOI
        FROM SU_SUJET P, SI_SITE S
       WHERE P.V_SU_MOT_PASSE = NEW_V_SU_MOT_PASSE
         AND P.L_SU_CLE = NEW_L_SU_CLE
         AND P.L_SI_CLE = NEW_L_SI_CLE
         AND P.L_SI_CLE = S.L_SI_CLE;
    Cardex_Special.sp_e_ac_acces('S',
                                 'SU',
                                 NEW_L_SU_CLE,
                                 NEW_L_SI_CLE,
                                 'SU',
                                 NEW_L_SU_CLE,
                                 NEW_L_SI_CLE,
                                 'SU',
                                 NEW_L_SU_CLE,
                                 NEW_L_SI_CLE);
  END SP_L_SU_SUJET;
  PROCEDURE SP_L_SU_SUJET(NEW_L_SU_CLE IN SU_SUJET.L_SU_CLE%TYPE,
                          NEW_L_SI_CLE IN SU_SUJET.L_SI_CLE%TYPE,
                          NEW_C_GF_CLE IN GF_GENRE_FICHIER.C_GF_CLE%TYPE,
                          rc1          IN OUT DTS_SU_SUJET_ROLE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SU_CLE,
             P.L_SI_CLE,
             P.I_SX_CLE,
             P.I_ST_CLE,
             P.I_NT_CLE,
             P.I_RA_CLE,
             P.I_LS_CLE,
             P.V_SU_NOM,
             P.V_SU_PRENOM,
             P.V_SU_SURNOM,
             P.D_SU_DATE_NAISSANCE,
             P.C_SU_ASSURANCE_SOCIALE,
             P.V_SU_PERMIS_CONDUIRE,
             P.V_SU_GRANDEUR_METRIQUE,
             P.V_SU_GRANDEUR_IMPERIAL,
             P.V_SU_POIDS_METRIQUE,
             P.V_SU_POIDS_IMPERIAL,
             P.C_SU_SYSTEME,
             P.I_CC_CLE,
             P.V_SU_MOT_PASSE,
             P.V_SU_REFERENCE_1,
             P.V_SU_REFERENCE_2,
             P.V_SU_REFERENCE_3,
             P.V_SU_CREE_PAR,
             P.D_SU_DATE_CREATION,
             P.C_SU_SNDX_NOM,
             P.C_SU_SNDX_PRENOM,
             P.C_SU_SNDX_SURNOM, --Ajout pour sujet et societe
             LDD.I_RO_CLE,
             LDD.L_LDD_CLE,
             LDD.L_SI_CLE,
             P.I_SE_CLE,
             P.I_SE_CLE_AUTRES,
             P.V_SU_NO_PASSEPORT,
             P.L_SU_TYPE_AGE,
             S.I_EN_CLE,
             P.V_SU_ASSURANCE_MALADIE,
             P.B_SU_IND_RDD,
             P.I_SE_CLE_CASINO,
             P.D_SU_DATE_FIN_EMPLOI
        FROM LDD_LIEN_DOSSIER LDD, SU_SUJET P, SI_SITE S
       WHERE P.L_SI_CLE = S.L_SI_CLE
         AND ((LDD.L_DO_CLE = P.L_SU_CLE AND LDD.L_DO_SITE = P.L_SI_CLE AND
             LDD.C_DO_GENRE = 'SU' AND
             LDD.L_LDD_DOSSIER_ASSOCIE = NEW_L_SU_CLE AND
             LDD.L_LDD_SITE = NEW_L_SI_CLE AND
             LDD.C_LDD_GENRE = NEW_C_GF_CLE) OR
             (LDD.L_DO_CLE = NEW_L_SU_CLE AND LDD.L_DO_SITE = NEW_L_SI_CLE AND
             LDD.C_DO_GENRE = NEW_C_GF_CLE AND
             LDD.L_LDD_DOSSIER_ASSOCIE = P.L_SU_CLE AND
             LDD.L_LDD_SITE = P.L_SI_CLE AND LDD.C_LDD_GENRE = 'SU'))
         AND ((P.V_SU_CREE_PAR = Cardex_Special.g_usager) OR
             (NVL(P.I_CC_CLE, Cardex_Special.g_code_confidentialite) <=
             Cardex_Special.g_code_confidentialite
             --AND P.V_SU_MOT_PASSE IS NULL
             ));
  END SP_L_SU_SUJET;

  PROCEDURE SP_L_SU_SUJET_DIRECT(NEW_V_SU_REFERENCE_3 IN SU_SUJET.V_SU_REFERENCE_3%TYPE,
                                 rc1                  IN OUT DTS_SU_SUJET_ENTITE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT P.L_SU_CLE,
             P.L_SI_CLE,
             P.I_SX_CLE,
             P.I_ST_CLE,
             P.I_NT_CLE,
             P.I_RA_CLE,
             P.I_LS_CLE,
             P.V_SU_NOM,
             P.V_SU_PRENOM,
             P.V_SU_SURNOM,
             P.D_SU_DATE_NAISSANCE,
             P.L_SU_TYPE_AGE,
             P.C_SU_ASSURANCE_SOCIALE,
             P.V_SU_PERMIS_CONDUIRE,
             P.V_SU_GRANDEUR_METRIQUE,
             P.V_SU_GRANDEUR_IMPERIAL,
             P.V_SU_POIDS_METRIQUE,
             P.V_SU_POIDS_IMPERIAL,
             P.C_SU_SYSTEME,
             P.I_CC_CLE,
             P.V_SU_MOT_PASSE,
             P.V_SU_REFERENCE_1,
             P.V_SU_REFERENCE_2,
             P.V_SU_REFERENCE_3,
             P.V_SU_CREE_PAR,
             P.D_SU_DATE_CREATION,
             P.C_SU_SNDX_NOM,
             P.C_SU_SNDX_PRENOM,
             P.C_SU_SNDX_SURNOM,
             P.I_SE_CLE,
             P.I_SE_CLE_AUTRES,
             P.V_SU_NO_PASSEPORT,
             S.I_EN_CLE,
             P.V_SU_ASSURANCE_MALADIE,
             P.B_SU_IND_RDD,
             P.I_SE_CLE_CASINO,
             P.D_SU_DATE_FIN_EMPLOI
        FROM SU_SUJET P, SI_SITE S
       WHERE P.V_SU_REFERENCE_3 = NEW_V_SU_REFERENCE_3
         AND P.L_SI_CLE = S.L_SI_CLE;
  END SP_L_SU_SUJET_DIRECT;

  PROCEDURE SP_RG_REGROUPEMENT(NEW_NAME RG_REGROUPEMENT.NAME%TYPE,
                               rc1      IN OUT DTS_RG_REGROUPEMENT) IS
  BEGIN
    OPEN rc1 FOR
      SELECT RG.I_RG_CLE,
             TR.V_TR_DESCRIPTION AS NOM_REGROUPEMENT,
             RG.NAME,
             RG.I_RG_QUOTA,
             RG.I_RG_QUOTA_MIN
        FROM RG_REGROUPEMENT RG, TR_TRADUCTION TR
       WHERE RG.I_RG_CLE = TR.L_TR_CLE
         AND RG.NAME = NEW_NAME
         AND TR.I_LA_CLE = Cardex_Special.g_langue;
  END SP_RG_REGROUPEMENT;

  procedure SP_L_SU_SUJET_GRP(NEW_V_SU_PRENOM         IN SU_SUJET.V_SU_PRENOM%TYPE,
                              NEW_V_SU_NOM            IN SU_SUJET.V_SU_NOM%TYPE,
                              NEW_D_SU_DATE_NAISSANCE IN SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
                              rc1                     IN OUT DTS_SU_SUJET_GRP) IS
  BEGIN
    OPEN rc1 FOR
      select su.l_su_cle,
             su.l_si_cle,
             su.v_su_prenom,
             su.v_su_nom,
             su.d_su_date_naissance,
             su.i_cc_cle
        from su_sujet su
       where (((convert(upper(su.v_su_nom), 'US7ASCII') like
             convert(upper('%' || NEW_V_SU_NOM || '%'), 'US7ASCII') and
             convert(upper(su.v_su_prenom), 'US7ASCII') like
             convert(upper('%' || NEW_V_SU_PRENOM || '%'), 'US7ASCII')) or
             (convert(upper(su.v_su_prenom), 'US7ASCII') like
             convert(upper('%' || NEW_V_SU_NOM || '%'), 'US7ASCII') and
             convert(upper(su.v_su_nom), 'US7ASCII') like
             convert(upper('%' || NEW_V_SU_PRENOM || '%'), 'US7ASCII'))) or
             (NEW_D_SU_DATE_NAISSANCE is not null and
             su.d_su_date_naissance = NEW_D_SU_DATE_NAISSANCE))
         and su.i_cc_cle <= 366;
  END SP_L_SU_SUJET_GRP;

  PROCEDURE SP_L_SUJET_EXCLU_JEL(NEW_V_SU_PRENOM         IN SU_SUJET.V_SU_PRENOM%TYPE,
                                 NEW_V_SU_NOM            IN SU_SUJET.V_SU_NOM%TYPE,
                                 NEW_D_SU_DATE_NAISSANCE IN SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
                                 rc1                     OUT DTS_SU_SUJET_JEL) IS
  BEGIN
    OPEN rc1 FOR
      select su.v_su_reference_3,
             do.i_pe_cle,
             do.d_do_date_fin,
             ad.v_ad_num_municipal,
             ad.v_ad_code_postal
        from su_sujet         su,
             do_dossier       do,
             ldd_lien_dossier ldd,
             ad_adresse       ad
       where convert(upper(su.v_su_nom), 'US7ASCII') =
             convert(upper(NEW_V_SU_NOM), 'US7ASCII')
         and convert(upper(su.v_su_prenom), 'US7ASCII') =
             convert(upper(NEW_V_SU_PRENOM), 'US7ASCII')
         and su.d_su_date_naissance = NEW_D_SU_DATE_NAISSANCE
         and do.i_ca_cle = 112
         and ldd.l_do_cle = do.l_do_cle
         and ldd.l_do_site = do.l_si_cle
         and ldd.c_do_genre = 'DO'
         and ldd.l_ldd_dossier_associe = su.l_su_cle
         and ldd.l_ldd_site = su.l_si_cle
         and ldd.c_ldd_genre = 'SU'
         and do.i_st_cle = 359
         and ad.l_ad_reference = su.l_su_cle
         and ad.l_ad_ref_site = su.l_si_cle
         and ad.c_ad_ref_genre = 'SU';
  END SP_L_SUJET_EXCLU_JEL;

  PROCEDURE SP_L_DOSSIER_PreventFinContrat(rc1 OUT DTS_DOSSIER_PREVENTION) IS
  BEGIN
    OPEN rc1 FOR
      select do.L_DO_CLE,
             do.L_SI_CLE,
             do.d_do_date_fin,
             do.V_DO_NUMERO_DOSSIER,
             su.L_SU_CLE,
             su.L_SI_CLE,
             su.V_SU_REFERENCE_3
        from V_DO_DOSSIER_CA_TY do, LDD_LIEN_DOSSIER ldd, SU_SUJET su
       where LDD.L_DO_CLE = do.l_do_cle
         AND LDD.L_DO_SITE = do.L_SI_CLE
         AND LDD.C_DO_GENRE = 'DO'
         AND LDD.L_LDD_DOSSIER_ASSOCIE = su.L_SU_CLE
         AND LDD.L_LDD_SITE = su.L_SI_CLE
         AND LDD.C_LDD_GENRE = 'SU'
         and do.i_na_cle = 416
         and do.i_st_cle = 359
         and (do.i_PE_cle = 22950 or do.i_pe_cle = 477)
         and do.i_cc_cle <> 14920
         and (((trunc(do.d_do_date_debut) <> trunc(sysdate) and
             trunc(do.d_do_date_fin) = trunc(sysdate + 61)) or
             (trunc(do.d_do_date_debut) = trunc(sysdate - 1) and
             trunc(do.d_do_date_fin) < trunc(sysdate + 61))));
  END SP_L_DOSSIER_PreventFinContrat;

  PROCEDURE SP_L_DOSSIER_PreveAideInitiale(rc1 OUT DTS_DOSSIER_PREVENTION) IS
  BEGIN
    OPEN rc1 FOR
      select distinct d.L_DO_CLE,
                      d.L_SI_CLE,
                      d.d_do_date_fin,
                      d.V_DO_NUMERO_DOSSIER,
                      s.L_SU_CLE,
                      s.L_SI_CLE,
                      s.V_SU_REFERENCE_3
        from V_DO_DOSSIER_CA_TY d, is_inscription i, SU_SUJET s
       where (s.L_SI_CLE, s.l_su_cle) in
             (select ldd.L_LDD_SITE, ldd.L_LDD_DOSSIER_ASSOCIE
                from ldd_lien_dossier ldd
               where LDD.L_DO_CLE = d.l_do_cle
                 AND LDD.L_DO_SITE = d.l_si_cle
                 AND LDD.C_DO_GENRE = 'DO'
                 AND LDD.L_LDD_DOSSIER_ASSOCIE = s.l_su_cle
                 AND LDD.L_LDD_SITE = s.l_si_cle
                 AND LDD.C_LDD_GENRE = 'SU')
         and d.L_DO_CLE = i.l_is_reference
         and d.i_na_cle = 416
         and d.L_si_cle = i.l_is_ref_site
         and i.B_IS_AIDE_INITIALE = 'yes'
         and i.d_is_courriel_aide is null
         and (d.i_PE_cle = 22950 or d.i_pe_cle = 477)
         and d.i_cc_cle <> 14920
         and i.i_st_cle = 359;
  END SP_L_DOSSIER_PreveAideInitiale;

  PROCEDURE SP_L_SUJET_MouvRechNoEmploye(NUMERO_EMPLOYE SU_SUJET.V_SU_REFERENCE_2%TYPE,
                                         rc1            OUT DTS_SU_SUJET) is
  begin
    OPEN rc1 FOR
      SELECT S.*
        FROM SU_SUJET S
       WHERE UPPER(S.V_SU_REFERENCE_2) = NUMERO_EMPLOYE
         and S.L_SI_CLE = 30;
  END SP_L_SUJET_MouvRechNoEmploye;

  PROCEDURE SP_L_SUJET_MouvRechDNNomPrenom(NEW_V_SU_NOM            SU_SUJET.V_SU_NOM%TYPE,
                                           NEW_V_SU_PRENOM         SU_SUJET.V_SU_PRENOM%TYPE,
                                           NEW_D_SU_DATE_NAISSANCE SU_SUJET.D_SU_DATE_NAISSANCE%TYPE,
                                           rc1                     OUT DTS_SU_SUJET) is
  begin
    OPEN rc1 FOR
      SELECT S.*
        FROM SU_SUJET S
       WHERE S.D_SU_DATE_NAISSANCE = NEW_D_SU_DATE_NAISSANCE
         AND convert(upper(S.V_SU_NOM), 'US7ASCII') = NEW_V_SU_NOM
         AND convert(upper(S.V_SU_PRENOM), 'US7ASCII') = NEW_V_SU_PRENOM
         and S.L_SI_CLE = 30
         AND S.V_SU_REFERENCE_2 is null;
  END SP_L_SUJET_MouvRechDNNomPrenom;

  --Recherche des contrats bonifiés dont la confidentialité n'est pas à "C"
  PROCEDURE SP_L_DOSSIER_Bonifies(rc1 OUT DTS_DOSSIER_PREVENTION) IS
  BEGIN
    OPEN rc1 FOR
      select do.L_DO_CLE,
             do.L_SI_CLE,
             do.d_do_date_fin,
             do.V_DO_NUMERO_DOSSIER,
             su.L_SU_CLE,
             su.L_SI_CLE,
             su.V_SU_REFERENCE_3
        from V_DO_DOSSIER_CA_TY do, LDD_LIEN_DOSSIER ldd, SU_SUJET su
       where LDD.L_DO_CLE = do.l_do_cle
         AND LDD.L_DO_SITE = do.L_SI_CLE
         AND LDD.C_DO_GENRE = 'DO'
         AND LDD.L_LDD_DOSSIER_ASSOCIE = su.L_SU_CLE
         AND LDD.L_LDD_SITE = su.L_SI_CLE
         AND LDD.C_LDD_GENRE = 'SU'
         and do.i_na_cle = 416
         and do.i_st_cle = 359
         and (do.i_PE_cle = 22950 or do.i_pe_cle = 477)
         and do.i_cc_cle <> 14920
         and (do.i_cc_cle <> 307 or su.i_cc_cle <> 307);
  END SP_L_DOSSIER_Bonifies;

  --Recherche des détaillants RDD qui ne sont pas des sociétés dans Cardex
  --Les détaillants trouvés seront ensuite ajoutés dans Cardex dans la
  --tâche CDX00_00013.
  PROCEDURE SP_L_SO_RDD(rc1 IN OUT DTS_SO_SOCIETE_ENTITE) IS
  BEGIN
    OPEN rc1 FOR
      SELECT distinct 0 as "L_SO_CLE",
                      8 as "L_SI_CLE", --(Loto-Québec)
                      3 as "I_EN_CLE",
                      18973 as "I_ST_CLE", --(statut Régulier),
                      decode(convert(upper(v.LANG_ECRIT), 'US7ASCII'),
                             '',
                             null,
                             'FRANCAIS',
                             410,
                             'ANGLAIS',
                             411,
                             412) as "I_LS_CLE",
                      v.NOM_CC as "V_SO_RAISON_SOCIALE",
                      v.NOM_DETAILLANT || ' ' || v.NO_SUCC_DV as "V_SO_NOM",
                      18971 as "I_CL_CLE", --(Détaillant Loto-Québec)
                      null as "D_SO_DATE_FONDATION",
                      307 as "I_CC_CLE", --(Confidentialité C)
                      '' as "V_SO_MOT_PASSE",
                      v.NOM_REPRESENTANT_PM as "V_SO_REFERENCE_NOM",
                      v.PRENOM_REPRESENTANT_PM as "V_SO_REFERENCE_PRENOM",
                      upper(decode(v.REGION_ADM_SECT_DIV_DESC,
                                   '02 Saguenay-Lac-St-Jean',
                                   '02 Saguenay',
                                   '12 Chaudière-Appalaches',
                                   '12 Appalaches',
                                   substr(v.REGION_ADM_SECT_DIV_DESC, 1, 20))) as "V_SO_REFERENCE_1",
                      '' as "V_SO_REFERENCE_2",
                      v.NO_DETAILLANT as "V_SO_REFERENCE_3",
                      'CARDEX' as "V_SO_CREE_PAR",
                      sysdate as "D_SO_DATE_CREATION",
                      '' as "C_SO_SNDX_RAISON_SOCIALE",
                      '' as "C_SO_SNDX_NOM",
                      null as "I_SE_CLE",
                      v.NO_CENTREREG as "L_SO_CENTRE_REGIONAL",
                      v.NO_DISTRICT as "V_SO_DISTRICT",
                      v.CODE_CPTE_COC as "V_SO_CODE_COMPTE",
                      decode(v.STATUT_ANNULATION, '', 'yes', 'no ') as "B_SO_ACTIF",
                      v.DATE_ANNUL_NO_DET as "D_SO_DATE_INACTIVATION",
                      'yes' as "B_SO_IND_RDD",
                      '' as "V_SO_COMMENTAIRE",
                      v.RAISON_ANNULATION as "V_SO_RAISON_INACTIVATION",
                      '' as "NOM_CENTREREG",
                      '' as "NOM_COC",
                      '' AS "NOM_DISTRICT",
                      NULL AS "I_SE_CLE_CASINO",
                      NULL AS "I_SO_ECHANTILLONAGE"
        FROM VEXI_CDX_DDS_DETAILLANT V
       WHERE length(nvl(v.NOM_REPRESENTANT_PM, ' ')) <= 20
         and length(nvl(v.PRENOM_REPRESENTANT_PM, ' ')) <= 20
         and NOT EXISTS (SELECT S.V_SO_REFERENCE_3
                FROM SO_SOCIETE S
               WHERE S.V_SO_REFERENCE_3 = V.NO_DETAILLANT
                 and S.L_SI_CLE = 8
                 and s.i_cc_cle <> 14920);
  END SP_L_SO_RDD;

  --Recherche des sociétés dont le sujet responsable lié est différent de celui de RDD (personne physique).
  --S'il y a un rôle responsable ou
  --Si le sujet n'existe pas, on l'ajoute.
  PROCEDURE SP_L_SO_PERSONNE_PHYSIQUE(rc1 IN OUT DTS_PERSONNE_PHYSIQUE) IS
  BEGIN
    OPEN rc1 FOR
      select so.l_so_cle,
             so.l_si_cle,
             trim(v.NOM_PP) as "V_SO_REFERENCE_NOM",
             trim(v.PRENOM_PP) as "V_SO_REFERENCE_PRENOM",
             so.v_so_reference_3
        from so_societe              so,
             vexi_cdx_dds_detaillant v,
             ldd_lien_dossier        l,
             su_sujet                su
       where so.v_so_reference_3 = v.NO_DETAILLANT
         and v.NOM_PP is not null
         and v.PRENOM_PP is not null
         and so.l_si_cle = 8
         and su.l_su_cle = l.l_do_cle
         and su.l_si_cle = l.l_do_site
         and l.c_do_genre = 'SU'
         and l.l_ldd_dossier_associe = so.l_so_cle
         and l.l_ldd_site = so.l_si_cle
         and l.c_ldd_genre = 'SO'
         and (trim(su.v_su_nom) <> trim(v.NOM_PP) or trim(su.v_su_prenom) <> trim(v.PRENOM_PP))
         and l.i_ro_cle = 659
         and not exists (select su2.v_su_nom, su2.v_su_prenom
                from ldd_lien_dossier l2, su_sujet su2
               where su2.l_su_cle = l2.l_do_cle
                 and su2.l_si_cle = l2.l_do_site
                 and l2.c_do_genre = 'SU'
                 and l2.l_ldd_dossier_associe = so.l_so_cle
                 and l2.l_ldd_site = so.l_si_cle
                 and l2.c_ldd_genre = 'SO'
                 and trim(su2.v_su_nom) = trim(v.NOM_PP)
                 and trim(su2.v_su_prenom) = trim(v.PRENOM_PP))
      union
      select so.l_so_cle,
             so.l_si_cle,
             trim(v.NOM_PP) as "V_SO_REFERENCE_NOM",
             trim(v.PRENOM_PP) as "V_SO_REFERENCE_PRENOM",
             so.v_so_reference_3
        from so_societe so, vexi_cdx_dds_detaillant v
       where so.v_so_reference_3 = v.NO_DETAILLANT
         and v.NOM_PP is not null
         and v.PRENOM_PP is not null
         and so.l_si_cle = 8
         and not exists
       (select l.l_ldd_dossier_associe
                from ldd_lien_dossier l, su_sujet su
               where su.l_su_cle = l.l_do_cle
                 and su.l_si_cle = l.l_do_site
                 and l.c_do_genre = 'SU'
                 and l.l_ldd_dossier_associe = so.l_so_cle
                 and l.l_ldd_site = so.l_si_cle
                 and l.c_ldd_genre = 'SO'
                 and (trim(su.v_su_nom) = trim(v.NOM_PP) or trim(su.v_su_prenom) = trim(v.PRENOM_PP)));
  END SP_L_SO_PERSONNE_PHYSIQUE;

  --Procédure pour lire les sociétés responsables provenant de RDD (personne morale)
  --qui n'existent pas dans Cardex
  procedure SP_L_SO_SOCIETE_MORALE(rc1 IN OUT DTS_SOCIETE_MORALE) IS
  BEGIN
    OPEN rc1 FOR
      select distinct trim(substr(v.NOM_PM, 1, 49)) as "NOM_PM",
                      v.NOM_REPRESENTANT_PM,
                      v.PRENOM_REPRESENTANT_PM
        from vexi_cdx_dds_detaillant v
       where length(v.NOM_REPRESENTANT_PM) <= 20
         and length(v.PRENOM_REPRESENTANT_PM) <= 20
         and trim(substr(v.NOM_PM, 1, 49)) not in
             (select so.v_so_nom
                from so_societe so
               where so.l_si_cle = 8
                 and so.b_so_ind_rdd = 'yes')
         and v.MOR_DATE_DEBUT_ACTV_RP =
             (select max(v2.MOR_DATE_DEBUT_ACTV_RP)
                from vexi_cdx_dds_detaillant v2
               where v.NOM_PM = v2.NOM_PM);
  END SP_L_SO_SOCIETE_MORALE;

  --Procédure pour lire les détaillants dont la société responsable liée ne correspond pas
  --à celles de RDD ou qui n'ont pas de société responsable liée
  procedure SP_L_SO_SOCIETE_MORALE_LIEE(rc1 IN OUT DTS_SOCIETE_MORALE_LIEE) IS
  BEGIN
    OPEN rc1 FOR
      select s.l_so_cle as "SOURCE", s2.l_so_cle as "LIAISON"
        from so_societe              s,
             so_societe              s2,
             vexi_cdx_dds_detaillant v,
             ldd_lien_dossier        l
       where s.v_so_reference_3 = v.NO_DETAILLANT
         and s.l_si_cle = 8
         and s.b_so_ind_rdd = 'yes'
         and s2.l_si_cle = 8
         and s2.b_so_ind_rdd = 'yes'
         and s2.v_so_reference_3 is null
         and s.l_so_cle = l.l_do_cle
         and s.l_si_cle = l.l_do_site
         and l.c_do_genre = 'SO'
         and s2.l_so_cle = l.l_ldd_dossier_associe
         and s2.l_si_cle = l.l_ldd_site
         and l.c_ldd_genre = 'SO'
         and nvl(s2.v_so_nom, ' ') <> v.NOM_PM
         and not exists (select l2.l_ldd_cle
                from ldd_lien_dossier l2
               where s.l_so_cle = l2.l_do_cle
                 and s.l_si_cle = l2.l_do_site
                 and l2.c_do_genre = 'SO'
                 and s2.l_so_cle = l2.l_ldd_dossier_associe
                 and s2.l_si_cle = l2.l_ldd_site
                 and l2.c_ldd_genre = 'SO'
                 and s2.l_si_cle = 8
                 and s2.b_so_ind_rdd = 'yes'
                 and s2.v_so_reference_3 is null)
      union
      select s.l_so_cle as "SOURCE", s4.l_so_cle as "LIAISON"
        from so_societe s, vexi_cdx_dds_detaillant v, so_societe s4
       where v.NOM_PM is not null
         and s.v_so_reference_3 = v.NO_DETAILLANT
         and s4.v_so_reference_3 is null
         and not exists (select l3.l_ldd_cle
                from ldd_lien_dossier l3
               where s.l_so_cle = l3.l_do_cle
                 and s.l_si_cle = l3.l_do_site
                 and l3.c_do_genre = 'SO'
                 and s4.l_so_cle = l3.l_ldd_dossier_associe
                 and s4.l_si_cle = l3.l_ldd_site
                 and l3.c_ldd_genre = 'SO')
         and s.l_si_cle = 8
         and s.b_so_ind_rdd = 'yes'
         and s4.l_si_cle = 8
         and s4.b_so_ind_rdd = 'yes'
         and s4.v_so_nom = v.NOM_PM
         and s.l_so_cle <> s4.l_so_cle;
  END SP_L_SO_SOCIETE_MORALE_LIEE;

  --Procédure pour lire les sujets d'habilitation sécuritaire
  --dont la sévérité SQ/RACJ doit être changée.
  PROCEDURE SP_L_SU_SEVERITE_CASINO(rc1 IN OUT DTS_SU_SEVERITE) IS
  BEGIN
    OPEN rc1 FOR
      select distinct s.l_su_cle,
                      s.l_si_cle,
                      s.v_su_reference_3 as "NumeroFiche",
                      s.i_se_cle_casino AS "SEVERITE",
                      d2.v_do_numero_dossier as "NumeroCardex",
                      d2.i_se_cle AS "SEVERITE_DOSSIER"
        from su_sujet             s,
             ldd_lien_dossier     l2,
             do_dossier           d2,
             is_inscription       i2,
             sis_site_inscription sis2
       where d2.l_do_cle = l2.l_do_cle
         and d2.l_si_cle = l2.l_do_site
         and l2.c_do_genre = 'DO'
         and l2.l_ldd_dossier_associe = s.l_su_cle
         and l2.l_ldd_site = s.l_si_cle
         and l2.c_ldd_genre = 'SU'
         and (d2.l_si_cle = 30 or d2.l_si_cle = 11)
         and d2.l_do_cle = i2.l_is_reference
         and d2.l_si_cle = i2.l_is_ref_site
         and i2.l_is_cle = sis2.l_is_cle
         and i2.l_si_cle = sis2.l_si_cle
         and sis2.l_is_site in (45, 46, 17, 19, 18, 49, 53, 15, 22)
         --Exclusion du rôle Demandeur
         and l2.i_ro_cle not in
             (996, 988, 968, 967, 969, 945, 959, 995, 960, 961, 958, 957, 962, 963, 948, 891, 878, 930, 904, 956, 965, 964, 966, 917, 348)
         and i2.d_is_date_creation =
             (select max(imax2.d_is_date_creation)
                from is_inscription imax2
               where d2.l_do_cle = imax2.l_is_reference
                 and d2.l_si_cle = imax2.l_is_ref_site)
         and d2.l_do_cle =
             (select max(d4.l_do_cle)
                from do_dossier           d4,
                     ldd_lien_dossier     l4,
                     is_inscription       i4,
                     sis_site_inscription sis4
               where d4.l_do_cle = l4.l_do_cle
                 and d4.l_si_cle = l4.l_do_site
                 and l4.c_do_genre = 'DO'
                 and l4.l_ldd_dossier_associe = s.l_su_cle
                 and l4.l_ldd_site = s.l_si_cle
                 and l4.c_ldd_genre = 'SU'
                 and (d4.l_si_cle = 30 or d4.l_si_cle = 11)
                 and d4.l_do_cle = i4.l_is_reference
                 and d4.l_si_cle = i4.l_is_ref_site
                 and i4.l_is_cle = sis4.l_is_cle
                 and i4.l_si_cle = sis4.l_si_cle
                 and l4.i_ro_cle not in
                     (996, 988, 968, 967, 969, 945, 959, 995, 960, 961, 958, 957, 962, 963, 948, 891, 878, 930, 904, 956, 965, 964, 966, 917, 348)
                 and sis4.l_is_site in (45, 46, 17, 19, 18, 49, 53, 15, 22))
         and nvl(s.i_se_cle_casino, 1) <> d2.i_se_cle;
  END SP_L_SU_SEVERITE_CASINO;

  --Procédure pour lire les sujets d'habilitation sécuritaire
  --dont la sévérité Autre doit être changée.
  PROCEDURE SP_L_SU_SEVERITE_AUTRE(rc1 IN OUT DTS_SU_SEVERITE) IS
  BEGIN
    OPEN rc1 FOR
      select distinct s.l_su_cle,
                      s.l_si_cle,
                      s.v_su_reference_3 as "NumeroFiche",
                      s.i_se_cle AS "SEVERITE",
                      d2.v_do_numero_dossier as "NumeroCardex",
                      d2.i_se_cle AS "SEVERITE_DOSSIER"
        from su_sujet             s,
             ldd_lien_dossier     l2,
             do_dossier           d2,
             is_inscription       i2,
             sis_site_inscription sis2
       where d2.l_do_cle = l2.l_do_cle
         and d2.l_si_cle = l2.l_do_site
         and l2.c_do_genre = 'DO'
         and l2.l_ldd_dossier_associe = s.l_su_cle
         and l2.l_ldd_site = s.l_si_cle
         and l2.c_ldd_genre = 'SU'
         and (d2.l_si_cle = 30 or d2.l_si_cle = 11)
         and d2.l_do_cle = i2.l_is_reference
         and d2.l_si_cle = i2.l_is_ref_site
         and i2.l_is_cle = sis2.l_is_cle
         and i2.l_si_cle = sis2.l_si_cle
         and sis2.l_is_site in (76, 13, 74, 20, 16, 21)
         --Exclusion du rôle Demandeur
         and l2.i_ro_cle not in
             (996, 988, 968, 967, 969, 945, 959, 995, 960, 961, 958, 957, 962, 963, 948, 891, 878, 930, 904, 956, 965, 964, 966, 917, 348)
         and i2.d_is_date_creation =
             (select max(imax2.d_is_date_creation)
                from is_inscription imax2
               where d2.l_do_cle = imax2.l_is_reference
                 and d2.l_si_cle = imax2.l_is_ref_site)
         and d2.l_do_cle =
             (select max(d4.l_do_cle)
                from do_dossier           d4,
                     ldd_lien_dossier     l4,
                     is_inscription       i4,
                     sis_site_inscription sis4
               where d4.l_do_cle = l4.l_do_cle
                 and d4.l_si_cle = l4.l_do_site
                 and l4.c_do_genre = 'DO'
                 and l4.l_ldd_dossier_associe = s.l_su_cle
                 and l4.l_ldd_site = s.l_si_cle
                 and l4.c_ldd_genre = 'SU'
                 and (d4.l_si_cle = 30 or d4.l_si_cle = 11)
                 and d4.l_do_cle = i4.l_is_reference
                 and d4.l_si_cle = i4.l_is_ref_site
                 and i4.l_is_cle = sis4.l_is_cle
                 and i4.l_si_cle = sis4.l_si_cle
                --Exclusion du rôle Demandeur
                 and l4.i_ro_cle not in
                     (996, 988, 968, 967, 969, 945, 959, 995, 960, 961, 958, 957, 962, 963, 948, 891, 878, 930, 904, 956, 965, 964, 966, 917, 348)
                 and sis4.l_is_site in (76, 13, 74, 20, 16, 21))
         and nvl(s.i_se_cle, 1) <> d2.i_se_cle;
  END SP_L_SU_SEVERITE_AUTRE;

  --Procédure pour lire les sociétés d'habilitation sécuritaire
  --dont la sévérité SQ/RACJ doit être changée.
  PROCEDURE SP_L_SO_SEVERITE_CASINO(rc1 IN OUT DTS_SO_SEVERITE) IS
  BEGIN
    OPEN rc1 FOR
      select distinct s.l_so_cle,
                      s.l_si_cle,
                      s.v_so_reference_3 as "NumeroFiche",                      
                      s.i_se_cle_casino AS "SEVERITE",
                      d2.v_do_numero_dossier as "NumeroCardex",
                      d2.i_se_cle AS "SEVERITE_DOSSIER"
        from so_societe           s,
             ldd_lien_dossier     l2,
             do_dossier           d2,
             is_inscription       i2,
             sis_site_inscription sis2
       where d2.l_do_cle = l2.l_do_cle
         and d2.l_si_cle = l2.l_do_site
         and l2.c_do_genre = 'DO'
         and l2.l_ldd_dossier_associe = s.l_so_cle
         and l2.l_ldd_site = s.l_si_cle
         and l2.c_ldd_genre = 'SO'
         and (d2.l_si_cle = 30 or d2.l_si_cle = 11)
         and d2.l_do_cle = i2.l_is_reference
         and d2.l_si_cle = i2.l_is_ref_site
         and i2.l_is_cle = sis2.l_is_cle
         and i2.l_si_cle = sis2.l_si_cle
         and sis2.l_is_site in (45, 46, 17, 19, 18, 49, 53, 15, 22)
         and i2.d_is_date_creation =
             (select max(imax2.d_is_date_creation)
                from is_inscription imax2
               where d2.l_do_cle = imax2.l_is_reference
                 and d2.l_si_cle = imax2.l_is_ref_site)
         and d2.l_do_cle =
             (select max(d4.l_do_cle)
                from do_dossier           d4,
                     ldd_lien_dossier     l4,
                     is_inscription       i4,
                     sis_site_inscription sis4
               where d4.l_do_cle = l4.l_do_cle
                 and d4.l_si_cle = l4.l_do_site
                 and l4.c_do_genre = 'DO'
                 and l4.l_ldd_dossier_associe = s.l_so_cle
                 and l4.l_ldd_site = s.l_si_cle
                 and l4.c_ldd_genre = 'SO'
                 and (d4.l_si_cle = 30 or d4.l_si_cle = 11)
                 and d4.l_do_cle = i4.l_is_reference
                 and d4.l_si_cle = i4.l_is_ref_site
                 and i4.l_is_cle = sis4.l_is_cle
                 and i4.l_si_cle = sis4.l_si_cle
                 and sis4.l_is_site in (45, 46, 17, 19, 18, 49, 53, 15, 22))
         and nvl(s.i_se_cle_casino, 1) <> d2.i_se_cle;
  END SP_L_SO_SEVERITE_CASINO;

  --Procédure pour lire les sociétés d'habilitation sécuritaire
  --dont la sévérité Autre doit être changée.
  PROCEDURE SP_L_SO_SEVERITE_AUTRE(rc1 IN OUT DTS_SO_SEVERITE) IS
  BEGIN
    OPEN rc1 FOR
      select distinct s.l_so_cle,
                      s.l_si_cle,
                      s.v_so_reference_3 as "NumeroFiche",                      
                      s.i_se_cle AS "SEVERITE",
                      d2.v_do_numero_dossier as "NumeroCardex",
                      d2.i_se_cle AS "SEVERITE_DOSSIER"
        from so_societe           s,
             ldd_lien_dossier     l2,
             do_dossier           d2,
             is_inscription       i2,
             sis_site_inscription sis2
       where d2.l_do_cle = l2.l_do_cle
         and d2.l_si_cle = l2.l_do_site
         and l2.c_do_genre = 'DO'
         and l2.l_ldd_dossier_associe = s.l_so_cle
         and l2.l_ldd_site = s.l_si_cle
         and l2.c_ldd_genre = 'SO'
         and (d2.l_si_cle = 30 or d2.l_si_cle = 11)
         and d2.l_do_cle = i2.l_is_reference
         and d2.l_si_cle = i2.l_is_ref_site
         and i2.l_is_cle = sis2.l_is_cle
         and i2.l_si_cle = sis2.l_si_cle
         and sis2.l_is_site in (76, 13, 74, 20, 16, 21)
         and i2.d_is_date_creation =
             (select max(imax2.d_is_date_creation)
                from is_inscription imax2
               where d2.l_do_cle = imax2.l_is_reference
                 and d2.l_si_cle = imax2.l_is_ref_site)
         and d2.l_do_cle =
             (select max(d4.l_do_cle)
                from do_dossier           d4,
                     ldd_lien_dossier     l4,
                     is_inscription       i4,
                     sis_site_inscription sis4
               where d4.l_do_cle = l4.l_do_cle
                 and d4.l_si_cle = l4.l_do_site
                 and l4.c_do_genre = 'DO'
                 and l4.l_ldd_dossier_associe = s.l_so_cle
                 and l4.l_ldd_site = s.l_si_cle
                 and l4.c_ldd_genre = 'SO'
                 and (d4.l_si_cle = 30 or d4.l_si_cle = 11)
                 and d4.l_do_cle = i4.l_is_reference
                 and d4.l_si_cle = i4.l_is_ref_site
                 and i4.l_is_cle = sis4.l_is_cle
                 and i4.l_si_cle = sis4.l_si_cle
                 and sis4.l_is_site in (76, 13, 74, 20, 16, 21))
         and nvl(s.i_se_cle, 1) <> d2.i_se_cle;
  END SP_L_SO_SEVERITE_AUTRE;

--Recherche du dernier dossier de client-mystère
PROCEDURE SP_DERNIER_DOSSIER(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                             NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                             rc1 IN OUT DTS_DERNIER_DOSSIER) IS
begin
  OPEN rc1 FOR
SELECT d.i_ca_cle,
       d.v_do_reference1,
       d.v_do_ancienne_reference
  FROM v_do_dossier_ca_ty d,
       ldd_lien_dossier   l,
       so_societe         s
 where d.l_do_cle = l.l_do_cle
   and d.l_si_cle = l.l_do_site
   and l.c_do_genre = 'DO'
   and l.l_ldd_dossier_associe = s.l_so_cle
   and l.l_ldd_site = s.l_si_cle
   and l.c_ldd_genre = 'SO'
   and d.i_ge_entite = 3
   and d.l_si_cle = 25
   and d.i_cc_cle <> 14920
   and s.i_cc_cle <> 14920
   and s.l_so_cle = NEW_L_SO_CLE
   and s.l_si_cle = NEW_L_SI_CLE
   and d.i_st_cle = 359
   and d.d_do_date_debut =
 (select max(d2.d_do_date_debut)
          from do_dossier d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s.l_so_cle
           and l2.l_ldd_site = s.l_si_cle
           and l2.c_ldd_genre = 'SO' and d2.l_si_cle = 25);
END SP_DERNIER_DOSSIER;

PROCEDURE SP_DERNIER_ECHANTILLION(NEW_L_SO_CLE IN SO_SOCIETE.L_SO_CLE%TYPE,
                             NEW_L_SI_CLE IN SO_SOCIETE.L_SI_CLE%TYPE,
                             rc1 IN OUT DTS_DERNIER_ECHANTILLION) IS
begin
  OPEN rc1 FOR
SELECT d.L_DO_CLE,
       d.L_SI_CLE,
       d.v_do_ancienne_reference
  FROM v_do_dossier_ca_ty d,
       ldd_lien_dossier   l,
       so_societe         s
 where d.l_do_cle = l.l_do_cle
   and d.l_si_cle = l.l_do_site
   and l.c_do_genre = 'DO'
   and l.l_ldd_dossier_associe = s.l_so_cle
   and l.l_ldd_site = s.l_si_cle
   and l.c_ldd_genre = 'SO'
   and d.i_ge_entite = 3
   and d.l_si_cle = 25
   and d.i_cc_cle <> 14920
   and s.i_cc_cle <> 14920
   and s.l_so_cle = NEW_L_SO_CLE
   and s.l_si_cle = NEW_L_SI_CLE
   and d.i_st_cle = 359
   and d.i_ca_cle = 662
   and d.d_do_date_debut =
 (select max(d2.d_do_date_debut)
          from do_dossier d2, ldd_lien_dossier l2
         where d2.l_do_cle = l2.l_do_cle
           and d2.l_si_cle = l2.l_do_site
           and l2.c_do_genre = 'DO'
           and l2.l_ldd_dossier_associe = s.l_so_cle
           and l2.l_ldd_site = s.l_si_cle
           and l2.c_ldd_genre = 'SO' and d2.l_si_cle = 25 and d2.i_ca_cle = 662);
END SP_DERNIER_ECHANTILLION;

/**Permet de retrouver les entités qui font un lien entre les deux entités en paramètre
*  Par exemple, un dossier X est lier a une société Y.  
*  Il existe égalemnt une liaison entre le dossier X a un sujet Z.  
*  Ce sujet Z a aussi un lien avec la société Y. (Il y a un triangle de relation)
*  Cette requête retourne, par exemple, la liste de sujet Z à partir du dossier X
*  et de la société Y.
**/
PROCEDURE SP_L_ENTITE_LIAISON(NEW_L_EN1_CLE IN LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
                            NEW_L_EN1_SI_CLE IN LDD_LIEN_DOSSIER.L_DO_SITE%TYPE,
                            NEW_C_EN1_DO_GENRE IN LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
                            NEW_C_EN1_LDD_GENRE IN LDD_LIEN_DOSSIER.C_LDD_GENRE%TYPE,
                            NEW_L_EN2_CLE IN LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
                            NEW_L_EN2_SI_CLE IN LDD_LIEN_DOSSIER.L_DO_SITE%TYPE,
                            NEW_C_EN2_DO_GENRE IN LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
                            NEW_C_EN2_LDD_GENRE IN LDD_LIEN_DOSSIER.C_LDD_GENRE%TYPE,
                            rc1 IN OUT DTS_ENTITE_LIAISON) IS
begin
  -- Il faut gérer le cas de la liasion d'un dossier à un dossiser.
  IF NEW_C_EN1_DO_GENRE = 'DO' AND NEW_C_EN1_LDD_GENRE = 'DO' THEN
     OPEN rc1 FOR                             
      select lddDoDo.l_ldd_dossier_associe, lddDoDo.l_ldd_site, 
      lddDoDo.l_Ldd_Cle, lddDoDo.l_Si_Cle, 'DO', lddDoDo.l_do_cle, lddDoDo.l_do_site,
      lddEcSo.l_Ldd_Cle, lddEcSo.l_Si_Cle, 'DO', lddEcSo.l_do_cle, lddEcSo.l_do_site
      from ldd_lien_dossier lddDoDo, ldd_lien_dossier lddEcSo
      where NEW_L_EN1_CLE = lddDoDo.l_do_cle
         and NEW_L_EN1_SI_CLE = lddDoDo.l_do_site
         and lddDoDo.c_do_genre = 'DO'
         and lddDoDo.l_ldd_dossier_associe = lddEcSo.l_do_cle
         and lddDoDo.l_ldd_site = lddEcSo.l_do_site
         and lddDoDo.c_ldd_genre = 'DO'
         and lddEcSo.c_do_genre = NEW_C_EN2_DO_GENRE
         and lddEcSo.l_ldd_dossier_associe = NEW_L_EN2_CLE
         and lddEcSo.l_ldd_site = NEW_L_EN2_SI_CLE
         and lddEcSo.c_ldd_genre = NEW_C_EN2_LDD_GENRE
      UNION   
      select lddDoDo.l_do_cle, lddDoDo.l_do_site, 
      lddDoDo.l_Ldd_Cle, lddDoDo.l_Si_Cle, 'DO', lddDoDo.l_ldd_dossier_associe, lddDoDo.l_ldd_site,
      lddEcSo.l_Ldd_Cle, lddEcSo.l_Si_Cle, NEW_C_EN2_LDD_GENRE, lddEcSo.l_ldd_dossier_associe, lddEcSo.l_ldd_site      
      from ldd_lien_dossier lddDoDo, ldd_lien_dossier lddEcSo
      where NEW_L_EN1_CLE = lddDoDo.l_ldd_dossier_associe
         and NEW_L_EN1_SI_CLE = lddDoDo.l_ldd_site
         and lddDoDo.c_do_genre = 'DO'
         and lddDoDo.l_do_cle = lddEcSo.l_do_cle
         and lddDoDo.l_do_site = lddEcSo.l_do_site
         and lddDoDo.c_ldd_genre = 'DO'
         and lddEcSo.c_do_genre = NEW_C_EN2_DO_GENRE
         and lddEcSo.l_ldd_dossier_associe = NEW_L_EN2_CLE
         and lddEcSo.l_ldd_site = NEW_L_EN2_SI_CLE
         and lddEcSo.c_ldd_genre = NEW_C_EN2_LDD_GENRE;
  ELSE
    OPEN rc1 FOR                             
      select ldd1.l_ldd_dossier_associe, ldd1.l_ldd_site, 
      ldd1.l_Ldd_Cle, ldd1.l_Si_Cle, ldd1.c_do_genre, ldd1.l_do_cle, ldd1.l_do_site,
      ldd2.l_Ldd_Cle, ldd2.l_Si_Cle, ldd2.c_do_genre, ldd2.l_do_cle, ldd2.l_do_site
      from ldd_lien_dossier ldd1, ldd_lien_dossier ldd2
      where NEW_L_EN1_CLE = ldd1.l_do_cle
         and NEW_L_EN1_SI_CLE = ldd1.l_do_site
         and ldd1.c_do_genre = NEW_C_EN1_DO_GENRE
         and ldd1.l_ldd_dossier_associe = ldd2.l_ldd_dossier_associe
         and ldd1.l_ldd_site = ldd2.l_ldd_site
         and ldd1.c_ldd_genre = NEW_C_EN2_LDD_GENRE
         and NEW_L_EN2_CLE = ldd2.l_do_cle
         and NEW_L_EN2_SI_CLE = ldd2.l_do_site
         and ldd2.c_do_genre = NEW_C_EN1_DO_GENRE
         and ldd2.l_ldd_dossier_associe = ldd1.l_ldd_dossier_associe
         and ldd2.l_ldd_site = ldd1.l_ldd_site
         and ldd2.c_ldd_genre = NEW_C_EN2_LDD_GENRE;
   END IF;
END SP_L_ENTITE_LIAISON;
-- RA0008	Dossier d'échantillon actif: 
-- Dossier de statut actif de catégorie "échantillon" qui possède au moins 
-- une société qui n'a pas encore été visitée.  Cette société n'aura pas 
-- d'autre dossier de type "vente aux mineurs" que le dossier d'échantillon 
-- lui-même pour cette même vague.
PROCEDURE SP_DOSSIER_ECHANTILLON_ACTIF(rc1 IN OUT DTS_DOSSIER_ECHANTILLON_ACTIF) IS
begin
  OPEN rc1 FOR
    SELECT DISTINCT DOECHANTILLON.L_DO_CLE,
                    DOECHANTILLON.L_SI_CLE,
                    DOECHANTILLON.V_DO_ANCIENNE_REFERENCE
      FROM DO_DOSSIER       DOECHANTILLON,
           LDD_LIEN_DOSSIER LDDDOSOECHANTILLON,
           SO_SOCIETE       SO
     WHERE SO.I_CC_CLE <> 14920
       AND DOECHANTILLON.I_CA_CLE = 662
       AND DOECHANTILLON.I_ST_CLE = 359
       AND DOECHANTILLON.I_CC_CLE <> 14920
       AND SO.B_SO_IND_RDD = 'yes'
       AND DOECHANTILLON.L_DO_CLE = LDDDOSOECHANTILLON.L_DO_CLE
       AND DOECHANTILLON.L_SI_CLE = LDDDOSOECHANTILLON.L_DO_SITE
       AND LDDDOSOECHANTILLON.C_DO_GENRE = 'DO'
       AND LDDDOSOECHANTILLON.L_LDD_DOSSIER_ASSOCIE = SO.L_SO_CLE
       AND LDDDOSOECHANTILLON.L_LDD_SITE = SO.L_SI_CLE
       AND LDDDOSOECHANTILLON.C_LDD_GENRE = 'SO'
       -- société avec référence à un dossier mystère 
       AND (SO.L_SO_CLE, SO.L_SI_CLE) NOT IN
           (select ldd2.l_ldd_dossier_associe, ldd2.l_ldd_site
          from ldd_lien_dossier ldd1, ldd_lien_dossier ldd2, do_dossier DO
          where DOECHANTILLON.L_DO_CLE = ldd1.l_do_cle
             and DOECHANTILLON.L_SI_CLE = ldd1.l_do_site
             and ldd1.c_do_genre = 'DO'
             and ldd1.l_ldd_dossier_associe = ldd2.l_ldd_dossier_associe
             and ldd1.l_ldd_site = ldd2.l_ldd_site
             and ldd1.c_ldd_genre = 'SO'
             and DO.L_DO_CLE = ldd2.l_do_cle
             and DO.L_SI_CLE = ldd2.l_do_site
             and ldd2.c_do_genre = 'DO'
             and ldd2.l_ldd_dossier_associe = ldd1.l_ldd_dossier_associe
             and ldd2.l_ldd_site = ldd1.l_ldd_site
             and ldd2.c_ldd_genre = 'SO'
             AND DO.I_CC_CLE <> 14920
             AND DO.I_CA_CLE IN (653,
                                 654,
                                 655,
                                 656,
                                 657,
                                 23667,
                                 23668,
                                 23669,
                                 23670,
                                 23735,
                                 24863));
END SP_DOSSIER_ECHANTILLON_ACTIF;

procedure SP_L_LIAISON(NEW_L_DO_CLE               IN LDD_LIEN_DOSSIER.L_DO_CLE%TYPE,
                       NEW_L_DO_SITE              IN LDD_LIEN_DOSSIER.L_DO_SITE%TYPE,
                       NEW_C_DO_GENRE             IN LDD_LIEN_DOSSIER.C_DO_GENRE%TYPE,
                       NEW_L_LDD_DOSSIER_ASSOCIE  IN LDD_LIEN_DOSSIER.L_LDD_DOSSIER_ASSOCIE%TYPE,
                       NEW_L_LDD_SITE             IN LDD_LIEN_DOSSIER.L_LDD_SITE%TYPE,
                       NEW_C_LDD_GENRE            IN LDD_LIEN_DOSSIER.c_Ldd_Genre%TYPE,
                       rc1 IN OUT DTS_LIAISON) IS
begin
    IF NEW_C_DO_GENRE = NEW_C_LDD_GENRE THEN
     OPEN rc1 FOR      
       select ldd.l_ldd_cle, ldd.l_si_cle, ldd.i_ro_cle
        from ldd_lien_dossier ldd
        where NEW_L_DO_CLE = ldd.l_do_cle
           and NEW_L_DO_SITE = ldd.l_do_site
           and ldd.c_do_genre = NEW_C_DO_GENRE
           and ldd.l_ldd_dossier_associe = NEW_L_LDD_DOSSIER_ASSOCIE
           and ldd.l_ldd_site = NEW_L_LDD_SITE
           and ldd.c_ldd_genre = NEW_C_LDD_GENRE
       UNION
       select ldd.l_ldd_cle, ldd.l_si_cle, ldd.i_ro_cle
        from ldd_lien_dossier ldd
        where NEW_L_LDD_DOSSIER_ASSOCIE = ldd.l_do_cle
           and NEW_L_LDD_SITE = ldd.l_do_site
           and ldd.c_do_genre = NEW_C_LDD_GENRE
           and ldd.l_ldd_dossier_associe = NEW_L_DO_CLE
           and ldd.l_ldd_site = NEW_L_DO_SITE
           and ldd.c_ldd_genre = NEW_C_DO_GENRE;
    ELSE
     OPEN rc1 FOR                             
      select ldd.l_ldd_cle, ldd.l_si_cle, ldd.i_ro_cle
      from ldd_lien_dossier ldd
      where NEW_L_DO_CLE = ldd.l_do_cle
         and NEW_L_DO_SITE = ldd.l_do_site
         and ldd.c_do_genre = NEW_C_DO_GENRE
         and ldd.l_ldd_dossier_associe = NEW_L_LDD_DOSSIER_ASSOCIE
         and ldd.l_ldd_site = NEW_L_LDD_SITE
         and ldd.c_ldd_genre = NEW_C_LDD_GENRE;
    END IF;
END SP_L_LIAISON;

-- Retourne tous les dossiers de sujets d'intéret actif
-- Il peut y en avoir plusieurs pour un même sujet
procedure SP_L_SU_SI_GALERIE_ACTIF(rc1 IN OUT DTS_SU_GALERIE_ANCIENNE_REF) IS
begin
OPEN rc1 FOR  
  select su.l_su_cle, su.l_si_cle, do.l_do_cle, do.l_si_cle, do.i_na_cle, do.v_do_ancienne_reference
  from cardex.v_do_dossier_ca_ty do,
       cardex.ldd_lien_dossier   ldd,
       cardex.su_sujet           su
 where do.i_ge_cle = 415
   and do.l_do_cle = ldd.l_do_cle
   and do.l_si_cle = ldd.l_do_site
   and ldd.c_do_genre = 'DO'
   and ldd.l_ldd_dossier_associe = su.l_su_cle
   and ldd.l_ldd_site = su.l_si_cle
   and ldd.c_ldd_genre = 'SU'
   and do.i_st_cle = 359;
END SP_L_SU_SI_GALERIE_ACTIF;

-- Retourne les dossiers inactifs de sujets d'intéret un dossier inactif par nature
procedure SP_L_SU_SI_GALERIE_INACTIF(rc1 IN OUT DTS_SU_GALERIE_ANCIENNE_REF) IS
begin
OPEN rc1 FOR  
 select su.l_su_cle, su.l_si_cle, do.l_do_cle, do.l_si_cle, do.i_na_cle, do.v_do_ancienne_reference
   from cardex.v_do_dossier_ca_ty do,
        cardex.ldd_lien_dossier   ldd,
        cardex.su_sujet           su
  where do.i_ge_cle = 415
    and do.l_do_cle = ldd.l_do_cle
    and do.l_si_cle = ldd.l_do_site
    and ldd.c_do_genre = 'DO'
    and ldd.l_ldd_dossier_associe = su.l_su_cle
    and ldd.l_ldd_site = su.l_si_cle
    and ldd.c_ldd_genre = 'SU'
    and do.i_st_cle = 361
    and do.d_do_date_creation =
        (select max(maxdo.d_do_date_creation)
           from cardex.v_do_dossier_ca_ty maxdo,
                cardex.ldd_lien_dossier   maxldd
          where maxdo.i_na_cle = do.i_na_cle
            and maxdo.l_do_cle = maxldd.l_do_cle
            and maxdo.l_si_cle = maxldd.l_do_site
            and maxldd.c_do_genre = 'DO'
            and maxldd.l_ldd_dossier_associe = su.l_su_cle
            and maxldd.l_ldd_site = su.l_si_cle
            and maxldd.c_ldd_genre = 'SU'
            and do.i_st_cle = 361);
END SP_L_SU_SI_GALERIE_INACTIF;

END Cardex_Lire_Doc;
/
